(function(g){g.fn.colorPicker=function(){if(this.length>0){c()}return this.each(function(m){j(this)})};var h;var k=false;var j=function(m){g(m).bind("click",b)};var c=function(){var m=['<div id="color_selector">'];g.each(g.fn.colorPicker.defaultColors,function(o){m.push('<div class="color_block clearfix">');g.each(this,function(p){m.push('<a href="#" class="color_swatch" style="background-color:#',this,';">','<span class="inner">&nbsp;</span>',"</a>")});m.push("</div>")});m.push('<div id="color_custom">','<label for="color_value">Hex</label>','<input type="text" size="8" id="color_value"/>',"</div>");m.push("</div>");var n=g(m.join(""));n.find("input#color_value").bind("keyup",function(o){if(o.keyCode==13){a(g(this).val())}if(o.keyCode==27){b()}});n.delegate(".color_swatch","click",function(o){o.preventDefault();a(g(this).css("background-color"))}).delegate(".color_swatch","mouseover",function(o){g(this).addClass("hover");n.find("input#color_value").val(d(g(this).css("background-color")))}).delegate(".color_swatch","mouseout",function(o){g(this).removeClass("hover");n.find("input#color_value").val(d(g(h).data("colorpicker-color")))});g("body").append(n);n.hide()};var f=function(n){var m="div#color_selector";var o=g(n.target).parents(m).length;if(n.target==g(m)[0]||n.target==h||o>0){return}e()};var e=function(){var m=g("div#color_selector");g(document).unbind("mousedown",f);m.hide();k=false};var l=function(){var m=g("div#color_selector");var n=g(h);var p=n.offset().top+n.outerHeight();var o=n.offset().left;if(p+m.outerHeight()>g(window).height()-30){p-=n.outerHeight()+m.outerHeight()}if(o+m.outerWidth()>g(window).width()-30){o-=m.outerWidth()-n.outerWidth()}m.css({top:p,left:o});hexColor=d(g(h).data("colorpicker-color"));g("input#color_value").val(hexColor);g(".color_swatch").removeClass("selected").each(function(q,r){if(d(g(r).css("background-color"))==hexColor){g(r).addClass("selected")}});m.show();g(document).bind("mousedown",f);k=true};var b=function(m){m.preventDefault();h=this;k?e():l()};var a=function(m){if(selectedValue=d(m)){g(h).data("colorpicker-color",selectedValue);g(h).trigger("color_change",[selectedValue]);e()}};var d=function(n){if(n.match(/[0-9a-fA-F]{3}$/)||n.match(/[0-9a-fA-F]{6}$/)){n=(n.charAt(0)=="#")?n:("#"+n)}else{if(n.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var s=([parseInt(RegExp.$1),parseInt(RegExp.$2),parseInt(RegExp.$3)]);var q=function(u){if(u.length<2){for(var t=0,r=2-u.length;t<r;t++){u="0"+u}}return u};if(s.length==3){var p=q(s[0].toString(16)),o=q(s[1].toString(16)),m=q(s[2].toString(16));n="#"+p+o+m}}else{n=false}}return n};g.fn.colorPicker.addColors=function(m){g.fn.colorPicker.defaultColors=g.fn.colorPicker.defaultColors.concat(m)};g.fn.colorPicker.defaultColors=[["000000","333333","666666","999999","cccccc","eeeeee","f3f3f3","ffffff"],["ff0000","ff9900","ffff00","00ff00","00ffff","0000ff","9900ff","ff00ff"],["f4cccc","fce5cd","fff2cc","d9ead3","d0e0e3","cfe2f3","d9d2e9","ead1dc","ea9999","f9cb9c","ffe599","b6d7a8","a2c4c9","9fc5e8","b4a7d6","d5a6bd","e06666","f6b26b","ffd966","93c47d","76a5af","6fa8dc","8e7cc3","c27ba0","cc0000","e69138","f1c232","6aa84f","45818e","3d85c6","674ea7","a64d79","990000","b45f06","bf9000","38761d","134f5c","0b5394","351c75","741b47","660000","783f04","7f6000","274e13","0c343d","073763","20124d","4c1130"]]})(jQuery);(function(d){var e=0;d.fn.awesomecomplete=function(l){var l=d.extend({},d.fn.awesomecomplete.defaults,l);return this.each(function(){var t=d(this);var p=d.meta?d.extend({},l,t.data()):l;t.data("awesomecomplete-config",p);var n=d(p.attachTo||t);width=n.innerWidth();if(width===0){width="100%"}var o=d("<ul/>").addClass(p.suggestionListClass).insertAfter(n).hide().css("width",width);t.data("awesomecomplete-list",o);var s;var q=false;t.keyup(function(u){if(q){q=false;return}if(((u.which>36)&&(u.which<41))||(u.which==16)){return}if(p.typingDelay>0){clearTimeout(s);s=setTimeout(function(){h(t)},p.typingDelay)}else{h(t)}});t.keydown(function(w){var u=o.children("li."+p.activeItemClass);switch(w.which){case 13:if((u.length!==0)&&(o.is(":visible"))){w.preventDefault();t.val(u.data("awesomecomplete-value"));p.onComplete(u.data("awesomecomplete-dataItem"),t);o.hide()}p.blurFunction(o);o.hide();q=true;break;case 38:w.preventDefault();var v;if(u.length===0){v=o.children("li:last-child")}else{if(u.is(":not(:first-of-type")){v=u.prev();u.removeClass(p.activeItemClass)}else{v=o.children("li:last-child");u.removeClass(p.activeItemClass)}}while(p.skipBlankValues&&v.length>0&&d.isBlank(v.data("awesomecomplete-value"))){v=v.prev()}v.addClass(p.activeItemClass);break;case 40:w.preventDefault();var v;if(u.length===0){v=o.children("li:first")}else{if(u.is(":not(:last-child)")){v=u.next();u.removeClass(p.activeItemClass)}else{v=o.children("li:first");u.removeClass(p.activeItemClass)}}if(!d.isBlank(v)){while(p.skipBlankValues&&v.length>0&&d.isBlank(v.data("awesomecomplete-value"))){v=v.next()}v.addClass(p.activeItemClass)}break;case 27:p.blurFunction(o);o.hide();q=true;break}});t.keypress(function(v){var u=o.children("li."+p.activeItemClass);if((v.which==13)&&(o.children("li."+p.activeItemClass).length>0)){v.preventDefault()}});var m=false;var r=false;d(document).bind("mousedown.awesomecomplete"+(++e),function(){m=true});d(document).bind("mouseup.awesomecomplete"+e,function(){m=false;if(r){r=false;p.blurFunction(o);o.hide()}});t.blur(function(){if(m){r=true}else{var u=o.children("li."+p.activeItemClass);if(o.is(":visible")&&(u.length!==0)){t.val(u.data("awesomecomplete-value"));p.onComplete(u.data("awesomecomplete-dataItem"),t)}p.blurFunction(o);o.hide()}});t.focus(function(){if(o.children(":not(."+p.noResultsClass+")").length>0){if(p.initDelay>0){setTimeout(function(){b(t)},p.initDelay)}else{b(t)}}else{if(p.showAll){h(t)}}})})};var a=function(m,l){return function(n){g(m,n,l)}};var h=function(m){var l=m.val();if(typeof m.data("awesomecomplete-config").dataMethod==="function"){m.data("awesomecomplete-config").dataMethod(l,m,a(m,l))}else{g(m,m.data("awesomecomplete-config").staticData,l)}};var k=function(l){if(typeof l!=="string"){return l}return l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var g=function(w,K,z){var I=w.data("awesomecomplete-config");var m=w.data("awesomecomplete-list");m.empty().hide();if(!I.showAll&&z===""){return}if(I.showAwesomeTip){m.append(d('<div class="awesome-tip"></div>'))}var x=[z];if(I.splitTerm){x=z.split(I.wordDelimiter)}if(I.headerText.length>0){var C=(x.length>1||x[0]!="")?1:0;m.append(d('<h2 class="awesome-header">'+I.headerText[C]+"</h2>"))}var A=[];for(var G=0;G<K.length;G++){var y=jQuery.extend({},K[G]);var q=0;if(I.showAll&&z===""){q++}var r=0;var s=null;var F=[];for(var p in y){if((typeof y[p]==="function")||(typeof y[p]==="object")){continue}var n=false;for(var D=0;D<I.dontMatch.length;D++){if(p==I.dontMatch[D]){n=true}}if(n){continue}var u=y[p].toString();var l=[];for(var D=0;D<x.length;D++){if(x[D]===""){continue}var H=x[D].replace(/([\\*+?|{}()^$.#])/g,"\\$1");var t=new RegExp("("+H+")",(I.ignoreCase?"ig":"g"));l.push(H);var o=[];if(o=u.match(t)){q+=o.length;if((p!=I.nameField)&&(o.length>r)){r=o.length;s=p;F[l.length-1]=true}}}if(I.highlightMatches){var t=new RegExp("("+l.join("|")+")",(I.ignoreCase?"ig":"g"));var v=u.split(t);for(var E=0;E<v.length;E++){v[E]=k(v[E]);if(E%2){v[E]='<span class="'+I.highlightClass+'">'+v[E]+"</span>"}}y[p]=v.join("")}else{y[p]=k(u)}}var J=0;for(var D=0;D<F.length;D++){if(F[D]===true){J++}}if(q>0){A.push({dataItem:y,originalDataItem:K[G],matchCount:q,topMatch:s,matchedTermCount:J})}}A.sort(function(M,L){return I.sortFunction(M,L,z)});A=A.slice(0,I.resultLimit);for(var E in A){var B=(I.hoverDefaultFirstItem&&E===0)?I.activeItemClass:"";if(A[E] instanceof Function){continue}d('<li class="'+B+'">'+I.renderFunction(A[E].dataItem,A[E].topMatch,I)+"</li>").data("awesomecomplete-dataItem",A[E].originalDataItem).data("awesomecomplete-value",I.valueFunction(A[E].originalDataItem,I)).appendTo(m).click(function(){var M=d(this);var L=M.data("awesomecomplete-value");if(I.skipBlankValues&&d.isBlank(L)){return}w.val(L);I.onComplete(M.data("awesomecomplete-dataItem"),w);I.blurFunction(m);m.hide();suppressKey=true}).mouseup(function(L){if(I.skipBlankValues&&d.isBlank(d(this).data("awesomecomplete-value"))){L.stopPropagation()}}).mouseover(function(){if(I.skipBlankValues&&d.isBlank(d(this).data("awesomecomplete-value"))){return}d(this).addClass(I.activeItemClass).siblings().removeClass(I.activeItemClass)})}if((I.noResultsMessage!==undefined)&&(A.length==0)){m.append(d('<li class="'+I.noResultsClass+'">'+I.noResultsMessage+"</li>"))}if((A.length>0)||(I.noResultsMessage!==undefined)){if(I.initDelay>0){setTimeout(function(){b(w)},I.initDelay)}else{b(w)}}};var b=function(o){var n=o.data("awesomecomplete-list");var m=o.data("awesomecomplete-config");m.showFunction(n);n.fadeIn(m.fadeInTime);if(m.forcePosition){if(m.alignRight){var l=m.alignRight===true?o:m.alignRight;n.css("left",l.position().left+(l.offsetParent().offset().left-n.offsetParent().offset().left)-n.outerWidth(true)+l.outerWidth(true))}else{n.css("left",o.position().left+(o.offsetParent().offset().left-n.offsetParent().offset().left))}n.css("top",o.position().top+o.outerHeight(true)+(o.offsetParent().offset().top-n.offsetParent().offset().top))}};var f=function(m,n,l){if((n===l.nameField)||(n===null)){return'<p class="title">'+m[l.nameField]+"</p>"}else{return'<p class="title">'+m[l.nameField]+'</p><p class="matchRow"><span class="matchedField">'+n+"</span>: "+m[n]+"</p>"}};var j=function(m,l){return m[l.nameField]};var c=function(m,l,n){return(m.matchedTermCount==l.matchedTermCount)?(l.matchCount-m.matchCount):(l.matchedTermCount-m.matchedTermCount)};d.fn.awesomecomplete.defaults={activeItemClass:"active",alignRight:false,attachTo:undefined,blurFunction:function(l){},dataMethod:undefined,dontMatch:[],forcePosition:false,highlightMatches:true,highlightClass:"match",ignoreCase:true,nameField:"name",noResultsClass:"noResults",noResultsMessage:undefined,onComplete:function(l,m){},showFunction:function(l){},sortFunction:c,splitTerm:true,staticData:[],suggestionListClass:"autocomplete",renderFunction:f,resultLimit:10,showAll:false,skipBlankValues:false,typingDelay:0,initDelay:0,fadeInTime:0,valueFunction:j,wordDelimiter:/[^\da-z]+/ig,showAwesomeTip:false,hoverDefaultFirstItem:false,headerText:[]}})(jQuery);(function(b){var c=function(d){return(d.css("overflow-y")=="auto")||(d.css("overflow-y")=="scroll")};var a=function(d,e){return parseInt(d.css("border-"+e+"-width"))};b.fn.awesomereorder=function(d){d=b.extend(true,{},b.fn.awesomereorder.defaults,d);return this.each(function(){var u=b(this),g=b.meta?b.extend({},d,u.data()):d,f=u.children(g.listItemSelector),t=(g.directionType=="auto")?((f.css("display")=="block")||(f.css("display")=="list-item")?"v":"h"):g.directionType,e,s,h,r,z=false,A,o,y,j;if(g.uiDraggableDefaults!==undefined){var p=["start","drag","stop"];for(var x in p){if(g.uiDraggableDefaults[p[x]]!==undefined){g[p[x]]=g.uiDraggableDefaults[p[x]];delete g.uiDraggableDefaults[p[x]]}}}var l=function(){return b("<div></div>").data("awesomereorder-placeholder",true).width(o).height(y)};var k=function(B,C){j.stop().slideUp("fast",function(){b(this).remove()});j=l();B[C](j);j.hide().slideDown("fast")};var w=function(B){if(!z){clearInterval(h);h=setInterval(B,10);z=true}};var v=function(B){if(r===undefined){return}var E=r.offset();var C=a(r,"top");var D=a(r,"bottom");if(B.top<(E.top+g.scrollMargin)){A=g.scrollSpeed*Math.min(Math.pow((E.top+g.scrollMargin+C-B.top)/g.scrollMargin,g.scrollCurve),1);w(function(){r.scrollTop(r.scrollTop()-A);m(s)})}else{if((B.top-C+y)>(E.top+r.outerHeight(false)-D-g.scrollMargin)){A=g.scrollSpeed*Math.min(Math.pow((B.top+y-C-(E.top+r.outerHeight(false)-D-g.scrollMargin))/g.scrollMargin,g.scrollCurve),1);w(function(){r.scrollTop(r.scrollTop()+A);m(s)})}else{z=false;clearInterval(h)}}};var m=function(B){var D=u.offset();var C=D.top+parseInt(u.css("margin-top"))-u.scrollTop();var F;if(s===undefined){F=0}else{F=B.top-s.top}var E=false;u.children(b(g.listItemSelector)).each(function(){var H=b(this);if(!H.is(":visible")){return}if(H.data("awesomereorder-placeholder")){C+=H.outerHeight(true);return}var G=H.outerHeight(true)*g.activeRange;if((F<=0)&&(B.top<(C+G))){if(!H.prev().data("awesomereorder-placeholder")){k(H,"before")}E=true;return false}C+=H.outerHeight(true);var I=B.top+e.outerHeight();if((F>=0)&&(I>(C-G))&&(I<(C+G))){if(!H.next().data("awesomereorder-placeholder")){k(H,"after")}E=true;return false}if(I<C){E=true;return false}});if(!E&&!u.children(":last-child").data("awesomereorder-placeholder")){k(u.children(g.listItemSelector).last(),"after")}};var n=function(B){j.after(e.show()).remove();e.trigger("awesomereorder-dropped")};var q=function(B){B.draggable(b.extend({},{addClass:false,axis:(t=="v")?"y":undefined,helper:"clone",scroll:false,start:function(C,D){r=undefined;if(c(u)){r=u}else{u.parents().each(function(){var E=b(this);if(c(E)){r=E;return false}})}e=b(this);D.helper.width(e.width());o=e.outerWidth(true);y=e.outerHeight(true);j=l();e.after(j);e.hide();if(typeof g.start=="function"){g.start(C,D)}},drag:function(C,E){var D={left:E.offset.left,top:E.offset.top};v(D);m(D);s=D;if(typeof g.drag=="function"){g.drag(C,E)}},stop:function(C,D){z=false;clearInterval(h);n(D.helper);if(typeof g.stop=="function"){g.stop(C,D)}}},g.uiDraggableDefaults))};q(f);u.bind("awesomereorder-listupdated",function(){f=u.children(g.listItemSelector);q(f.filter(":not(.ui-draggable)"))})})};b.fn.awesomereorder.defaults={activeRange:0.3,directionType:"auto",drag:null,handleSelector:".",listItemSelector:"li",scrollCurve:3,scrollMargin:40,scrollSpeed:25,start:null,stop:null,uiDraggableDefaults:{containment:"parent",distance:5,opacity:0.8}}})(jQuery);(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssSortGroupSelector:"tbody tr:not(.sortGroup)",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:".",debug:false,headerNode:null};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms")}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s)}else{alert(s)}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug=""}var rows=$(table).find(table.config.cssSortGroupSelector);if(rows.length>0){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter)}else{if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter)}}if(!p){p=detectParserForColumn(table,cells[i])}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n"}list.push(p)}}if(table.config.debug){log(parsersDebug)}return list}function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($.trim(getElementText(table.config,node)),table,node)){return parsers[i]}}return parsers[0]}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i]}}return false}function buildCache(table){if(table.config.debug){var cacheTime=new Date()}var $rows=$(table).find(table.config.cssSortGroupSelector);var totalRows=$rows.length||0;var totalCells=($rows[0]&&$rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$rows[i],cols=[];cache.row.push($(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]))}cols.push(i);cache.normalized.push(cols);cols=null}if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime)}return cache}function getElementText(config,node){if(!node){return""}var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML}else{t=node.innerHTML}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node)}else{t=$(node).text()}}return t}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j])}}}if(table.config.appender){table.config.appender(table,rows)}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime)}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd")},0)}function buildHeaders(table){if(table.config.debug){var time=new Date()}var meta=($.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<$("tr",table.config.headerNode).length;i++){tableHeadersRows[i]=0}var $tableHeaders=$("th",table.config.headerNode);$tableHeaders.each(function(index){this.column=index;this.count=this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index)){this.sortDisabled=true}if(!this.sortDisabled){$(this).addClass(table.config.cssHeader).prop("tabIndex",0).attr("role","button")}table.config.headerList[index]=this});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders)}return $tableHeaders}function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true}return false}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true}return false}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table)}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i]}}}function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0}else{i=(v==(0||1))?v:0}return i}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true}}return false}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this)}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]])}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$("<colgroup>");$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($("<col>").css("width",$(this).width()))});$(table).prepend(colgroup)}}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date()}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { "}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; "}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime)}return cache}function sortText(a,b){if(a===""&&b!==""){return 1}else{if(b===""&&a!==""){return -1}}return((a<b)?-1:((a>b)?1:0))}function sortTextDesc(a,b){if(a===""&&b!==""){return -1}else{if(b===""&&a!==""){return 1}}return((b<a)?-1:((b>a)?1:0))}function sortNumeric(a,b){return a-b}function sortNumericDesc(a,b){return b-a}function getCachedSortType(parsers,i){return parsers[i].type}this.construct=function(settings){return this.each(function(){if(!this.tBodies){return}var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);if(!config.headerNode){if(!this.tHead){return}config.headerNode=this.tHead}$this=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.on("keypress click",function(e){if(e.type==="keypress"&&e.which!==13){return true}$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j])}}}config.sortList.push([i,this.order])}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2}}}else{config.sortList.push([i,this.order])}}setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache))},1);return false}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this)}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache))}).bind("appendCache",function(){appendToTable(this,cache)}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this)}).bind("applyWidgets",function(){applyWidget(this)});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList])}applyWidget(this)})};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false}}if(a){parsers.push(parser)}};this.addWidget=function(widget){widgets.push(widget)};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i};this.isDigit=function(s,config){var DECIMAL="\\"+config.decimal;var exp="/(^[+]?0("+DECIMAL+"0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)"+DECIMAL+"(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*"+DECIMAL+"0+$)/";return RegExp(exp).test($.trim(s))};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild){this.removeChild(this.firstChild)}}empty.apply(table.tBodies[0])}else{table.tBodies[0].innerHTML=""}}}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true},format:function(s){return $.trim(s.toLowerCase())},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c)},format:function(s){return $.tablesorter.formatFloat(s)},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[£$€?.]/.test(s)},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""))},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s)},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item}else{r+=item}}return $.tablesorter.formatFloat(r)},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s)},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),""))},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s)},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0")},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s))},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""))},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2})( (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM))))?$/))},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return(/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/).test(s)},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2")}else{if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1")}else{if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3")}}}return $.tablesorter.formatFloat(new Date(s).getTime())},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s)},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime())},type:"numeric"});ts.addParser({id:"autoDateTime",is:function(s){return !isNaN((new Date(s)).getTime())},format:function(s){return $.tablesorter.formatFloat((new Date(s)).getTime())}});ts.addParser({id:"metadata",is:function(s){return false},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?"sortValue":c.parserMetadataName;return $(cell).metadata()[p]},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date()}$("tr:visible",table.tBodies[0]).filter(":even").removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(":odd").removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time)}}})})(jQuery);(function(){function m(q,o){var r=this,p;r.element=typeof q=="object"?q:document.getElementById(q);r.wrapper=r.element.parentNode;r.element.style.webkitTransitionProperty="-webkit-transform";r.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";r.element.style.webkitTransitionDuration="0";r.element.style.webkitTransform=k+"0,0"+b;r.options={bounce:f,momentum:f,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:f,vScrollbar:f,fadeScrollbar:c||d||!a,shrinkScrollbar:c||d,desktopCompatibility:false,overflow:"auto",snap:false};if(typeof o=="object"){for(p in o){r.options[p]=o[p]}}if(r.options.desktopCompatibility){r.options.overflow="hidden"}r.wrapper.style.overflow=r.options.overflow;r.refresh();window.addEventListener("onorientationchange" in window?"orientationchange":"resize",r,false);if(a||r.options.desktopCompatibility){r.element.addEventListener(h,r,false);r.element.addEventListener(l,r,false);r.element.addEventListener(g,r,false)}if(r.options.checkDOMChanges){r.element.addEventListener("DOMSubtreeModified",r,false)}if(!a){r.element.addEventListener("click",r,true)}}m.prototype={x:0,y:0,dist:0,handleEvent:function(p){var o=this;switch(p.type){case"click":if(!p._fake){p.stopPropagation()}break;case h:o.touchStart(p);break;case l:o.touchMove(p);break;case g:o.touchEnd(p);break;case"webkitTransitionEnd":o.transitionEnd();break;case"orientationchange":case"resize":o.refresh();break;case"DOMSubtreeModified":o.onDOMModified();break}},onDOMModified:function(){var o=this;o.refresh();if(o.options.topOnDOMChanges&&(o.x!=0||o.y!=0)){o.scrollTo(0,0,"0")}},refresh:function(){var p=this,r=this.x,q=this.y,o;p.scrollWidth=p.wrapper.clientWidth;p.scrollHeight=p.wrapper.clientHeight;p.scrollerWidth=p.element.offsetWidth;p.scrollerHeight=p.element.offsetHeight;p.maxScrollX=p.scrollWidth-p.scrollerWidth;p.maxScrollY=p.scrollHeight-p.scrollerHeight;p.directionX=0;p.directionY=0;if(p.scrollX){if(p.maxScrollX>=0){r=0}else{if(p.x<p.maxScrollX){r=p.maxScrollX}}}if(p.scrollY){if(p.maxScrollY>=0){q=0}else{if(p.y<p.maxScrollY){q=p.maxScrollY}}}if(p.options.snap){p.maxPageX=-Math.floor(p.maxScrollX/p.scrollWidth);p.maxPageY=-Math.floor(p.maxScrollY/p.scrollHeight);o=p.snap(r,q);r=o.x;q=o.y}if(r!=p.x||q!=p.y){p.setTransitionTime("0");p.setPosition(r,q,true)}p.scrollX=p.scrollerWidth>p.scrollWidth;p.scrollY=!p.scrollX||p.scrollerHeight>p.scrollHeight;if(p.options.hScrollbar&&p.scrollX){p.scrollBarX=p.scrollBarX||new n("horizontal",p.wrapper,p.options.fadeScrollbar,p.options.shrinkScrollbar);p.scrollBarX.init(p.scrollWidth,p.scrollerWidth)}else{if(p.scrollBarX){p.scrollBarX=p.scrollBarX.remove()}}if(p.options.vScrollbar&&p.scrollY&&p.scrollerHeight>p.scrollHeight){p.scrollBarY=p.scrollBarY||new n("vertical",p.wrapper,p.options.fadeScrollbar,p.options.shrinkScrollbar);p.scrollBarY.init(p.scrollHeight,p.scrollerHeight)}else{if(p.scrollBarY){p.scrollBarY=p.scrollBarY.remove()}}},setPosition:function(o,r,q){var p=this;p.x=o;p.y=r;p.element.style.webkitTransform=k+p.x+"px,"+p.y+"px"+b;if(!q){if(p.scrollBarX){p.scrollBarX.setPosition(p.x)}if(p.scrollBarY){p.scrollBarY.setPosition(p.y)}}},setTransitionTime:function(p){var o=this;p=p||"0";o.element.style.webkitTransitionDuration=p;if(o.scrollBarX){o.scrollBarX.bar.style.webkitTransitionDuration=p;o.scrollBarX.wrapper.style.webkitTransitionDuration=f&&o.options.fadeScrollbar?"300ms":"0"}if(o.scrollBarY){o.scrollBarY.bar.style.webkitTransitionDuration=p;o.scrollBarY.wrapper.style.webkitTransitionDuration=f&&o.options.fadeScrollbar?"300ms":"0"}},touchStart:function(q){var p=this,o;p.scrolling=true;q.preventDefault();q.stopPropagation();p.moved=false;p.dist=0;p.setTransitionTime("0");if(p.options.momentum||p.options.snap){o=new WebKitCSSMatrix(window.getComputedStyle(p.element).webkitTransform);if(o.e!=p.x||o.f!=p.y){document.removeEventListener("webkitTransitionEnd",p,false);p.setPosition(o.e,o.f);p.moved=true}}p.touchStartX=a?q.changedTouches[0].pageX:q.pageX;p.scrollStartX=p.x;p.touchStartY=a?q.changedTouches[0].pageY:q.pageY;p.scrollStartY=p.y;p.scrollStartTime=q.timeStamp;p.directionX=0;p.directionY=0},touchMove:function(u){var s=this,r=a?u.changedTouches[0].pageX:u.pageX,q=a?u.changedTouches[0].pageY:u.pageY,p=s.scrollX?r-s.touchStartX:0,o=s.scrollY?q-s.touchStartY:0,v=s.x+p,t=s.y+o;if(!s.scrolling){return}s.dist+=Math.abs(s.touchStartX-r)+Math.abs(s.touchStartY-q);s.touchStartX=r;s.touchStartY=q;if(v>0||v<s.maxScrollX){v=s.options.bounce?Math.round(s.x+p/3):v>=0?0:s.maxScrollX}if(t>0||t<s.maxScrollY){t=s.options.bounce?Math.round(s.y+o/3):t>=0?0:s.maxScrollY}if(s.dist>5){s.setPosition(v,t);s.moved=true;s.directionX=p>0?-1:1;s.directionY=o>0?-1:1}},touchEnd:function(w){var v=this,r=w.timeStamp-v.scrollStartTime,x,y,p,o,q=0,u=v.x,t=v.y,s;if(!v.scrolling){return}v.scrolling=false;if(!v.moved){v.resetPosition();x=a?w.changedTouches[0].target:w.target;while(x.nodeType!=1){x=x.parentNode}y=document.createEvent("Event");y.initEvent("focus",true,true);x.dispatchEvent(y);y=document.createEvent("MouseEvents");y.initMouseEvent("click",true,true,w.view,1,x.screenX,x.screenY,x.clientX,x.clientY,w.ctrlKey,w.altKey,w.shiftKey,w.metaKey,0,null);y._fake=true;x.dispatchEvent(y);return}if(!v.options.snap&&r>250){v.resetPosition();return}if(v.options.momentum){p=v.scrollX===true?v.momentum(v.x-v.scrollStartX,r,v.options.bounce?-v.x+v.scrollWidth/5:-v.x,v.options.bounce?v.x+v.scrollerWidth-v.scrollWidth+v.scrollWidth/5:v.x+v.scrollerWidth-v.scrollWidth):{dist:0,time:0};o=v.scrollY===true?v.momentum(v.y-v.scrollStartY,r,v.options.bounce?-v.y+v.scrollHeight/5:-v.y,v.options.bounce?(v.maxScrollY<0?v.y+v.scrollerHeight-v.scrollHeight:0)+v.scrollHeight/5:v.y+v.scrollerHeight-v.scrollHeight):{dist:0,time:0};q=Math.max(Math.max(p.time,o.time),1);u=v.x+p.dist;t=v.y+o.dist}if(v.options.snap){s=v.snap(u,t);u=s.x;t=s.y;q=Math.max(s.time,q)}v.scrollTo(u,t,q+"ms")},transitionEnd:function(){var o=this;document.removeEventListener("webkitTransitionEnd",o,false);o.resetPosition()},resetPosition:function(q){var o=this,r=o.x,p=o.y;if(o.x>=0){r=0}else{if(o.x<o.maxScrollX){r=o.maxScrollX}}if(o.y>=0||o.maxScrollY>0){p=0}else{if(o.y<o.maxScrollY){p=o.maxScrollY}}if(r!=o.x||p!=o.y){o.scrollTo(r,p,q)}else{o.onScrollEnd();if(o.scrollBarX){o.scrollBarX.hide()}if(o.scrollBarY){o.scrollBarY.hide()}}},snap:function(o,r){var p=this,q;if(p.directionX>0){o=Math.floor(o/p.scrollWidth)}else{if(p.directionX<0){o=Math.ceil(o/p.scrollWidth)}else{o=Math.round(o/p.scrollWidth)}}p.pageX=-o;o=o*p.scrollWidth;if(o>0){o=p.pageX=0}else{if(o<p.maxScrollX){p.pageX=p.maxPageX;o=p.maxScrollX}}if(p.directionY>0){r=Math.floor(r/p.scrollHeight)}else{if(p.directionY<0){r=Math.ceil(r/p.scrollHeight)}else{r=Math.round(r/p.scrollHeight)}}p.pageY=-r;r=r*p.scrollHeight;if(r>0){r=p.pageY=0}else{if(r<p.maxScrollY){p.pageY=p.maxPageY;r=p.maxScrollY}}q=Math.round(Math.max(Math.abs(p.x-o)/p.scrollWidth*500,Math.abs(p.y-r)/p.scrollHeight*500));return{x:o,y:r,time:q}},scrollTo:function(p,o,r){var q=this;if(q.x==p&&q.y==o){q.onScrollEnd();return}q.setTransitionTime(r||"400ms");q.setPosition(p,o);if(r==="0"||r=="0s"||r=="0ms"){q.resetPosition();q.onScrollEnd()}else{document.addEventListener("webkitTransitionEnd",q,false)}},scrollToPage:function(q,p,s){var r=this,o;if(!r.options.snap){r.pageX=-Math.round(r.x/r.scrollWidth);r.pageY=-Math.round(r.y/r.scrollHeight)}if(q=="next"){q=++r.pageX}else{if(q=="prev"){q=--r.pageX}}if(p=="next"){p=++r.pageY}else{if(p=="prev"){p=--r.pageY}}q=-q*r.scrollWidth;p=-p*r.scrollHeight;o=r.snap(q,p);q=o.x;p=o.y;r.scrollTo(q,p,s||"500ms")},scrollToElement:function(p,r){p=typeof p=="object"?p:this.element.querySelector(p);if(!p){return}var q=this,o=q.scrollX?-p.offsetLeft:0,s=q.scrollY?-p.offsetTop:0;if(o>=0){o=0}else{if(o<q.maxScrollX){o=q.maxScrollX}}if(s>=0){s=0}else{if(s<q.maxScrollY){s=q.maxScrollY}}q.scrollTo(o,s,r)},momentum:function(v,p,t,o){var s=2.5,u=1.2,q=Math.abs(v)/p*1000,r=q*q/s/1000,w=0;if(v>0&&r>t){q=q*t/r/s;r=t}else{if(v<0&&r>o){q=q*o/r/s;r=o}}r=r*(v<0?-1:1);w=q/u;return{dist:Math.round(r),time:Math.round(w)}},onScrollEnd:function(){},destroy:function(o){var p=this;window.removeEventListener("orientationchange",p,false);window.removeEventListener("resize",p,false);p.element.removeEventListener(h,p,false);p.element.removeEventListener(l,p,false);p.element.removeEventListener(g,p,false);p.element.removeEventListener("DOMSubtreeModified",p,false);p.element.removeEventListener("click",p,true);document.removeEventListener("webkitTransitionEnd",p,false);if(p.scrollBarX){p.scrollBarX=p.scrollBarX.remove()}if(p.scrollBarY){p.scrollBarY=p.scrollBarY.remove()}if(o){p.wrapper.parentNode.removeChild(p.wrapper)}return null}};function n(o,t,s,p){var r=this,q;r.dir=o;r.fade=s;r.shrink=p;r.uid=++e;r.bar=document.createElement("div");q="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:rgba(0,0,0,0.5);-webkit-transform:"+k+"0,0"+b+";"+(o=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");r.bar.setAttribute("style",q);r.wrapper=document.createElement("div");q="-webkit-mask:-webkit-canvas(scrollbar"+r.uid+r.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(s?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(r.dir=="horizontal"?"bottom:2px;left:1px;right:7px;height:5px":"top:1px;right:2px;bottom:7px;width:5px;");r.wrapper.setAttribute("style",q);r.wrapper.appendChild(r.bar);t.appendChild(r.wrapper)}n.prototype={init:function(o,r){var s=this,p,q;if(s.dir=="horizontal"){q=s.wrapper.offsetWidth;p=document.getCSSCanvasContext("2d","scrollbar"+s.uid+s.dir,q,5);p.fillStyle="rgb(0,0,0)";p.beginPath();p.arc(2.5,2.5,2.5,Math.PI/2,-Math.PI/2,false);p.lineTo(q-2.5,0);p.arc(q-2.5,2.5,2.5,-Math.PI/2,Math.PI/2,false);p.closePath();p.fill()}else{q=s.wrapper.offsetHeight;p=document.getCSSCanvasContext("2d","scrollbar"+s.uid+s.dir,5,q);p.fillStyle="rgb(0,0,0)";p.beginPath();p.arc(2.5,2.5,2.5,Math.PI,0,false);p.lineTo(5,q-2.5);p.arc(2.5,q-2.5,2.5,0,Math.PI,false);p.closePath();p.fill()}s.maxSize=s.dir=="horizontal"?s.wrapper.clientWidth:s.wrapper.clientHeight;s.size=Math.round(s.maxSize*s.maxSize/r);s.maxScroll=s.maxSize-s.size;s.toWrapperProp=s.maxScroll/(o-r);s.bar.style[s.dir=="horizontal"?"width":"height"]=s.size+"px"},setPosition:function(q,p){var o=this;if(!p&&o.wrapper.style.opacity!="1"){o.show()}q=o.toWrapperProp*q;if(q<0){q=o.shrink?q+q*3:0;if(o.size+q<5){q=-o.size+5}}else{if(q>o.maxScroll){q=o.shrink?q+(q-o.maxScroll)*3:o.maxScroll;if(o.size+o.maxScroll-q<5){q=o.size+o.maxScroll-5}}}q=o.dir=="horizontal"?k+Math.round(q)+"px,0"+b:k+"0,"+Math.round(q)+"px"+b;o.bar.style.webkitTransform=q},show:function(){if(f){this.wrapper.style.webkitTransitionDelay="0"}this.wrapper.style.opacity="1"},hide:function(){if(f){this.wrapper.style.webkitTransitionDelay="200ms"}this.wrapper.style.opacity="0"},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null}};var f=("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix()),c=(/iphone/gi).test(navigator.appVersion),d=(/ipad/gi).test(navigator.appVersion),j=(/android/gi).test(navigator.appVersion),a=c||d||j,h=a?"touchstart":"mousedown",l=a?"touchmove":"mousemove",g=a?"touchend":"mouseup",k="translate"+(f?"3d(":"("),b=f?",0)":")",e=0;window.iScroll=m})();(function(){function d(r,q,p){if(r.addEventListener){r.addEventListener(q,p,false)}else{if(r.attachEvent){r.attachEvent("on"+q,function(){p.call(r)})}else{throw new Error("not supported or DOM not loaded")}}}function h(p){var q;d(window,"resize",function(){if(q){clearTimeout(q)}q=setTimeout(p,100)})}if(document.documentElement.getBoundingClientRect){var n=function(p){var u=p.getBoundingClientRect();var y=p.ownerDocument;var v=y.body;var q=y.documentElement;var t=q.clientTop||v.clientTop||0;var w=q.clientLeft||v.clientLeft||0;var z=1;if(v.getBoundingClientRect){var s=v.getBoundingClientRect();z=(s.right-s.left)/v.clientWidth}if(z>1){t=0;w=0}var x=u.top/z+(window.pageYOffset||q&&q.scrollTop/z||v.scrollTop/z)-t,r=u.left/z+(window.pageXOffset||q&&q.scrollLeft/z||v.scrollLeft/z)-w;return{top:x,left:r}}}else{var n=function(p){var r=0,q=0;do{r+=p.offsetTop||0;q+=p.offsetLeft||0;p=p.offsetParent}while(p);return{left:q,top:r}}}function a(r){var t,q,s,p;var u=n(r);t=u.left;s=u.top;q=t+r.offsetWidth;p=s+r.offsetHeight;return{left:t,right:q,top:s,bottom:p}}function f(q,r){for(var p in r){if(r.hasOwnProperty(p)){q.style[p]=r[p]}}}function m(r,q){var p=a(r);f(q,{position:"absolute",left:p.left+"px",top:p.top+"px",width:r.offsetWidth+"px",height:r.offsetHeight+"px"})}var c=(function(){var p=document.createElement("div");return function(q){p.innerHTML=q;var r=p.firstChild;return p.removeChild(r)}})();var j=(function(){var p=0;return function(){return"ValumsAjaxUpload"+p++}})();function o(p){return p.replace(/.*(\/|\\)/,"")}function k(p){return(-1!==p.indexOf("."))?p.replace(/.*[.]/,""):""}function e(r,p){var q=new RegExp("\\b"+p+"\\b");return q.test(r.className)}function g(q,p){if(!e(q,p)){q.className+=" "+p}}function l(r,p){var q=new RegExp("\\b"+p+"\\b");r.className=r.className.replace(q,"")}function b(p){p.parentNode.removeChild(p)}window.AjaxUpload=function(r,p){this._settings={action:"upload.php",name:"userfile",multiple:false,data:{},autoSubmit:true,responseType:false,hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",onChange:function(s,t){},onSubmit:function(s,t){},onComplete:function(t,s){}};for(var q in p){if(p.hasOwnProperty(q)){this._settings[q]=p[q]}}if(r.jquery){r=r[0]}else{if(typeof r=="string"){if(/^#.*/.test(r)){r=r.slice(1)}r=document.getElementById(r)}}if(!r||r.nodeType!==1){throw new Error("Please make sure that you're passing a valid element")}if(r.nodeName.toUpperCase()=="A"){d(r,"click",function(s){if(s&&s.preventDefault){s.preventDefault()}else{if(window.event){window.event.returnValue=false}}})}this._button=r;this._input=null;this._disabled=false;this.enable();this._rerouteClicks()};AjaxUpload.prototype={setData:function(p){this._settings.data=p},disable:function(){g(this._button,this._settings.disabledClass);this._disabled=true;var p=this._button.nodeName.toUpperCase();if(p=="INPUT"||p=="BUTTON"){this._button.setAttribute("disabled","disabled")}if(this._input){if(this._input.parentNode){this._input.parentNode.style.visibility="hidden"}}},enable:function(){l(this._button,this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=false},_createInput:function(){var q=this;var p=document.createElement("input");p.setAttribute("type","file");p.setAttribute("name",this._settings.name);if(this._settings.multiple){p.setAttribute("multiple","multiple")}f(p,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});var r=document.createElement("div");f(r,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(r.style.opacity!=="0"){r.style.filter="alpha(opacity=0)"}d(p,"change",function(){if(!p||p.value===""){return}var s=o(p.value);if(false===q._settings.onChange.call(q,s,k(s))){q._clearInput();return}if(q._settings.autoSubmit){q.submit()}});d(p,"mouseover",function(){g(q._button,q._settings.hoverClass)});d(p,"mouseout",function(){l(q._button,q._settings.hoverClass);l(q._button,q._settings.focusClass);if(p.parentNode){p.parentNode.style.visibility="hidden"}});d(p,"focus",function(){g(q._button,q._settings.focusClass)});d(p,"blur",function(){l(q._button,q._settings.focusClass)});r.appendChild(p);document.body.appendChild(r);this._input=p},_clearInput:function(){if(!this._input){return}b(this._input.parentNode);this._input=null;this._createInput();l(this._button,this._settings.hoverClass);l(this._button,this._settings.focusClass)},_rerouteClicks:function(){var p=this;d(p._button,"mouseover",function(){if(p._disabled){return}if(!p._input){p._createInput()}var q=p._input.parentNode;m(p._button,q);q.style.visibility="visible"})},_createIframe:function(){var q=j();var p=c('<iframe src="javascript:false;" name="'+q+'" />');p.setAttribute("id",q);p.style.display="none";document.body.appendChild(p);return p},_createForm:function(s){var r=this._settings;var u=c('<form method="post" enctype="multipart/form-data"></form>');var t=$('meta[name="csrf-token"]').attr("content");var p=r.action;p+=((p.indexOf("?")==-1)?"?":"&")+"app_token=U29jcmF0YS0td2VraWNrYXNz0&authenticity_token="+escape(t);u.setAttribute("action",p);u.setAttribute("target",s.name);u.style.display="none";document.body.appendChild(u);r.data=r.data||{};r.data.authenticity_token=t;for(var v in r.data){if(r.data.hasOwnProperty(v)){var q=document.createElement("input");q.setAttribute("type","hidden");q.setAttribute("name",v);q.setAttribute("value",r.data[v]);u.appendChild(q)}}return u},_getResponse:function(s,q){var t=false,p=this,r=this._settings;d(s,"load",function(){if(s.src=="javascript:'%3Chtml%3E%3C/html%3E';"||s.src=="javascript:'<html></html>';"){if(t){setTimeout(function(){b(s)},0)}return}var w=s.contentDocument?s.contentDocument:window.frames[s.id].document;if(w.readyState&&w.readyState!="complete"){return}if(w.body&&w.body.innerHTML=="false"){return}var u;if(w.XMLDocument){u=w.XMLDocument}else{if(w.body){if(w.body.firstChild.tagName=="PRE"){u=w.body.firstChild.innerHTML}else{u=w.body.innerHTML}if(r.responseType&&r.responseType.toLowerCase()=="json"){if(w.body.firstChild&&w.body.firstChild.nodeName.toUpperCase()=="PRE"){if((typeof w.normalize)!=="undefined"){w.normalize()}u=w.body.firstChild.firstChild.nodeValue}if(u){try{u=JSON.parse(u)}catch(v){u={error:true,message:u}}}else{u={}}}}else{u=w}}r.onComplete.call(p,q,u);t=true;s.src="javascript:'<html></html>';"})},submit:function(){var p=this,s=this._settings;if(!this._input||this._input.value===""){return}var q=o(this._input.value);if(false===s.onSubmit.call(this,q,k(q))){this._clearInput();return}var r=this._createIframe();var t=this._createForm(r);b(this._input.parentNode);l(p._button,p._settings.hoverClass);l(p._button,p._settings.focusClass);t.appendChild(this._input);t.submit();b(t);t=null;b(this._input);this._input=null;this._getResponse(r,q);this._createInput()}}})();
/*! LAB.js (LABjs :: Loading And Blocking JavaScript)
    v2.0.3 (c) Kyle Simpson
    MIT License
*/
(function(r){var v=r.$LAB,k="UseLocalXHR",q="AlwaysPreserveOrder",n="AllowDuplicates",m="CacheBust",l="Debug",e="BasePath",s=/^[^?#]*\//.exec(location.href)[0],C=/^\w+\:\/\/\/?[^\/]+/.exec(s)[0],f=document.head||document.getElementsByTagName("head"),h=(r.opera&&Object.prototype.toString.call(r.opera)=="[object Opera]")||("MozAppearance" in document.documentElement.style),c=function(){},o=c,A=document.createElement("script"),a=typeof A.preload=="boolean",x=a||(A.readyState&&A.readyState=="uninitialized"),y=!x&&A.async===true,z=!x&&!y&&!h;
/*!START_DEBUG*/
;if(r.console&&r.console.log){if(!r.console.error){r.console.error=r.console.log}c=function(D){r.console.log(D)};o=function(E,D){r.console.error(E,D)}}
/*!END_DEBUG*/
;function u(D){return Object.prototype.toString.call(D)=="[object Function]"}function B(D){return Object.prototype.toString.call(D)=="[object Array]"}function g(F,E){var D=/^\w+\:\/\//;if(/^\/\/\/?/.test(F)){F=location.protocol+F}else{if(!D.test(F)&&F.charAt(0)!="/"){F=(E||"")+F}}return D.test(F)?F:((F.charAt(0)=="/"?C:s)+F)}function j(E,F){for(var D in E){if(E.hasOwnProperty(D)){F[D]=E[D]}}return F}function b(E){var F=false;for(var D=0;D<E.scripts.length;D++){if(E.scripts[D].ready&&E.scripts[D].exec_trigger){F=true;E.scripts[D].exec_trigger();E.scripts[D].exec_trigger=null}}return F}function d(F,E,D,G){F.onload=F.onreadystatechange=function(){if((F.readyState&&F.readyState!="complete"&&F.readyState!="loaded")||E[D]){return}F.onload=F.onreadystatechange=null;G()}}function w(D){D.ready=D.finished=true;for(var E=0;E<D.finished_listeners.length;E++){D.finished_listeners[E]()}D.ready_listeners=[];D.finished_listeners=[]}function t(F,G,E,H,D){setTimeout(function(){var I,K=G.real_src,J;if("item" in f){if(!f[0]){setTimeout(arguments.callee,25);return}f=f[0]}I=document.createElement("script");if(G.type){I.type=G.type}if(G.charset){I.charset=G.charset}if(D){if(x){
/*!START_DEBUG*/
;if(F[l]){c("start script preload: "+K)}
/*!END_DEBUG*/
;E.elem=I;if(a){I.preload=true;I.onpreload=H}else{I.onreadystatechange=function(){if(I.readyState=="loaded"){H()}}}I.src=K}else{if(D&&K.indexOf(C)==0&&F[k]){J=new XMLHttpRequest();
/*!START_DEBUG*/
;if(F[l]){c("start script preload (xhr): "+K)}
/*!END_DEBUG*/
;J.onreadystatechange=function(){if(J.readyState==4){J.onreadystatechange=function(){};E.text=J.responseText+"\n//@ sourceURL="+K;H()}};J.open("GET",K);J.send()}else{
/*!START_DEBUG*/
;if(F[l]){c("start script preload (cache): "+K)}
/*!END_DEBUG*/
;I.type="text/cache-script";d(I,E,"ready",function(){f.removeChild(I);H()});I.src=K;f.insertBefore(I,f.firstChild)}}}else{if(y){
/*!START_DEBUG*/
;if(F[l]){c("start script load (ordered async): "+K)}
/*!END_DEBUG*/
;I.async=false;d(I,E,"finished",H);I.src=K;f.insertBefore(I,f.firstChild)}else{
/*!START_DEBUG*/
;if(F[l]){c("start script load: "+K)}
/*!END_DEBUG*/
;d(I,E,"finished",H);I.src=K;f.insertBefore(I,f.firstChild)}}},0)}function p(){var L={},I=x||z,J=[],D={},H;L[k]=true;L[q]=false;L[n]=false;L[m]=false;
/*!START_DEBUG*/
;var F=(window.blist||{}).feature_flags||{};var E=!!(F.debug_assets||F.debug_labjs);L[l]=E;
/*!END_DEBUG*/
;L[e]="";function M(P,R,O){var N;function Q(){if(N!=null){N=null;w(O)}}if(D[R.src].finished){return}if(!P[n]){D[R.src].finished=true}N=O.elem||document.createElement("script");if(R.type){N.type=R.type}if(R.charset){N.charset=R.charset}d(N,O,"finished",Q);if(O.elem){O.elem=null}else{if(O.text){N.onload=N.onreadystatechange=null;N.text=O.text}else{N.src=R.real_src}}f.insertBefore(N,f.firstChild);if(O.text){Q()}}function K(P,T,S,N){var O,R,Q=function(){T.ready_cb(T,function(){M(P,T,O)})},U=function(){T.finished_cb(T,S)};T.src=g(T.src,P[e]);T.real_src=T.src+(P[m]?((/\?.*$/.test(T.src)?"&_":"?_")+~~(Math.random()*1000000000)+"="):"");if(!D[T.src]){D[T.src]={items:[],finished:false}}R=D[T.src].items;if(P[n]||R.length==0){O=R[R.length]={ready:false,finished:false,ready_listeners:[Q],finished_listeners:[U]};t(P,T,O,((N)?function(){O.ready=true;for(var V=0;V<O.ready_listeners.length;V++){O.ready_listeners[V]()}O.ready_listeners=[]}:function(){w(O)}),N)}else{O=R[0];if(O.finished){U()}else{O.finished_listeners.push(U)}}}function G(){var Q,U=j(L,{}),N=[],P=0,R=false,T;function W(Y,X){
/*!START_DEBUG*/
;if(U[l]){c("script preload finished: "+Y.real_src)}
/*!END_DEBUG*/
;Y.ready=true;Y.exec_trigger=X;O()}function V(Z,Y){
/*!START_DEBUG*/
;if(U[l]){c("script execution finished: "+Z.real_src)}
/*!END_DEBUG*/
;Z.ready=Z.finished=true;Z.exec_trigger=null;for(var X=0;X<Y.scripts.length;X++){if(!Y.scripts[X].finished){return}}Y.finished=true;O()}function O(){while(P<N.length){if(u(N[P])){
/*!START_DEBUG*/
;if(U[l]){c("$LAB.wait() executing: "+N[P])}
/*!END_DEBUG*/
;try{N[P++]()}catch(X){
/*!START_DEBUG*/
;if(U[l]){o("$LAB.wait() error caught: ",X)}
/*!END_DEBUG*/
}continue}else{if(!N[P].finished){if(b(N[P])){continue}break}}P++}if(P==N.length){R=false;T=false}}function S(){if(!T||!T.scripts){N.push(T={scripts:[],finished:true})}}Q={script:function(){for(var X=0;X<arguments.length;X++){(function(ab,Z){var aa;if(!B(ab)){Z=[ab]}for(var Y=0;Y<Z.length;Y++){S();ab=Z[Y];if(u(ab)){ab=ab()}if(!ab){continue}if(B(ab)){aa=[].slice.call(ab);aa.unshift(Y,1);[].splice.apply(Z,aa);Y--;continue}if(typeof ab=="string"){ab={src:ab}}ab=j(ab,{ready:false,ready_cb:W,finished:false,finished_cb:V});T.finished=false;T.scripts.push(ab);K(U,ab,T,(I&&R));R=true;if(U[q]){Q.wait()}}})(arguments[X],arguments[X])}return Q},wait:function(){if(arguments.length>0){for(var X=0;X<arguments.length;X++){N.push(arguments[X])}T=N[N.length-1]}else{T=false}O();return Q}};return{script:Q.script,wait:Q.wait,setOptions:function(X){j(X,U);return Q}}}H={setGlobalDefaults:function(N){j(N,L);return H},setOptions:function(){return G().setOptions.apply(null,arguments)},script:function(){return G().script.apply(null,arguments)},wait:function(){return G().wait.apply(null,arguments)},queueScript:function(){J[J.length]={type:"script",args:[].slice.call(arguments)};return H},queueWait:function(){J[J.length]={type:"wait",args:[].slice.call(arguments)};return H},runQueue:function(){var P=H,N=J.length,O=N,Q;for(;--O>=0;){Q=J.shift();P=P[Q.type].apply(null,Q.args)}return P},noConflict:function(){r.$LAB=v;return H},sandbox:function(){return p()}};return H}r.$LAB=p();(function(F,D,E){if(document.readyState==null&&document[F]){document.readyState="loading";document[F](D,E=function(){document.removeEventListener(D,E,false);document.readyState="complete"},false)}})("addEventListener","DOMContentLoaded")})(this);
/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0-beta.1
 */
(function(aX,G){var a2=aX,a4=a2.document,N=a2.navigator,A=a2.setTimeout,p=a2.clearTimeout,aR=a2.encodeURIComponent,an=a2.ActiveXObject,ap=a2.Error,ah=a2.Number.parseInt||a2.parseInt,R=a2.Number.parseFloat||a2.parseFloat,U=a2.Number.isNaN||a2.isNaN,y=a2.Math.round,S=a2.Date.now,af=a2.Object.keys,aG=a2.Object.defineProperty,aA=a2.Object.prototype.hasOwnProperty,j=a2.Array.prototype.slice,aN=function(){var a8=function(a9){return a9};if(typeof a2.wrap==="function"&&typeof a2.unwrap==="function"){try{var a7=a4.createElement("div");var a5=a2.unwrap(a7);if(a7.nodeType===1&&a5&&a5.nodeType===1){a8=a2.unwrap}}catch(a6){}}return a8}();var aI=function(a5){return j.call(a5,0)};var aF=function(){var a8,a6,a5,bc,ba,bb,a7=aI(arguments),a9=a7[0]||{};for(a8=1,a6=a7.length;a8<a6;a8++){if((a5=a7[a8])!=null){for(bc in a5){if(aA.call(a5,bc)){ba=a9[bc];bb=a5[bc];if(a9!==bb&&bb!==G){a9[bc]=bb}}}}}return a9};var K=function(a7){var a9,a6,a5,a8;if(typeof a7!=="object"||a7==null){a9=a7}else{if(typeof a7.length==="number"){a9=[];for(a6=0,a5=a7.length;a6<a5;a6++){if(aA.call(a7,a6)){a9[a6]=K(a7[a6])}}}else{a9={};for(a8 in a7){if(aA.call(a7,a8)){a9[a8]=K(a7[a8])}}}}return a9};var s=function(a9,a8){var a6={};for(var a7=0,a5=a8.length;a7<a5;a7++){if(a8[a7] in a9){a6[a8[a7]]=a9[a8[a7]]}}return a6};var a0=function(a7,a6){var a5={};for(var a8 in a7){if(a6.indexOf(a8)===-1){a5[a8]=a7[a8]}}return a5};var ai=function(a5){if(a5){for(var a6 in a5){if(aA.call(a5,a6)){delete a5[a6]}}}return a5};var aH=function(a5,a6){if(a5&&a5.nodeType===1&&a5.ownerDocument&&a6&&(a6.nodeType===1&&a6.ownerDocument&&a6.ownerDocument===a5.ownerDocument||a6.nodeType===9&&!a6.ownerDocument&&a6===a5.ownerDocument)){do{if(a5===a6){return true}a5=a5.parentNode}while(a5)}return false};var M=function(a6){var a5;if(typeof a6==="string"&&a6){a5=a6.split("#")[0].split("?")[0];a5=a6.slice(0,a6.lastIndexOf("/")+1)}return a5};var Q=function(a5){var a6,a7;if(typeof a5==="string"&&a5){a7=a5.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(a7&&a7[1]){a6=a7[1]}else{a7=a5.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(a7&&a7[1]){a6=a7[1]}}}return a6};var aq=function(){var a5,a6;try{throw new ap()}catch(a7){a6=a7}if(a6){a5=a6.sourceURL||a6.fileName||Q(a6.stack)}return a5};var aE=function(){var a7,a5,a6;if(a4.currentScript&&(a7=a4.currentScript.src)){return a7}a5=a4.getElementsByTagName("script");if(a5.length===1){return a5[0].src||G}if("readyState" in a5[0]){for(a6=a5.length;a6--;){if(a5[a6].readyState==="interactive"&&(a7=a5[a6].src)){return a7}}}if(a4.readyState==="loading"&&(a7=a5[a5.length-1].src)){return a7}if(a7=aq()){return a7}return G};var B=function(){var a7,a6,a8,a5=a4.getElementsByTagName("script");for(a7=a5.length;a7--;){if(!(a8=a5[a7].src)){a6=null;break}a8=M(a8);if(a6==null){a6=a8}else{if(a6!==a8){a6=null;break}}}return a6||G};var z=function(){var a5=M(aE())||B()||"";return a5+"ZeroClipboard.swf"};var n={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null};var aj="11.0.0";var am={};var ac;var r;var t={};var ao=null;var o=0;var k={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}};var aS={swfPath:z(),trustedDomains:aX.location.host?[aX.location.host]:[],cacheBust:true,forceEnhancedClipboard:false,flashLoadTimeout:30000,autoActivate:true,bubbleEvents:true,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:false,title:null,zIndex:999999999};var aC=function(a5){if(typeof a5==="object"&&a5!==null){for(var a6 in a5){if(aA.call(a5,a6)){if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(a6)){aS[a6]=a5[a6]}else{if(n.bridge==null){if(a6==="containerId"||a6==="swfObjectId"){if(aY(a5[a6])){aS[a6]=a5[a6]}else{throw new Error("The specified `"+a6+"` value is not valid as an HTML4 Element ID")}}else{aS[a6]=a5[a6]}}}}}}if(typeof a5==="string"&&a5){if(aA.call(aS,a5)){return aS[a5]}return}return K(aS)};var aJ=function(){return{browser:s(N,["userAgent","platform","appName"]),flash:a0(n,["bridge"]),zeroclipboard:{version:a3.version,config:a3.config()}}};var w=function(){return !!(n.disabled||n.outdated||n.unavailable||n.degraded||n.deactivated)};var V=function(a8,ba){var a7,a5,a6,a9={};if(typeof a8==="string"&&a8){a6=a8.toLowerCase().split(/\s+/)}else{if(typeof a8==="object"&&a8&&typeof ba==="undefined"){for(a7 in a8){if(aA.call(a8,a7)&&typeof a7==="string"&&a7&&typeof a8[a7]==="function"){a3.on(a7,a8[a7])}}}}if(a6&&a6.length){for(a7=0,a5=a6.length;a7<a5;a7++){a8=a6[a7].replace(/^on/,"");a9[a8]=true;if(!am[a8]){am[a8]=[]}am[a8].push(ba)}if(a9.ready&&n.ready){a3.emit({type:"ready"})}if(a9.error){var bb=["disabled","outdated","unavailable","degraded","deactivated","overdue"];for(a7=0,a5=bb.length;a7<a5;a7++){if(n[bb[a7]]===true){a3.emit({type:"error",name:"flash-"+bb[a7]});break}}}}return a3};var aZ=function(a9,ba){var a8,a5,bb,a7,a6;if(arguments.length===0){a7=af(am)}else{if(typeof a9==="string"&&a9){a7=a9.split(/\s+/)}else{if(typeof a9==="object"&&a9&&typeof ba==="undefined"){for(a8 in a9){if(aA.call(a9,a8)&&typeof a8==="string"&&a8&&typeof a9[a8]==="function"){a3.off(a8,a9[a8])}}}}}if(a7&&a7.length){for(a8=0,a5=a7.length;a8<a5;a8++){a9=a7[a8].toLowerCase().replace(/^on/,"");a6=am[a9];if(a6&&a6.length){if(ba){bb=a6.indexOf(ba);while(bb!==-1){a6.splice(bb,1);bb=a6.indexOf(ba,bb)}}else{a6.length=0}}}}return a3};var c=function(a5){var a6;if(typeof a5==="string"&&a5){a6=K(am[a5])||null}else{a6=K(am)}return a6};var aB=function(a7){var a8,a6,a5;a7=F(a7);if(!a7){return}if(aU(a7)){return}if(a7.type==="ready"&&n.overdue===true){return a3.emit({type:"error",name:"flash-overdue"})}a8=aF({},a7);ag.call(this,a8);if(a7.type==="copy"){a5=m(t);a6=a5.data;ao=a5.formatMap}return a6};var L=function(){if(typeof n.ready!=="boolean"){n.ready=false}if(!a3.isFlashUnusable()&&n.bridge===null){var a5=aS.flashLoadTimeout;if(typeof a5==="number"&&a5>=0){o=A(function(){if(typeof n.deactivated!=="boolean"){n.deactivated=true}if(n.deactivated===true){a3.emit({type:"error",name:"flash-deactivated"})}},a5)}n.overdue=false;ar()}};var T=function(){a3.clearData();a3.blur();a3.emit("destroy");f();a3.off()};var e=function(a7,a6){var a5;if(typeof a7==="object"&&a7&&typeof a6==="undefined"){a5=a7;a3.clearData()}else{if(typeof a7==="string"&&a7){a5={};a5[a7]=a6}else{return}}for(var a8 in a5){if(typeof a8==="string"&&a8&&aA.call(a5,a8)&&typeof a5[a8]==="string"&&a5[a8]){t[a8]=a5[a8]}}};var q=function(a5){if(typeof a5==="undefined"){ai(t);ao=null}else{if(typeof a5==="string"&&aA.call(t,a5)){delete t[a5]}}};var C=function(a5){if(typeof a5==="undefined"){return K(t)}else{if(typeof a5==="string"&&aA.call(t,a5)){return t[a5]}}};var aK=function(a7){if(!(a7&&a7.nodeType===1)){return}if(ac){at(ac,aS.activeClass);if(ac!==a7){at(ac,aS.hoverClass)}}ac=a7;Y(a7,aS.hoverClass);var a8=a7.getAttribute("title")||aS.title;if(typeof a8==="string"&&a8){var a6=a1(n.bridge);if(a6){a6.setAttribute("title",a8)}}var a5=aS.forceHandCursor===true||I(a7,"cursor")==="pointer";aV(a5);aW()};var aD=function(){var a5=a1(n.bridge);if(a5){a5.removeAttribute("title");a5.style.left="0px";a5.style.top="-9999px";a5.style.width="1px";a5.style.top="1px"}if(ac){at(ac,aS.hoverClass);at(ac,aS.activeClass);ac=null}};var ab=function(){return ac||null};var aY=function(a5){return typeof a5==="string"&&a5&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a5)};var F=function(a6){var a5;if(typeof a6==="string"&&a6){a5=a6;a6={}}else{if(typeof a6==="object"&&a6&&typeof a6.type==="string"&&a6.type){a5=a6.type}}if(!a5){return}if(!a6.target&&/^(copy|aftercopy|_click)$/.test(a5.toLowerCase())){a6.target=r}aF(a6,{type:a5.toLowerCase(),target:a6.target||ac||null,relatedTarget:a6.relatedTarget||null,currentTarget:n&&n.bridge||null,timeStamp:a6.timeStamp||S()||null});var a7=k[a6.type];if(a6.type==="error"&&a6.name&&a7){a7=a7[a6.name]}if(a7){a6.message=a7}if(a6.type==="ready"){aF(a6,{target:null,version:n.version})}if(a6.type==="error"){if(/^flash-(disabled|outdated|unavailable|degraded|deactivated|overdue)$/.test(a6.name)){aF(a6,{target:null,minimumVersion:aj})}if(/^flash-(outdated|unavailable|degraded|deactivated|overdue)$/.test(a6.name)){aF(a6,{version:n.version})}}if(a6.type==="copy"){a6.clipboardData={setData:a3.setData,clearData:a3.clearData}}if(a6.type==="aftercopy"){a6=g(a6,ao)}if(a6.target&&!a6.relatedTarget){a6.relatedTarget=P(a6.target)}a6=v(a6);return a6};var P=function(a6){var a5=a6&&a6.getAttribute&&a6.getAttribute("data-clipboard-target");return a5?a4.getElementById(a5):null};var v=function(a6){if(a6&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a6.type)){var bk=a6.target;var bj=a6.type==="_mouseover"&&a6.relatedTarget?a6.relatedTarget:G;var be=a6.type==="_mouseout"&&a6.relatedTarget?a6.relatedTarget:G;var bl=az(bk);var bh=a2.screenLeft||a2.screenX||0;var bb=a2.screenTop||a2.screenY||0;var bf=a4.body.scrollLeft+a4.documentElement.scrollLeft;var a8=a4.body.scrollTop+a4.documentElement.scrollTop;var bi=bl.left+(typeof a6._stageX==="number"?a6._stageX:0);var bg=bl.top+(typeof a6._stageY==="number"?a6._stageY:0);var a7=bi-bf;var a5=bg-a8;var bd=bh+a7;var ba=bb+a5;var bc=typeof a6.movementX==="number"?a6.movementX:0;var a9=typeof a6.movementY==="number"?a6.movementY:0;delete a6._stageX;delete a6._stageY;aF(a6,{srcElement:bk,fromElement:bj,toElement:be,screenX:bd,screenY:ba,pageX:bi,pageY:bg,clientX:a7,clientY:a5,x:a7,y:a5,movementX:bc,movementY:a9,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a6};var Z=function(a6){var a5=a6&&typeof a6.type==="string"&&a6.type||"";return !/^(?:(?:before)?copy|destroy)$/.test(a5)};var ak=function(a8,a6,a5,a7){if(a7){A(function(){a8.apply(a6,a5)},0)}else{a8.apply(a6,a5)}};var ag=function(a5){if(!(typeof a5==="object"&&a5&&a5.type)){return}var a9=Z(a5);var bc=am["*"]||[];var bf=am[a5.type]||[];var a8=bc.concat(bf);if(a8&&a8.length){var ba,bd,a7,a6,bb,be=this;for(ba=0,bd=a8.length;ba<bd;ba++){a7=a8[ba];a6=be;if(typeof a7==="string"&&typeof a2[a7]==="function"){a7=a2[a7]}if(typeof a7==="object"&&a7&&typeof a7.handleEvent==="function"){a6=a7;a7=a7.handleEvent}if(typeof a7==="function"){bb=aF({},a5);ak(a7,a6,[bb],a9)}}}return this};var aU=function(a8){var a6=a8.target||ac||null;var ba=a8._source==="swf";delete a8._source;var a9=["flash-disabled","flash-outdated","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"];switch(a8.type){case"error":if(a9.indexOf(a8.name)!==-1){aF(n,{disabled:a8.name==="flash-disabled",outdated:a8.name==="flash-outdated",unavailable:a8.name==="flash-unavailable",degraded:a8.name==="flash-degraded",deactivated:a8.name==="flash-deactivated",overdue:a8.name==="flash-overdue",ready:false})}break;case"ready":var a5=n.deactivated===true;aF(n,{disabled:false,outdated:false,unavailable:false,degraded:false,deactivated:false,overdue:a5,ready:!a5});break;case"beforecopy":r=a6;break;case"copy":var a7,bc,bb=a8.relatedTarget;if(!(t["text/html"]||t["text/plain"])&&bb&&(bc=bb.value||bb.outerHTML||bb.innerHTML)&&(a7=bb.value||bb.textContent||bb.innerText)){a8.clipboardData.clearData();a8.clipboardData.setData("text/plain",a7);if(bc!==a7){a8.clipboardData.setData("text/html",bc)}}else{if(!t["text/plain"]&&a8.target&&(a7=a8.target.getAttribute("data-clipboard-text"))){a8.clipboardData.clearData();a8.clipboardData.setData("text/plain",a7)}}break;case"aftercopy":a3.clearData();if(a6&&a6!==ay()&&a6.focus){a6.focus()}break;case"_mouseover":a3.focus(a6);if(aS.bubbleEvents===true&&ba){if(a6&&a6!==a8.relatedTarget&&!aH(a8.relatedTarget,a6)){b(aF({},a8,{type:"mouseenter",bubbles:false,cancelable:false}))}b(aF({},a8,{type:"mouseover"}))}break;case"_mouseout":a3.blur();if(aS.bubbleEvents===true&&ba){if(a6&&a6!==a8.relatedTarget&&!aH(a8.relatedTarget,a6)){b(aF({},a8,{type:"mouseleave",bubbles:false,cancelable:false}))}b(aF({},a8,{type:"mouseout"}))}break;case"_mousedown":Y(a6,aS.activeClass);if(aS.bubbleEvents===true&&ba){b(aF({},a8,{type:a8.type.slice(1)}))}break;case"_mouseup":at(a6,aS.activeClass);if(aS.bubbleEvents===true&&ba){b(aF({},a8,{type:a8.type.slice(1)}))}break;case"_click":r=null;if(aS.bubbleEvents===true&&ba){b(aF({},a8,{type:a8.type.slice(1)}))}break;case"_mousemove":if(aS.bubbleEvents===true&&ba){b(aF({},a8,{type:a8.type.slice(1)}))}break}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a8.type)){return true}};var b=function(a6){if(!(a6&&typeof a6.type==="string"&&a6)){return}var ba,a9=a6.target||null,a8=a9&&a9.ownerDocument||a4,a7={view:a8.defaultView||a2,canBubble:true,cancelable:true,detail:a6.type==="click"?1:0,button:typeof a6.which==="number"?a6.which-1:typeof a6.button==="number"?a6.button:a8.createEvent?0:1},a5=aF(a7,a6);if(!a9){return}if(a8.createEvent&&a9.dispatchEvent){a5=[a5.type,a5.canBubble,a5.cancelable,a5.view,a5.detail,a5.screenX,a5.screenY,a5.clientX,a5.clientY,a5.ctrlKey,a5.altKey,a5.shiftKey,a5.metaKey,a5.button,a5.relatedTarget];ba=a8.createEvent("MouseEvents");if(ba.initMouseEvent){ba.initMouseEvent.apply(ba,a5);ba._source="js";a9.dispatchEvent(ba)}}};var a=function(){var a5=a4.createElement("div");a5.id=aS.containerId;a5.className=aS.containerClass;a5.style.position="absolute";a5.style.left="0px";a5.style.top="-9999px";a5.style.width="1px";a5.style.height="1px";a5.style.zIndex=""+av(aS.zIndex);return a5};var a1=function(a6){var a5=a6&&a6.parentNode;while(a5&&a5.nodeName==="OBJECT"&&a5.parentNode){a5=a5.parentNode}return a5||null};var ar=function(){var bb,bd=n.bridge,a5=a1(bd);if(!bd){var a8=aM(a2.location.host,aS);var a6=a8==="never"?"none":"all";var a7=d(aS);var a9=aS.swfPath+x(aS.swfPath,aS);a5=a();var bc=a4.createElement("div");a5.appendChild(bc);a4.body.appendChild(a5);var be=a4.createElement("div");var ba=n.pluginType==="activex";be.innerHTML='<object id="'+aS.swfObjectId+'" name="'+aS.swfObjectId+'" width="100%" height="100%" '+(ba?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+a9+'"')+">"+(ba?'<param name="movie" value="'+a9+'"/>':"")+'<param name="allowScriptAccess" value="'+a8+'"/><param name="allowNetworking" value="'+a6+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+a7+'"/></object>';bd=be.firstChild;be=null;aN(bd).ZeroClipboard=a3;a5.replaceChild(bd,bc)}if(!bd){bd=a4[aS.swfObjectId];if(bd&&(bb=bd.length)){bd=bd[bb-1]}if(!bd&&a5){bd=a5.firstChild}}n.bridge=bd||null;return bd};var f=function(){var a6=n.bridge;if(a6){var a5=a1(a6);if(a5){if(n.pluginType==="activex"&&"readyState" in a6){a6.style.display="none";(function a7(){if(a6.readyState===4){for(var a8 in a6){if(typeof a6[a8]==="function"){a6[a8]=null}}if(a6.parentNode){a6.parentNode.removeChild(a6)}if(a5.parentNode){a5.parentNode.removeChild(a5)}}else{A(a7,10)}})()}else{if(a6.parentNode){a6.parentNode.removeChild(a6)}if(a5.parentNode){a5.parentNode.removeChild(a5)}}}p(o);o=0;n.ready=null;n.bridge=null;n.deactivated=null}};var m=function(a7){var a6={},a5={};if(!(typeof a7==="object"&&a7)){return}for(var a8 in a7){if(a8&&aA.call(a7,a8)&&typeof a7[a8]==="string"&&a7[a8]){switch(a8.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":a6.text=a7[a8];a5.text=a8;break;case"text/html":case"html":case"air:html":case"flash:html":a6.html=a7[a8];a5.html=a8;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":a6.rtf=a7[a8];a5.rtf=a8;break;default:break}}}return{data:a6,formatMap:a5}};var g=function(a7,a5){if(!(typeof a7==="object"&&a7&&typeof a5==="object"&&a5)){return a7}var ba={};for(var a9 in a7){if(aA.call(a7,a9)){if(a9!=="success"&&a9!=="data"){ba[a9]=a7[a9];continue}ba[a9]={};var a6=a7[a9];for(var a8 in a6){if(a8&&aA.call(a6,a8)&&aA.call(a5,a8)){ba[a9][a5[a8]]=a6[a8]}}}}return ba};var x=function(a7,a5){var a6=a5==null||a5&&a5.cacheBust===true;if(a6){return(a7.indexOf("?")===-1?"?":"&")+"noCache="+S()}else{return""}};var d=function(a7){var a8,a6,a9,a5,ba="",bb=[];if(a7.trustedDomains){if(typeof a7.trustedDomains==="string"){a5=[a7.trustedDomains]}else{if(typeof a7.trustedDomains==="object"&&"length" in a7.trustedDomains){a5=a7.trustedDomains}}}if(a5&&a5.length){for(a8=0,a6=a5.length;a8<a6;a8++){if(aA.call(a5,a8)&&a5[a8]&&typeof a5[a8]==="string"){a9=al(a5[a8]);if(!a9){continue}if(a9==="*"){bb.length=0;bb.push(a9);break}bb.push.apply(bb,[a9,"//"+a9,a2.location.protocol+"//"+a9])}}}if(bb.length){ba+="trustedOrigins="+aR(bb.join(","))}if(a7.forceEnhancedClipboard===true){ba+=(ba?"&":"")+"forceEnhancedClipboard=true"}if(typeof a7.swfObjectId==="string"&&a7.swfObjectId){ba+=(ba?"&":"")+"swfObjectId="+aR(a7.swfObjectId)}return ba};var al=function(a6){if(a6==null||a6===""){return null}a6=a6.replace(/^\s+|\s+$/g,"");if(a6===""){return null}var a7=a6.indexOf("//");a6=a7===-1?a6:a6.slice(a7+2);var a5=a6.indexOf("/");a6=a5===-1?a6:a7===-1||a5===0?null:a6.slice(0,a5);if(a6&&a6.slice(-4).toLowerCase()===".swf"){return null}return a6||null};var aM=function(){var a5=function(ba){var a8,a6,a7,a9=[];if(typeof ba==="string"){ba=[ba]}if(!(typeof ba==="object"&&ba&&typeof ba.length==="number")){return a9}for(a8=0,a6=ba.length;a8<a6;a8++){if(aA.call(ba,a8)&&(a7=al(ba[a8]))){if(a7==="*"){a9.length=0;a9.push("*");break}if(a9.indexOf(a7)===-1){a9.push(a7)}}}return a9};return function(ba,a7){var a9=al(a7.swfPath);if(a9===null){a9=ba}var a8=a5(a7.trustedDomains);var a6=a8.length;if(a6>0){if(a6===1&&a8[0]==="*"){return"always"}if(a8.indexOf(ba)!==-1){if(a6===1&&ba===a9){return"sameDomain"}return"always"}}return"never"}}();var ay=function(){try{return a4.activeElement}catch(a5){return null}};var Y=function(a6,a8){if(!a6||a6.nodeType!==1){return a6}if(a6.classList){if(!a6.classList.contains(a8)){a6.classList.add(a8)}return a6}if(a8&&typeof a8==="string"){var ba=(a8||"").split(/\s+/);if(a6.nodeType===1){if(!a6.className){a6.className=a8}else{var a7=" "+a6.className+" ",a9=a6.className;for(var bb=0,a5=ba.length;bb<a5;bb++){if(a7.indexOf(" "+ba[bb]+" ")<0){a9+=" "+ba[bb]}}a6.className=a9.replace(/^\s+|\s+$/g,"")}}}return a6};var at=function(a6,a8){if(!a6||a6.nodeType!==1){return a6}if(a6.classList){if(a6.classList.contains(a8)){a6.classList.remove(a8)}return a6}if(typeof a8==="string"&&a8){var a9=a8.split(/\s+/);if(a6.nodeType===1&&a6.className){var a7=(" "+a6.className+" ").replace(/[\n\t]/g," ");for(var ba=0,a5=a9.length;ba<a5;ba++){a7=a7.replace(" "+a9[ba]+" "," ")}a6.className=a7.replace(/^\s+|\s+$/g,"")}}return a6};var I=function(a5,a7){var a6=a2.getComputedStyle(a5,null).getPropertyValue(a7);if(a7==="cursor"){if(!a6||a6==="auto"){if(a5.nodeName==="A"){return"pointer"}}}return a6};var ax=function(){var a7,a8,a5,a6=1;if(typeof a4.body.getBoundingClientRect==="function"){a7=a4.body.getBoundingClientRect();a8=a7.right-a7.left;a5=a4.body.offsetWidth;a6=y(a8/a5*100)/100}return a6};var az=function(bc){var bb={left:0,top:0,width:0,height:0};if(bc.getBoundingClientRect){var a8=bc.getBoundingClientRect();var a7,ba,a6;if("pageXOffset" in a2&&"pageYOffset" in a2){a7=a2.pageXOffset;ba=a2.pageYOffset}else{a6=ax();a7=y(a4.documentElement.scrollLeft/a6);ba=y(a4.documentElement.scrollTop/a6)}var a9=a4.documentElement.clientLeft||0;var a5=a4.documentElement.clientTop||0;bb.left=a8.left+a7-a9;bb.top=a8.top+ba-a5;bb.width="width" in a8?a8.width:a8.right-a8.left;bb.height="height" in a8?a8.height:a8.bottom-a8.top}return bb};var aW=function(){var a5;if(ac&&(a5=a1(n.bridge))){var a6=az(ac);aF(a5.style,{width:a6.width+"px",height:a6.height+"px",top:a6.top+"px",left:a6.left+"px",zIndex:""+av(aS.zIndex)})}};var aV=function(a5){if(n.ready===true){if(n.bridge&&typeof n.bridge.setHandCursor==="function"){n.bridge.setHandCursor(a5)}else{n.ready=false}}};var av=function(a5){if(/^(?:auto|inherit)$/.test(a5)){return a5}var a6;if(typeof a5==="number"&&!U(a5)){a6=a5}else{if(typeof a5==="string"){a6=av(ah(a5,10))}}return typeof a6==="number"?a6:"auto"};var ae=function(a9){var bd,a5,a6,bf=false,bh=false,bc=false,a7="";function bb(bk){var bj=bk.match(/[\d]+/g);bj.length=3;return bj.join(".")}function a8(bj){return !!bj&&(bj=bj.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(bj)||bj.slice(-13)==="chrome.plugin")}function ba(bj){if(bj){bf=true;if(bj.version){a7=bb(bj.version)}if(!a7&&bj.description){a7=bb(bj.description)}if(bj.filename){bc=a8(bj.filename)}}}if(N.plugins&&N.plugins.length){bd=N.plugins["Shockwave Flash"];ba(bd);if(N.plugins["Shockwave Flash 2.0"]){bf=true;a7="2.0.0.11"}}else{if(N.mimeTypes&&N.mimeTypes.length){a6=N.mimeTypes["application/x-shockwave-flash"];bd=a6&&a6.enabledPlugin;ba(bd)}else{if(typeof a9!=="undefined"){bh=true;try{a5=new a9("ShockwaveFlash.ShockwaveFlash.7");bf=true;a7=bb(a5.GetVariable("$version"))}catch(bi){try{a5=new a9("ShockwaveFlash.ShockwaveFlash.6");bf=true;a7="6.0.21"}catch(bg){try{a5=new a9("ShockwaveFlash.ShockwaveFlash");bf=true;a7=bb(a5.GetVariable("$version"))}catch(be){bh=false}}}}}}n.disabled=bf!==true;n.outdated=a7&&R(a7)<R(aj);n.version=a7||"0.0.0";n.pluginType=bc?"pepper":bh?"activex":bf?"netscape":"unknown"};ae(an);var a3=function(){if(!(this instanceof a3)){return new a3()}if(typeof a3._createClient==="function"){a3._createClient.apply(this,aI(arguments))}};aG(a3,"version",{value:"2.2.0-beta.1",writable:false,configurable:true,enumerable:true});a3.config=function(){return aC.apply(this,aI(arguments))};a3.state=function(){return aJ.apply(this,aI(arguments))};a3.isFlashUnusable=function(){return w.apply(this,aI(arguments))};a3.on=function(){return V.apply(this,aI(arguments))};a3.off=function(){return aZ.apply(this,aI(arguments))};a3.handlers=function(){return c.apply(this,aI(arguments))};a3.emit=function(){return aB.apply(this,aI(arguments))};a3.create=function(){return L.apply(this,aI(arguments))};a3.destroy=function(){return T.apply(this,aI(arguments))};a3.setData=function(){return e.apply(this,aI(arguments))};a3.clearData=function(){return q.apply(this,aI(arguments))};a3.getData=function(){return C.apply(this,aI(arguments))};a3.focus=a3.activate=function(){return aK.apply(this,aI(arguments))};a3.blur=a3.deactivate=function(){return aD.apply(this,aI(arguments))};a3.activeElement=function(){return ab.apply(this,aI(arguments))};var aa=0;var E={};var h=0;var aw={};var J={};aF(aS,{autoActivate:true});var aP=function(a6){var a5=this;a5.id=""+aa++;E[a5.id]={instance:a5,elements:[],handlers:{}};if(a6){a5.clip(a6)}a3.on("*",function(a7){return a5.emit(a7)});a3.on("destroy",function(){a5.destroy()});a3.create()};var au=function(a5,a6){var a8,a9,bd,ba={},bc=E[this.id],a7=bc&&bc.handlers;if(!bc){throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance")}if(typeof a5==="string"&&a5){bd=a5.toLowerCase().split(/\s+/)}else{if(typeof a5==="object"&&a5&&typeof a6==="undefined"){for(a8 in a5){if(aA.call(a5,a8)&&typeof a8==="string"&&a8&&typeof a5[a8]==="function"){this.on(a8,a5[a8])}}}}if(bd&&bd.length){for(a8=0,a9=bd.length;a8<a9;a8++){a5=bd[a8].replace(/^on/,"");ba[a5]=true;if(!a7[a5]){a7[a5]=[]}a7[a5].push(a6)}if(ba.ready&&n.ready){this.emit({type:"ready",client:this})}if(ba.error){var bb=["disabled","outdated","unavailable","degraded","deactivated","overdue"];for(a8=0,a9=bb.length;a8<a9;a8++){if(n[bb[a8]]){this.emit({type:"error",name:"flash-"+bb[a8],client:this});break}}}}return this};var aL=function(a5,a6){var a8,a9,bb,bd,ba,bc=E[this.id],a7=bc&&bc.handlers;if(!a7){return this}if(arguments.length===0){bd=af(a7)}else{if(typeof a5==="string"&&a5){bd=a5.split(/\s+/)}else{if(typeof a5==="object"&&a5&&typeof a6==="undefined"){for(a8 in a5){if(aA.call(a5,a8)&&typeof a8==="string"&&a8&&typeof a5[a8]==="function"){this.off(a8,a5[a8])}}}}}if(bd&&bd.length){for(a8=0,a9=bd.length;a8<a9;a8++){a5=bd[a8].toLowerCase().replace(/^on/,"");ba=a7[a5];if(ba&&ba.length){if(a6){bb=ba.indexOf(a6);while(bb!==-1){ba.splice(bb,1);bb=ba.indexOf(a6,bb)}}else{ba.length=0}}}}return this};var aO=function(a6){var a7=null,a5=E[this.id]&&E[this.id].handlers;if(a5){if(typeof a6==="string"&&a6){a7=a5[a6]?a5[a6].slice(0):[]}else{a7=K(a5)}}return a7};var X=function(a5){if(ad.call(this,a5)){if(typeof a5==="object"&&a5&&typeof a5.type==="string"&&a5.type){a5=aF({},a5)}var a6=aF({},F(a5),{client:this});l.call(this,a6)}return this};var W=function(a7){if(!E[this.id]){throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance")}a7=aQ(a7);for(var a6=0;a6<a7.length;a6++){if(aA.call(a7,a6)&&a7[a6]&&a7[a6].nodeType===1){if(!a7[a6].zcClippingId){a7[a6].zcClippingId="zcClippingId_"+h++;aw[a7[a6].zcClippingId]=[this.id];if(aS.autoActivate===true){H(a7[a6])}}else{if(aw[a7[a6].zcClippingId].indexOf(this.id)===-1){aw[a7[a6].zcClippingId].push(this.id)}}var a5=E[this.id]&&E[this.id].elements;if(a5.indexOf(a7[a6])===-1){a5.push(a7[a6])}}}return this};var D=function(a9){var ba=E[this.id];if(!ba){return this}var a6=ba.elements;var a5;if(typeof a9==="undefined"){a9=a6.slice(0)}else{a9=aQ(a9)}for(var a7=a9.length;a7--;){if(aA.call(a9,a7)&&a9[a7]&&a9[a7].nodeType===1){a5=0;while((a5=a6.indexOf(a9[a7],a5))!==-1){a6.splice(a5,1)}var a8=aw[a9[a7].zcClippingId];if(a8){a5=0;while((a5=a8.indexOf(this.id,a5))!==-1){a8.splice(a5,1)}if(a8.length===0){if(aS.autoActivate===true){aT(a9[a7])}delete a9[a7].zcClippingId}}}}return this};var u=function(){var a5=E[this.id];return a5&&a5.elements?a5.elements.slice(0):[]};var O=function(){if(!E[this.id]){return}this.unclip();this.off();delete E[this.id]};var ad=function(a9){if(!(a9&&a9.type)){return false}if(a9.client&&a9.client!==this){return false}var bb=E[this.id];var ba=bb&&bb.elements;var a5=!!ba&&ba.length>0;var a6=!a9.target||a5&&ba.indexOf(a9.target)!==-1;var a7=a9.relatedTarget&&a5&&ba.indexOf(a9.relatedTarget)!==-1;var a8=a9.client&&a9.client===this;if(!bb||!(a6||a7||a8)){return false}return true};var l=function(a5){var bg=E[this.id];if(!(typeof a5==="object"&&a5&&a5.type&&bg)){return}var a9=Z(a5);var bc=bg&&bg.handlers["*"]||[];var bf=bg&&bg.handlers[a5.type]||[];var a8=bc.concat(bf);if(a8&&a8.length){var ba,bd,a7,a6,bb,be=this;for(ba=0,bd=a8.length;ba<bd;ba++){a7=a8[ba];a6=be;if(typeof a7==="string"&&typeof a2[a7]==="function"){a7=a2[a7]}if(typeof a7==="object"&&a7&&typeof a7.handleEvent==="function"){a6=a7;a7=a7.handleEvent}if(typeof a7==="function"){bb=aF({},a5);ak(a7,a6,[bb],a9)}}}};var aQ=function(a5){if(typeof a5==="string"){a5=[]}return typeof a5.length!=="number"?[a5]:a5};var H=function(a6){if(!(a6&&a6.nodeType===1)){return}var a5=function(a8){if(!(a8||(a8=a2.event))){return}if(a8._source!=="js"){a8.stopImmediatePropagation();a8.preventDefault()}delete a8._source};var a7=function(a8){if(!(a8||(a8=a2.event))){return}a5(a8);a3.focus(a6)};a6.addEventListener("mouseover",a7,false);a6.addEventListener("mouseout",a5,false);a6.addEventListener("mouseenter",a5,false);a6.addEventListener("mouseleave",a5,false);a6.addEventListener("mousemove",a5,false);J[a6.zcClippingId]={mouseover:a7,mouseout:a5,mouseenter:a5,mouseleave:a5,mousemove:a5}};var aT=function(ba){if(!(ba&&ba.nodeType===1)){return}var a6=J[ba.zcClippingId];if(!(typeof a6==="object"&&a6)){return}var a9,bb,a7=["move","leave","enter","out","over"];for(var a8=0,a5=a7.length;a8<a5;a8++){a9="mouse"+a7[a8];bb=a6[a9];if(typeof bb==="function"){ba.removeEventListener(a9,bb,false)}}delete J[ba.zcClippingId]};a3._createClient=function(){aP.apply(this,aI(arguments))};a3.prototype.on=function(){return au.apply(this,aI(arguments))};a3.prototype.off=function(){return aL.apply(this,aI(arguments))};a3.prototype.handlers=function(){return aO.apply(this,aI(arguments))};a3.prototype.emit=function(){return X.apply(this,aI(arguments))};a3.prototype.clip=function(){return W.apply(this,aI(arguments))};a3.prototype.unclip=function(){return D.apply(this,aI(arguments))};a3.prototype.elements=function(){return u.apply(this,aI(arguments))};a3.prototype.destroy=function(){return O.apply(this,aI(arguments))};a3.prototype.setText=function(a5){if(!E[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}a3.setData("text/plain",a5);return this};a3.prototype.setHtml=function(a5){if(!E[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}a3.setData("text/html",a5);return this};a3.prototype.setRichText=function(a5){if(!E[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}a3.setData("application/rtf",a5);return this};a3.prototype.setData=function(){if(!E[this.id]){throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance")}a3.setData.apply(this,aI(arguments));return this};a3.prototype.clearData=function(){if(!E[this.id]){throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance")}a3.clearData.apply(this,aI(arguments));return this};a3.prototype.getData=function(){if(!E[this.id]){throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance")}return a3.getData.apply(this,aI(arguments))};if(typeof define==="function"&&define.amd){define(function(){return a3})}else{if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){module.exports=a3}else{aX.ZeroClipboard=a3}}})(function(){return this||window}());(function(c){var d="blist.util.assetLoading";var l=blist.namespace.fetch(d);var a={libraries:{},translations:{}};var f={libraries:{},stylesheets:{}};var k=[];var e=[];var g;l.loadAssets=function(p,t,u){if(!c.subKeyDefined(p,"stylesheets")&&!c.subKeyDefined(p,"javascripts")&&!c.subKeyDefined(p,"templates")&&!c.subKeyDefined(p,"translations")&&!c.subKeyDefined(p,"modals")&&!c.subKeyDefined(p,"newModals")){if(_.isFunction(t)){t()}return}if(!c.isBlank(p.stylesheets)){var q=_.map(p.stylesheets,function(y){var x=h("/styles/",[y.sheet||y],"stylesheets");if(c.isPlainObject(y)){y.sheet=x[0]}else{y=x[0]}return y});l.loadStylesheets(q,u)}var s=_.isArray(p.javascripts)&&p.javascripts.length>0;var w=_.isArray(p.templates)&&p.templates.length>0;var r=_.isArray(p.modals)&&p.modals.length>0;var o=_.isArray(p.newModals)&&p.newModals.length>0;var n=_.isArray(p.translations)&&p.translations.length>0;var v=_.compact([s,w,n,r,o]).length;var m=_.after(v,function(){if(_.isFunction(t)){t()}});if(v===0){m()}if(w){l.loadPartials(h("/templates/",p.templates,"js-appended-templates"),"js-appended-templates",m)}if(r){l.loadPartials(h("/modals/",p.modals,"modals"),"modals",function(x){if(!c.isBlank(x)){x.socrataJqm()}m()})}if(o){l.loadPartials(h("/modals/",p.newModals,"newModals"),"newModals",m)}if(s){l.loadLibraries(h("/javascripts/",p.javascripts,"libraries"),m)}if(n){l.loadTranslations(p.translations,m)}};l.loadLibraries=function(o,r){var m=_.compact(_.flatten(c.arrayify(o)));if(_.isEmpty(m)){if(_.isFunction(r)){r()}return}g=$LAB;var q={queue:m,callback:r};k.push(q);var p=false;var n=[];_.each(m,function(x){var t=c.isPlainObject(x)?x.url:x;if(a.libraries[t]||f.libraries[t]){if(a.libraries[t]){p=true}return}var s=t;var w=false;if(c.subKeyDefined(x,"jsonp")){var u={};var v="callback_"+_.uniqueId();l[v]=function(){j(t)};u[x.jsonp]=d+"."+v;s+=(t.indexOf("?")>=0?"&":"?")+c.param(u);w=true}if(blist.configuration.development){if(t.indexOf("veapicore")<0){s+=(t.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}g=g.script(s);if(!w){g=g.wait(function(){j(t)})}}else{g=g.script(s);if(s.indexOf("socket.io")>-1){g=g.wait()}if(!w){n.push(t)}}a.libraries[t]=true;p=true});if(n.length>0){g=g.wait(function(){_.each(n,function(s){j(s)})})}if(!p){k=_.without(k,q);if(_.isFunction(r)){r()}}};var j=function(m){f.libraries[m]=a.libraries[m];delete a.libraries[m];var n=[];_.each(k,function(o){if(_.all(o.queue,function(p){return !_.isUndefined(f.libraries[c.isPlainObject(p)?p.url:p])})){if(_.isFunction(o.callback)){o.callback()}n.push(o)}});k=_.without.apply(this,[k].concat(n))};l.loadStylesheets=function(q,r){var p=_.chain(c.makeArray(q)).map(function(s){return !c.subKeyDefined(s,"sheet")?{sheet:s}:s}).map(function(s){return _.isArray(s.sheet)?_.map(s.sheet,function(t){return c.extend({},s,{sheet:t})}):s}).flatten().reject(function(s){return f.stylesheets[s.sheet]}).value();var o=0;var n=p.length;var m="";_.each(p,function(t){var s=t.sheet;if(blist.configuration.development){s+=(s.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}if((c.browser.msie&&c.browser.majorVersion==7&&t.hasSpecialSelectors)||(c.browser.msie&&window.parent!=window&&t.hasImages)||(c.browser.msie&&t.hasFonts)||s.startsWith("http://")||s.startsWith("https://")){n--;if(document.createStyleSheet){document.createStyleSheet(s)}else{c("head").append(c.tag({tagName:"link",type:"text/css",rel:"stylesheet",href:s}))}}else{c.socrataServer.makeRequest({url:s,contentType:"text/css",pageCache:true,dataType:"text",success:function(u){o++;if(!f.stylesheets[t.sheet]){m+=u;f.stylesheets[t.sheet]=true}if(o==n){c("head").append('<style type="text/css">'+m+"</style>\n");if(_.isFunction(r)){r()}}}})}})};l.loadPartials=function(q,p,r){if(c.isBlank(f[p])){f[p]={}}var o=_.reject(c.arrayify(q),function(s){return f[p][s]});if(o.length<1){if(_.isFunction(r)){r()}return}var n="";var m=_.after(o.length,function(){var s=c("#"+p);if(s.length<1){c("body").append(c.tag({tagName:"div",id:p}));s=c("#"+p)}var t=c(n);s.append(t);if(_.isFunction(r)){r(t)}});if(o.length===0){m()}_.each(o,function(s){var t=c.path(s);if(blist.configuration.development){t+=(t.indexOf("?")>=0?"&":"?")+c.param({_:(new Date()).valueOf().toString().slice(0,9)})}c.socrataServer.makeRequest({url:t,pageCache:true,dataType:"text",contentType:"text/html",success:function(u){if(!f[p][s]){n+=u}m();f[p][s]=true}})})};l.loadTranslations=function(m,o){var n=_.filter(c.arrayify(m),function(q){var p=false;if(c.isPlainObject(q)){p=q.force;q=q.key}if(c.subKeyDefined(blist.translations,q)&&!p){return false}if(a.translations[q]===true){return true}a.translations[q]=true;c.socrataServer.makeRequest({url:"/"+blist.locale+"/translations/"+q.replace(/\./g,"/"),contentType:"application/json",dataType:"json",success:function(r){c.extend(true,blist.translations,r);b()}});return true});if(n.length>0){e.push({queue:n,callback:o})}else{if(_.isFunction(o)){o()}}};var b=function(){e=_.filter(e,function(m){if(_.all(m.queue,function(n){return c.subKeyDefined(blist.translations,n.key||n)})){m.callback();return false}return true})};var h=function(n,o,m){return _.map(o,function(q){if(c.subKeyDefined(q,"assets")&&c.subKeyDefined(blist,"assets."+m)){return blist.assets[m][q.assets]}else{var p=c.isPlainObject(q)?q.url:q;if(p&&!p.startsWith("http")&&!p.startsWith("/")){p=n+p}if(c.isPlainObject(q)){q.url=p}else{q=p}return q}})}})(jQuery);(function(c){c.fn.combinationList=function(f){var e=c(this[0]).data("combinationList");if(!e){e=new c.combinationListObject(f,this[0])}return e};c.combinationListObject=function(e,f){this.settings=c.extend({},c.combinationListObject.defaults,e);this.currentList=f;this.init()};c.extend(c.combinationListObject,{defaults:{clipText:false,headerContainerSelector:".headerContainer",hoverOnly:false,initialSort:[],loadedCallback:function(){},scrollableBody:true,searchable:false,searchCompleteCallback:function(){},searchFormSelector:"form",selectable:true,selectionCallback:function(e){},sortable:true,sortGrouping:true,sortHeaders:{},sortTextExtraction:"complex",treeTable:false,treeColumn:0},prototype:{init:function(){var f=this;var h=c(f.currentList);h.data("combinationList",f);if(f.settings.clipText){c(window).resize(function(j){a(f)})}if(f.settings.scrollableBody){h.clone().removeAttr("id").find("tbody").remove().end().appendTo(f.settings.headerContainerSelector).end().end().find("thead").remove()}if(f.settings.selectable){h.blistSelectableList({rowSelectionHandler:function(j){f.settings.selectionCallback(j,f.selectedItems())}})}else{if(f.settings.hoverOnly){h.blistListHoverItems()}}if(f.settings.treeTable){h.treeTable({indent:0,treeColumn:f.settings.treeColumn})}if(f.settings.sortable){h.bind("sortEnd",function(j){b(f,j)});var g={headers:f.settings.sortHeaders,textExtraction:f.settings.sortTextExtraction,widgets:[]};var e={};if(f.settings.sortHeaders){_.each(f.settings.sortHeaders,function(k,j){e[j]=(k.sorter===false)})}h.find("thead th").each(function(j){if(!e[j]){c(this).addClass("sortable")}});if(f.settings.scrollableBody){g.headerNode=c(f.settings.headerContainerSelector).find("table.selectableList thead")}if(f.settings.sortGrouping){g.widgets.push("sortGrouping")}if(f.settings.initialSort.length>0){g.sortInitialOrder=f.settings.initialSort[0][1]==1?"asc":"desc"}h.tablesorter(g);d(f)}if(f.settings.searchable){h.searchable({searchFormSelector:f.settings.searchFormSelector,searchCompleteCallback:function(){f.settings.searchCompleteCallback();h.trigger("applyWidgetId","sortGrouping");a(f);if(f.settings.treeTable){h.find("tr.item.parent.filteredOut").each(function(){c(this).treeTable_disownChildren()});h.find("tr.item.parent:not(.filteredOut)").each(function(){c(this).treeTable_reparentChildren()})}}})}if(h.find("tbody tr").length<1){f.displayNoResults()}f.settings.loadedCallback()},updateList:function(f){var e=this;var g=c(e.currentList);g.find("tbody").html(f);if(e.settings.sortable){c(e.settings.headerContainerSelector).find("table tr th").removeClass("headerSortUp").removeClass("headerSortDown");d(e)}e.settings.loadedCallback();a(e);if(g.find("tbody tr").length>0){if(e.settings.treeTable){g.treeTable({indent:0,treeColumn:e.settings.treeColumn})}g.trigger("update")}else{e.displayNoResults()}},totalItemCount:function(){return c(this.currentList).find("tr.item:not(.filteredOut)").length},selectedItems:function(){return c(this.currentList).find("tr.item.selected")},displayNoResults:function(){var e=this;var g=c(e.settings.headerContainerSelector).find("table tr th").length;var f=c("<tr class='sortGroup'><td colspan='"+g+"'><div>"+c.t("controls.common.no_results")+"</div></td></tr>");c(e.currentList).find("tbody").append(f)}}});var b=function(e,f){var g=c(e.currentList);if(e.settings.treeTable){g.find("tr.child").reverse().each(function(){var h=c(this).attr("class").match(/child-of-(\S+)/);if(h&&h.length>1){var j=c("#"+h[1]);if(j.length==1){j.after(this)}}})}};var a=function(e){if(e.settings.clipText){c(e.currentList).find("tbody .clipText > *").each(function(){blist.widget.clippedText.clipElement(c(this))})}};var d=function(e){c.each(e.settings.initialSort,function(f,g){c(e.settings.headerContainerSelector).find("table tr th:nth("+g[0]+")").addClass(g[1]==1?"headerSortUp":"headerSortDown")})};c.tablesorter.addWidget({id:"sortGrouping",format:function(p){function h(r,t){var q=t.format(r.text(),p,r[0]);var s=q;if(r.hasClass("favorite")){return""}else{if(r.hasClass("type")){s=q+"s"}else{if(t.type=="text"){s=q.slice(0,1).toLowerCase()}else{if(t.id.match(/date/i)){if(q===0){s=""}else{s=blist.util.humaneDate.getFromDate(new Date(q),blist.util.humaneDate.DAY)}}}}}if(s===""){s="none"}return s}if(!p||!p.config||!p.config.sortList||p.config.sortList.length<1||p.config.sortList[0].length<1){return}var o=p.config.sortList[0][0];c("tr.sortGroup",p).remove();var f="";for(var k=0;k<p.tBodies[0].rows.length;k++){var e=c(p.tBodies[0].rows[k]);if(e.hasClass("child")||e.is(":hidden")){continue}var j=c(e[0].cells[o]);var n=h(j,p.config.parsers[o]);if(f!=n){f=n;var l=c("<tr class='sortGroup'/>");var m=p.config.headerNode[0].rows[0].cells.length;var g=c("<td colspan='"+m+"'/>");l.append(g);l.find("td:first-child").append("<div>"+f+"</div>");e.before(l)}}}})})(jQuery);$(function(){blist.namespace.fetch("blist.util.inlineLogin");blist.util.inlineLogin.verifyUser=function(l,e){var j=function(){window.location=window.location};if(!blist.currentUserId){var k=$("#login");var d=$("#signup");if(k.length<1||d.length<1){var f=this;var c=arguments;$("body").loadingSpinner().showHide(true);blist.util.assetLoading.loadAssets({modals:["inline_login"]},function(){$("body").loadingSpinner().showHide(false);if($("#login, #signup").length<2){alert("You are not logged in");return}blist.util.inlineLogin.verifyUser.apply(f,c)});return}k.jqmShow().find(".flash").text(e).addClass("notice").end().find("a.close").unbind("click.inlineLogin").bind("click.inlineLogin",function(n){n.preventDefault();k.jqmHide();l(false)}).end().find("a.signupLink").unbind("click.inlineLogin").bind("click.inlineLogin",function(n){n.preventDefault();k.jqmHide();setTimeout(function(){d.jqmShow().find(":text:first").focus().end().find(":input").val("").end().find(":checked").attr("checked",false).end().find("form").validate().resetForm();blist.util.loadCaptcha("captchaPlaceholder")},0)}).end().find("a.loginButton").unbind("click.inlineLogin").bind("click.inlineLogin",function(n){n.preventDefault();$(this).closest("form").trigger("submit.inlineLogin")}).end().find("form").unbind("keyup.inlineLogin").bind("keyup.inlineLogin",function(n){if(n.keyCode==27){k.jqmHide();l(false)}}).unbind("submit.inlineLogin").bind("submit.inlineLogin",function(o){o.preventDefault();var n=$(this);$.ajax({url:"/login.json",type:"POST",data:n.find("input[name=authenticity_token], input#user_session_login, input#user_session_password, input#user_session_remember_me:checked"),dataType:"json",success:function(p){if(p.error){k.find(".flash").text(p.error);k.find(":text:first").focus().select()}else{blist.currentUserId=p.user_id;k.jqmHide();$("#header .userNav, #siteHeader .siteUserNav").addClass("loggedInNav").find(".signOutLink").removeClass("hide");l(true,j)}}})}).find(":text:first").focus();d.find("a.close").unbind("click.inlineLogin").bind("click.inlineLogin",function(n){n.preventDefault();d.jqmHide();l(false)}).end().find("a#signup_submit").unbind("click.inlineLogin").bind("click.inlineLogin",function(n){n.preventDefault();$(this).closest("form").trigger("submit.inlineLogin")}).end().find("form").unbind("keyup.inlineLogin").bind("keyup.inlineLogin",function(n){if(n.keyCode==27){d.jqmHide();l(false)}}).unbind("submit.inlineLogin").bind("submit.inlineLogin",function(o){o.preventDefault();var n=$(this);if(n.valid()){var p={};n.find(":input").each(function(){var q=$(this);if(q.is(":checkbox")){p[q.attr("name")]=q.value()}else{p[q.attr("name")]=q.val()}});$.ajax({url:"/signup.json",type:"POST",data:p,dataType:"json",success:m})}});var h=d.find("label.password");if(!h.data("passwordHint")){var b=$("<div/>").append($.t("account.common.form.password_requirements_html"));h.addClass("about").append('<span class="icon">&nbsp;</span>').data("passwordHint",true);d.find("span.icon").socrataTip({content:b,onModal:true})}var g=function(o){var n=o.find(".flash");if(n.length===0){n=$("<div/>",{"class":"flash"}).insertAfter(o.find("h2"))}return n};var m=function(n){if(n&&(n.error||n.notice)){if(n.error){if(_.isArray(n.error)){n.error=n.error.join(" ").split("|").map(function(o){return"<p>"+o+"</p>"}).join("")}if(n.promptLogin){d.jqmHide();_.defer(function(){k.jqmShow().find(":text:first").focus();g(k).html(n.error).addClass("error")})}else{g(d).html(n.error).addClass("error");d.find(":text:first").focus().select()}}else{if(n.notice){d.jqmHide();_.defer(function(){k.jqmShow().find(":text:first").focus();g(k).html(n.notice).addClass("notice")})}}}else{if(n&&n.user_id){blist.currentUserId=n.user_id}d.jqmHide();k.jqmHide();$("#header .userNav, #siteHeader .siteUserNav").addClass("loggedInNav").find(".signOutLink").removeClass("hide");l(true,j)}}}else{l(true)}};var a=function(){$("#login").jqm({trigger:false});$("#signup").jqm({trigger:false})};a()});(function(b){b.fn.wizardPrompt=function(d){var c=b(this[0]).data("wizardPrompt");if(!c){c=new a(d,this[0])}return c};var a=function(c,d){this.settings=b.extend({},a.defaults,c);this.currentDom=d;this.init()};b.extend(a,{defaults:{buttons:null,buttonCallback:null,closeCallback:null,closeEvents:null,closeSelector:"a:not(.wizExclude), :input:not(.wizExclude)",positions:null,prompt:null},prototype:{init:function(){var g=this;var f=g.$dom();f.data("wizardPrompt",g);g._uid=_.uniqueId();var c=b('<div class="wizardPrompt"><a href="#close" title="Dismiss" class="wizardDismiss"></a><span class="prompt">'+g.settings.prompt+"</span></div>");if(!_.isEmpty(g.settings.buttons)){c.append('<ul class="actionButtons"></ul>');var d=c.find("ul.actionButtons");_.each(g.settings.buttons,function(j){var k=b.button(b.htmlEscape(j.text));k.data("wizardValue",j.value);d.append(b("<li></li>").append(k))})}c.find(".actionButtons a").click(function(j){j.preventDefault();if(!_.isNull(g.settings.buttonCallback)){g.settings.buttonCallback(b(this).data("wizardValue"))}_.defer(function(){g.close()})});c.children(".wizardDismiss").click(function(j){j.preventDefault();if(_.isFunction(g.settings.dismissCallback)){g.settings.dismissCallback()}g.close()});f.socrataTip({content:c,closeOnClick:false,overlap:-10,trigger:"now",killTitle:false,positions:g.settings.positions});var e=g.settings.closeEvents;if(_.isNull(e)){e="click, change"}var h=f.find(g.settings.closeSelector).andSelf().filter(g.settings.closeSelector);if(typeof e=="string"){e=e.replace(/\s+/g,"").split(",")}_.each(e,function(j){h.bind(j+".wizardPrompt"+g._uid,function(k){g.close()})})},$dom:function(){if(!this._$dom){this._$dom=b(this.currentDom)}return this._$dom},close:function(){var c=this;c.$dom().socrataTip().destroy();c.$dom().removeData("wizardPrompt");var d=c.$dom().find(c.settings.closeSelector);d.unbind(".wizardPrompt"+c._uid);if(!_.isNull(c.settings.closeCallback)){c.settings.closeCallback()}}}})})(jQuery);(function(c){var d=false;var b={};var a={};c.fn.popupSelect=function(e){var f=c.extend({},c.fn.popupSelect.defaults,e);return c.each(this,function(){var j=c(this);var g=_.uniqueId();var k=c.tag({tagName:"div","class":"popupSelectContainer","data-popupid":g,contents:[{tagName:"p","class":"popupSelectPrompt",contents:f.prompt},{tagName:"ul","class":["popupSelectList"].concat(c.arrayify(f.listContainerClass))}]});j.data("popupSelect-$popup",k);$list=k.find(".popupSelectList");_.each(f.choices,function(m){var o=_.uniqueId();a[o]=m;var n;if(_.isFunction(f.isSelected)){n=f.isSelected(m)}else{n=_.include(c.arrayify(f.selectedItems),m)}var l=c.tag({tagName:"li","class":["none",{value:"checked",onlyIf:n}],"data-itemid":o,contents:[{tagName:"span","class":"icon selectedIcon"},{tagName:"div","class":"contentWrapper",contents:f.renderer(m)}]});$list.append(l)});var h=j.socrataTip({content:k,fill:"#444444",isSolo:true,onShowCallback:f.onShowCallback,shownCallback:function(l){c(l).find(".popupSelectList").lockScroll(true)},stroke:"#444444",trigger:"click"});j.data("popupSelect-tip",h);b[g]={opts:f,selectedItems:_.compact(c.arrayify(f.selectedItems)),tip:h};j.parents().on("scroll",function(){h.hide()});if(!d){c.live(".popupSelectList li","click",function(m){var l=c(this);var o=l.closest(".popupSelectContainer");var n=b[o.attr("data-popupid")];if(n.opts.selectCallback(a[l.attr("data-itemid")],!l.hasClass("checked"))){if(n.opts.multiselect){l.toggleClass("checked")}else{l.siblings().removeClass("checked");l.addClass("checked")}}else{if(f.canDeselect){l.removeClass("checked")}}n.selectedItems=c.makeArray(l.siblings().andSelf().filter(".checked").map(function(){return a[c(this).attr("data-itemid")]}));if(n.opts.dismissOnClick){n.tip.hide()}});d=true}})};c.fn.popupSelect_update=function(e){return this.each(function(){var h=c(this);var j=h.data("popupSelect-$popup");var f=j.find(".popupSelectList");var g=b[j.attr("data-popupid")];var k=_.intersection(g.selectedItems,e);h.popupSelect(c.extend({},g.opts,{choices:e,selectedItems:k}))})};c.fn.popupSelect_selectedItems=function(){return b[this.data("popupSelect-$popup").attr("data-popupid")].selectedItems};c.fn.popupSelect.defaults={canDeselect:false,choices:[],dismissOnClick:true,isSelected:null,listContainerClass:[],multiselect:false,onShowCallback:null,positions:["bottom","top"],prompt:"Choose one:",renderer:function(e){return e},selectCallback:function(e,f){return true},selectedItems:null}})(jQuery);var blistCommonNS=blist.namespace.fetch("blist.common");blistCommonNS.formInliner=function(c){var b=$(c.target);var a=b.data("dataset").cleanCopy();if(b.find("input[name=view]").size()>0){return}b.append($('<input type="hidden" name="view"/>').val(JSON.stringify(a))).append($('<input type="hidden" name="method" value="index" />'))};(function(a){a.fn.downloadToFormCatcher=function(c,b){return this.each(function(){var d=a(this);var e;d.off(".downloadToFormCatcher");d.on("click.downloadToFormCatcher",function(h){var j=_.isUndefined(e)||(_.now()-e)>(30*1000);if(!j){return false}e=_.now();if(c.temporary!==true){return true}h.preventDefault();var g=d.attr("href").replace(/\w{4}-\w{4}/,"INLINE");var f=a("<form>").attr("ACTION",g).attr("method","post");f.data("dataset",c);(b||d).append(f);f.bind("submit",blistCommonNS.formInliner);f.submit()})})}})(jQuery);(function(a){a.fn.expander=function(b){var c=a.extend({},a.fn.expander.defaults,b);return this.each(function(){var g=a(this);var f=a.meta?a.extend({},c,g.data()):c;g.data("config-expander",f);var e=g.find(f.contentSelector);var h=g.find(f.expandSelector);e.removeClass("collapsed");var d=e.height();e.addClass("collapsed");if(!f.forceExpander&&(a.isBlank(e.text())||(d==e.height()))){h.hide();e.removeClass("collapsed");return}h.addClass(f.expanderCollapsedClass);h.click(function(l){l.preventDefault();if(h.hasClass(f.expanderCollapsedClass)){f.preExpandCallback(g);var k=e.css("height");e.removeClass("collapsed").css("height","");var j=e.height();g.removeClass("collapsed");if(f.animate){e.css("height",k).animate({height:j},f.resizeFinishCallback)}else{e.height(j);f.resizeFinishCallback()}h.removeClass(f.expanderCollapsedClass).addClass(f.expanderExpandedClass).attr("title",a.t("controls.common.expander.collapse"))}else{e.addClass("collapsed").css("height","");var k=e.height();e.removeClass("collapsed");var m=function(){e.css("display","");e.addClass("collapsed");g.addClass("collapsed");f.resizeFinishCallback()};if(f.animate){e.animate({height:k},m)}else{e.height(k);m()}h.removeClass(f.expanderExpandedClass).addClass(f.expanderCollapsedClass).attr("title",a.t("controls.common.expander.expand"))}})})};a.fn.expander.defaults={animate:true,contentSelector:".content",expanderCollapsedClass:"downArrow",expanderExpandedClass:"upArrow",expandSelector:".expand",forceExpander:false,moveExpandTrigger:false,preExpandCallback:function(b){},resizeFinishCallback:function(){}}})(jQuery);(function(e){var g={".commentActions .commentInappropriateLink":function(h){return h.context.commentFlagged?e.t("controls.feed.comment_actions.already_marked_inappropriate"):e.t("controls.feed.comment_actions.inappropriate")},".commentActions .commentInappropriateLink@class+":function(h){return h.context.commentFlagged?"disabled":""},".commentActions .upRatings":function(h){return(h.context.upRatings>0)?("+"+h.context.upRatings):""},".commentActions .downRatings":function(h){return(h.context.downRatings>0)?("-"+h.context.downRatings):""},".commentActions .rateUp@class+":function(h){return(!_.isUndefined(h.context.currentUserRating)&&h.context.currentUserRating.thumbUp===true)?" ratedUp":""},".commentActions .rateDown@class+":function(h){return(!_.isUndefined(h.context.currentUserRating)&&h.context.currentUserRating.thumbUp===false)?" ratedDown":""},".commentActions@class+":function(h){return _.compact([(_.get(h.context,"user.id")==blist.currentUserId)?"ownItem":null,((!_.isUndefined(blist.currentUser)&&_.include(blist.currentUser.rights,blist.rights.user.MODERATE_COMMENTS))?"isModerator":null)]).join(" ")}};var c={comment:g,reply:g,view:{".viewDetails@class+":"viewType",".viewName":"viewName!",".viewName@href":"viewPath",".viewDescription":"viewDescription!"}};var f={};e(function(){_.each(["comment","view","reply"],function(h){f[h]=e.compileTemplate("feedItem_"+h,c[h])})});var d=function(h,j){return _.detect(j.views.concat(j.mainView),function(k){return k.id==h})};e.fn.feedList=function(t){var j=e.extend({},e.fn.feedList.defaults,t);var q={".@class+":function(u){return _.compact([(j.highlightCallback(u.item)?u.item.itemType+" specialFeedItem":u.item.itemType),(u.item.itemDeleted?"itemDeleted":null)]).join(" ")},".@data-itemId":"feedItem.itemId",".feedCommon@class+":"feedItem.itemType",".feedActor":"feedItem.user.displayName!",".feedActor@href":function(u){return new User(u.item.user).getProfileUrl()},".feedBody":"feedItem.body!",".feedTimestamp":function(u){return blist.util.humaneDate.getFromDate(u.item.timestamp*1000)},".feedCustom":function(u){var v=f[u.item.itemType];return _.isFunction(v)?v(u.item):""}};var k=e.compileTemplate("feedItem",{li:{"feedItem<-":q}});var s={li:{"feedItem<-":e.extend({},q,{".@data-serialId":"feedItem.serialId",".feedChildren":function(u){return _.isArray(u.item.children)?k(u.item.children):""},".feedChildren@class+":function(u){return(_.isUndefined(u.item.children)||(u.item.childCount===0))?"hide":""},".replyViewAllLink":function(u){return e.t("controls.feed.listing.all_replies_with_count",{count:u.item.childCount})},".replyViewAllLink@class+":function(u){return(_.isUndefined(u.item.children)||(u.item.childCount<=j.replyPageLimit))?"hide":""}})}};var o=function(v,u){return{itemType:u||"comment",itemId:v.id,body:_.compact([v.title,v.body]).join(" "),timestamp:v.createdAt,downRatings:v.downRatings,upRatings:v.upRatings,currentUserRating:v.currentUserRating,commentFlagged:_.include(v.flags||[],"flaggedByCurrentUser"),user:v.user,viewId:(v.view?v.view.id:null),children:_.isUndefined(v.children)?[]:_.map(v.children,function(w){return o(w,"reply")})}};var n=_.map(_.reject(j.comments,function(u){return e.isBlank(u.title)&&e.isBlank(u.body)}),function(u){return o(u)});var r=_.map(j.views,function(u){return{itemType:"view",itemId:u.id,body:e.t("controls.feed.listing.user_create_action",{thing:u.displayName}),timestamp:u.createdAt,viewName:u.name,viewType:"type"+u.styleClass,viewPath:u.url,viewDescription:u.description,user:u.owner}});var p=n.concat(r);p.sort(function(v,u){return u.timestamp-v.timestamp});var m={};var l=[];var h=function(u){if(!_.isUndefined(u.children)){u.childCount=u.children.length;u.allChildren=u.children;u.children=u.allChildren.slice(0,j.replyPageLimit)}u.serialId=_.uniqueId();m[u.serialId]=u;return u};p=_.map(p,h)||[];return this.each(function(){var C=e(this);var D=C;var u=j.$scrollContainer||C.closest(j.scrollContainerSelector);var y=C.find(".feedFilter");var w=C.find(".feedList");var E=C.find(".feedMoreItemsLink");var A=C.find(".moderationNotice");if(!_.isArray(j.filterCategories)||(j.filterCategories.length===0)){C.find(".feedFilterLine").hide()}else{y.empty().append(e.tag(_.map(j.filterCategories,function(F){return{tagName:"option",value:F,contents:e.t("controls.feed.types."+F)}}),true)).val(j.defaultFilter||_.first(j.filterCategories));if(!e.isBlank(e.uniform)&&!e.isBlank(e.uniform.update)){e.uniform.update(y)}}var z=function(F){if(F=="all items"){return p}else{var G={view:"views",comment:"comments",replies:"comments"};return _.select(p,function(H){return G[H.itemType]==F})}};var x=function(I){var H=j.pageSize;if(I){H=j.firstPageSize||j.pageSize}var F=w.children().length;w.append(e.renderTemplate("feedItem",l.slice(F,F+H),s));var G=l.length-F-H;E.show();if(G<=0){E.hide()}else{if(G==1){E.text(e.t("controls.feed.listing.last_item"))}else{E.text(e.t("controls.feed.listing.next_item_page",{count:Math.min(G,j.pageSize)}))}}if(!I){u.animate({scrollTop:Math.min(C.outerHeight(true)-u.height(),u.scrollTop()+u.height())},"slow")}else{C.find(".noResults").toggleClass("hide",w.children().length>0)}};var B=function(K,F){var J=b(D);if(e.isBlank(J)){return}var I=h(o(K));if(!e.subKeyDefined(F,"id")){J.feedData.unshift(I);D.children(".feedList").prepend(e.renderTemplate("feedItem",[I],s))}else{var H=D.find('.feedItem[data-itemid="'+F.id+'"]');if(H.length<1){return}I.itemType="reply";var G=J.feedMap[a(H)];G.allChildren.unshift(I);G.children.unshift(I);G.children.splice(j.replyPageLimit,1);H.find(".feedChildren").removeClass("hide").prepend(k([I]))}D.find(".noResults").addClass("hide")};E.click(function(F){F.preventDefault();x()});y.change(function(F){l=z(e(this).val());w.empty();x(true)});if(!j.hideFeed){l=z(j.defaultFilter);x(true)}C.data("feedList-data",{feedData:l,feedMap:m,opts:j});C.delegate(".replyViewAllLink","click",function(F){F.preventDefault();var H=e(this);var G=b(H);H.siblings(".feedChildren").empty().append(k(G.feedMap[a(H)].allChildren));H.remove()});if(!j.hideFeed){_.each(j.views,function(F){F.bind("new_comment",B)},C)}else{D.find(".feedList, .feedMoreItemsLink, .noResults").addClass("hide")}if(j.bindCommentEvents===true){C.delegate(".commentActions a","click",function(H){H.preventDefault();var K=e(this);var I=b(K);var M=I.feedMap[a(K,".comment")];var F=K.closest(".feedItem.reply");if(F.length>0){var J=parseInt(F.attr("data-itemId"));M=_.detect(M.allChildren,function(N){return N.itemId==J})}if(K.is(".commentInappropriateLink:not(.disabled)")){blist.util.doAuthedAction(e.t("controls.feed.authed_actions.flag_comment"),function(N){j.actionDelegate(M,j).flagComment(M.itemId,function(){M.commentFlagged=true;K.fadeOut(function(){K.addClass("disabled").text(e.t("controls.feed.comment_actions.marked_inappropriate")).fadeIn()});if(_.isFunction(N)){N()}})})}else{if(K.is(".commentDeleteLink")){blist.util.doAuthedAction(e.t("controls.feed.authed_actions.delete_comment"),function(N){j.actionDelegate(M,j).removeComment(M.itemId,function(){M.itemDeleted=true;K.closest(".feedItem").animate({opacity:0.3},2000);if(_.isFunction(N)){N()}})})}else{if(K.is(".commentRateUpLink:not(.ratedUp)")||K.is(".commentRateDownLink:not(.ratedDown)")){var G=K.hasClass("commentRateUpLink");blist.util.doAuthedAction(e.t("controls.feed.authed_actions.rate_comment"),function(N){j.actionDelegate(M,j).rateComment(M.itemId,G,function(){var O=G?"up":"down";if(!_.isUndefined(M.currentUserRating)){M[(G?"down":"up")+"Ratings"]--;K.closest("li").siblings().removeClass("ratedUp ratedDown")}M.currentUserRating={thumbUp:G};M[O+"Ratings"]++;K.closest("li").addClass("rated"+O.capitalize());_.each({up:"+",down:"-"},function(P,Q){var R=P+M[Q+"Ratings"];if(M[Q+"Ratings"]===0){R=""}K.closest("li").siblings("."+Q+"Ratings").text(R)});if(_.isFunction(N)){N()}})})}else{if(K.is(".commentReplyLink")&&(K.closest(".feedItem").children(".newCommentForm").length===0)){var L=e.renderTemplate("feedItem_newComment");L.find(".postNewCommentButton").data("view",j.actionDelegate(M,j));K.closest(".feedItem").children(".feedChildren").before(L);K.closest(".feedItem").find("#newCommentBody").focus()}}}}});C.delegate(".newCommentForm .cancelNewCommentButton","click",function(F){F.preventDefault();var G=e(this);if(e.isBlank(G.siblings("#newCommentBody").val())||confirm(e.t("controls.feed.comment_actions.delete_confirm"))){G.closest(".newCommentForm").remove()}});C.delegate(".newCommentForm .postNewCommentButton","click",function(H){H.preventDefault();var J=e(this);var F=J.data("view");var I=J.siblings("#newCommentBody").val();if(!e.isBlank(I)){J.siblings(".error").slideUp();var G=e.extend({},j.commentCreateData,{body:I});var K=parseInt(J.closest(".feedItem").attr("data-itemId"));if(_.isNumber(K)&&!isNaN(K)){G.parent={id:K}}blist.util.doAuthedAction(e.t("controls.feed.authed_actions.post_comment"),function(L){F.addComment(G,function(M){if(M.status=="pending"){J.closest(".newCommentForm").remove();A.fadeIn(300,function(){A.effect("highlight",5000)});return}var N=h(o(M));if(_.isFunction(j.addCommentCallback)){j.addCommentCallback(F,N)}J.closest(".newCommentForm").remove();if((j.alwaysShowNewCommentForm===true)&&(D.find(".newCommentForm").length===0)){v(D.find(".noResults"),j.mainView)}if(_.isFunction(L)){L()}},function(M){J.siblings(".error").slideDown().text(JSON.parse(M.responseText).message)})})}else{J.siblings(".error").text(e.t("controls.feed.comment_form.empty_body_error")).slideDown()}});C.delegate(".feedNewCommentButton","click",function(F){F.preventDefault();var G=e(this);if(G.siblings(".newCommentForm").length===0){v(G,b(G).opts.mainView);G.siblings(".newCommentForm").find("#newCommentBody").focus()}});var v=function(G,F){var H=e.renderTemplate("feedItem_newComment");H.find(".postNewCommentButton").data("view",F);G.after(H)};if(j.alwaysShowNewCommentForm===true){v(C.find(".noResults"),j.mainView)}}})};var b=function(h){return h.closest(".feed").data("feedList-data")};var a=function(h,j){return parseInt(h.closest(".feedItem"+(j||"")).attr("data-serialId"))};e.fn.feedList.defaults={addCommentCallback:function(h,j){},actionDelegate:function(j,h){return d(j.viewId,h)},alwaysShowNewCommentForm:false,bindCommentEvents:true,commentCreateData:{},comments:[],defaultFilter:"comments",filterCategories:["all items","comments","views"],hideFeed:false,highlightCallback:function(h){return blist.dataset&&((h.user||{}).id==blist.dataset.tableAuthor.id)},firstPageSize:null,mainView:null,pageSize:20,replyPageLimit:2,scrollContainerSelector:".scrollContent",views:[]}})(jQuery);(function(a){a.fn.stars=function(b){var c=a.extend({},a.fn.stars.defaults,b);return this.each(function(){var d=a(this);d.addClass("jsEnabled");if(!a.isBlank(c.value)){d.attr("data-rating",c.value);d.attr("title",a.t("controls.common.stars.tooltip",{number:c.value}));d.find(":radio").eq(parseInt(c.value)).attr("checked","checked")}d.on("change",function(f){_.defer(function(){if(_.isFunction(c.onChange)){c.onChange(d.find(":radio:checked").val())}})})})};a.fn.stars.defaults={onChange:function(b){},value:null}})(jQuery);(function(d){d.fn.contentIndicator=function(e){var f=d(this[0]).data("contentIndicator");if(!f){f=new c(e,this[0])}return f};var c=function(e,f){this.settings=d.extend({},c.defaults,e);this.currentDom=f;this.init()};d.extend(c,{defaults:{left:"-5px",text:"",top:"-5px"},prototype:{init:function(){var f=this;var e=f.$dom();e.data("contentIndicator",f);if(d.isBlank(f.settings.text)){return}b(f)},$dom:function(){if(!this._$dom){this._$dom=d(this.currentDom)}return this._$dom},setText:function(e){var f=this;f.settings.text=e||"";a(f)}}});var b=function(e){e.$dom().addClass("contentIndicatorContainer");e.$dom().append(d.tag({tagName:"span","class":"contentIndicator",style:{left:e.settings.left,top:e.settings.top,display:d.isBlank(e.settings.text)?"none":"block"},contents:e.settings.text}))};var a=function(e){if(!e.$dom().hasClass("contentIndicatorContainer")){b(e);return}e.$dom().find(".contentIndicator").text(e.settings.text).toggle(!d.isBlank(e.settings.text))}})(jQuery);(function(d){d.fn.userPicker=function(f){var g=d(this[0]).data("userPicker");if(!g){g=new b(f,this[0])}return g};var b=function(f,g){this.settings=d.extend({},b.defaults,f);this.currentDom=g;this.init()};d.extend(b,{defaults:{chooseCallback:function(f){},filterCallback:function(f){return true},limit:10,valueFunction:function(f){return f.id}},prototype:{init:function(){var g=this;var f=g.$dom();f.data("userPicker",g);f.attr("autocomplete","off");f.closest("form").attr("autocomplete","off");f.awesomecomplete({attachTo:g.settings.attachTo||f.offsetParent(),forcePosition:true,suggestionListClass:"autocomplete userPicker",typingDelay:500,dataMethod:function(j,h,k){e(g,j,k)},renderFunction:c,onComplete:function(h){a(g,h)},valueFunction:g.settings.valueFunction})},$dom:function(){if(!this._$dom){this._$dom=d(this.currentDom)}return this._$dom}}});var e=function(h,g,j){g=d.trim(g);if(d.isBlank(g)){j([]);return}var f=g.match(/\w{4}-\w{4}$/);if(!d.isBlank(f)){User.createFromUserId(f[0],function(k){j([]);if(h.settings.filterCallback(k)){a(h,k)}},function(){j([])})}else{d.Tache.Get({url:"/api/search/users.json",data:{limit:h.settings.limit,q:g},success:function(k){j(_.chain(k.results||[]).map(function(l){return new User(l)}).select(h.settings.filterCallback).value())}})}};var c=function(f,g){return'<p class="title">'+f.displayName+'</p><p class="matchRow"><span class="matchedField">Email:</span> '+f.email+"</p>"};var a=function(g,f){g.settings.chooseCallback(f)}})(jQuery);(function(l){var d=blist.namespace.fetch("blist.mixpanel");var q=function(){return !l.browser.msie||l.browser.majorVersion>7};var s=function(E){if(blist.mixpanelLoaded){var G=_.any(E.currentElements,function(J){return J.name.match(/chart_create/)});var H=_.any(E.errorList,function(J){return J.message!=l.t("core.validation.required")});if(G&&H){var F=_.find(E.currentElements,function(J){return J.dataset.origname==="displayFormat.chartType"}).dataset.datavalue.replace(/"/g,"");if(F.match(/stacked/)){var C=F.replace("stacked","");F="Stacked "+C.capitalize()}else{F=F.capitalize()}var D=_.get(E,"lastActive.name");var I=_.get(E.errorMap,D,"No error message provided");d.trackUserError({Product:"Classic Visualizations","Message Shown":I,"Chart/Map Type":F})}}};l.validator.addMethod("data-notEqualTo",function(F,D,G){if(this.optional(D)){return true}var E=false;var C=l(D);if(!C.is(":visible")){return true}l(G+":visible").each(function(I,J){var H=l(J);if(C.index(H)<0&&H.val()==F){E=true;return false}});return !E},l.t("screens.ds.grid_sidebar.base.validation.different_value"));l.validator.addMethod("data-onlyIfInput",function(D,C,E){if(this.optional(C)){return true}return _.isNull(C.className.match(/\bsectionDisabled-/))},l.t("screens.ds.grid_sidebar.base.validation.invalid_value"));l.validator.addMethod("data-custom-4x4uid",function(E,C,G){var D=E;if(l.isBlank(D)||D==l(C).attr("title")||D.match(blist.util.patterns.UID)){return true}var F=D.match(/(\/[a-zA-Z0-9_\-]+){1,2}\/(\w{4}-\w{4})/);if(l.isBlank(F)){return false}else{l(C).val(F[2])}return true},l.t("screens.ds.grid_sidebar.base.validation.uid_required"));l.validator.addMethod("data-custom-fieldName",function(D,C,E){return D==Column.sanitizeName(D)},l.t("screens.ds.grid_sidebar.base.validation.identifier_format"));l.validator.addMethod("data-requiredTypes",function(D,C,E){if(this.optional(C)){return true}return l.isBlank(E)},function(C){l.t("screens.ds.grid_sidebar.base.validation.file_format",{formats:C})});l.validator.addMethod("data-custom-validlayerurl",function(F,E,G){if(this.optional(E)){return true}if(G=="valid"){return true}if(_.include(["invalid","verifying"],G)){return false}var C=l(E);var D=this;C.attr("data-custom-validlayerurl","verifying");l.getJSON("/proxy/verify_layer_url",{url:F},function(H){if(H.value){C.val(H.value);C.attr("data-custom-validlayerurl","valid");C.closest(".inputBlock").find("select option:selected").attr("data-custom-type",H.data.type)}else{C.attr("data-custom-validlayerurl","invalid")}D.element(E)})},function(D,C){return _.include(["unverified","verifying"],D)?l.t("screens.ds.grid_sidebar.base.validation.verifying_url"):l.t("screens.ds.grid_sidebar.base.validation.invalid_url")});l.validator.addMethod("data-validateMin",function(D,C,E){D=parseInt(D);if(_.isNaN(D)){return false}return D>=parseFloat(E)},function(D,C){return !_.isNaN(parseInt(D))?l.t("screens.ds.grid_sidebar.base.validation.at_least",{value:l(C).attr("data-validateMin")}):l.t("screens.ds.grid_sidebar.base.validation.numeric")});l.validator.addMethod("data-validateMax",function(D,C,E){D=parseInt(D);if(_.isNaN(D)){return false}return D<=parseFloat(E)},function(D,C){return !_.isNaN(parseInt(D))?l.t("screens.ds.grid_sidebar.base.validation.no_greater",{value:l(C).attr("data-validateMax")}):l.t("screens.ds.grid_sidebar.base.validation.numeric")});l.controlPane={buttons:{create:{text:l.t("screens.ds.grid_sidebar.base.buttons.create"),value:true,isDefault:true,requiresLogin:true},update:{text:l.t("screens.ds.grid_sidebar.base.buttons.update"),value:true,isDefault:true,requiresLogin:true},apply:{text:l.t("screens.ds.grid_sidebar.base.buttons.apply"),value:true,isDefault:true},done:{text:l.t("screens.ds.grid_sidebar.base.buttons.done"),value:false,isDefault:true},cancel:{text:l.t("screens.ds.grid_sidebar.base.buttons.cancel"),value:false,isCancel:true}}};l.Control.extend("controlPane",{_init:function(){var C=this;C._super.apply(C,arguments);C.$dom().loadingSpinner({overlay:true});C.$dom().append(l.tag([{tagName:"div","class":"disabledOverlay"},{tagName:"p","class":"disabledMessage"}]));C._selectOptions={};C._customCallbacks={};C._customSections={};C._columnSelects=[];C._fieldOnlyIfs={};C._fieldDisabled={};C._changeHandlers={};C._isDirty=true;C._visible=false;C._isReady=true;C.setView(C.settings.view);C.$dom().attr("id","controlPane_"+C.settings.name+"_"+_.uniqueId()).addClass("controlPane "+C.settings.name);if(C.settings.noReset){C.$dom().addClass("noReset")}},$content:function(){if(l.isBlank(this._$content)){this._$content=l.tag({tagName:"form","class":["commonForm",{value:"minimal",onlyIf:this.settings.minimalDisplay}]});this.$dom().append(this._$content)}return this._$content},setView:function(D){var C=this;if(!l.isBlank(C._view)){C._view.unbind(null,null,C)}C._view=D;if(l.isBlank(D)){return}C._view.bind("columns_changed",function(){x(C)},C)},isAvailable:function(){return true},getTitle:function(){return""},getSubtitle:function(){return""},getDisabledSubtitle:function(){return""},shown:function(){this._visible=true},hidden:function(){this._visible=false},render:function(I,G,H){H=H||function(){};var J=this;var F=J.$content();if(!J._isReady){if(l.isBlank(J._cachedRender)||!l.isBlank(I)){J._cachedRender={data:I,isTempData:G}}J._startProcessing();H(false);return}J._finishProcessing();if((l.isBlank(I)||_.isEqual(I,J._getCurrentData()))&&!J._isDirty){H(false);return}F.find(".line.custom").each(function(){z(J,l(this))});F.find("[data-customContent]").each(function(){p(J,l(this))});F.empty();if(!J.isAvailable()){H(false);return}if(l.isBlank(I)){I=J._getCurrentData()}else{if(!G){this._data=I}}if(!l.isBlank(I)){I=J._dataPreProcess(I)}this._curData=I;var E={title:J.getTitle(),subtitle:J.getSubtitle(),sections:J._getSections(),paneId:J.$dom().attr("id"),data:I||{}};if(!J._isReadOnly()&&J.settings.showFinishButtons){E.finishButtons=J._getFinishButtons()}else{E.readOnlyMessage=J._getReadOnlyMessage()}var D=function(){var K={};var M;var O={".subtitle":"subtitle",".subtitleBlock@class+":function(P){return l.isBlank(P.context.subtitle)?"hide":""},".readOnlyMessage":"readOnlyMessage",".readOnlyBlock@class+":function(P){return l.isBlank(P.context.readOnlyMessage)?"hide":""},".formSection":{"section<-sections":{"@class+":function(P){M=_.uniqueId();return _.compact([P.item.type,P.item.name,(P.item.initShow?"initShow":""),(P.item.validateCollapsed?"validateCollapsed":""),(!l.isBlank(P.item.onlyIf)||P.item.type=="hidden"?"hide":""),(!l.isBlank(P.item.customContent))?"custom":""].concat(l.arrayify(P.item.customClasses))).join(" ")},"@data-onlyIf":function(P){if(!l.isBlank(P.item.onlyIf)){var Q=_.uniqueId();K[Q]=l.arrayify(P.item.onlyIf);return Q}return""},"@data-customContent":function(P){if(!l.isBlank(P.item.customContent)){var Q=_.uniqueId();J._customSections[Q]=P.item.customContent;return Q}return""},"@name":function(P){return(P.item.name||"")+"_"+M},".formHeader+":"section.title",".formHeader@for":function(P){return(P.item.name||"")+"_"+M},".formHeader@class+":function(P){return l.isBlank(P.item.title)?"hide":""},".sectionSelect@id":function(P){return(P.item.name||"")+"_"+M},".sectionSelect@name":function(P){return(P.item.name||"")+"_"+M},".sectionContent+":function(P){return _.map(P.item.fields||[],function(R,Q){return b(J,{context:l.extend({},P.context,{sectionName:P.item.name,sectionOptions:{showIfData:P.item.showIfData}}),item:R,items:P.item.fields,pos:Q})}).join("")}}},".finishButtons > li":{"button<-finishButtons":{".+":function(P){var Q={text:P.item.text,className:[],customAttrs:{"data-value":P.item.value,"data-loginMsg":P.item.loginMessage}};if(P.item.isDefault){Q.className.push("arrowButton");Q.iconClass="submit"}else{if(P.item.isCancel){Q.iconClass="cancel"}}if(P.item.requiresLogin){Q.className.push("requiresLogin")}return l.button(Q,true)}}}};F.append(l.renderTemplate(J.getTemplateName(),E,O));F.toggleClass("readOnly",J._isReadOnly());if(F.find("label.required").length>0){F.find("div.required").removeClass("hide")}var N=J.$dom().find(".formSection");var L=J.$dom().find("input, select, textarea");_.each(K,function(Q,P){t(J,Q,P,N,L)});F.find(".formSection.selectable").each(function(){var P=l(this),Q=false;P.find("[data-dataValue]").each(function(){var T=l(this),R=T.attr("type")=="checkbox",S=T.hasClass("colorInput");Q=Q||(!S&&!R)||(S&&"["+T.attr("data-dataValue")+"]"!=T.attr("data-defaultValue"))||(R&&T.attr("data-dataValue")!=T.attr("data-defaultValue"))});Q=Q||P.hasClass("initShow");P.toggleClass("collapsed",!Q);P.find(".sectionSelect").value(Q)});if(!J._isReadOnly()){F.find(".formSection.selectable .sectionSelect").bind("click",function(Q){var P=l(this);P.closest(".formSection").toggleClass("collapsed",!P.value())})}w(J,F);F.undelegate(".button.addValue",".paneAddValue");F.delegate(".button.addValue","click.paneAddValue",function(P){P.stopImmediatePropagation();P.preventDefault();B(J,l(this))});F.find(".finishButtons a").bind("click",function(R){R.preventDefault();var Q=l(this);if(Q.is(".disabled")){return}J._startProcessing();var P=function(T){J._finish(I,Q.attr("data-value"),T)};if(!l.isBlank(blist.util.inlineLogin)&&Q.is(".requiresLogin")){var S=Q.attr("data-loginMsg")||J.settings.defaultLoginMessage;blist.util.inlineLogin.verifyUser(function(U,T){if(U){P(T)}else{F.find(".mainError").text(S);J._finishProcessing()}},S)}else{P()}});_.each(J._customSections,function(Q,P){var R=F.find('[data-customContent="'+P+'"]');var S=R.find(".sectionContent");if(!l.isBlank(Q.template)){S.addClass(Q.template).append(l.renderTemplate(Q.template,l.extend({},I,Q.data),Q.directive))}if(_.isFunction(Q.callback)){Q.callback.call(J,S,I)}});J._validator=F.submit(function(P){if(l.isBlank(l(this).attr("action"))){P.preventDefault()}}).validate({ignore:":hidden",errorElement:"span",errorPlacement:function(P,Q){P.appendTo(Q.closest(".line"))},invalidHandler:function(Q,P){s(P)}});F.data("form-validator",J._validator);J._isDirty=false;J._visible=true;H(true)};var C=function(K){if(K.type=="columnSelect"){return K.columns.useQueryBase}if(K.type=="repeater"){return C(K.field)}if(K.type=="group"){return _.any(K.options,C)}return false};if(_.any(E.sections,function(K){return _.any(K.fields,C)})){J._view.getQueryBase(D)}else{D()}},getTemplateName:function(){return"sidebarPane"},reset:function(C){var D=this;if(C&&D.$dom().is(".noReset")){return}D._isDirty=true;if(D._visible){D.render()}},validatePane:function(){var D=this;var C=D.$dom().find(".formSection").filter(":visible");var E=C.filter(".sectionDisabled");D.$dom().find(".finishButtons").toggleClass("hide",C.length==E.length).find(".submit").toggleClass("disabled",D.$dom().find("input, select, textarea").filter(".required:visible:not(:disabled)").filter(":blank, .prompt, :checkbox:unchecked").length>0||E.length>0)},_startProcessing:function(){this.$dom().loadingSpinner().showHide(true)},_finishProcessing:function(){this.$dom().loadingSpinner().showHide(false)},_hide:function(){this.$dom().trigger("hide");this.reset()},_getCurrentData:function(){return this._data||this.settings.data},_dataPreProcess:function(C){return C},_isReadOnly:function(){return false},_getReadOnlyMessage:function(){return null},_getSections:function(){return[]},_getFinishButtons:function(){return[]},_finish:function(E,D,C){var F=this;if(!D){F._finishProcessing();F._hide();return false}return F.validateForm()},validateForm:function(){var C=this;C.$dom().find(".formSection.disabled:visible").addClass("error");k(C);if(!C.$dom().find("form").valid()){C._finishProcessing();u(C);C.$dom().find(".mainError").text(l.t("screens.ds.grid_sidebar.base.validation.invalid_values"));return false}u(C);C.$dom().find(".mainError").text("");return true},_isValid:function(E){var D=E;if(E.hasClass("customWrapper")){var C=this._customCallbacks[E.attr("data-customId")];if(!l.isBlank(C)){C=C.validate}if(!_.isFunction(C)){return true}return C.call(this,E)}if(E.hasClass("colorInput")){D=E.siblings("a.colorControl")}return D.is(":visible")&&E.valid()},_getInputValue:function(F,Q){var M=this;var H=F.parents();if(F.isInputType("radio")&&H.hasClass("radioBlock")){var D={};F.closest(".radioLine").siblings(".radioLine").quickEach(function(){this.find("label :input").quickEach(function(){M._getInputValue(this,D)})});D=m(D);Q=l.extend(Q,D);F.closest(".radioLine").find("label :input").quickEach(function(){M._getInputValue(this,Q)});return Q}var R=A(M,F);var I=F.attr("name");if(_.isUndefined(I)){return Q}Q=Q||{};var G=Q;var T;var S;if(H.hasClass("repeater")){var J=H.filter(".line.repeater");for(var U=J.length-1;U>=0;U--){var V=J.eq(U);var K=V.children(".button.addValue").attr("name");if(U!=J.length-1){K=K.split("-").slice(0,-1).join("-")}T=n(K,[],G,S);var E=(U==0?F:J.eq(U-1).children(".button.addValue")).attr("name");var N=E.split("-");S=N[N.length-1];if(!l.isBlank(T)){G=T[S]||{}}}I=I.split("-").slice(0,-1).join("-");var P=F.closest(".line[data-savedData]");if(P.length>0){l.extend(G,JSON.parse(P.attr("data-savedData")||"{}"))}}if(!l.isBlank(R)&&(F.tagName()=="select")&&H.hasClass("columnSelect")&&_.include(["tableColumnId","id"],F.attr("data-columnIdField"))){R=parseInt(R)}n(I,R,G,S);if(F.tagName()=="select"){var C=F.find("option:selected");var O=C.attr("data-customKeys");if(!l.isBlank(O)){_.each(O.split(","),function(W){n(W,C.attr("data-custom-"+W),G,S)})}}if(!l.isBlank(T)&&!_.isEmpty(G)){var L=_.keys(G);if(L.length==1&&l.isBlank(L[0])){G=G[""]}T[S]=G}return Q},_getFormValues:function(C){var G=this;var F={};k(G);var E=G.$dom().find(".formSection.validateCollapsed").find(".sectionContent:hidden");E.show();var D=G.$dom().find("form :input, form .colorControl, form .customWrapper").filter(":visible:not(:disabled, .prompt, .sectionSelect, .radioLine label *, .customWrapper *)");E.hide();D.each(function(){var J=l(this);var H=J.parents();if(J.isInputType("radio")&&H.hasClass("radioLine")&&!J.is(":checked")){return}if(J.isInputType("radio")&&H.hasClass("radioBlock")){J=J.closest(".radioLine").find("label :input:not(.prompt)");if(J.length<1){return}}if(!C&&H.hasClass("group")){var I=false;J.closest(".inputBlock").find("[data-isrequired]:visible:not(:disabled)").each(function(){var K=A(G,l(this));I=I||l.isBlank(K)||K===false});if(I){return}}G._getInputValue(J,F)});u(G);return l.deepCompact(F)},_showMessage:function(C){this.$dom().socrataAlert({message:C,overlay:true})},_genericErrorHandler:function(C){this._finishProcessing();this.$dom().find(".mainError").text(JSON.parse(C.responseText).message)},_markReady:function(){var D=this;D._isReady=true;var C=D._cachedRender;if(!l.isBlank(C)){delete D._cachedRender;D.render(C.data,C.isTempData)}}},{columnChoosers:null,name:"unset",noReset:false,renderTypeManager:null,showFinishButtons:true,view:null});var j=function(C){if(!q()){return}if(!l.isBlank(l.uniform)&&!l.isBlank(l.uniform.update)){l.uniform.update(C)}};var m=function(C){if(_.isArray(C)){return _.map(C,m)}else{if(l.isPlainObject(C)){var D={};_.each(C,function(F,E){D[E]=m(F)})}else{return null}}};var k=function(C){C.$dom().find(".radioBlock > .radioLine").each(function(){var D=l(this);if(!D.find("input[type=radio]").is(":checked")){D.addClass("hideValidation")}})};var u=function(C){C.$dom().find(".radioLine.hideValidation").removeClass("hideValidation")};var n=function(E,F,C,H){var G=E.split(":");E=G[G.length-1];if(_.isNull(E)||_.isUndefined(E)){return null}G=E.split(".");while(G.length>1){C[G[0]]=C[G[0]]||(G[0]=="flags"||!l.isBlank(G[1].match(/^\d+$/))?[]:{});C=C[G[0]];G.shift()}var D;if(_.isArray(C)){if(!l.isBlank(G[0].match(/^\d+$/))){if(!l.isBlank(H)){C[H]=F}else{C.push(F)}}else{if(F){C.push(G[0]);D=G[0]}}}else{if(l.isBlank(C[G[0]])){C[G[0]]=F}else{if(_.isArray(F)&&_.isArray(C[G[0]])){C[G[0]]=l.extend(true,_.compact(C[G[0]]),_.compact(F))}}D=C[G[0]]}return D};var A=function(H,I){if(I.hasClass("prompt")){return null}if(I.hasClass("colorControl")){I=I.siblings(":input")}var G=JSON.parse(I.attr("data-origSavedValue")||"null");if(l.isBlank(G)){G=I.value()}if(I.isInputType("checkbox")){var D=I.attr("data-trueValue");var F=I.attr("data-falseValue");if(!l.isBlank(D)&&G===true){G=D}else{if(!l.isBlank(F)&&G===false){G=F}}}else{if(I.isInputType("radio")){G=I.attr("data-dataValue")}else{if(I.hasClass("sliderInput")){var C=parseFloat(I.attr("data-scale"));G=(C==0)?0:(G/C)}else{if(I.hasClass("select")){if(G=="true"){G=true}if(G=="false"){G=false}}else{if(I.hasClass("customWrapper")){var E=H._customCallbacks[I.attr("data-customId")];if(!l.isBlank(E)){E=E.value}if(_.isFunction(E)){G=E.call(H,I)}}else{if((I.tagName()=="input")&&I.parents().hasClass("fileChooser")){G=I.closest(".fileChooser").data("ajaxupload")}else{if(I.hasClass("radioSectionSelector")){G=I.attr("value")}}}}}}}return G};var f=function(F,E){var D=(E==="_selected"&&F.selected===true)||(F.value||"").toLowerCase()===(E||"").toLowerCase();var G={tagName:"option",value:F.value,selected:D,contents:F.text,disabled:F.disabled};var C=[];_.each(F.data||{},function(I,H){G["data-custom-"+H]=I;C.push(H)});if(C.length>0){G["data-customKeys"]=C.join(",")}return G};var h=function(G,D,C,J,H){D=D||{};var K=D.useQueryBase?(G._view||{})._queryBase:G._view;if(l.isBlank(K)){return[]}C=C||"id";var I=K.columnsForType((D||{}).type,(D||{}).hidden);var F=_.reject(K.visibleColumns,function(O){return _.contains(I,O)});if(l.isBlank(J)&&_.isArray((D||{}).defaultNames)){var E;_.any(D.defaultNames,function(O){E=_.detect(I,function(P){return O.toLowerCase()==P.name.toLowerCase()});return !l.isBlank(E)});if(!l.isBlank(E)){J=E[C]}}var N=[];_.each(I,function(S){var O=S.id;var Q=S.tableColumnId;var R=S.fieldName;var P;P=J==R||J==Q||J==O;if(G.settings.name!=="chart_create"){P=P||(I.length==1&&!D.noDefault&&l.isBlank(J))}N.push({tagName:"option",value:S[C],selected:P,contents:l.htmlEscape(S.name)})});var M=[];_.each(F,function(O){M.push({tagName:"option",value:O[C],contents:l.htmlEscape(O.name),disabled:"disabled"})});if(_.isEmpty(M)){M.push({tagName:"option",contents:l.t("screens.ds.grid_sidebar.base.column_select.none"),disabled:"disabled"})}if(_.isEmpty(N)){N.push({tagName:"option",contents:l.t("screens.ds.grid_sidebar.base.column_select.none"),disabled:"disabled"})}var L=l.t("screens.ds.grid_sidebar.base.column_select.none_selected");if(l.subKeyDefined(H,"item.origName")){if(H.item.origName=="displayFormat.titleFlyout"){L=l.t("screens.ds.grid_sidebar.base.column_select.auto")}}return[{tagName:"option",value:"",contents:L},{tagName:"optgroup",contents:N,label:l.t("screens.ds.grid_sidebar.base.column_select.selectable")},{tagName:"optgroup",contents:M,label:l.t("screens.ds.grid_sidebar.base.column_select.nonselectable")}]};var c=function(I,G,F){var D=I._isReadOnly()||(_.isFunction(G.disabled)?G.disabled.call(I,F.data):G.disabled);var C={id:G.name+"_"+(G.uniqueId||_.uniqueId()),name:G.name,title:G.prompt,disabled:D,"data-isDisabled":D,"class":["inputItem",{value:"required",onlyIf:G.required&&!F.inRepeater},{value:"textPrompt",onlyIf:!l.isBlank(G.prompt)&&_.include(["text","textarea"],G.type)},G.notequalto].concat(G.extraClass),"data-origName":G.origName,"data-isRequired":{value:true,onlyIf:G.required},"data-notequalto":{value:"."+(G.notequalto||"").split(" ").join(", ."),onlyIf:!l.isBlank(G.notequalto)},"data-validateMin":{value:G.validateMin,onlyIf:!l.isBlank(G.validateMin)},"data-validateMax":{value:G.validateMax,onlyIf:!l.isBlank(G.validateMax)},"data-defaultValue":l.htmlEscape(JSON.stringify(G.defaultValue||"")),"data-dataValue":{value:l.htmlEscape(JSON.stringify(G.dataValue||"")),onlyIf:!l.isBlank(G.dataValue)&&(G.dataValue!==G.defaultValue||F.sectionOptions.showIfData)},"data-origSavedValue":l.htmlEscape(JSON.stringify(G.dataValue||""))};if(l.isPlainObject(G.onlyIf)){var J=_.uniqueId();I._fieldOnlyIfs[J]=G.onlyIf;C["data-onlyIf"]=J}if(l.isPlainObject(G.disabled)){var H=_.uniqueId();I._fieldDisabled[H]=G.disabled;C["data-disabled"]=H}if(_.isFunction(G.change)){var E="handler_"+_.uniqueId();I._changeHandlers[E]=G.change;C["data-change"]=E}_.each(G.data||{},function(L,K){C["data-custom-"+K]=L});return C};var g=function(E,F,D){var C=null;_.any(_.reject(_.flatten(l.makeArray(F)),function(G){return _.isNull(G)||_.isUndefined(G)}),function(G){var I=(G||"").split(".");var J=E;while(I.length>0&&!l.isBlank(J)){var K=I.shift();if(!l.isBlank(K)){J=J[K]}if(_.isArray(J)&&I.length>0){if(l.isBlank(I[0].match(/^\d+$/))){J=_.include(J,I.shift())}else{var H=parseInt(I.shift());if(!l.isBlank(D)){H=D}J=J[H]}}}if(I.length==0&&!l.isBlank(J)){C=J;return true}return false});return C};var o=function(E,F,I){var G=[];var C=l.arrayify(I);while(C.length>0){var D=C.shift();if(D.type=="group"){C=C.concat(D.options);continue}if(!D.required){continue}if(D.onlyIf){var J=false;var K=g(F,D.onlyIf.field);if(_.isFunction(D.onlyIf.func)){J=J||D.onlyIf.func.call(E,K)}if(!l.isBlank(D.onlyIf.value)){J=J||D.onlyIf.value!=K}if(D.onlyIf.negate){J=!J}if(J){continue}}if(D.type=="custom"&&!l.isBlank(D.editorCallbacks)&&_.isFunction(D.editorCallbacks.required)){var H={};_.each(l.arrayify(D.linkedField),function(L){H[L]=g(F,L)});if(_.size(H)==1){H=_.values(H)[0]}if(!D.editorCallbacks.required.call(E,H)){continue}}G.push(_.compact(_.flatten([D.name,D.otherNames])))}return G};var y=function(E,C,D){return _.all(o(E,C,D),function(F){return !l.isBlank(g(C,F))})};var a={};a.checkbox=function(J,G,F,I,H){var D=I;if(l.isBlank(D)){D=H}_.last(G).contents=l.extend(c(J,F.item,F.context),{tagName:"input",type:"checkbox","data-trueValue":F.item.trueValue,"data-falseValue":F.item.falseValue,checked:(!l.isBlank(F.item.trueValue)&&D===F.item.trueValue)||_.include([true,"true",1,"1","yes","checked"],D)});if(F.item.inputFirst===true){var C=G.pop();var E=G.pop();G.push(C);G.push(E)}};a.color=function(H,F,D,G){var E=l.extend({},D.item,{defaultValue:l.arrayify(D.item.defaultValue||[]),extraClass:"colorInput"});var C=G||E.defaultValue[D.context.repeaterIndex]||E.defaultValue[0];var I=_.last(F);I.contents=[];I.contents.push({tagName:"a",href:"#Color",title:l.t("screens.ds.grid_sidebar.base.color_select.prompt"),name:D.item.name,"class":["colorControl",{value:"advanced",onlyIf:D.item.advanced}],contents:l.t("screens.ds.grid_sidebar.base.color_select.prompt"),style:{"background-color":C}});if(D.item.showLabel===true){I.contents.push({tagName:"span","class":"colorControlLabel"})}I.contents.push(l.extend(c(H,E,D.context),{tagName:"input",type:"hidden",value:C}))};a.columnSelect=function(I,E,D,G,F){var H=D.item.useFieldName?"fieldName":(D.item.isTableColumn?"tableColumnId":"id");var J=_.last(E);E.push({tagName:"a",href:"#Select:"+l.makeArray(D.item.columns.type).join("-"),title:l.t("screens.ds.grid_sidebar.base.column_select.from_grid"),"class":"columnSelector","data-columnIdField":H,contents:l.t("screens.ds.grid_sidebar.base.column_select.from_grid")});var C=h(I,D.item.columns,H,G||F,D);J.contents=l.extend(c(I,l.extend({},D.item,{extraClass:"columnSelectControl"}),D.context),{tagName:"select",contents:C,"data-columnIdField":H,"data-columnOptions":l.htmlEscape(JSON.stringify(D.item.columns||""))})};a.custom=function(H,E,D,G,F){var C=_.uniqueId();_.last(E).contents=l.extend(c(H,l.extend({},D.item,{extraClass:"customWrapper"}),D.context),{tagName:"div","data-customId":C,"data-linkedField":l.arrayify(D.item.linkedField).join(",")});_.last(E).contents["data-defaultValue"]=l.htmlEscape(JSON.stringify(F||""));H._customCallbacks[C]=D.item.editorCallbacks};a.file=function(F,D,C,E){_.last(D).contents={tagName:"div","class":["uploader","uniform","fileChooser"],"data-fileTypes":l.htmlEscape(JSON.stringify(l.makeArray(C.item.fileTypes))),"data-action":C.item.fileAction,contents:[{tagName:"span","class":"filename",contents:l.extend(c(F,C.item,C.context),{tagName:"input",type:"text",readonly:true})},{tagName:"span","class":"action",contents:"Choose"}]}};a.group=function(G,E,D,F){if(D.item.includeLabel!==true){E.splice(0,E.length)}var C=_.map(D.item.options,function(I,H){return b(G,{context:l.extend({},D.context,{noTag:true}),item:I,items:D.item.options,pos:H})});E.push({tagName:"div","class":["inputBlock",D.item.extraClass],contents:C})};a.note=function(G,D,C,E){var F=_.isFunction(C.item.value)?C.item.value.call(G,_.isEmpty(C.context.data)?null:C.context.data):C.item.value;if(!l.isBlank(F)&&!C.item.isInput){_.last(D).contents=l.extend(c(G,C.item,C.context),{tagName:"span",contents:F})}else{D.splice(0,D.length)}};a.radioGroup=function(I,D,J,E,K){var C="-templateId";if(J.item.name.endsWith(C)){J.item.name=[J.item.name.slice(0,-C.length),_.uniqueId(),C].join("")}else{J.item.name+="_"+_.uniqueId()}var F=c(I,J.item,J.context);var L;var G;var H=_.map(J.item.options,function(O,N){var T=F.id+"-"+N;var P;if(J.item.sectionSelector){P=b(I,{context:l.extend({},J.context,{noTag:true,inputOnly:true}),item:l.extend({},O,{type:"static",isInput:true,extraClass:"radioSectionSelector",name:J.item.origName,items:J.item.options,pos:N})})}else{P=b(I,{context:l.extend({},J.context,{noTag:true,inputOnly:true}),item:O,items:J.item.options,pos:N})}var S=_.all(P,function(U){return _.any(l.makeArray(U.contents),function(V){return V.disabled})});var R=l.extend({},F,{id:T,tagName:"input",type:"radio",disabled:S,"data-defaultValue":l.htmlEscape(JSON.stringify(K==O.name))});if((E||K)==O.name){L=R}var M;M=function(U){if(J.item.sectionSelector){return O.value==E}if(l.isPlainObject(U)){return(U["data-dataValue"]||{}).onlyIf||M(U.contents)}if(!_.isArray(U)){return false}return _.any(U,function(V){return M(V)})};if(M(P)){G=R}var Q={tagName:"label","for":T,contents:P};return{tagName:"div","class":["radioLine",O.type,(O.lineClass||"")],contents:[R,Q]}});if(!l.isBlank(G)){G.checked=true}else{if(!l.isBlank(L)){L.checked=true}}D.push({tagName:"div","class":"radioBlock"+(J.item.extraClass===undefined?"":" "+J.item.extraClass),contents:H})};a.radioSelect=function(J,G,E,I,H){var D=I;if(l.isBlank(D)){D=H}var F=c(J,E.item,E.context);var C=_.map(E.item.options,function(L,K){var M=F.id+"-"+L;return{tagName:"div","class":"radioLine",contents:[l.extend({},F,{tagName:"input",type:"radio",id:M,"data-dataValue":L,checked:L===D}),{tagName:"label","for":M,contents:L}]}});_.last(G).contents={tagName:"div","class":"radioSelectBlock",contents:C}};a.repeater=function(N,E,O,G){var P=N._isReadOnly();if(l.isBlank(O.item.text)){E.splice(0,E.length)}var K={tagName:"a",href:"#remove",title:l.t("screens.ds.grid_sidebar.base.buttons.remove"),"class":"removeLink delete",contents:{tagName:"span","class":"icon"}};var H=0;if(l.isBlank(O.item.field.name)){var R=o(N,O.context.data,O.item.field);if(R.length>0){_.each(_.first(R),function(V){var T=V.match(/^(.+)\.\d+(\..+)?$/);if(!l.isBlank(T)){var U=g(O.context.data,T[1]);if(_.isArray(U)){H=U.length}}})}}G=_.select(G||[],function(T){return y(N,T,O.item.field)});var L=l.makeArray(O.item.defaultValue);var Q=G.length||H||L.length;if(!P&&Q<1){Q=_.isNumber(O.item.initialRepeatCount)?O.item.initialRepeatCount:1}for(var I=0;I<Q;I++){var M=G[I]||((l.isBlank(O.item.field.name))?null:O.context.data);var D=y(N,M,O.item.field);var F=b(N,{item:l.extend({},O.item.field,{defaultValue:L[I]}),context:l.extend({},O.context,{repeaterIndex:I,noTag:true,inRepeater:I>=O.item.minimum,inRepeaterContext:!l.isBlank(O.item.field.name),data:D?M:null})});if(!l.isBlank(O.item.savedField)){var J=g(M,O.item.savedField);if(!l.isBlank(J)){var C={};C[O.item.savedField]=J;F["data-savedData"]=l.htmlEscape(JSON.stringify(C))}}if(I>=O.item.minimum&&!P){F.contents.unshift(K)}E.push(F)}if(!P){var S=b(N,{item:l.extend({},O.item.field,{lineClass:"repeaterAdded"}),context:l.extend({},O.context,{repeaterIndex:"templateId",noTag:true,inRepeater:true,data:null})});S.contents.unshift(K);S=l.htmlEscape(l.tag(S,true));E.push(l.button({text:O.item.addText||"Add Value",customAttrs:l.extend(c(N,O.item,O.context),{"data-template":S,"data-count":I,"data-dataValue":null,"data-minimum":O.item.minimum,"data-maximum":O.item.maximum,title:O.item.addText||"Add Value"}),className:"addValue",iconClass:"add"},true))}};a.select=function(I,D,J,E,K){var C={};var M=[];if(!_.isNull(J.item.prompt)){M.push({tagName:"option",value:"","class":"prompt",contents:J.item.prompt||l.t("screens.ds.grid_sidebar.base.generic_select.prompt")})}if(_.isBoolean(E)){E=E.toString()}var N={tagName:"select",contents:M};if(_.isArray(J.item.options)){var G=false;_.each(J.item.options,function(P){var Q=E||K;var O=f(P,Q);if(P.group){C[P.group]=C[P.group]||{tagName:"optgroup",label:P.group,contents:[]};C[P.group].contents.push(O)}else{M.push(O)}if(J.item.onlySelectFirst&&G&&O.selected){O.selected=false}else{if(O.selected){G=true}}});if(!_.isEmpty(C)){for(var L in C){N.contents.push(C[L])}}}else{if(_.isFunction(J.item.options)){var H=_.uniqueId();I._selectOptions[H]=J.item.options;N["data-selectOption"]=H}}if(!l.isBlank(J.item.linkedField)){N["data-linkedField"]=l.arrayify(J.item.linkedField).join(",")}var F=c(I,l.extend({},J.item,{dataValue:E}),J.context);_.last(D).contents=l.extend(F,N)};a.slider=function(H,D,I,F,K){var G=I.item.minimum||0;var J=I.item.maximum||100;var E=1;if(_.isString(F)){F=parseFloat(F)}if(_.isNaN(F)){F=null}if(J<=1){E=100;G*=E;J*=E;K*=E;if(!l.isBlank(F)){F*=E}}if(!_.isNumber(F)&&!_.isNumber(K)){K=G}var C=_.last(D);C.contents=[];C.contents.push(l.extend(c(H,l.extend({},I.item,{defaultValue:K,dataValue:F,extraClass:"sliderInput"}),I.context),{tagName:"input",type:"text",value:(_.isNumber(F)?F:K),"data-scale":E,readonly:true}));C.contents.push({tagName:"span","class":"sliderControl","data-min":G,"data-max":J})};a["static"]=function(H,E,C,F){var G=_.isFunction(C.item.value)?C.item.value.call(H,_.isEmpty(C.context.data)?null:C.context.data):C.item.value;var I=_.last(E);if(!l.isBlank(G)){if(C.item.isInput){var D=(((C.item.extraClass||"").search("radioSectionSelector")>=0)?C.item.text:G);I.contents=[];I.contents.push({tagName:"span",contents:D});I.contents.push(l.extend(c(H,C.item,C.context),{tagName:"input",type:"hidden",value:G}))}else{I.contents=l.extend(c(H,C.item,C.context),{tagName:"span",contents:G})}}else{E.splice(0,E.length)}};a.text=function(H,E,D,G,F){var I=_.last(E);I["class"].push("textWrapper");var C=c(H,D.item,D.context);if(H._isReadOnly()){delete C.disabled;C.readonly="readonly"}if(C.disabled||C.readonly){delete C.title}if(D.item.minimum!=null){C["data-min"]=D.item.minimum}if(D.item.maximum!=null){C["data-max"]=D.item.maximum}I.contents=l.extend(C,{tagName:"input",type:"text",value:l.htmlEscape(G||F)})};a.textarea=function(H,E,D,G,F){var I=_.last(E);I["class"].push("textWrapper");var C=c(H,D.item,D.context);if(H._isReadOnly()){delete C.disabled;C.readonly="readonly"}if(C.disabled||C.readonly){delete C.title}I.contents=l.extend(C,{tagName:"textarea",contents:l.htmlEscape(G||F)})};var b=function(G,I){if(I.item.onlyIf===false){return null}I.item=l.extend({},I.item,{origName:I.item.name,name:I.context.paneId+(l.isBlank(I.context.sectionName)?"":"_"+I.context.sectionName)+":"+(I.item.name||"")+(l.isBlank(I.context.repeaterIndex)?"":"-"+I.context.repeaterIndex)});var D=[];if(!I.context.inputOnly){I.item.uniqueId=_.uniqueId();var H=I.item.required&&!I.context.inRepeater;D.push({tagName:"label","for":I.item.name+"_"+I.item.uniqueId,title:I.item.text,"class":[{value:"required",onlyIf:H},{value:"requiredBlank",onlyIf:H&&l.isBlank(I.item.text)}],contents:I.item.text})}var J=I.item.defaultValue;if(I.context.inRepeater&&!_.isUndefined(I.item.repeaterValue)){J=I.item.repeaterValue}var E;var F=_.reject(_.flatten([I.item.origName,I.item.otherNames]),function(L){return _.isNull(L)||_.isUndefined(L)});if(F.length>0){E=g(I.context.data,F,I.context.inRepeaterContext?I.context.repeaterIndex:null);if(!l.isBlank(E)){I.item=l.extend({},I.item,{dataValue:E})}}var C={tagName:"span","class":["inputWrapper"]};D.push(C);a[I.item.type](G,D,I,E,J);if(_.isUndefined(C.contents)){D=_.without(D,C)}if(D.length<1){return null}if(I.context.inputOnly){return I.context.noTag?D:_.map(D,function(L){return l.tag(L,true)}).join("")}else{var K={tagName:"div","class":["line","clearfix",I.item.type,I.item.lineClass,{value:"inputFirst",onlyIf:I.item.inputFirst}],contents:D};return I.context.noTag?K:l.tag(K,true)}};var z=function(D,C){C.find("[data-linkedField]").each(function(){var E=l(this);var F=E.data("linkedGroup");if(!l.isBlank(F)){F.unbind(".linkedField-"+E.attr("data-linkedField"))}});C.find(".customWrapper").each(function(){var E=l(this);var F=D._customCallbacks[E.attr("data-customId")];if(!l.isBlank(F)){F=F.cleanup}if(!_.isFunction(F)){return}F.call(D,E)});C.find("select.columnSelectControl").each(function(){D._columnSelects=_.without(D._columnSelects,this)})};var p=function(E,D){var C=E._customSections[D.attr("data-customContent")];if(!l.isBlank(C)){C=C.cleanupCallback}if(!_.isFunction(C)){return}C.call(E,D.find(".sectionContent"))};var x=function(D,C){_.each(C||D._columnSelects,function(E){var G=l(E);var F=h(D,JSON.parse(G.attr("data-columnOptions")||'""'),G.attr("data-columnIdField"),G.val());G.find("option").remove();G.find("optGroup").remove();_.each(F,function(H){G.append(l.tag(H))});j(G)})};var v=function(J,L){var K=L.attr("data-customId");var G=J._customCallbacks[K];if(!l.isBlank(G)){G=G.create}var M=J._fieldOnlyIfs[L.attr("data-onlyIf")];var H=J._fieldDisabled[L.attr("data-disabled")];var I=J._selectOptions[L.attr("data-selectOption")];if(!_.isFunction(I)&&!_.isFunction(G)&&!l.isPlainObject(M)&&!l.isPlainObject(H)){return}var N=l();var F=l.makeArray((M||{}).field||null);F=F.concat(l.makeArray((H||{}).field||null));if(!l.isBlank(L.attr("data-linkedField"))){F=F.concat(L.attr("data-linkedField").split(","))}_.each(F,function(P){var O='[data-origname="'+P+'"]:first';var Q=L.closest(".line.group, .formSection");var R=Q.find(O).not(L);if(R.length<1){R=L.closest("form").find(O)}N=N.add(R).not(L)});L.data("linkedGroup",N);var E=N.closest(".repeater");var D=function(P,O){if(l.isBlank(P)){P=JSON.parse(L.attr("data-defaultValue")||'""')}var T={};N.each(function(){var aa=l(this),Y=aa.filter(":checkbox").length>0;if(aa.hasClass("addValue")){var X=E.find(".line:not(.hide) .inputItem");var Z=[];_.each(X,function(ab){Z.push(A(J,l(ab)))});T[aa.attr("data-origName")]=Z}else{T[aa.attr("data-origName")]=Y?aa.filter(":checked").length>0:l(this).val()}});if(_.size(T)==1){T=_.values(T)[0];T=(T===false)?false:(T||"")}var V=L.data("linkedFieldValues");if(!O&&_.isEqual(V,T)){return}L.data("linkedFieldValues",T);var U=L.closest(".line");if(l.isPlainObject(M)){var Q=true;if(_.isFunction(M.func)){Q=Q&&M.func.call(J,T)}if(!l.isBlank(M.value)){Q=Q&&M.value==(T[M.field]||T)}if(M.negate){Q=!Q}U[Q!==false?"show":"hide"]()}if(l.isPlainObject(H)){var W=true;if(_.isFunction(H.func)){W=W&&H.func.call(J,T)}if(!l.isBlank(H.value)){W=W&&H.value==(T[H.field]||T)}U.find("input").attr("disabled",W)}if(_.isFunction(I)){var R=I.call(J,T,J._curData,L,P);L.find("option:not(.prompt)").remove();L.attr("disabled",l.isBlank(R)||R=="disabled"||!!L.attr("data-isDisabled"));L.closest(".line").toggleClass("hide",R=="hidden");if(!_.isArray(R)){R=null}_.each(R||[],function(X){L.append(l.tag(f(X,P)))});L.change()}else{if(_.isFunction(G)){z(J,U);L.empty();var S=G.call(J,L,T,P);U[S!==false?"show":"hide"]()}}_.defer(function(){j(L)})};var C=function(){L.trigger("resetToDefault")};if(N.hasClass("addValue")){E.delegate(".inputItem","change",C).delegate(".removeLink","click",function(){_.defer(C)})}else{N.bind("change.linkedField-"+K,C).bind("blur.linkedField-"+K,C)}L.bind("resetToDefault",function(){D(JSON.parse(L.attr("data-dataValue")||'""'),true)}).trigger("resetToDefault")};var e=function(G,E,D){var C=function(H){D.call(G,E,H)};var F=function(H){_.defer(function(){C(H)})};if(E.hasClass("customWrapper")){E.find("input,select").each(function(){var H=l(this);H.change(C);if(l.browser.msie&&_.include(["checkbox","radio"],H.attr("type"))){E.click(C)}});E.delegate(".columnColorControl","color_change",F);E.change(C)}if(E.hasClass("sliderInput")){E.siblings(".sliderControl").bind("slide",F)}else{if(E.hasClass("colorInput")){E.siblings(".colorControl").bind("color_change",F)}else{if(E.is("input[type=text],textarea,select,input[type=file]")){E.change(C)}else{if(E.is("input[type=checkbox],input[type=radio]")){E.change(C);if(l.browser.msie){if(E.hasClass("option-icons")){E.parents(".radioLine:first").find("label").click(function(){E.click()})}E.click(C)}}}}}};var w=function(E,D){D.find(".textPrompt").example(function(){return l(this).attr("title")});D.delegate(".columnSelector","click",function(K){K.preventDefault();K.stopPropagation();var H=l(this);var F=E.$dom().closest(".outerPane").find(".paneOverlay");var J=function(){F.css("cursor","auto").addClass("hide");l(document).unbind(".pane_"+E.$dom().attr("id"));H.removeClass("inProcess");E.settings.columnChoosers.each(function(){l(this).blistTableAccessor().exitColumnChoose()})};if(H.is(".inProcess")){J()}else{F.css("cursor","crosshair").removeClass("hide");l(document).bind("keypress.pane_"+E.$dom().attr("id"),function(L){if(L.keyCode==27){J()}}).bind("click.pane_"+E.$dom().attr("id"),function(M){var L=false;E.settings.columnChoosers.each(function(){L=L||(M.target!=document&&l.contains(this,M.target))});if(!L){J()}});H.addClass("inProcess");var G=H.attr("href");G=G.slice(G.indexOf("#")+1);var I=G.split(":")[1];if(l.isBlank(I)){I=null}else{I=I.split("-")}E.settings.columnChoosers.each(function(){l(this).blistTableAccessor().enterColumnChoose(I,function(M){J();var L=H.siblings(".inputWrapper").find("select");L.val(M[H.attr("data-columnIdField")]).change();j(L)})})}});D.find("select.columnSelectControl").each(function(){E._columnSelects.push(this)});D.find("[data-change]").each(function(){e(E,l(this),E._changeHandlers[l(this).attr("data-change")])});D.find(".inputItem").each(function(){e(E,l(this),function(F){F.attr("data-origSavedValue",null)})});if(_.isFunction(E._changeHandler)){D.find(".inputItem").each(function(){e(E,l(this),E._changeHandler)})}D.find(".sliderControl").each(function(){var F=l(this);F.slider({disabled:F.siblings("input")[0].disabled,min:parseInt(F.attr("data-min")),max:parseInt(F.attr("data-max")),value:parseInt(F.siblings(":input").val())})}).bind("slide",function(F,G){l(this).siblings(":input").val(G.value)});D.find(".colorControl").each(function(){var G=l(this);if(G.siblings("input")[0].disabled){G.click(function(H){H.preventDefault()});return}if(!G.hasClass("advanced")){G.bind("color_change",function(I,H){l(this).css("background-color",H).siblings(":input").val(H).siblings(".colorControlLabel").text(H)}).mousedown(function(H){var I=l(this);I.data("colorpicker-color",I.siblings(":input").val())}).one("mousedown",function(){G.colorPicker()})}else{var F=(G.siblings(":input").val()||"#ffffff");if(!F.startsWith("#")){F="#"+F}G.ColorPicker({color:F,onChange:function(H,J,I){G.css("background-color","#"+J).siblings(".colorControlLabel").text("#"+J).siblings(":input").val("#"+J)},onHide:function(){G.trigger("color_change")}});G.css("background-color",F).siblings(".colorControlLabel").text(F)}});D.find(".fileChooser").each(function(){var F=l(this);var I=F.find(".filename input");var G=JSON.parse(F.attr("data-fileTypes")||"[]");var H=_.map(G,function(J){return J.toLowerCase()});F.data("ajaxupload",new AjaxUpload(F,{action:F.attr("data-fileAction"),autoSubmit:false,name:I.attr("id")+"_ajaxupload",responseType:"json",onChange:function(J,K){I.val(J);if(H.length>0&&(l.isBlank(K)||!_.include(H,K.toLowerCase()))){I.attr("data-requiredTypes",l.arrayToSentence(G,"or",",",true))}else{I.attr("data-requiredTypes","")}_.defer(function(){I.change()})}}))});D.find(".line.repeater").each(function(){r(E,l(this))});D.delegate(".removeLink","click",function(J){J.preventDefault();var K=l(this);var G=K.closest(".line.repeater");var I=K.closest(".line");if(I.is(".repeaterAdded")){z(E,I);I.remove()}else{I.addClass("hide")}var F=G.find(".addValue");var H=F.data("count");F.attr("data-count",H-1);r(E,G)});D.find("[data-linkedField], [data-onlyIf], [data-disabled]").each(function(){v(E,l(this))});D.find("[data-selectOption]:not([data-linkedField])").each(function(){var H=l(this);var G=E._selectOptions[H.attr("data-selectOption")];if(!_.isFunction(G)){return}var I=JSON.parse(H.attr("data-dataValue")||H.attr("data-defaultValue")||'""');var F=G.call(E,E._curData);H.find("option:not(.prompt)").remove();H.attr("disabled",l.isBlank(F)||F=="disabled"||!!H.attr("data-isDisabled"));H.closest(".line").toggleClass("hide",F=="hidden");if(!_.isArray(F)){F=null}_.each(F||[],function(J){H.append(l.tag(f(J,I)))});H.change();j(H)});D.delegate("input, select, textarea","change blur",function(){_.defer(function(){E.validatePane()})});var C=function(G){var F=l(this).parents("label").attr("for");if(!l.isBlank(F)){E.$dom().find("#"+l.safeId(F)).click()}};D.delegate("label input, label select, label textarea, label a","click",function(F){F.preventDefault()}).delegate("label input, label select, label textarea, label a","mouseup change focus",C);if(q()&&!l.isBlank(l.uniform)){_.defer(function(){D.find("select:not(.noUniform)").uniform();D.find(":checkbox:not(.noUniform)").uniform();D.find(":radio:not(.noUniform)").uniform();D.find(":file:not(.noUniform)").uniform()})}};var t=function(I,E,D,G,C){var F=G.filter('[data-onlyIf="'+D+'"]');var H=function(){_.defer(function(){var M=false;var K=false;var L=false;var O="";var J="";F.removeClass("error");var N;_.each(E,function(Q){var P=false;if(!l.isBlank(Q.$field)){if(Q.inRadioGroup){P=!Q.$field.is(":checked")}else{P=Q.$field.val()!=Q.value}if(l.isBlank(N)){N=Q.$field}}else{if(_.isFunction(Q.func)){P=!Q.func.call(I,I._curData)}}if(Q.negate){P=!P}if(Q.warn===false){return}if(Q.disable){K=K||P;if(P&&!l.isBlank(Q.disabledMessage)){O+=_.isFunction(Q.disabledMessage)?Q.disabledMessage.call(I):Q.disabledMessage}}else{if(Q.warn&&P){L=L||P;if(!l.isBlank(Q.warningMessage)){J+=_.isFunction(Q.warningMessage)?Q.warningMessage.call(I):Q.warningMessage}}else{M=M||P}}});if(!l.isBlank(N)){N.toggleClass("sectionDisabled sectionDisabled-"+F.attr("name"),!F.hasClass("selectable")&&!M&&K)}F.toggleClass("hide",M);F.toggleClass("disabled",K);F.toggleClass("warned",L);if(K){F.find(".sectionDisabledMessage").html(O)}else{if(L){F.find(".sectionWarningMessage").html(J)}}})};_.each(E,function(M){var N=!l.isBlank(M.field);var K=_.isFunction(M.func);if(!N&&!K){throw new Error("Only field-value or func objects supported for section onlyIfs")}if(N){M.$field=C.filter('[name="'+I.$dom().attr("id")+":"+M.field+'"]');if(M.$field.length>1){var J;M.$field.each(function(){if(this.value==M.value){J=l(this)}});if(!M.$field.hasClass("radioSectionSelector")){return}var L=J.closest(".radioLine").find('input[type="radio"]');if(!L){return}M.$field=L;M.inRadioGroup=true}M.$field.change(H).keypress(H).click(H).attr("data-onlyIfInput",true);if(M.inRadioGroup){M.$field.closest(".radioGroup").click(H)}}else{if(K&&!l.isBlank(I._view)){I._view.bind("columns_changed",H,I)}}});H()};var r=function(H,D){var E=D.children(".line:not(.hide)").length;var G=D.children(".button.addValue");var F=parseInt(G.attr("data-minimum"));if(E<(_.isNumber(F)?F:1)){_.defer(function(){B(H,G)})}var C=G.attr("data-maximum");if(l.isBlank(C)){return}G.toggleClass("hide",E>=parseInt(C))};var B=function(H,E){var G=E.closest(".line.repeater");var F=l(E.attr("data-template"));F.find(".required").removeClass("required");var D=parseInt(E.attr("data-count"));E.attr("data-count",D+1);var C="-templateId";F.find('[name$="'+C+'"], [id$="'+C+'"], [for$="'+C+'"]').each(function(){var I=l(this);_.each(["name","id","for"],function(K){var J=I.attr(K);if(!l.isBlank(J)&&J.endsWith(C)){I.attr(K,J.slice(0,-C.length)+"-"+D)}})});F.find(".colorControl").each(function(){var K=l(this);var L=K.siblings(":input");var I=JSON.parse(L.attr("data-defaultValue")||'""');if(I.length<2){return}var J=I[D%I.length];K.css("background-color",J);L.val(J)});w(H,F);E.before(F);r(H,G)}})(jQuery);(function(g){var f={};g.gridSidebar={registerConfig:function(r,v,s,o){if(g.isBlank(r)){throw"Sidebar config requires a name"}_.each(g.makeArray(o||[]),function(p){g.gridSidebar.paneForDisplayType[p]=r});var q={name:r,priority:s||1,controlName:v};var u=r.split(".");if(u.length==1){f[r]=g.extend(f[r],q)}else{if(u.length==2){var t=u[0];if(g.isBlank(f[t])){f[t]={name:t,isParent:true,title:g.tNull("controls.common.sidebar.tabs."+t)||t.replace(/([a-z]+)([A-Z])/g,"$1 $2").capitalize(),subPanes:{}}}q.name=u[1];q.parent=f[t];f[t].subPanes[u[1]]=q}else{throw"Pane config: can't name with more than one or two parts"}}},paneForDisplayType:{}};g.Control.extend("gridSidebar",{_init:function(){var o=this;o._super.apply(this,arguments);var q=o.$dom();q.find("a.close").click(function(r){r.preventDefault();o.hide()});q.addClass("hide position-"+o.settings.position);q.attr("aria-live","polite");g(window).resize(function(){m(o)});q.resize(function(){m(o)});o._setPositionCount=0;o._setPositionMaxCount=50;o._resizeBlocked=false;o._lastWidth=-1;o._lastHeight=-1;o._resizeNotReady=false;o._ready=true;if(o.settings.waitOnDataset&&!g.isBlank(o.settings.view)&&o.settings.view.viewType=="tabular"){o._ready=false;o.settings.view.bind("row_count_change",function(){if(o._ready){return}_.defer(function(){if(!g.isBlank(o._paneToShow)){o.show(o._paneToShow);delete o._paneToShow}});o._ready=true})}if(!g.isBlank(o.settings.view)){var p=function(){if(g.subKeyDefined(o.settings.view,"metadata.sidebar.width")){q.width(o.settings.view.metadata.sidebar.width)}else{q.css("width","")}g(window).resize()};o.settings.view.bind("clear_temporary",p);p();o.settings.view.bind("permissions_changed",function(){o.updateEnabledSubPanes()})}q.resizable({handles:o.settings.position=="left"?"e":"w",maxWidth:g(window).width()*0.8,minWidth:300,stop:function(){b(o)}})},$neighbor:function(){if(!this._$neighbor){this._$neighbor=g(this.settings.resizeNeighbor)}return this._$neighbor},$currentOuterPane:function(){if(!g.subKeyDefined(this._currentOuterPane,"$pane")){return null}return this._currentOuterPane.$pane},$currentPane:function(){if(!g.subKeyDefined(this._currentPane,"control")){return null}return this._currentPane.control.$dom()},setDefault:function(p){var o=this;o._defaultPane=p;if(g.isBlank(o._currentPane)&&o.hasPane(o._defaultPane)){o.show(o._defaultPane)}},hasPane:function(q){var o=n(q);var r=f[o.primary];if(g.isBlank(r)){return false}var p=(r.subPanes||{})[o.secondary]||f[o.secondary];return !g.isBlank(p)},getPane:function(r){var o=this;var p=n(r);var s=f[p.primary];if(g.isBlank(s)){return false}var q=(s.subPanes||{})[p.secondary]||f[p.secondary];return(q||{}).control},addPane:function(t,s,r){var o=this;var p=n(t);var u=f[p.primary];var q=(u.subPanes||{})[p.secondary]||f[p.secondary];if(g.isBlank(q)||g.isBlank(u)){throw"Configuration required for gridSidebar"}if(g.isBlank(u.$pane)){a(o,u)}if(q.isParent){return}q.control.render(s,r);q.control.$dom().hide()},show:function(v,r){var w=this;if(g.isBlank(v)){v=w._defaultPane}if(g.isBlank(v)){return}var u=n(v);if(g.subKeyDefined(w,"_currentOuterPane.name")&&w._currentOuterPane.name==u.primary&&(g.subKeyDefined(w,"_currentPane.name")&&w._currentPane.name==u.secondary||u.secondary==v)){return}j(w);if(!g.isBlank(r)){w.addPane(v,r,true)}if(!w._ready){w._paneToShow=v;return}var s=n(v);var o=f[s.primary];var p=(o.subPanes||{})[s.secondary]||f[s.secondary];if(g.isBlank(p)){return}if(g.isBlank(o.$pane)||(!p.isParent&&g.isBlank(p.control))){w.addPane(v)}if(!g.isBlank(p.control)){p.control.render()}w._currentOuterPane=o;w.$currentOuterPane().show();if(!p.isParent){w._currentPane=p;w.$currentOuterPane().find('.headerLink[data-paneName="'+s.secondary+'"]').addClass("selected");_.defer(function(){var x=w.$currentPane();if(!g.isBlank(x)){x.slideDown(function(){if(!g.isBlank(p.control)){p.control.validatePane()}})}})}k(w);w.updateEnabledSubPanes();w.$dom().removeClass("hide");g(window).resize();if(!p.isParent){if(g.device.ipad){var t=new iScroll(w.$currentOuterPane().find(".panes").get(0))}}else{var q=w.$currentOuterPane().find(".headerLink:not(.disabled):last");if(q.length<1){q=w.$currentOuterPane().find(".headerLink:last")}w.show(o.name+"."+q.attr("data-paneName"))}w.settings.onSidebarShown(s.primary,s.secondary);if(!g.isBlank(p.control)){p.control.shown()}g("ul#moreActionBarButtons").addClass("hide")},hide:function(p){var o=this;if(!p&&!g.isBlank(o._defaultPane)&&o.hasPane(o._defaultPane)){var q=n(o._defaultPane);if(o._currentOuterPane.name!=q.primary||o._currentPane.name!=q.secondary){o.show(o._defaultPane);return}}o.$dom().addClass("hide");o.$neighbor().css("width","").css("left","");j(o);g(window).resize();o.settings.onSidebarClosed()},refresh:function(r){var o=this;if(g.isBlank(r)){r=e(o._currentOuterPane,o._currentPane)}if(g.isBlank(r)){return}var p=n(r);var q=h(r);if(g.subKeyDefined(q,"control")){q.control.reset()}},updateEnabledSubPanes:function(){var o=this;if(g.isBlank(o.$currentOuterPane())){return}var p=function(t){if(g.isBlank(t.control)){return}var r=t.control.isAvailable();var q=t.control.getDisabledSubtitle();var s=o.$currentOuterPane().find('.headerLink[data-panename="'+t.name+'"]');if(s.hasClass("disabled")!=!r){s.toggleClass("disabled",!r).data("title",r?t.control.getSubtitle():q)}if(t.name==(o._currentPane||{}).name){t.control.$dom().toggleClass("disabled",!r).find(".disabledMessage").text(q)}};_.each(o._currentOuterPane.subPanes||g.makeArray(o._currentOuterPane),p)},isPaneEnabled:function(r){var o=this;var p=n(r);var s=f[p.primary];if(g.isBlank(s)){return false}var q=(s.subPanes||{})[p.secondary]||f[p.secondary];if(g.isBlank(q)){return false}if(g.isBlank(q.control)){o.addPane(r)}return q.control.isAvailable()}},{defaultLoginMessage:"You must be signed in",onSidebarClosed:function(){},onSidebarShown:function(p,o){},position:"right",renderTypeManager:null,resizeNeighbor:null,setHeight:true,setSidebarTop:true,view:null,waitOnDataset:false});var l=function(o){return !g.isBlank(o.settings.renderTypeManager)&&o.settings.renderTypeManager.visibleTypes.table};var e=function(q,p){var o=q.name;if(q.name!=p.name){o=_.compact([q.name,p.name]).join(".")}return o};var n=function(r){var q=r.split(".");var o={};if(q.length==1){o.primary=o.secondary=r}else{if(q.length==2){o.primary=q[0];o.secondary=q[1]}else{throw"Only config names of 1 or 2 parts are supported"}}return o};var h=function(p){var o=n(p);var q=f[o.primary];if(q==null){return}return(q.subPanes||{})[o.secondary]||f[o.secondary]};var j=function(o,q){var p;if(g.isBlank(q)){p=o._currentPane}else{p=h(q)}if(g.isBlank(p)){return}var s=p.parent||p;if(!g.isBlank(s.$pane)){s.$pane.hide().find(".panes").unbind("scroll").find(".headerLink.selected").removeClass("selected")}if(!g.isBlank(p.control)){var r=p.control.$dom();_.defer(function(){if(r.is(":visible")){r.slideUp()}else{r.hide()}})}if(g.subKeyDefined(p,"control")){p.control.hidden();p.control.reset(true)}if(s==o._currentOuterPane){o._currentOuterPane=null}if(p==o._currentPane){o._currentPane=null}};var k=function(o){var r=o.$neighbor().outerHeight();var s=o.$dom().outerHeight()-o.$dom().height();if(o.settings.setHeight){o.$dom().height(r-s)}if(o.settings.setSidebarTop){o.$dom().css("top",-r+"px")}if(o.settings.position=="left"){o.$dom().css("left",0);o.$neighbor().css("left",o.$dom().outerWidth(true))}else{o.$dom().css("right",0)}var t=o.$dom().parent().innerWidth();o.$neighbor().width(t-o.$dom().outerWidth(true)-(o.$neighbor().outerWidth()-o.$neighbor().width()));o.$neighbor().resize();var q=o.$currentOuterPane();if(!g.isBlank(q)){if(q.outerHeight()<1){o._resizeNotReady=true;return}o._resizeNotReady=false;var p=q.find(".panes");p.css("height","");s=q.outerHeight()-p.height();p.height(o.$dom().height()-s)}};var m=function(o){var q=g("body").width();var p=o.$dom().height();if(q==o._lastWidth&&p==o._lastHeight&&!o._resizeNotReady){return}o._lastWidth=q;o._lastHeight=p;if(o._setPositionCount>o._setPositionMaxCount||o._resizeBlocked){console.error("Layout Cycle");o._resizeBlocked=true;return}o._setPositionCount++;_.defer(function(){try{if(!o.$dom().is(":hidden")){k(o)}}finally{o._setPositionCount--;if(o._setPositionCount==0){o._resizeBlocked=false}}})};var b=function(o){o.$dom().css("left","");g(window).resize();if(!g.isBlank(o.settings.view)){var p=g.extend(true,{},o.settings.view.metadata);p.sidebar=p.sidebar||{};p.sidebar.width=o.$dom().width();o.settings.view.update({metadata:p},false,true)}};var c=function(o,p,s){var q=g.tag({tagName:"div"});s.$pane.find(".panes").append(q);p.control=q[p.controlName]({columnChoosers:o.settings.columnChoosers,renderTypeManager:o.settings.renderTypeManager,view:o.settings.view});q.bind("hide",function(){if(p.control.settings.name==(o._currentPane||{}).name){o.hide()}});if(!g.isBlank(p.parent)){var r=p.control.getTitle();q.hide().before(g.tag({tagName:"a",href:"#"+r,"class":["headerLink",p.name],data:{title:p.control.getSubtitle(),paneName:p.name},contents:[{tagName:"span","class":"icon"},{tagName:"span","class":"title",contents:r}]}))}};var a=function(o,p){var q=g.tag({tagName:"div",id:o.$dom().attr("id")+"_outer_"+p.name,"class":"outerPane"});p.$pane=q;q.append(g.renderTemplate("outerPane"));if(!g.isBlank(p.controlName)){c(o,p,p)}q.find(".mainTitleBlock .title").text(!g.isBlank(p.control)?p.control.getTitle():p.title);_.each(_.sortBy(p.subPanes,function(r){return r.priority}).reverse(),function(r){c(o,r,p)});q.find(".headerLink").click(function(r){r.preventDefault();d(o,g(this),p.name)}).each(function(){var r=g(this);var s=g(this).data("title").clean();if(!g.isBlank(s)){r.socrataTip({content:function(){return g.tag({tagName:"p",contents:g(this).data("title").clean()},true)},killTitle:true,positions:"left"})}});o.$dom().append(q);q.hide()};var d=function(o,q,p){if(q.is(".selected, .disabled")){return}o.show(p+"."+q.attr("data-paneName"))}})(jQuery);(function(a){a.Control.extend("pane_about",{getTitle:function(){return a.t("controls.common.sidebar.tabs.about")},_getSections:function(){var b=this;return[{customContent:{template:"aboutDataset",directive:{},data:{},callback:function(c){if(b._view.isTabular()){b._view.getTotalRows(function(){c.find(".row_count").text(b._view.totalRows())})}c.find(".datasetAverageRating").each(function(){blist.datasetControls.datasetRating(a(this),c,true);a(this).validate()});c.find(".expander").click(function(d){d.preventDefault();var e=a(this);e.toggleClass("expanded").toggleClass("collapsed").siblings(".sectionContent").slideToggle(e.hasClass("expanded"))});c.find(".routingApproval .reasonBox").each(function(){if(b._view.isDefault()){blist.datasetControls.raReasonBox(a(this))}else{(a(this)).closest('div[class="formSection"]').css("display","none")}});blist.datasetControls.datasetContact(c)}}}]}},{name:"about"},"controlPane");if(!blist.sidebarHidden.about){a.gridSidebar.registerConfig("about","pane_about")}})(jQuery);(function(c){var d=function(h){var e=!_.isUndefined((h||{}).parentId);var f=blist.dataset.newBackend||blist.feature_flags.disable_legacy_types;var g=_.chain(blist.datatypes).map(function(l,j){var m=l.createable;if(f){m=(!m&&l.nbeModifiable)||(m&&!l.deprecatedInNbe)}else{m=m&&!l.nbeOnly}if(m&&(!e||!l.excludeInNestedTable)){return{text:c.t("core.data_types."+l.name),value:j,priority:l.priority,group:l.group}}}).compact().sortBy(function(j){return j.priority}).value();if(!e&&blist.dataset.hasDatasetLinkColumn()){g.push({value:"link",text:c.t("core.data_types.link")})}return g};c.Control.extend("pane_addColumn",{isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)&&this._view.type=="blist"},getTitle:function(){return c.t("screens.ds.grid_sidebar.add_column.title")},getSubtitle:function(){return c.t("screens.ds.grid_sidebar.add_column.subtitle")},getDisabledSubtitle:function(){return !this._view.valid?c.t("screens.ds.grid_sidebar.base.validation.invalid_view"):c.t("screens.ds.grid_sidebar.add_column.validation.view_column")},_getSections:function(){return[{title:c.t("screens.ds.grid_sidebar.column_common.basic.title"),fields:[{text:c.t("screens.ds.grid_sidebar.column_common.basic.name"),type:"text",required:true,name:"name",prompt:c.t("screens.ds.grid_sidebar.column_common.basic.name_prompt")},{text:c.t("screens.ds.grid_sidebar.column_common.basic.description"),type:"textarea",name:"description",prompt:c.t("screens.ds.grid_sidebar.column_common.basic.description_prompt")}]},{title:c.t("screens.ds.grid_sidebar.column_common.type.title"),fields:[{text:c.t("screens.ds.grid_sidebar.column_common.type.type"),type:"select",required:true,prompt:c.t("screens.ds.grid_sidebar.column_common.type.type_prompt"),name:"dataTypeName",options:blist.dataset.newBackend?d():d},{text:c.t("screens.ds.grid_sidebar.column_common.type.key"),type:"columnSelect",name:"format.linkedKey",required:true,onlyIf:{field:"dataTypeName",value:"link"},columns:{type:"dataset_link",hidden:false}},{text:c.t("screens.ds.grid_sidebar.column_common.type.source"),type:"select",name:"format.linkedSource",required:true,onlyIf:{field:"dataTypeName",value:"link"},linkedField:"format.linkedKey",options:function(h,j,g,f){var e=this._view;return e.getLinkedColumnOptions.call(e,h,j,g,f)}}]},{title:c.t("screens.ds.grid_sidebar.add_column.multiple_choice.title"),onlyIf:{field:"dataTypeName",value:"drop_down_list"},fields:[{type:"repeater",addText:c.t("screens.ds.grid_sidebar.add_column.multiple_choice.add_option_button"),name:"dropDownList.values",minimum:1,field:{type:"text",text:c.t("screens.ds.grid_sidebar.add_column.multiple_choice.option"),name:"description"}}]},{title:c.t("screens.ds.grid_sidebar.column_common.linked_dataset.title"),onlyIf:{field:"dataTypeName",value:"dataset_link"},fields:[{text:c.t("screens.ds.grid_sidebar.column_common.linked_dataset.dataset"),type:"text",name:"format.linkedDataset",data:{"4x4uid":"unverified"},prompt:""},{text:c.t("screens.ds.grid_sidebar.column_common.linked_dataset.key"),type:"select",name:"format.keyColumn",linkedField:"format.linkedDataset",defaultValue:"_selected",options:Dataset.getLinkedDatasetOptionsDefault},{text:c.t("screens.ds.grid_sidebar.column_common.linked_dataset.label"),type:"select",name:"format.labelColumn",linkedField:"format.linkedDataset",options:Dataset.getLinkedDatasetOptionsDefault}]},{title:c.t("screens.ds.grid_sidebar.add_column.convert_latlong.title"),onlyIf:{field:"dataTypeName",value:"location"},type:"selectable",name:"latLongSection",fields:[{text:c.t("screens.ds.grid_sidebar.add_column.convert_latlong.latitude"),type:"columnSelect",name:"convert.latitudeColumn",required:true,notequalto:"convertNumber",columns:{type:"number",hidden:false,defaultNames:["latitude","lat","y"]}},{text:c.t("screens.ds.grid_sidebar.add_column.convert_latlong.longitude"),type:"columnSelect",name:"convert.longitudeColumn",required:true,notequalto:"convertNumber",columns:{type:"number",hidden:false,defaultNames:["longitude","long","x"]}}]},{title:c.t("screens.ds.grid_sidebar.add_column.convert_address.title"),onlyIf:{field:"dataTypeName",value:"location"},type:"selectable",name:"addressSection",fields:[{text:c.t("screens.ds.grid_sidebar.add_column.convert_address.street"),type:"radioGroup",name:"convertStreetGroup",defaultValue:"streetNone",options:[{value:c.t("core.forms.none"),name:"streetNone",type:"static"},{type:"columnSelect",name:"convert.addressColumn",notequalto:"convertText",columns:{type:"text",hidden:false,defaultNames:["street address","street","address"]}}]},{text:c.t("screens.ds.grid_sidebar.add_column.convert_address.city"),type:"radioGroup",name:"convertCityGroup",defaultValue:"cityNone",options:[{value:c.t("core.forms.none"),type:"static",name:"cityNone"},{type:"columnSelect",name:"convert.cityColumn",notequalto:"convertText",columns:{type:"text",hidden:false,defaultNames:["city"]}},{type:"text",name:"convert.cityValue",prompt:c.t("screens.ds.grid_sidebar.add_column.convert_address.city_prompt")}]},{text:c.t("screens.ds.grid_sidebar.add_column.convert_address.state"),type:"radioGroup",name:"convertStateGroup",defaultValue:"stateNone",options:[{value:c.t("core.forms.none"),type:"static",name:"stateNone"},{type:"columnSelect",name:"convert.stateColumn",notequalto:"convertText",columns:{type:"text",hidden:false,defaultNames:["state"]}},{type:"text",name:"convert.stateValue",prompt:c.t("screens.ds.grid_sidebar.add_column.convert_address.state_prompt")}]},{text:c.t("screens.ds.grid_sidebar.add_column.convert_address.zip_code"),type:"radioGroup",name:"convertZipGroup",defaultValue:"zipNone",options:[{value:c.t("core.forms.none"),type:"static",name:"zipNone"},{type:"columnSelect",name:"convert.zipColumn",notequalto:"convertText convertNumber",columns:{type:["text","number"],hidden:false,defaultNames:["zip code","postal code","zip"]}},{type:"text",name:"convert.zipValue",prompt:c.t("screens.ds.grid_sidebar.add_column.convert_address.zip_code_prompt")}]}]}]},_getFinishButtons:function(){return[c.controlPane.buttons.create,c.controlPane.buttons.cancel]},_finish:function(g,n,k){var j=this;if(!j._super.apply(this,arguments)){return}var e=j._getFormValues();if(e.dataTypeName=="nested_table"){e.childColumns=[{dataTypeName:"text",name:c.t("screens.ds.grid_sidebar.add_column.nested_table.default_column_name"),width:100}]}else{if(e.dataTypeName=="location"&&!c.isBlank(e.convert)){a(j,e,k);return}else{if(e.dataTypeName=="link"){var l=e.format.linkedKey;if(_.isNumber(l)){var m=this._view.columnForID(l);if(m!=null){e.format.linkedKey=m.fieldName}}var h=e.format.linkedSource;e.dataTypeName=j._view.getLinkSourceDataType(null,h,l).value}}}if(!c.isBlank((g||{}).parentId)){var f=j._view.columnForID(g.parentId);f.addChildColumn(e,function(o){b(j,o,k)},function(o){j._genericErrorHandler(o)})}else{j._view.addColumn(e,function(o){b(j,o,k)},function(o){j._genericErrorHandler(o)})}}},{name:"addColumn"},"controlPane");var b=function(g,f,e){g._finishProcessing();g._showMessage(c.t("screens.ds.grid_sidebar.add_column.success"));g._hide();if(_.isFunction(e)){e()}};var a=function(g,e,f){g._view.addColumn(null,function(h){if(!c.isBlank(e.description)){h.description=e.description;h.save(function(j){b(g,j,f)},function(j){g._genericErrorHandler(j)})}else{b(g,h,f)}g._view.reload(true)},function(h){g._genericErrorHandler(h)},c.extend({method:"addressify",deleteOriginalColumns:false,location:e.name},e.convert))};if(c.isBlank(blist.sidebarHidden.edit)||!blist.sidebarHidden.edit.addColumn){c.gridSidebar.registerConfig("edit.addColumn","pane_addColumn",1)}})(jQuery);(function(a){a.Control.extend("pane_api",{getTitle:function(){return a.t("screens.ds.grid_sidebar.api.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.api.subtitle",{view_type:this._view.displayName})},render:function(){var b=this;b._super(null,null,function(c){if(c){b.$dom().find("input").click(function(){var d=a(this);d.focus();d.select()});ZeroClipboard.config({swfPath:"/ZeroClipboard.swf"});new ZeroClipboard(b.$dom().find("button")[0])}})},_getSections:function(){return[{customContent:{template:"apiContentWrapper",directive:{"p@class+":"pClass"},data:{pClass:"sectionContent"}}}]}},{name:"api"},"controlPane");if(a.isBlank(blist.sidebarHidden.exportSection)||!blist.sidebarHidden.exportSection.api){a.gridSidebar.registerConfig("export.api","pane_api",10)}})(jQuery);(function(a){a.Control.extend("pane_api_foundry",{getTitle:function(){return a.t("screens.ds.grid_sidebar.apis.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.apis.subtitle")},_getSections:function(){return[{customContent:{template:"apiFoundryPaneWrapper",directive:{"p@class+":"pClass"},data:{pClass:"sectionContent"},callback:function(b){var c=this;c._startProcessing();c._$section=b;c._view.getRelatedViews(function(e){c._finishProcessing();c._viewList=e;var h=_.filter(e,function(k){return k.displayType==="api"});if(h.length>0){var d=a("#selectAPI"),f=[],g=a("#existingAPIs");d.empty();_.each(h,function(k){d.append(a.tag({tagName:"option",value:k.id,contents:a.htmlEscape(k.name)}))});if(a.uniform){a.uniform.update(d)}function j(){a(".manageAPI").attr("href",a.path("/api_foundry/manage/"+encodeURIComponent(d.value())))}j();d.change(j);g.show()}})}}}]}},{name:"apiFoundry"},"controlPane");if(a.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.api_foundry){a.gridSidebar.registerConfig("manage.api_foundry","pane_api_foundry",8)}})(jQuery);(function(a){a.Control.extend("pane_appendReplace",{getTitle:function(){return(blist.dataset.isImmutable()?a.t("screens.ds.grid_sidebar.append_replace.title.immutable"):a.t("screens.ds.grid_sidebar.append_replace.title.mutable"))},getSubtitle:function(){return(blist.dataset.isImmutable()?a.t("screens.ds.grid_sidebar.append_replace.subtitle.immutable"):a.t("screens.ds.grid_sidebar.append_replace.subtitle.mutable"))},_getSections:function(){return[{customContent:{template:"appendReplace",data:{},directive:{}}}]}},{name:"appendReplace",noReset:true},"controlPane");if(a.isBlank(blist.sidebarHidden.edit)||!blist.sidebarHidden.edit.appendReplace){a.gridSidebar.registerConfig("edit.appendReplace","pane_appendReplace",5)}})(jQuery);(function(c){var a=10;var b=function(f){f._$section.removeClass("noResults");if(f._backupList.length<1){f._$section.addClass("noResults");return}var d=f._$section.find(".itemsContent ul.itemsList");d.empty();var g=0;var e=f._backupList.length;f._renderBlock=function(h){if(e<=0){return}_.each(f._backupList.slice(g,g+a),function(l){var m=c.renderTemplate("backupItemContainer",{backup:l},{".backupLink@href":"backup.downloadLinks.csv",".backupTime":function(n){return n.context.backup.moment.format("llll")}});d.append(m)});var k=f._$section.find(".moreLink");g+=a;e-=a;if(e>0){k.removeClass("hide");if(e==1){k.text(c.t("screens.ds.grid_sidebar.view_list.pagination.last"))}else{k.text(c.t("screens.ds.grid_sidebar.view_list.pagination.next",{count:Math.min(e,a)}))}}else{k.addClass("hide")}if(!h){var j=f._$section.closest(".scrollContent");j.animate({scrollTop:Math.min(f._$section.outerHeight(true)-j.height(),j.scrollTop()+j.height()-k.outerHeight(true))},"slow")}};f._renderBlock(true);f._$section.find(".moreLink").click(function(h){h.preventDefault();if(_.isFunction(f._renderBlock)){f._renderBlock()}})};c.Control.extend("pane_backupList",{getTitle:function(){return c.t("screens.ds.grid_sidebar.view_list.snapshots.title")},getSubtitle:function(){return c.t("screens.ds.grid_sidebar.view_list.snapshots.subtitle")},_getSections:function(){return[{customContent:{template:"itemsListBlock",directive:{".sortMenu@class+":"hide",".showMenu@class+":"hide",".searchWrapper@class+":"hide"},data:{resultType:"dataset",hide:"hide"},callback:function(e){var g=this;var f=true;g._startProcessing();g._$section=e;var d=function(){g._view.getBackups(function(h){if(f){g._finishProcessing();f=false}g._backupList=h;b(g)})};if(g._view.hasRight(blist.rights.view.UPDATE_VIEW)){g._$section.find(".createBackup").removeClass("hide").click(function(){g._view.makeBackup(d)})}d()}}}]}},{name:"backupList"},"controlPane");if(c.isBlank(blist.sidebarHidden.moreViews)||!blist.sidebarHidden.moreViews.backups){c.gridSidebar.registerConfig("moreViews.backupList","pane_backupList",3)}})(jQuery);(function(b){b.Control.extend("pane_calendarCreate",{_init:function(){var c=this;c._super.apply(c,arguments);c._view.bind("clear_temporary",function(){c.reset()},c)},getTitle:function(){return b.t("screens.ds.grid_sidebar.calendar.title")},getSubtitle:function(){return b.t("screens.ds.grid_sidebar.calendar.subtitle")},_getCurrentData:function(){return this._super()||this._view},isAvailable:function(){var d=this;var c=d._view.columnsForType(["date","calendar_date"],a(d));return c.length>0&&(d._view.valid||a(d))&&(_.include(d._view.metadata.availableDisplayTypes,"calendar")||d._view.shouldShowViewCreationOptions())},getDisabledSubtitle:function(){return(!this._view.valid&&!a(this))?b.t("screens.ds.grid_sidebar.base.validation.invalid_view"):((!_.include(this._view.metadata.availableDisplayTypes,"calendar")&&!this._view.shouldShowViewCreationOptions())?b.t("screens.ds.grid_sidebar.calendar.validation.viz_limit"):b.t("screens.ds.grid_sidebar.calendar.validation.invalid_columns"))},_getSections:function(){var c=this;return[{title:b.t("screens.ds.grid_sidebar.calendar.dates.title"),fields:[{text:b.t("screens.ds.grid_sidebar.calendar.dates.start"),name:"displayFormat.startDateTableId",type:"columnSelect",required:true,notequalto:"dateCol",isTableColumn:true,columns:{type:["calendar_date","date"],hidden:a(c),defaultNames:["start date","start"]}},{text:b.t("screens.ds.grid_sidebar.calendar.dates.end"),name:"displayFormat.endDateTableId",type:"columnSelect",notequalto:"dateCol",isTableColumn:true,columns:{type:["calendar_date","date"],hidden:a(c),noDefault:true,defaultNames:["end date","end"]}}]},{title:b.t("screens.ds.grid_sidebar.calendar.information.title"),fields:[{text:b.t("screens.ds.grid_sidebar.calendar.information.event_title"),name:"displayFormat.titleTableId",type:"columnSelect",required:true,isTableColumn:true,columns:{type:["calendar_date","dataset_link","date","drop_down_list","email","flag","html","location","money","number","percent","phone","stars","text","url"],hidden:a(c),defaultNames:["title"]}},{type:"repeater",name:"displayFormat.descriptionColumns",field:{text:b.t("screens.ds.grid_sidebar.calendar.information.details"),name:"tableColumnId",type:"columnSelect",isTableColumn:true,columns:{hidden:a(c)}},minimum:1,addText:b.t("screens.ds.grid_sidebar.calendar.information.new_details_button")}]}]},_getFinishButtons:function(){return[b.controlPane.buttons.apply,b.controlPane.buttons.cancel]},_finish:function(g,f,e){var h=this;if(!h._super.apply(this,arguments)){return}var c=b.extend(true,{metadata:{renderTypeConfig:{visible:{calendar:true}}}},h._getFormValues(),{metadata:h._view.metadata});h._view.update(c);var j=false;if(a(h)){var d=_.pluck(h._view.realColumns,"id");if(d.length>0){h._view.setVisibleColumns(d,e,true);j=true}}h._finishProcessing();h.reset();if(!j&&_.isFunction(e)){e()}}},{name:"calendarCreate"},"controlPane");var a=function(c){return _.include(c._view.metadata.availableDisplayTypes,"calendar")};if(b.isBlank(blist.sidebarHidden.visualize)||!blist.sidebarHidden.visualize.calendarCreate){b.gridSidebar.registerConfig("visualize.calendarCreate","pane_calendarCreate",5,"calendar")}})(jQuery);(function(a){a.Control.extend("pane_cellFeed",{getTitle:function(){return"Cell Comments"},_getSections:function(){var b=this;return[{customContent:{template:"cellFeedTitle",directive:{".rowName":function(d){return b._view.rowForID(d.context.rowId).index+1},".columnName":function(d){return a.htmlEscape(b._view.columnForTCID(d.context.tableColumnId).name)}}}},{customContent:{template:"feedList",directive:{},data:{},callback:function(c,d){b._cellPaneData=d;b._startProcessing();b._view.getComments(function(e){b._finishProcessing();c.find(".feed").feedList({comments:e,filterCategories:null,mainView:b._view,commentCreateData:{rowId:d.rowId,tableColumnId:d.tableColumnId}})},d.rowId,d.tableColumnId)}}}]},shown:function(){this._super();a(document).trigger("cell_feed_shown",[this._cellPaneData.rowId,this._cellPaneData.tableColumnId])},hidden:function(){this._super();a(document).trigger("cell_feed_hidden",[this._cellPaneData.rowId,this._cellPaneData.tableColumnId])}},{name:"cellFeed",noReset:true},"controlPane");if(a.isBlank(blist.sidebarHidden.feed)||!blist.sidebarHidden.feed.cellFeed){a.gridSidebar.registerConfig("cellFeed","pane_cellFeed")}})(jQuery);(function(I){var g=blist.namespace.fetch("blist.configs.chart");var D=(blist.configuration.newChartsEnabled||I.urlParam(window.location.href,"charts")=="nextgen")&&I.urlParam(window.location.href,"charts")!="old";var c;if(D){c=blist.defaultColors}else{c=["#042656","#19538b","#6a9feb","#bed6f7","#495969","#bbc3c9"]}var O=["column","stackedcolumn","bar","stackedbar","pie","donut","line","area","timeline","bubble","treemap"];var u=[{text:I.t("screens.ds.grid_sidebar.chart.axes.x_axis_title"),name:"displayFormat.titleX",type:"text",prompt:I.t("screens.ds.grid_sidebar.chart.axes.x_axis_title_prompt")},{text:I.t("screens.ds.grid_sidebar.chart.axes.y_axis_title"),name:"displayFormat.titleY",type:"text",prompt:I.t("screens.ds.grid_sidebar.chart.axes.y_axis_title_prompt")}];var G={text:I.t("screens.ds.grid_sidebar.chart.legend.position"),type:"select",prompt:I.t("screens.ds.grid_sidebar.chart.legend.position_prompt"),defaultValue:"bottom",name:"displayFormat.legend",options:[{text:I.t("screens.ds.grid_sidebar.chart.legend.positions.bottom"),value:"bottom"},{text:I.t("screens.ds.grid_sidebar.chart.legend.positions.top"),value:"top"},{text:I.t("screens.ds.grid_sidebar.chart.legend.positions.right"),value:"right"},{text:I.t("screens.ds.grid_sidebar.chart.legend.positions.left"),value:"left"},{text:I.t("screens.ds.grid_sidebar.chart.legend.positions.none"),value:"none"}]};if(D){var y=G;G={onlyIf:false}}var t={text:I.t("screens.ds.grid_sidebar.chart.group_extra"),type:"checkbox",defaultValue:false,name:"displayFormat.renderOther"};if(D){t={onlyIf:false}}var C={type:"color",name:"color",defaultValue:c,lineClass:"colorCollapse"};var o={text:I.t("screens.ds.grid_sidebar.chart.show_lines"),name:"displayFormat.lineSize",type:"checkbox",trueValue:"2",falseValue:"0",defaultValue:"2"};var z={text:I.t("screens.ds.grid_sidebar.chart.show_points"),name:"displayFormat.pointSize",type:"checkbox",trueValue:"3",falseValue:"0",defaultValue:"3"};var F={text:I.t("screens.ds.grid_sidebar.chart.min_angle_html"),name:"displayFormat.pieJoinAngle",type:"slider",minimum:0,maximum:15,defaultValue:1,lineClass:"hasIcon minAngle"};var Q={text:I.t("screens.ds.grid_sidebar.chart.smooth_line"),name:"displayFormat.smoothLine",type:"checkbox",defaultValue:false};var K=function(){return{onlyIf:{func:function(){return false}}}};if(D){K=function(ad,ab){var ag=_.contains(["line","area","stackedbar","stackedcolumn","bar","column"],ad.value);var ac=_.contains(["line","area","stackedbar","stackedcolumn","bar","column"],ad.value);var ae=_.contains(["pie","donut"],ad.value);var af=!_.isUndefined(ab.view.metadata.conditionalFormatting);var aa=true;var Z=[I.extend({},y,{text:I.t("screens.ds.grid_sidebar.chart.legend.display")})];if(ae){Z.push({text:I.t("screens.ds.grid_sidebar.chart.legend.values"),type:"checkbox",inputFirst:true,name:"displayFormat.legendDetails.showValues",defaultValue:true,lineClass:"advLegendCheck"})}if(ag){Z.push({text:I.t("screens.ds.grid_sidebar.chart.legend.series"),type:"checkbox",inputFirst:true,name:"displayFormat.legendDetails.showSeries",defaultValue:true,lineClass:"advLegendCheck"})}if(af){Z.push({text:I.t("screens.ds.grid_sidebar.chart.legend.conditional_formats"),type:"checkbox",inputFirst:true,name:"displayFormat.legendDetails.showConditional",defaultValue:false,lineClass:"advLegendCheck"})}if(ac){Z.push({text:I.t("screens.ds.grid_sidebar.chart.legend.annotations"),type:"checkbox",inputFirst:true,name:"displayFormat.legendDetails.showValueMarkers",defaultValue:true,lineClass:"advLegendCheck"})}if(aa){Z.push({type:"repeater",minimum:0,initialRepeatCount:0,addText:I.t("screens.ds.grid_sidebar.chart.legend.add_text_button"),name:"displayFormat.legendDetails.customEntries",prompt:I.t("screens.ds.grid_sidebar.chart.axes.x_axis_title_prompt"),field:{type:"group",options:[{type:"color",name:"color",defaultValue:"#fff",lineClass:"hide"},{text:I.t("screens.ds.grid_sidebar.chart.legend.add_text"),type:"text",name:"label",required:true}]}})}return h(ad,ab,I.t("screens.ds.grid_sidebar.chart.legend.title_short"),Z)}}var L=function(Z){return{text:I.t("screens.ds.grid_sidebar.chart.point_size"),name:"displayFormat.pointSize",type:"columnSelect",useFieldName:true,lineClass:"hasIcon pointSize",columns:{type:["number","money","percent"],hidden:Z.isEdit}}};var n=function(Z){return{text:I.t("screens.ds.grid_sidebar.chart.point_color"),name:"displayFormat.pointColor",type:"columnSelect",useFieldName:true,lineClass:"hasIcon pointColor",columns:{type:["number","money","percent"],hidden:Z.isEdit}}};var d={text:I.t("screens.ds.grid_sidebar.chart.base_color"),name:"displayFormat.color",type:"color",defaultValue:"#042656"};var b={text:I.t("screens.ds.grid_sidebar.chart.draw_line"),name:"displayFormat.showLine",type:"checkbox"};var j={text:I.t("screens.ds.grid_sidebar.chart.data_labels"),name:"displayFormat.dataLabels",type:"checkbox"};var W={type:"note",value:I.t("screens.ds.grid_sidebar.chart.color_override_html")};var J={type:"note",value:I.t("screens.ds.grid_sidebar.chart.treemap_color_html")};var E=function(aa,Z){return h(aa,Z,I.t("screens.ds.grid_sidebar.chart.marker.title"),[{type:"repeater",name:"displayFormat.valueMarker",addText:I.t("screens.ds.grid_sidebar.chart.marker.add_button"),minimum:0,initialRepeatCount:0,lineClass:"hasIcon valueMarker",field:{type:"group",options:[{type:"group",options:[{type:"color",name:"color",lineClass:"colorCollapse",defaultValue:"#000000"},{text:I.t("screens.ds.grid_sidebar.chart.marker.value"),type:"text",name:"atValue"}]},{text:I.t("screens.ds.grid_sidebar.chart.marker.caption"),type:"text",name:"caption"}]}}])};var s={type:"checkbox",name:"displayFormat.showPercentages",text:I.t("screens.ds.grid_sidebar.chart.show_percent"),inputFirst:true,lineClass:"indentedFormSection"};var X={type:"checkbox",name:"displayFormat.showActualValues",text:I.t("screens.ds.grid_sidebar.chart.show_values"),inputFirst:true,lineClass:"indentedFormSection"};var S=function(aa,Z){return{title:I.t("screens.ds.grid_sidebar.chart.error_bars.title"),onlyIf:Y(aa,Z,false),type:"selectable",name:"errorBars",fields:[{text:I.t("screens.ds.grid_sidebar.chart.error_bars.low"),name:"displayFormat.plot.errorBarLow",required:true,type:"columnSelect",useFieldName:true,notequalto:"errorBar",columns:{type:Dataset.chart.numericTypes,hidden:Z.isEdit}},{text:I.t("screens.ds.grid_sidebar.chart.error_bars.high"),name:"displayFormat.plot.errorBarHigh",required:true,type:"columnSelect",useFieldName:true,notequalto:"errorBar",columns:{type:Dataset.chart.numericTypes,hidden:Z.isEdit}},{text:I.t("screens.ds.grid_sidebar.chart.error_bars.color"),name:"displayFormat.errorBarColor",type:"color",defaultValue:"#ff0000"}]}};var e={text:I.t("screens.ds.grid_sidebar.chart.labelInBar"),type:"checkbox",name:"displayFormat.xAxis.labelInBar",lineClass:"hasIcon labelInBar",inputFirst:true};var v={text:I.t("screens.ds.grid_sidebar.chart.valueInBar"),type:"checkbox",name:"displayFormat.xAxis.valueInBar",lineClass:"hasIcon valueInBar",inputFirst:true};if(!D){e={onlyIf:false};v={onlyIf:false}}var B=function(af){var ab=af.text.toLowerCase();var ad=[];var ag=af.requiredColumns.slice();while(ag.length>0){var ac=ag.shift();var ae=ag.length;ag=_.without(ag,ac);ad.push({count:(ae-ag.length)+1,types:ac})}var aa=function(ah){if(ah==="Date & Time (with timezone)"){return"date_time_timezone"}return ah.replace(/\(.*\)/,"").replace(" & ","_").replace(" ","_").toLowerCase()};var Z=[];_.each(ad,function(aj){var ai=aj.count;var ah;if(aj==ad[0]){ah="";Z.push({tagName:"span","class":"title",contents:I.t("screens.ds.grid_sidebar.chart.validation.chart_requires",{chart_type:ab.capitalize()})+I.t("screens.ds.grid_sidebar.chart.validation.chart_requires2",{and:ah,count:ai})})}else{ah="and";Z.push({tagName:"span","class":"title",contents:I.t("screens.ds.grid_sidebar.chart.validation.chart_requires2",{and:ah,count:ai})})}_.each(aj.types,function(ak){Z.push({tagName:"div","class":blist.datatypes[ak].name+" flyoutIcon",contents:[{tagName:"span","class":"blist-th-icon"},{tagName:"span",contents:I.t("screens.ds.grid_sidebar.base.datatypes."+aa(blist.datatypes[ak].title).toLowerCase()).capitalize()}]})})});return I.tag(Z,true)};var U=function(aa,Z){return I.isBlank(Z.view)?false:Dataset.chart.hasRequiredColumns(Z.view.realColumns,aa.requiredColumns,Z.isEdit)};var w=function(ab,Z){if(I.isBlank(Z.view)){return false}var aa=Z.view.totalRows();if(!I.isBlank(aa)&&aa>((ab.displayLimit||{}).points||500)){return false}return true};var Y=function(ab,aa,Z){if(!aa.useOnlyIf){return null}return[{field:"displayFormat.chartType",value:ab.value},{disable:Z,func:function(){return U(ab,aa)},disabledMessage:function(){return B(ab)}},{warn:Z,func:function(){return w(ab,aa)}}]};var f=function(ab,aa,Z){return{title:Z,customClasses:"sectionHeading"}};var h=function(ac,ab,aa,ad,Z){return{title:aa,type:"selectable",customClasses:"sectionSubheading",fields:ad,validateCollapsed:true,initShow:(Z||false)}};var T=function(ad,aa,ac,Z,ae){var ab=h(ad,aa,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.title"),[{text:ae,name:"displayFormat.fixedColumns.0",lineClass:"hasIcon "+ad.value+"LabelSelection",type:"columnSelect",required:true,useFieldName:true,notequalto:"valueCol",columns:{type:ac,hidden:aa.isEdit}},{type:"repeater",minimum:1,addText:I.t("screens.ds.grid_sidebar.chart.data_columns.new_data_column_button"),name:"displayFormat.valueColumns",lineClass:"hasIcon "+ad.value+"ValueSelection",field:{required:true,type:"columnSelect",text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.value_title"),notequalto:"valueCol",useFieldName:true,name:"fieldName",otherNames:"tableColumnId",columns:{type:Z,hidden:aa.isEdit}}}],true);return ab};var P=function(ad,ab,ac){var aa=D&&_.any(ab.view.realColumns,function(ae){return I.deepGet(ae,"cachedContents","non_null")>10000});var Z=h(ad,ab,I.t("screens.ds.grid_sidebar.chart.data_selection.advanced_data_selection.title"),[{type:"group",extraClass:"subsection dsg",options:[{type:"note",value:I.t("screens.ds.grid_sidebar.chart.series_group.title")},{type:"note",value:I.t("screens.ds.grid_sidebar.chart.series_group.row_limit_warning"),onlyIf:aa,lineClass:"flash notice"},{type:"repeater",minimum:1,addText:I.t("screens.ds.grid_sidebar.chart.series_group.new_column_button"),lineClass:"dataSeriesGrouping",name:"displayFormat.seriesColumns",field:{text:I.t("screens.ds.grid_sidebar.chart.series_group.group_by"),type:"columnSelect",notequalto:"valueCol",useFieldName:true,name:"fieldName",otherNames:"tableColumnId",columns:{type:ac,hidden:ab.isEdit}}},{type:"checkbox",text:I.t("screens.ds.grid_sidebar.chart.series_group.alphabetize"),name:"displayFormat.sortSeries",inputFirst:true,lineClass:"indentedFormSection"},{type:"checkbox",text:I.t("screens.ds.grid_sidebar.chart.series_group.hideLoadingMsg"),name:"displayFormat.hideDsgMsg",inputFirst:true,lineClass:"indentedFormSection"}]}]);if(ad.value!="line"&&ad.value!="area"&&ad.value!="timeline"){Z.fields=Z.fields.concat([{type:"group",extraClass:"subsection errorBars",options:[{type:"note",value:I.t("screens.ds.grid_sidebar.chart.error_bars.title")},{text:I.t("screens.ds.grid_sidebar.chart.error_bars.color"),name:"displayFormat.errorBarColor",type:"color",defaultValue:"#ff0000",lineClass:"hasIcon errorBar"},{text:I.t("screens.ds.grid_sidebar.chart.error_bars.data_low"),name:"displayFormat.plot.errorBarLow",type:"columnSelect",useFieldName:true,notequalto:"errorBar",columns:{type:Dataset.chart.numericTypes,hidden:ab.isEdit}},{text:I.t("screens.ds.grid_sidebar.chart.error_bars.data_high"),name:"displayFormat.plot.errorBarHigh",type:"columnSelect",useFieldName:true,notequalto:"errorBar",columns:{type:Dataset.chart.numericTypes,hidden:ab.isEdit}}]}])}return Z};var R=function(ab,aa){var Z=h(ab,aa,I.t("screens.ds.grid_sidebar.chart.colors"),[]);if(ab.value=="bubble"){Z.fields.push(d)}else{Z.fields.push({type:"repeater",text:I.t("screens.ds.grid_sidebar.chart.colors"),field:I.extend({},C,{name:""}),name:"displayFormat.colors",minimum:1,initialRepeatCount:5,lineClass:"colorArray"})}if(!_.contains(["bubble","donut","treemap","pie"],ab.value)){Z.fields[0].onlyIf={field:"displayFormat.seriesColumns",func:function(ac){return _.compact(ac).length>0}};Z.fields.push({text:I.t("screens.ds.grid_sidebar.chart.color_options.column_colors"),type:"custom",linkedField:["displayFormat.valueColumns"],name:"displayFormat.valueColumns",lineClass:"colors",editorCallbacks:{create:function(ae,ai,ad){var ah={};ai=_.reject(ai,function(aj){if(!ah[aj]&&aj!=null){ah[aj]=true;return false}return true});var ag=function(aj){var ak=24*Math.floor(aj/c.length);return I.rotateHex(c[aj%c.length],ak)};var af={tagName:"div",contents:[]};_.each(ai,function(aj,am){var an=I.deepGetStringField(aa,"view.displayFormat.valueColumns."+am+".color")||c[am]||ag(am);var al=aa.view.columnForIdentifier(aj);var ao=al?I.htmlEscape(al.name):"";var ak={tagName:"div","class":"colorGroup",contents:[]};ak.contents.push({tagName:"div","class":"columnColorControl","data-colorpicker-color":an},{tagName:"div",contents:ao});af.contents.push(ak)});ae.append(I.tag(af));var ac=ae.find(".columnColorControl");ac.each(function(ak,al){var aj=I(al);aj.css("background-color",aj.attr("data-colorpicker-color"));aj.bind("color_change",function(an,am){var ao=I(this);ao.css("background-color",am);ao.attr("data-colorpicker-color",am)}).one("mousedown",function(){aj.colorPicker()})});return true},value:function(ad){var ac=[];ad.find(".columnColorControl").each(function(ae,af){ac.push({color:I(af).data("colorpicker-color")})});return ac}}})}Z.fields.push({type:"note",value:I.t("screens.ds.grid_sidebar.chart.cdlfmtg_color_override_html"),lineClass:"conditionalFormattingWarning notice flash"});return Z};var V=function(ab,aa,Z){return h(ab,aa,I.t("screens.ds.grid_sidebar.chart.labels_and_values"),Z)};var l=function(aa,Z){return h(aa,Z,I.t("screens.ds.grid_sidebar.chart.flyout.title"),[{text:I.t("screens.ds.grid_sidebar.chart.flyout.title_column"),name:"displayFormat.titleFlyout",otherNames:"tableColumnId",onlyIf:{field:"displayFormat.pointSize",value:"0",negate:true},type:"columnSelect",useFieldName:true,columns:{hidden:Z.isEdit}},{type:"repeater",name:"displayFormat.descriptionColumns",lineClass:"hasIcon flyout",onlyIf:{field:"displayFormat.pointSize",value:"0",negate:true},field:{type:"group",options:[{text:I.t("screens.ds.grid_sidebar.chart.flyout.value"),name:"fieldName",otherNames:"tableColumnId",type:"columnSelect",useFieldName:true,columns:{hidden:Z.isEdit}}]},minimum:1,addText:I.t("screens.ds.grid_sidebar.chart.flyout.new_values_button")}])};var A=function(ab,aa){var Z=h(ab,aa,I.t("screens.ds.grid_sidebar.chart.axes.title"),[{text:I.t("screens.ds.grid_sidebar.chart.axes.x_axis_title"),name:"displayFormat.titleX",type:"text",prompt:I.t("screens.ds.grid_sidebar.chart.axes.x_axis_title_prompt")},{text:I.t("screens.ds.grid_sidebar.chart.axes.y_axis_title"),name:"displayFormat.titleY",type:"text",prompt:I.t("screens.ds.grid_sidebar.chart.axes.y_axis_title_prompt")},{text:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.axis_min"),type:"radioGroup",defaultValue:"yAxisMinAuto",name:"yAxisMin",options:[{type:"static",name:"yAxisMinAuto",value:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.auto")},{type:"text",name:"displayFormat.yAxis.min",prompt:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.axis_prompt"),extraClass:"number"}]},{text:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.axis_max"),type:"radioGroup",defaultValue:"yAxisMaxAuto",name:"yAxisMax",options:[{type:"static",name:"yAxisMaxAuto",value:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.auto")},{type:"text",name:"displayFormat.yAxis.max",prompt:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.axis_prompt"),extraClass:"number"}]},D?{text:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.decimals"),type:"radioGroup",name:"yAxisDecimalPlaces",defaultValue:"yAxisDecimalPlacesAuto",options:[{type:"static",value:"Auto",name:"yAxisDecimalPlacesAuto"},{type:"slider",minimum:0,maximum:10,defaultValue:0,name:"displayFormat.yAxis.formatter.decimalPlaces"}]}:{text:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.precision"),type:"text",spinner:true,minimum:0,maximum:10,defaultValue:2,name:"displayFormat.yAxis.formatter.decimalPlaces"},{text:I.t("screens.ds.grid_sidebar.chart.y_axis_formatting.abbreviate"),type:"checkbox",defaultValue:true,name:"displayFormat.yAxis.formatter.abbreviate"}]);if(ab.value=="timeline"){Z.fields.splice(0,1)}return Z};var a=function(aa,Z){return h(aa,Z,I.t("screens.ds.grid_sidebar.chart.data_columns.title"),[{text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"),name:"displayFormat.fixedColumns.0",lineClass:"hasIcon bubbleLabelSelection",type:"columnSelect",required:false,useFieldName:true,notequalto:"valueCol",columns:{type:Dataset.chart.textualTypes,hidden:Z.isEdit}},{text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.value_title"),required:true,type:"columnSelect",useFieldName:true,notequalto:"valueCol",lineClass:"hasIcon bubbleValueSelection",name:"displayFormat.valueColumns.0.fieldName",otherNames:"displayFormat.valueColumns.0.tableColumnId",columns:{type:Dataset.chart.numericTypes,hidden:Z.isEdit}},L(Z),n(Z)],true)};var p=function(Z){var aa=T(Dataset.chart.types.line,Z,Dataset.chart.textualTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"));aa.fields[0].required=false;return aa};var H=function(aa){var Z=aa.view;return _.compact(_.map(Z.displayFormat.valueColumns,function(ab){var ab=Z.columnForIdentifier(ab.fieldName||ab.tableColumnId);if(ab&&!_.isUndefined(ab.fieldName)){return{ascending:false,columnFieldName:ab.fieldName}}else{return null}}))};var k=function(Z){if(I.subKeyDefined(Z.view,"metadata.jsonQuery.order")){var aa=H(Z);return _.isEqual(aa,Z.view.metadata.jsonQuery.order)}return false};var q=function(Z){return D&&I.subKeyDefined(Z.view,"displayFormat.valueColumns")&&!_.isEmpty(Z.view.displayFormat.valueColumns)&&!k(Z)};var r=function(ab){var Z=false;var aa=function(ad){var ah=this;var af=I.t("screens.ds.grid_sidebar.chart.auto_update_sort_button");var ag=I("<a href='#' class='button applyDefaultPieSort'>"+af+"</a>");ad.append(ag);var ac=false;var ae=function(){if(!ac){ac=true;if(q(ab)!=Z){ah.reset()}ac=false}};blist.dataset.bind("query_change",ae);blist.dataset.bind("displayformat_change",ae);ag.on("click",function(){var ai=I.extend(true,{},ab.view.metadata);ai.jsonQuery.order=H(ab);ab.view.update({metadata:ai},false,true)});Z=q(ab);return Z};return{type:"custom",lineClass:"autoSortButton",editorCallbacks:{create:aa}}};var x=function(Z,aa){return{type:"note",onlyIf:{func:function(){return q(Z)}},lineClass:"autoSortInfo flash notice",value:I.t("screens.ds.grid_sidebar.chart.auto_update_sort_info_"+aa)}};var M=function(Z){var aa=T(Dataset.chart.types.pie,Z,Dataset.chart.textualTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"));aa.fields.splice(1,2);aa.fields.push({text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.value_title"),name:"displayFormat.valueColumns.0.fieldName",otherNames:"displayFormat.valueColumns.0.tableColumnId",lineClass:"hasIcon pieValueSelection",notequalto:"valueCol",type:"columnSelect",required:true,useFieldName:true,columns:{type:Dataset.chart.numericTypes,hidden:Z.isEdit}});aa.fields.push(x(Z,"pie"));aa.fields.push(r(Z));return aa};var N=function(Z){var aa=T(Dataset.chart.types.donut,Z,Dataset.chart.textualTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"));aa.fields.push(x(Z,"donut"));aa.fields.push(r(Z));return aa};var m=function(Z){var aa=T(Dataset.chart.types.timeline,Z,Dataset.chart.dateTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"));return aa};g.configChartSelector=function(ab){var af=I.extend(true,{},Dataset.chart.types);for(var ae in af){af[ae].text=I.t("core.chart_types_short."+af[ae].value)}var ad={};for(var ac=0;ac<O.length;ac++){ad[O[ac]]=af[O[ac]];var aa=ad[O[ac]];if(!U(aa,ab)){aa.lineClass="unavailable";aa.disabled="disabled"}aa.prompt=I.htmlEscape(B(aa))}var Z=[{title:I.t("screens.ds.grid_sidebar.visualize.choose_type"),type:"selectable",initShow:true,validateCollapsed:true,customClasses:"sectionSubheading chartTypeSelection",fields:[{text:I.t("screens.ds.grid_sidebar.chart.setup.type"),name:"displayFormat.chartType",type:"radioGroup",required:true,extraClass:"option-icons",sectionSelector:true,defaultValue:"",prompt:I.t("screens.ds.grid_sidebar.chart.setup.type_prompt"),options:ad}]}];return Z};g.newConfigForType=function(ag,ae){ae=I.extend({isEdit:false,useOnlyIf:false},ae);var af=Dataset.chart.types[ag];var aa=f(af,ae,I.t("screens.ds.grid_sidebar.chart.headings.data_selection")),ad=f(af,ae,I.t("screens.ds.grid_sidebar.chart.headings.data_presentation")),ab=f(af,ae,I.t("screens.ds.grid_sidebar.chart.headings.chart_details"));var Z=[];switch(ag){case"area":Z.push(aa,T(af,ae,Dataset.chart.textualTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title")),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),V(af,ae,[o,z]),E(af,ae),ab,K(af,ae),l(af,ae),A(af,ae));break;case"stackedbar":case"bar":Z.push(aa,T(af,ae,Dataset.chart.textAndDateTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title")),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),V(af,ae,[e,v]),E(af,ae),ab,K(af,ae),l(af,ae),A(af,ae));break;case"bubble":Z.push(aa,a(af,ae),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),E(af,ae),ab,l(af,ae),A(af,ae));break;case"stackedcolumn":case"column":Z.push(aa,T(af,ae,Dataset.chart.textAndDateTypes,Dataset.chart.numericTypes,I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title")),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),V(af,ae,[e,v]),E(af,ae),ab,K(af,ae),l(af,ae),A(af,ae));break;case"donut":Z.push(aa,N(ae),ad,R(af,ae),V(af,ae,[s,X,F]),ab,K(af,ae),l(af,ae));break;case"line":Z.push(aa,p(ae),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),V(af,ae,[o,z,j,Q]),E(af,ae),ab,K(af,ae),l(af,ae),A(af,ae));break;case"pie":Z.push(aa,M(ae),ad,R(af,ae),V(af,ae,[s,X,F]),ab,K(af,ae),l(af,ae));break;case"timeline":Z.push(aa,m(ae),P(af,ae,Dataset.chart.textualTypes),ad,R(af,ae),E(af,ae),ab,l(af,ae),A(af,ae));break;case"treemap":var ac=R(af,ae);ac.fields.push(J);Z.push(aa,h(af,ae,I.t("screens.ds.grid_sidebar.chart.configuration"),[{text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.label_title"),name:"displayFormat.fixedColumns.0",notequalto:"valueCol",type:"columnSelect",required:true,useFieldName:true,lineClass:"hasIcon treemapLabelSelection",columns:{type:Dataset.chart.textualTypes,hidden:ae.isEdit}},{text:I.t("screens.ds.grid_sidebar.chart.data_selection.chart_definition.value_title"),name:"displayFormat.valueColumns.0.fieldName",otherNames:"displayFormat.valueColumns.0.tableColumnId",lineClass:"hasIcon treemapValueSelection",notequalto:"valueCol",type:"columnSelect",required:true,useFieldName:true,columns:{type:Dataset.chart.numericTypes,hidden:ae.isEdit}}],true),ad,ac,ab,l(af,ae));break}return Z}})(jQuery);(function(c){var a=["column","stackedcolumn","bar","stackedbar","pie","donut","line","area","timeline","bubble","treemap"];c.Control.extend("pane_chart_create",{_init:function(){var d=this;d._super.apply(d,arguments);d._view.bind("clear_temporary",function(){d.reset()},d);d.$dom().delegate(".showConditionalFormatting","click",function(f){f.preventDefault();if(c.subKeyDefined(blist,"datasetPage.sidebar")){blist.datasetPage.sidebar.show("filter.conditionalFormatting")}});d.$dom().delegate(".clearConditionalFormatting","click",function(g){g.preventDefault();var f=c.extend(true,{},d._view.metadata);delete f.conditionalFormatting;d._view.update({metadata:f})})},render:function(){var d=this;d._super(null,null,function(f){if(f){d.$dom().find(".chartTypeSelection .radioLine").each(function(g,h){c(h).addClass(a[g])});d.$dom().find(".chartTypeSelection .formHeader").append(c.tag({tagName:"div","class":["currentSelection"],contents:[{tagName:"span","class":["selectionName"]},{tagName:"span","class":["selectionIcon"]}]}));d.$dom().find(".line.hasIcon").after(c.tag({tagName:"div","class":["lineIcon"]}));d.$dom().find(".hasIcon.repeater .addValue").hover(function(){c(this).parent().siblings().filter(".lineIcon").addClass("hover")},function(){c(this).parent().siblings().filter(".lineIcon").removeClass("hover")});if(!d._view.metadata.conditionalFormatting){d.$dom().find(".conditionalFormattingWarning").hide()}d.$dom().find(".mainError+.required").hide();d.$dom().find(".unavailable").each(function(){var h=c(this);var g=c.htmlUnescape(h.find("label input").attr("title"));h.socrataTip({content:g})});var e=function(g){var h=g.split(" ")[1];if(h!="unavailable"){d.$dom().find(".formSection.chartTypeSelection, .paneContent").removeClass(function(k,j){var l=j.match(/\S*-selected/);return(c.isBlank(l)?"":l.join(" "))}).addClass(g+"-selected").find(".currentSelection .selectionName").text(Dataset.chart.types[h].text)}};if(blist.dataset.displayFormat.chartType){e("radioLine "+blist.dataset.displayFormat.chartType)}d.$dom().find(".chartTypeSelection .radioLine").click(function(g){e(c(g.currentTarget).attr("class"))});d.$dom().find(".repeater").delegate(".removeLink","click",function(g){d._changeHandler(c(g.currentTarget))});d.$dom().find(".formSection.selectable .sectionSelect").click(function(g){var h=c(g.currentTarget).closest(".formSection");if(h.hasClass("collapsed")){h.find(".sectionContent").show().slideUp({duration:100,easing:"linear"})}else{h.find(".sectionContent").hide().slideDown({duration:100,easing:"linear"})}})}})},_getSections:function(){var g=this;var e={view:g._view,isEdit:b(g)&&!g._view.isGrouped(),useOnlyIf:true};var d=blist.configs.chart.configChartSelector(e);var f=g._view.displayFormat.chartType;if(f){d=d.concat(blist.configs.chart.newConfigForType(f,{view:g._view,isEdit:b(g)&&!g._view.isGrouped(),useOnlyIf:true}))}return d},getTitle:function(){return c.t("screens.ds.grid_sidebar.chart.title")},_getCurrentData:function(){return this._super()||this._view},isAvailable:function(){return(this._view.valid||b(this))&&(_.include(this._view.metadata.availableDisplayTypes,"chart")||this._view.shouldShowViewCreationOptions())},getDisabledSubtitle:function(){return !this._view.valid&&!b(this)?c.t("screens.ds.grid_sidebar.base.validation.invalid_view"):c.t("screens.ds.grid_sidebar.chart.validation.viz_limit")},validateForm:function(){var d=this._super();this._updateErrorVisibility();return d},_updateErrorVisibility:function(d){d=d||this._view.displayFormat.valueColumns;var e=_.isEmpty(d)||_.some(d,_.isEmpty);this.$dom().toggleClass("inlineErrorsHidden",e||false)},_changeHandler:function(e){var d=this;_.defer(function(){var f=d.$dom().closest(".panes").scrollTop();var p=c.subKeyDefined(d._view,"displayFormat.chartType")?d._view.displayFormat.chartType:undefined;var g=_.isEmpty(p);var u=d._getFormValues();if(e.data("origname")=="displayFormat.chartType"){var l=u.displayFormat.chartType;var n=!g&&p==l;if(d.validateForm()||!n){if(_.isFunction(Dataset.chart.types[l].translateFormat)){u.displayFormat=Dataset.chart.types[l].translateFormat(d._view,u.displayFormat)}d._view.update(c.extend(true,{},u,{metadata:d._view.metadata}));d._updateErrorVisibility()}d.reset();u=d._getFormValues()}if(!d.validateForm()){d._updateErrorVisibility(u.displayFormat.valueColumns);d.$dom().closest(".panes").scrollTop(f);return}d.$dom().find("[class*='ValueSelection'] .line").each(function(v,w){var x=c(w);if(c.isBlank(x.find(".columnSelectControl").val())){x.remove()}});var h=d.$dom().find(".colorArray");var j=d.$dom().find(".colors");if(h.css("display")=="none"&&j){j.show()}else{j.hide()}var o=c.extend(true,{metadata:{renderTypeConfig:{visible:{chart:true}}}},u,{metadata:d._view.metadata});var k=function(w){var v=d._view.columnForIdentifier(w);if(_.any(v.renderType.aggregates,function(x){return x.value=="sum"})){v.format.aggregate="sum"}};_.each(o.displayFormat.fixedColumns||[],k);var q=["pie","donut"];var s=_.include(["pie","donut"],o.displayFormat.chartType);var r=!g&&p==o.displayFormat.chartType;if((g||r)&&s&&!c.subKeyDefined(d,"_view.metadata.jsonQuery.order")){o.metadata=c.extend(true,o.metadata,d._view.metadata);o.metadata.jsonQuery.order=d._getPieDefaultOrderBy(o.displayFormat.valueColumns)}if(((o.displayFormat.chartType=="bar")||(o.displayFormat.chartType=="column"))&&(o.displayFormat.stacking==true)){o.displayFormat.chartType="stacked"+o.displayFormat.chartType}d._view.update(o);d._updateErrorVisibility();var t=false;if(b(d)){var m=_.pluck(d._view.realColumns,"id");if(m.length>0){d._view.setVisibleColumns(m,null,true);t=true}}d.$dom().closest(".panes").scrollTop(f);d._finishProcessing()})},_getPieDefaultOrderBy:function(e){var d=this;return _.map(e,function(f){return{ascending:false,columnFieldName:d._view.columnForIdentifier(f.fieldName||f.tableColumnId).fieldName}})}},{name:"chart_create"},"controlPane");var b=function(d){return _.include(d._view.metadata.availableDisplayTypes,"chart")};if(!blist.sidebarHidden.visualize.chartCreate){c.gridSidebar.registerConfig("visualize.chart_create","pane_chart_create",0)}})(jQuery);(function(b){var a=false;b.Control.extend("pane_columnOrder",{_init:function(){var c=this;c._super.apply(c,arguments);c._view.bind("columns_changed",function(){if(a){return}c.reset()},c)},getTitle:function(){return b.t("screens.ds.grid_sidebar.column_order.title")},getSubtitle:function(){return b.t("screens.ds.grid_sidebar.column_order.subtitle")},isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)&&!_.isEmpty(this._view.visibleColumns)},getDisabledSubtitle:function(){return b.t("screens.ds.grid_sidebar.column_order.validation.valid_columns")},_getSections:function(){return[{title:b.t("screens.ds.grid_sidebar.column_order.columns.title"),customContent:{template:"columnOrderBlock",directive:{"li.columnItem":{"column<-":{".@data-columnId":"column.id",".name":"column.name!",".@class+":"column.renderTypeName"}}},data:this._view.visibleColumns}}]},shown:function(){this._super();this.$dom().find("ul.columnsList").awesomereorder()},_getFinishButtons:function(){return[b.controlPane.buttons.apply,b.controlPane.buttons.cancel]},_finish:function(g,f,e){var h=this;if(!h._super.apply(h,arguments)){return}var c=h.$dom().find(".columnsList");var d=_.pluck(_.sortBy(h._view.visibleColumns,function(j){return c.children("[data-columnId="+j.id+"]").index()}),"id");a=true;h._view.setVisibleColumns(d,function(){h._finishProcessing();h._hide();a=false;if(_.isFunction(e)){e()}})}},{name:"columnOrder"},"controlPane");if(b.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.updateColumn){b.gridSidebar.registerConfig("manage.columnOrder","pane_columnOrder",3)}})(jQuery);(function(g){var p=function(r){return r._view.type=="blist"};var h=function(r){return !(p(this)||this._view.type=="grouped")&&g.isBlank(r.format.grouping_aggregate)&&g.isBlank(r.format.drill_down)};var b=function(u,s){if(g.isBlank(s)||!u._view.hasRight(blist.rights.view.UPDATE_COLUMN)){return false}var t=s.dataType.convertableTypes;var r=s.isLinked()?true:_.isArray(t)&&t.length>0;return p(u)&&g.isBlank(s.format.grouping_aggregate)&&r};var k=function(w){if(g.isBlank(w)||!b(this,w.origColumn)){return"hidden"}var s=w.origColumn;var r=blist.feature_flags.disable_legacy_types||this._view.newBackend;var v=s.dataType;var u=[{text:g.t("core.data_types."+s.renderTypeName),value:s.renderTypeName}];return u.concat(_.chain(v.convertableTypes||[]).reject(function(t){return r&&blist.datatypes[t].deprecatedInNbe}).sortBy(function(t){return blist.datatypes[t].priority}).map(function(t){return{value:t,text:g.t("core.data_types."+t)}}).value())};var n=function(r){return g.isBlank(r)?false:r.origColumn.isLinked()};var e=function(t){if(g.isBlank(t)||b(this,t.origColumn)){return""}var r=t.origColumn;var s=g.t("core.data_types."+r.renderTypeName);if(!g.isBlank(r.format.grouping_aggregate)){s+=" ("+g.capitalize(r.format.grouping_aggregate)+" on "+r.dataType.title+")"}return s};var c=function(r){if(g.isBlank(r)){return"hidden"}return r.origColumn.renderType.alignment||"hidden"};var a=function(r){if(g.isBlank(r)){return"plain"}return r.origColumn.renderType.displayOptions||"plain"};var q=function(r){if(g.isBlank(r)||_.isEmpty(r.origColumn.renderType.aggregates)){return"hidden"}return _.map(r.origColumn.renderType.aggregates,function(s){return g.extend({},s,{value:blist.datatypes.aggregateFromSoda2(s.value)})})};var d=function(v){if(g.isBlank(v)){return"hidden"}var s=v.origColumn;var t=s.renderType;var u=t.viewTypes;if(_.isFunction(u)){u=u(s)}if(_.include(["date","calendar_date"],s.renderTypeName)){var r=new Date();u=_.map(u,function(w){return{text:r.format(t.formats[w.value]),value:w.value}})}return u||"hidden"};var m=function(r){if(g.isBlank(r)){return"hidden"}return r.origColumn.renderType.precisionStyle||"hidden"};var l=g.t("screens.ds.grid_sidebar.column_properties.money.groups.common");var o=g.t("screens.ds.grid_sidebar.column_properties.money.groups.all");var j=_.map([{value:"USD",text:"United States, Dollars",group:l},{value:"EUR",text:"Euros",group:l},{value:"GBP",text:"British, Pounds",group:l},{value:"RUB",text:"Russia, Rubles",group:l},{value:"CAD",text:"Canada, Dollars",group:l},{value:"AFN",text:"Afghanistan, Afghanis"},{value:"ALL",text:"Albania, Leke"},{value:"ARS",text:"Argentina, Pesos"},{value:"AUD",text:"Australia, Dollars"},{value:"AZN",text:"Azerbaijan, New Manats"},{value:"BSD",text:"Bahamas, Dollars"},{value:"BBD",text:"Barbados, Dollars"},{value:"BYR",text:"Belarus, Rubles"},{value:"BZD",text:"Belize, Dollars"},{value:"BMD",text:"Bermuda, Dollars"},{value:"BOB",text:"Bolivia, Bolivianos"},{value:"BAM",text:"Bosnia and Herzegovina, Convertible Marka"},{value:"BWP",text:"Botswana, Pulas"},{value:"BRL",text:"Brazil, Real"},{value:"BGN",text:"Bulgaria, Leva"},{value:"KHR",text:"Cambodia, Riels"},{value:"CLP",text:"Chile, Pesos"},{value:"CNY",text:"China, Yuan Renminbi"},{value:"COP",text:"Colombia, Pesos"},{value:"CRC",text:"Costa Rica, Colones"},{value:"HRK",text:"Croatia, Kuna"},{value:"CZK",text:"Czech Republic, Koruny"},{value:"DKK",text:"Denmark, Kroner"},{value:"DOP",text:"Dominican Republic, Pesos"},{value:"EGP",text:"Egypt, Pounds"},{value:"EEK",text:"Estonia, Krooni"},{value:"FJD",text:"Fiji, Dollars"},{value:"GHC",text:"Ghana, Cedis"},{value:"GTQ",text:"Guatemala, Quetzales"},{value:"GYD",text:"Guyana, Dollars"},{value:"HKD",text:"Hong Kong, Dollars"},{value:"HNL",text:"Honduras, Lempiras"},{value:"HUF",text:"Hungary, Forint"},{value:"ISK",text:"Iceland, Kronur"},{value:"INR",text:"India, Rupees"},{value:"IDR",text:"Indonesia, Rupiahs"},{value:"IRR",text:"Iran, Rials"},{value:"ILS",text:"Israel, New Shekels"},{value:"JMD",text:"Jamaica, Dollars"},{value:"JPY",text:"Japanese Yen"},{value:"KZT",text:"Kazakhstan, Tenge"},{value:"KES",text:"Kenya, Shilling"},{value:"KRW",text:"Korea, Won"},{value:"KGS",text:"Kyrgyzstan, Soms"},{value:"LAK",text:"Laos, Kips"},{value:"LVL",text:"Latvia, Lati"},{value:"LBP",text:"Lebanon, Pounds"},{value:"LRD",text:"Liberia, Dollars"},{value:"LTL",text:"Lithuania, Litai"},{value:"MKD",text:"Macedonia, Denars"},{value:"MYR",text:"Malaysia, Ringgits"},{value:"MXN",text:"Mexico, Pesos"},{value:"MNT",text:"Mongolia, Tugriks"},{value:"MZN",text:"Mozambique, Meticais"},{value:"NAD",text:"Namibia, Dollars"},{value:"NPR",text:"Nepal, Nepal Rupees"},{value:"NZD",text:"New Zealand, Dollar"},{value:"NIO",text:"Nicaragua, Cordobas"},{value:"NGN",text:"Nigeria, Nairas"},{value:"NOK",text:"Norway, Krone"},{value:"OMR",text:"Oman, Rials"},{value:"PKR",text:"Pakistan, Rupees"},{value:"PYG",text:"Paraguay, Guarani"},{value:"PEN",text:"Peru, Nuevos Soles"},{value:"PHP",text:"Philippines, Pesos"},{value:"PLN",text:"Poland, Klotych"},{value:"QAR",text:"Qatar, Rials"},{value:"RON",text:"Romania, New Lei"},{value:"SAR",text:"Saudi Arabia, Riyals"},{value:"RSD",text:"Serbia, Dinars"},{value:"SGD",text:"Singapore, Dollars"},{value:"SOS",text:"Somalia, Shillings"},{value:"ZAR",text:"South Africa, Rand"},{value:"LKR",text:"Sri Lanka, Rupees"},{value:"SEK",text:"Sweden, Kronor"},{value:"CHF",text:"Swiss, Francs"},{value:"SYP",text:"Syria, Pounds"},{value:"TWD",text:"Taiwan, New Dollars"},{value:"THB",text:"Thailand, Baht"},{value:"TRY",text:"Turkey, New Lira"},{value:"UAH",text:"Ukraine, Hryvnia"},{value:"USD",text:"United States, Dollars"},{value:"UYU",text:"Uruguay, Pesos"},{value:"UZS",text:"Uzbekistan, Sums"},{value:"VEF",text:"Venezuela, Bolivares Fuertes"},{value:"VND",text:"Vietnam, Dong"},{value:"YER",text:"Yemen, Rials"}],function(r){return{value:r.value,group:r.group||o,text:r.text+" ("+blist.datatypes.money.currencies[r.value]+")"}});var f=[];g.Control.extend("pane_columnProperties",{_init:function(){var r=this;r._super.apply(r,arguments);r._isReady=false;g.Tache.Get({url:"/api/rdfTerms.json",data:{type:"property","class":(r._view.metadata||{}).rdfClass},success:function(s){_.each(s,function(t){f.push({value:t.CName,text:t.namespace+": "+(t.displayName||t.name)})});r._markReady()}})},getTitle:function(){return g.t("screens.ds.grid_sidebar.column_properties.title")},getSubtitle:function(){return g.t("screens.ds.grid_sidebar.column_properties.subtitle")},isAvailable:function(){return this._view.hasRight(blist.rights.view.UPDATE_COLUMN)&&(!this._view.temporary||this._view.minorChange)},getDisabledSubtitle:function(){if(!this._view.hasRight(blist.rights.view.UPDATE_COLUMN)){return g.t("screens.ds.grid_sidebar.column_properties.validation.notallowed")}else{return g.t("screens.ds.grid_sidebar.column_properties.validation.unsaved")}},render:function(t,s){var u=this;var r=function(v){if(v){var w=u.$content();w.on("click","a.createWorkingCopy",function(x){x.preventDefault();blist.datasetPage.sidebar.show("edit")})}};this._super.apply(this,[t,s,r]);if(g.subKeyDefined(this,"_curData.origColumn")){this.$dom().loadingSpinner().setModel(this._curData.origColumn)}},_dataPreProcess:function(s){var r=s.cleanCopy();r.origColumn=s;if(!g.isBlank(r.dropDownList)){r.dropDownList={values:_.reject(r.dropDownList.values||[],function(u){return u.deleted})}}if(!g.isBlank(s.format)&&!g.isBlank(s.format.rdf)){r.format.rdf=[];var t=s.format.rdf.split(",");_.forEach(t,function(u){if(_.any(f,function(v){return v.value==u})){r.format.rdf.push({stock:u})}else{r.format.rdf.push({custom:u})}})}return r},_isReadOnly:function(){return this._view.isSnapshot()},_getReadOnlyMessage:function(){return g.t("screens.ds.grid_sidebar.column_properties.validation.snapshot")},_getSections:function(){var r=this;return[{title:g.t("screens.ds.grid_sidebar.column_common.basic.title"),fields:[{text:g.t("screens.ds.grid_sidebar.column_common.basic.name"),type:"text",required:true,disabled:h,name:"name",prompt:g.t("screens.ds.grid_sidebar.column_common.basic.name_prompt")},{text:g.t("screens.ds.grid_sidebar.column_common.basic.description"),type:"textarea",disabled:h,name:"description",prompt:g.t("screens.ds.grid_sidebar.column_common.basic.description_prompt")}]},{title:g.t("screens.ds.grid_sidebar.column_common.type.title"),onlyIf:{func:function(s){return !n(s)&&!r._view.newBackend&&!r._view.isPublished()},warn:true,warningMessage:function(s){if(r._view.isPublished()){return g.t("screens.ds.grid_sidebar.column_common.type.working_copy_html")}return""}},fields:[{text:g.t("screens.ds.grid_sidebar.column_common.type.type"),type:"select",required:true,name:"dataTypeName",disabled:function(){return r._view.isPublished()},prompt:null,options:k},{text:g.t("screens.ds.grid_sidebar.column_common.type.type"),type:"static",disabled:function(){return r._view.isPublished()},value:e}]},{title:g.t("screens.ds.grid_sidebar.column_properties.link.title"),onlyIf:{func:n},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.link.key"),type:"columnSelect",name:"format.linkedKey",required:true,columns:{type:"dataset_link",hidden:false}},{text:g.t("screens.ds.grid_sidebar.column_properties.link.source"),type:"select",name:"format.linkedSource",required:true,linkedField:"format.linkedKey",options:function(u,v,t,s){return r._view.getLinkedColumnOptions.call(r._view,u,v,t,s)}}]},{title:g.t("screens.ds.grid_sidebar.column_properties.formatting.title"),onlyIf:{func:function(u){if(g.isBlank(u)){return false}var s=u.origColumn.renderType;return !g.isBlank(s.alignment)||!g.isBlank(s.viewTypes)}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.formatting.alignment"),type:"select",name:"format.align",prompt:null,options:c},{text:g.t("screens.ds.grid_sidebar.column_properties.formatting.view_style"),type:"select",name:"format.view",prompt:null,options:d}]},{title:g.t("screens.ds.grid_sidebar.column_properties.text_formatting.title"),onlyIf:{func:function(u){if(g.isBlank(u)){return false}var s=u.origColumn.renderType;if(s.name!=="text"){return false}return !g.isBlank(s.alignment)||!g.isBlank(s.viewTypes)}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.text_formatting.display_style"),type:"select",name:"format.displayStyle",prompt:null,options:a}]},{title:g.t("screens.ds.grid_sidebar.column_properties.number.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return _.include(["number","percent"],s.origColumn.renderTypeName)}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.number.precision"),type:"radioGroup",name:"precisionGroup",defaultValue:"format.precisionNone",options:[{type:"static",value:g.t("screens.ds.grid_sidebar.column_properties.number.no_precision"),name:"format.precisionNone"},{type:"slider",minimum:0,maximum:10,defaultValue:0,name:"format.precision"}]},{text:g.t("screens.ds.grid_sidebar.column_properties.number.display"),type:"select",name:"format.precisionStyle",prompt:null,options:m},{text:g.t("screens.ds.grid_sidebar.column_properties.money.currency"),type:"select",name:"format.currencyStyle",options:j,defaultValue:"USD",onlySelectFirst:true,onlyIf:{field:"format.precisionStyle",value:"currency"},prompt:null},{text:g.t("screens.ds.grid_sidebar.column_properties.formatting.view_style"),type:"select",name:"format.view",prompt:null,options:blist.datatypes.percent.viewTypes,onlyIf:{field:"format.precisionStyle",value:"percentage"}},{text:g.t("screens.ds.grid_sidebar.column_properties.number.no_commas"),type:"checkbox",name:"format.noCommas"}]},{title:g.t("screens.ds.grid_sidebar.column_properties.number_advanced.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="number"}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.number_advanced.format_mask"),type:"text",name:"format.mask"},{type:"note",value:g.t("screens.ds.grid_sidebar.column_properties.number_advanced.format_mask_prompt")},{type:"note",value:g.t("screens.ds.grid_sidebar.column_properties.number_advanced.format_mask_warning")}]},{title:g.t("screens.ds.grid_sidebar.column_properties.money.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="money"}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.money.precision"),type:"radioGroup",name:"moneyPrecisionGroup",defaultValue:"format.precisionNone",options:[{type:"static",value:g.t("screens.ds.grid_sidebar.column_properties.money.no_precision"),name:"format.precisionNone"},{type:"slider",minimum:0,maximum:2,defaultValue:2,name:"format.precision"}]},{text:g.t("screens.ds.grid_sidebar.column_properties.money.currency"),type:"select",name:"format.currency",prompt:null,defaultValue:"dollar",options:j},{text:g.t("screens.ds.grid_sidebar.column_properties.money.abbreviated"),type:"checkbox",name:"format.humane"}]},{title:g.t("screens.ds.grid_sidebar.column_properties.localization.title"),type:"selectable",showIfData:true,onlyIf:{func:function(s){if(g.isBlank(s)){return false}return _.include(["number","percent","money"],s.origColumn.renderTypeName)}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.localization.decimal"),type:"text",name:"format.decimalSeparator",defaultValue:"."},{text:g.t("screens.ds.grid_sidebar.column_properties.localization.thousands"),type:"text",name:"format.groupSeparator",defaultValue:","}]},{title:g.t("screens.ds.grid_sidebar.column_properties.photo.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="photo"}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.photo.size"),type:"select",name:"format.size",prompt:g.t("screens.ds.grid_sidebar.column_properties.photo.size_prompt"),options:[{value:"tiny",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.tiny")},{value:"thumb",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.thumb")},{value:"medium",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.medium")},{value:"featured",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.featured")},{value:"large",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.large")},{value:"",text:g.t("screens.ds.grid_sidebar.column_properties.photo.sizes.original")}],defaultValue:""}]},{title:g.t("screens.ds.grid_sidebar.column_properties.url.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="url"}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.url.base_url"),type:"text",name:"format.baseUrl",prompt:g.t("screens.ds.grid_sidebar.column_properties.url.base_url_prompt"),extraClass:"url"}]},{title:g.t("screens.ds.grid_sidebar.column_properties.display_order.title"),type:"selectable",name:"displayOrder",showIfData:true,onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="text"}},fields:[{type:"repeater",addText:g.t("screens.ds.grid_sidebar.column_properties.display_order.new_item_button"),defaultValue:g.subKeyDefined(r,"_curData.origColumn.cachedContents.top")?_.pluck(r._curData.origColumn.cachedContents.top,"item"):null,name:"metadata.displayOrder",minimum:0,field:{type:"text",text:g.t("screens.ds.grid_sidebar.column_properties.display_order.option"),name:"orderItem"}}]},{title:g.t("screens.ds.grid_sidebar.column_properties.multiple_choice.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="drop_down_list"}},fields:[{type:"repeater",addText:g.t("screens.ds.grid_sidebar.column_properties.multiple_choice.new_option_button"),name:"dropDownList.values",minimum:1,savedField:"id",field:{type:"text",text:g.t("screens.ds.grid_sidebar.column_properties.multiple_choice.option"),name:"description"}}]},{title:g.t("screens.ds.grid_sidebar.column_common.linked_dataset.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return s.origColumn.renderTypeName=="dataset_link"}},fields:[{text:g.t("screens.ds.grid_sidebar.column_common.linked_dataset.dataset"),type:"text",name:"format.linkedDataset",data:{"4x4uid":"unverified"},prompt:g.t("screens.ds.grid_sidebar.column_common.linked_dataset.dataset_prompt")},{text:g.t("screens.ds.grid_sidebar.column_common.linked_dataset.key"),type:"select",name:"format.keyColumn",linkedField:"format.linkedDataset",options:Dataset.getLinkedDatasetOptionsNoDefault},{text:g.t("screens.ds.grid_sidebar.column_common.linked_dataset.label"),type:"select",name:"format.labelColumn",linkedField:"format.linkedDataset",options:Dataset.getLinkedDatasetOptionsDefault}]},{title:g.t("screens.ds.grid_sidebar.column_properties.column_totals.title"),onlyIf:{func:function(s){if(g.isBlank(s)){return false}return !g.isBlank(s.origColumn.renderType.aggregates)}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.column_totals.total"),type:"select",name:"format.aggregate",prompt:g.t("screens.ds.grid_sidebar.column_properties.column_totals.total_prompt"),options:q}]},{title:g.t("screens.ds.grid_sidebar.column_properties.advanced.title"),type:"selectable",name:"advanced",onlyIf:{func:function(s){return !r._view.isPublished()}},fields:[{text:g.t("screens.ds.grid_sidebar.column_properties.advanced.api_identifier"),type:"text",data:{fieldName:"unverified"},name:"fieldName"},{type:"repeater",addText:g.t("screens.ds.grid_sidebar.column_properties.advanced.new_rdf_button"),name:"format.rdf",minimum:0,field:{type:"radioGroup",text:g.t("screens.ds.grid_sidebar.column_properties.advanced.semantics"),name:"rdfGroup",options:[{type:"select",name:"stock",options:f},{type:"text",name:"custom",prompt:g.t("screens.ds.grid_sidebar.column_properties.advanced.url"),extraClass:"url"}]}}]}]},_getFinishButtons:function(){return[g.extend({},g.controlPane.buttons.update,{requiresLogin:false}),g.controlPane.buttons.cancel]},_finish:function(w,D,A){var z=this;if(!z._super.apply(z,arguments)){return}var t=z._getFormValues();var r=w.origColumn;if(!g.isBlank(r.format)){t.format=t.format||{};_.each(["drill_down","grouping_aggregate","group_function"],function(E){t.format[E]=r.format[E]});if(t.format.decimalSeparator=="."){delete t.format.decimalSeparator}if(t.format.groupSeparator==","){delete t.format.groupSeparator}}if(!g.isBlank(t.format)&&!g.isBlank(t.format.rdf)){var y=_.map(t.format.rdf,function(E){return g.isBlank(E.stock)?E.custom:E.stock});t.format.rdf=y.join(",")}if(r.isLinked()){var C=t.format.linkedKey;if(_.isNumber(C)){var B=this._view.columnForID(C);if(B!=null){t.format.linkedKey=B.fieldName}}var v=t.format.linkedSource;t.dataTypeName=z._view.getLinkSourceDataType(null,v,C).value}var s=t.dataTypeName;delete t.dataTypeName;var u=!g.isBlank(s)&&s!=w.dataTypeName;var x=function(){z._finishProcessing();z._showMessage(g.t("screens.ds.grid_sidebar.column_properties.success"));_.defer(function(){z._hide()});if(_.isFunction(A)){A()}};r.update(t);r.view.trigger("columns_changed");r.view.invalidateMeta();if(!r.save(function(G){if(u){var F=G.id;var E=G.lookup;G.convert(s,function(I){x();var H={};H[E]=I.lookup;G.view.trigger("columns_changed",["lookupChange",H])},function(H){z._genericErrorHandler(H)})}else{x()}},function(E){z._genericErrorHandler(E)})){x()}}},{name:"columnProperties"},"controlPane");if(!blist.sidebarHidden.columnProperties){g.gridSidebar.registerConfig("columnProperties","pane_columnProperties")}})(jQuery);(function(c){var d=_.compact(_.map(blist.datatypes,function(m,o){return !c.isBlank(m.filterConditions)||_.any(m.subColumns,function(n){return !c.isBlank(n.filterConditions)})?o:null}));var j=function(m){if(c.isBlank(m)){return false}return !_.isEmpty(this._view.columnForTCID(m).renderType.subColumns)};var b=function(m){if(c.isBlank(m)){return null}var o=this._view.columnForTCID(m);var n=_.map(o.renderType.subColumns||{},function(p){return{value:p.name,text:p.title}});return _.isEmpty(n)?null:n};var e=function(n){if(c.isBlank(n.tableColumnId)){return null}var m=this._view.columnForTCID(n.tableColumnId).renderType;if(c.subKeyDefined(m,"subColumns."+n.subColumn)){m=m.subColumns[n.subColumn]}if(c.isBlank(m.filterConditions)){return null}return _.map(m.filterConditions.orderedList,function(o){return{value:o,text:m.filterConditions.details[o].text}})};var f=function(q,r,t){if(c.isBlank(r.tableColumnId)||c.isBlank(r.operator)){return false}var n=this._view.columnForTCID(r.tableColumnId);var p=n.renderType;if(c.subKeyDefined(p,"subColumns."+r.subColumn)){p=p.subColumns[r.subColumn]}if(!c.subKeyDefined(p,"filterConditions.details."+r.operator)||p.filterConditions.details[r.operator].editorCount<1){return false}var o=p.filterConditions.details[r.operator];var s={dropDownList:n.dropDownList,baseUrl:n.baseUrl()};var m=p.filterConditions.details[r.operator].interfaceType;_.times(o.editorCount,function(u){if(u>0){q.append(c.tag({tagName:"span","class":["joiner",p.name],contents:"&amp;"}))}var v=c.tag({tagName:"div","class":["editorWrapper",p.name]});v.blistEditor({type:p,editorInterface:m,row:null,value:_.isArray(t)?t[u]:t,format:n.format,customProperties:s});q.append(v)});q.toggleClass("twoEditors",o.editorCount==2);if(!c.isBlank(c.uniform)){q.find("select, :checkbox, :radio, :file").uniform()}return true};var g=function(o){if(c.isBlank(o.tableColumnId)||c.isBlank(o.operator)){return false}var m=this._view.columnForTCID(o.tableColumnId);var n=m.renderType;if(c.subKeyDefined(n,"subColumns."+o.subColumn)){n=n.subColumns[o.subColumn]}if(!c.subKeyDefined(n,"filterConditions.details."+o.operator)||n.filterConditions.details[o.operator].editorCount<1){return false}return true};var k=function(m){var o=m.find(".editorWrapper");if(o.length<1){return null}var n=[];o.each(function(){var q=c(this);var p=q.blistEditor().currentValue();if(_.isNull(p)&&q.blistEditor().type.name=="checkbox"){p="0"}if(!c.isBlank(p)){n.push(p)}});if(n.length<o.length){return null}if(n.length==1){n=n[0]}return n};var a=function(m){var n=m.find(".editorWrapper");n.each(function(){var o=c(this);if(o.isControlClass("blistEditor")){o.blistEditor().finishEdit()}})};var l={text:c.t("screens.ds.grid_sidebar.conditional_formatting.format_html"),type:"radioGroup",name:"conditionIndicator",defaultValue:"color",options:[{type:"color",required:true,name:"color",defaultValue:"#bbffbb"},{type:"custom",required:true,disabled:function(){return !this._parentView&&!_.include(this._view.metadata.availableDisplayTypes,"map")},editorCallbacks:{create:function(o,p,q){if(q){o.append('<img src="'+q+'" /> ')}var n=o.parents(".radioLine").children(":disabled").length>0;if(n){o.append(c.t("screens.ds.grid_sidebar.conditional_formatting.validation.no_icons"));return true}o.append("(<a>"+c.t("screens.ds.grid_sidebar.conditional_formatting.change_icon")+'</a>)<input type="hidden" name="'+o.attr("name")+'" value="'+q+'" />');var m=this._view.id;o.find("a").data("ajaxupload",new AjaxUpload(o,{action:"/api/views/"+m+"/files.txt",autoSubmit:true,responseType:"json",onComplete:function(s,r){var u="/api/views/"+m+"/files/"+r.file;var t=o.find("img");if(t.length==0){o.prepend('<img src="'+u+'" /> ')}else{t.attr("src",u)}o.find("input").attr("value",u);o.parents(".radioLine").find("input:radio").prop("checked",true).click()}}));return true},value:function(m){return m.find("img").attr("src")}},name:"icon"}]};var h=function(n){var o=n._parentView&&n._view.id==n._parentView.id?"self":n._view.id;if(c.subKeyDefined(n._parentView,"metadata.conditionalFormatting."+o)){var m=c.extend(true,{},n._view.metadata);m.conditionalFormatting=_.union(n._parentView.metadata.conditionalFormatting[o],o=="self"?[]:(m.conditionalFormatting||[]));n._view.update({metadata:m})}};c.Control.extend("pane_conditionalFormatting",{setView:function(p){var o=this;var n=o._super;var m=function(q){n.call(o,q);o._view.bind("clear_temporary",function(){o.reset()},o);o._view.bind("conditionalformatting_change",function(){o.reset()},o);h(o)};if(c.subKeyDefined(p,"displayFormat.viewDefinitions")){if(!c.isBlank(o._parentView)){o._parentView.unbind(null,null,o)}o._parentView=p;o._parentView.bind("clear_temporary",function(){o.reset()},o);o._parentView.bind("displayformat_change",function(){o.setView(o._parentView);o.reset()},o);o._parentView.bind("conditionalformatting_change",function(){o.reset()},o);if(p.displayFormat.viewDefinitions[0].uid=="self"){m(p)}else{Dataset.lookupFromViewId(p.displayFormat.viewDefinitions[0].uid,m)}}else{m(p)}},getTitle:function(){return c.t("screens.ds.grid_sidebar.conditional_formatting.title")},getSubtitle:function(){return c.t("screens.ds.grid_sidebar.conditional_formatting.subtitle")},isAvailable:function(){return this._view.visibleColumns.length>0&&this._view.valid},getDisabledSubtitle:function(){return !this._view.valid?c.t("screens.ds.grid_sidebar.base.validation.invalid_view"):c.t("screens.ds.grid_sidebar.conditional_formatting.validation.no_columns")},_getCurrentData:function(){return this._super()||this._view},_dataPreProcess:function(n){var m=c.extend(true,{},n.metadata);if(c.isPlainObject(m.conditionalFormatting)){m.conditionalFormatting=_.union.apply(this,_.values(m.conditionalFormatting))}_.each(m.conditionalFormatting||[],function(o){if(o.condition===true){o.condition={operator:"always"}}else{if(!_.isArray(o.condition.children)){var p={children:[o.condition],operator:"and"};o.condition=p}}});return{metadata:m}},render:function(){h(this);this._super.apply(this,arguments)},_getSections:function(){return[{title:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.title"),fields:[{type:"repeater",minimum:0,addText:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.new_rule_button"),name:"metadata.conditionalFormatting",field:{type:"group",extraClass:"conditionGroup",options:[{type:"text",text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.description"),name:"description",prompt:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.description_prompt")},l,{type:"select",text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.when_title"),prompt:null,options:[{text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.when.all"),value:"and"},{text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.when.any"),value:"or"},{text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.when.always"),value:"always"}],name:"condition.operator"},{type:"repeater",minimum:0,addText:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.new_condition_button"),name:"condition.children",onlyIf:{field:"condition.operator",value:"always",negate:true},field:{type:"group",options:[{type:"columnSelect",text:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.item.title"),required:true,name:"tableColumnId",isTableColumn:true,columns:{type:d,hidden:false}},{type:"select",name:"subColumn",linkedField:"tableColumnId",prompt:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.item.subcolumn"),onlyIf:{field:"tableColumnId",func:j},options:b},{type:"select",name:"operator",required:true,linkedField:["tableColumnId","subColumn"],prompt:c.t("screens.ds.grid_sidebar.conditional_formatting.conditions.item.operator"),options:e},{type:"custom",required:true,name:"value",linkedField:["tableColumnId","subColumn","operator"],editorCallbacks:{create:f,required:g,value:k,cleanup:a}}]}}]}}]}]},_getFinishButtons:function(){return[{text:c.t("core.dialogs.apply"),isDefault:true,value:true},c.controlPane.buttons.cancel]},_finish:function(r,q,p){var s=this;if(!s._super.apply(s,arguments)){return}var n=s._getFormValues();var m=c.extend(true,{},s._view.metadata);m.conditionalFormatting=(n.metadata||{}).conditionalFormatting;_.each(m.conditionalFormatting||[],function(t){if(t.condition.operator=="always"){t.condition=true}else{if(t.condition.children.length<2){t.condition=t.condition.children[0]}}});s._view.update({metadata:m});if(s._parentView){var o=c.extend(true,{},s._parentView.metadata);o.conditionalFormatting=o.conditionalFormatting||{};o.conditionalFormatting[s._view.id==s._parentView.id?"self":s._view.id]=(s._view.metadata||{}).conditionalFormatting;s._parentView.update({metadata:o})}s._finishProcessing();if(_.isFunction(p)){p()}}},{name:"conditionalFormatting"},"controlPane");if(c.isBlank(blist.sidebarHidden.filter.conditionalFormatting)||!blist.sidebarHidden.filter.conditionalFormatting){c.gridSidebar.registerConfig("filter.conditionalFormatting","pane_conditionalFormatting",10)}})(jQuery);(function(e){e.Control.extend("pane_dataLensCreate",{_init:function(){var g=this;g._super.apply(g,arguments);g._view.bind("clear_temporary",function(){g.reset()},g)},_getSections:function(){return[{customContent:{template:"dataLensPaneContentWrapper"}}]},render:function(j,g,h){var k=this;k._super(j,g,function(){if(_.isFunction(h)){h()}var l=k.$dom().find(".dataLensPaneContentWrapper .finishButtons .button");var m=e.t("screens.ds.grid_sidebar.data_lens.button_flyout");l.socrataTip({content:m,positions:"left"});c().then(function(n){if(n!=="#"){l.removeClass("disabled").attr("href",n).socrataTip().destroy()}})})},getTitle:function(){return e.t("screens.ds.grid_sidebar.data_lens.title")}},{name:"dataLensCreate"},"controlPane");var f=e.isBlank(blist.sidebarHidden.visualize)||!blist.sidebarHidden.visualize.dataLensCreate;var a=blist.feature_flags.use_ephemeral_bootstrap;var d;if(a&&f){e.gridSidebar.registerConfig("visualize.dataLensCreate","pane_dataLensCreate",2,"chart");d=blist.dataset.getNewBackendMetadata()}function b(){var g=!_.isUndefined(blist.dataset.query)&&!_.isUndefined(blist.dataset.query.groupBys);return{hasGroupBys:g,dataset:blist.dataset,dataLensState:blist.feature_flags.data_lens_transition_state}}function c(){var j="#";var g=blist.locale===blist.defaultLocale?"":"/"+blist.locale;var l=b();var k=!l.hasGroupBys;var h=e.Deferred();if(l.dataset.viewType==="geo"){h.resolve(j);return h.promise()}else{if(l.dataset.newBackend){if(k){j="{0}/view/bootstrap/{1}".format(g,l.dataset.id)}h.resolve(j);return h.promise()}else{if(_.isUndefined(d)){h.resolve(j);return h.promise()}return d.pipe(function(m){if(m&&k){j="{0}/view/bootstrap/{1}".format(g,m.id)}return j}).fail(function(){return j})}}}})(jQuery);(function(a){a.Control.extend("pane_deleteDataset",{getTitle:function(){return a.t("screens.ds.grid_sidebar.delete.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.delete.subtitle",{view_type:this._view.displayName})},_getSections:function(){var b="";if(this._view.type=="blist"){if(this._view.isPublished()){b=a.t("screens.ds.grid_sidebar.delete.warning.published")}else{b=a.t("screens.ds.grid_sidebar.delete.warning.working_copy")}}else{if(this._view.isAPI()){b=a.t("screens.ds.grid_sidebar.delete.warning.api")}else{if(this._view.viewType=="tabular"){b=a.t("screens.ds.grid_sidebar.delete.warning.view")}}}return[{fields:[{type:"static",value:b}]}]},_getFinishButtons:function(){return[{isDefault:true,text:a.t("screens.ds.grid_sidebar.delete.delete_button",{view_type:this._view.displayName}),value:true},a.controlPane.buttons.cancel]},_finish:function(e,d,c){var f=this;if(!f._super.apply(f,arguments)){return}var g=function(){var h=f._view._modifyingView||f._view._parent;if(_.isUndefined(h)){window.location.href=a.path("/profile")}else{h.redirectTo()}};f._finishProcessing();var b="";if(_.indexOf(this._view.flags,"restorable")!=-1){b=a.t("screens.ds.grid_sidebar.delete.confirm_restorable",{number_of_days_restorable:Dataset.getNumberOfDaysRestorable()})}else{b=a.t("screens.ds.grid_sidebar.delete.confirm_permanent",{view_type:this._view.displayName})}prettyConfirm(b,function(){f._view.remove(g)})}},{name:"deleteDataset"},"controlPane");if(blist.sidebarHidden&&(a.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.deleteDataset)){a.gridSidebar.registerConfig("manage.deleteDataset","pane_deleteDataset",9)}})(jQuery);(function(a){a.Control.extend("pane_downloadDataset",{getTitle:function(){return a.t("screens.ds.grid_sidebar.download.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.download.subtitle")},isAvailable:function(){return this._view.valid&&blist.dataset.isExportable()},getDisabledSubtitle:function(){if(this._view.valid){return a.t("screens.ds.grid_sidebar.download.download_dataset")}else{return a.t("screens.ds.grid_sidebar.base.validation.invalid_view")}},_getSections:function(){var b=this;var f=this._view;var d=this._view.getDownloadType();var e=(f.newBackend&&f.isLayered())?"layer_geojson_attributes":"layer_attributes";var c=!this._view.isGeoDataset();return[{customContent:{template:"downloadsSectionContent",directive:a.templates.downloadsTable.directive[d],data:{downloadTypes:a.templates.downloadsTable.downloadTypes[d],layerDownloadTypes:a.templates.downloadsTable.downloadTypes[e],view:this._view},callback:function(g){if(c){g.find(".downloadsList .item a").downloadToFormCatcher(f,b.$dom())}if(f.isGeoDataset()){f.getChildOptionsForType("table",function(j){var h=function(k){g.find(".layerDownloadsContent .item a").each(function(){var l=a(this);var m=_.detect(j,function(n){return n.id==k});l.attr("href",m.downloadUrl(l.data("type")))})};h(j[0].id);if(j.length>1){g.find(".layerTableDownloads").find(".layerChooser").append(_.map(j,function(k){return a.tag({tagName:"option",contents:k.name,"data-uid":k.id},true)}).join("")).change(function(){h(a(this).find("option:selected").data("uid"))}).end().addClass("hasChoices")}})}a.templates.downloadsTable.postRender(g)}}}]}},{name:"downloadDataset"},"controlPane");if(a.isBlank(blist.sidebarHidden.exportSection)||!blist.sidebarHidden.exportSection.download){a.gridSidebar.registerConfig("export.downloadDataset","pane_downloadDataset",1)}})(jQuery);(function(a){a.Control.extend("pane_editRedirect",{getTitle:function(){return a.t("controls.common.sidebar.tabs.edit")},_getSections:function(){return[{customContent:{callback:function(b){b.append(blist.datasetControls.editPublishedMessage())}}}]}},{name:"edit"},"controlPane");if(a.isBlank(blist.sidebarHidden.edit)||!blist.sidebarHidden.edit.redirect){a.gridSidebar.registerConfig("edit","pane_editRedirect")}})(jQuery);(function(a){a.Control.extend("pane_embedSdp",{getTitle:function(){return a.t("screens.ds.grid_sidebar.sdp.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.sdp.subtitle")},isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)},getDisabledSubtitle:function(){return !this._view.valid||(this._view.temporary&&!this._view.minorChange)?a.t("screens.ds.grid_sidebar.sdp.validation.valid_saved"):a.t("screens.ds.grid_sidebar.sdp.validation.public")},_getSections:function(){var b=this;return[{customContent:{template:"embedForm",directive:{},data:{},callback:function(d){d.find(".privateDatasetMessage").toggleClass("hide",b._view.isPublic());d.embedForm({invalidCallback:function(){d.closest(".paneContent").find(".button[data-value=preview]").addClass("disabled")},validCallback:function(){d.closest(".paneContent").find(".button[data-value=preview]").removeClass("disabled")}});var c=d.find("#form_code").text();d.find("#form_code").text(a.htmlUnescape(c))}}}]},_getFinishButtons:function(){return[a.controlPane.buttons.done,{text:a.t("screens.ds.grid_sidebar.sdp.preview"),value:"preview",isDefault:false}]},_finish:function(g,f,e){var j=this;if(!j._super.apply(j,arguments)){return}j._finishProcessing();var h=j.$dom().find(".embedForm.commonForm");if((f=="preview")&&(!j.$dom().find(".button[data-value=preview]").hasClass("disabled"))){var d=h.find("#embed_width").val();var c=h.find("#embed_height").val();var b=h.find("#embed_template").val()||"";window.open(j._view.url+"/widget_preview?width="+d+"&height="+c+"&customization_id="+b,"Preview")}if(_.isFunction(e)){e()}}},{name:"embedSdp",noReset:true},"controlPane");if(a.isBlank(blist.sidebarHidden.embed)||!blist.sidebarHidden.embed.sdp){a.gridSidebar.registerConfig("embed.embedSdp","pane_embedSdp",1)}})(jQuery);(function(a){a.Control.extend("pane_feed",{getTitle:function(){return a.t("screens.ds.grid_sidebar.feed.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.feed.subtitle")},_getSections:function(){return[{customContent:{template:"feedList",directive:{},data:{},callback:function(c){var e=this;e._startProcessing();var d;var b=[];doRender=_.after(3,function(){e._finishProcessing();e.$dom().find(".feedList .feed").feedList({comments:d,mainView:e._view,views:b,addCommentCallback:function(f,g){a(".controlPane.about .numberOfComments").text(f.numberOfComments);if(!a.isBlank(blist.datasetPage)){blist.datasetPage.$feedTab.contentIndicator().setText(f.numberOfComments)}}})});e._view.getComments(function(f){d=f;doRender()});e._view.getRelatedViews(function(f){b=b.concat(f);doRender()});e._view.getParentDataset(function(f){if(!a.isBlank(f)){b=b.concat(f)}doRender()})}}}]}},{name:"feed",noReset:true},"controlPane");if(a.isBlank(blist.sidebarHidden.feed)||!blist.sidebarHidden.feed.discuss){a.gridSidebar.registerConfig("feed","pane_feed")}})(jQuery);(function(c){c.Control.extend("pane_formCreate",{isAvailable:function(){var d=this;return _.any(d._view.visibleColumns,function(e){return"nested_table"!=e.dataTypeName})&&(d._view.valid||b(d))},_getCurrentData:function(){var f=this._super();if(!c.isBlank(f)){return f}if(!b(this)){return null}var e=this._view.cleanCopy();e.flags=e.flags||[];if(this._view.isPublic()){e.flags.push("dataPublicAdd")}return e},getTitle:function(){return c.t("screens.ds.grid_sidebar.form.title")},getSubtitle:function(){return c.t("screens.ds.grid_sidebar.form.subtitle")},getDisabledSubtitle:function(){return !this._view.valid?c.t("screens.ds.grid_sidebar.base.validation.invalid_view"):c.t("screens.ds.grid_sidebar.form.validation.no_columns")},_getSections:function(){return[{title:c.t("screens.ds.grid_sidebar.form.information.title"),fields:[{type:"text",text:c.t("screens.ds.grid_sidebar.form.information.name"),name:"name",required:true,prompt:c.t("screens.ds.grid_sidebar.form.information.name_prompt")},{type:"text",text:c.t("screens.ds.grid_sidebar.form.information.success"),name:"displayFormat.successRedirect",extraClass:"url",prompt:c.t("screens.ds.grid_sidebar.form.information.success_prompt")},{type:"checkbox",text:c.t("screens.ds.grid_sidebar.form.information.public"),name:"flags.dataPublicAdd",defaultValue:true}]}]},_getFinishButtons:function(){return[b(this)?c.controlPane.buttons.update:c.controlPane.buttons.create,c.controlPane.buttons.cancel]},_finish:function(f,m,j){var h=this;if(!h._super.apply(this,arguments)){return}var k=c.extend(true,{displayFormat:null,displayType:"form",metadata:{}},h._getFormValues(),{metadata:h._view.metadata});k.metadata.renderTypeConfig.visible={form:true};var o=h._view.isPublic();var n=a(k);var d=b(h);k.metadata.availableDisplayTypes=["form"];h._view.update(k);if(!d){var e;var l=_.after(2,function(){h._finishProcessing();if(_.isFunction(j)){j()}e.redirectTo()});h._view.getParentDataset(function(q){if(!q.publicationAppendEnabled){q.update({publicationAppendEnabled:true});q.save(l,function(r){h._genericErrorHandler(r)},{publicationAppendEnabled:true})}else{l()}});var g=false;h._view.saveNew(g,function(q){e=q;l()},function(q){h._genericErrorHandler(q)})}else{var p=function(){h._view.save(function(t){h._finishProcessing();if(!c.isBlank(h.settings.renderTypeManager)){var r=h.settings.renderTypeManager.$domForType("form").find("form.formView");var s=t.displayFormat.successRedirect;if(c.isBlank(s)){s=r.attr("data-defaultSuccessRedirect")}var q=r.attr("action");q=c.urlParam(q,"successRedirect",escape(s));r.attr("action",q)}c(".currentViewName").text(t.name);h._showMessage("Your form has been updated");h._hide();if(_.isFunction(j)){j()}})};if(o!==n){h._view["make"+(n?"Public":"Private")](p)}else{p()}}}},{name:"formCreate"},"controlPane");var b=function(d){return d._view.type=="form"};var a=function(d){return _.include(d.flags||[],"dataPublicAdd")||_.any(d.grants||[],function(e){return e.type=="contributor"&&_.include(e.flags||[],"public")})};if(c.isBlank(blist.sidebarHidden.embed)||!blist.sidebarHidden.embed.formCreate){c.gridSidebar.registerConfig("embed.formCreate","pane_formCreate",5,"form")}})(jQuery);(function(e){var b=blist.namespace.fetch("blist.configs.map");var o=blist.namespace.fetch("blist.mixpanel");var n=_.map(_.pluck(Dataset.map.backgroundLayers,"key"),function(q){return{text:q,value:q}});var k=[{text:e.t("screens.ds.grid_sidebar.map.regions.countries"),value:"countries"},{text:e.t("screens.ds.grid_sidebar.map.regions.state"),value:"state"},{text:e.t("screens.ds.grid_sidebar.map.regions.canada_provinces"),value:"canada_provinces"},{text:e.t("screens.ds.grid_sidebar.map.regions.counties"),value:"counties"}];var p=function(r){var q=[{text:e.t("screens.ds.grid_sidebar.map.plots.point"),value:"point"},{text:e.t("screens.ds.grid_sidebar.map.plots.heatmap"),value:"heatmap"},{text:e.t("screens.ds.grid_sidebar.map.plots.rastermap"),value:"rastermap"}];return q};if(blist.currentUser){n=n.concat({text:e.t("screens.ds.grid_sidebar.map.layers.custom"),value:"custom",data:{type:null}})}var g=function(q,r){q.attr("data-custom-validlayerurl","unverified")};var a=function(q){if(e.isBlank(q)||(_.isString(q)&&q!="counties")||!_.include(q,"counties")){return null}return[{value:"ak",text:"Alaska"},{value:"al",text:"Alabama"},{value:"ar",text:"Arkansas"},{value:"az",text:"Arizona"},{value:"ca",text:"California"},{value:"co",text:"Colorado"},{value:"ct",text:"Connecticut"},{value:"de",text:"Delaware"},{value:"fl",text:"Florida"},{value:"ga",text:"Georgia"},{value:"hi",text:"Hawaii"},{value:"ia",text:"Iowa"},{value:"id",text:"Idaho"},{value:"il",text:"Illinois"},{value:"in",text:"Indiana"},{value:"ks",text:"Kansas"},{value:"ky",text:"Kentucky"},{value:"la",text:"Louisiana"},{value:"ma",text:"Massachusetts"},{value:"md",text:"Maryland"},{value:"me",text:"Maine"},{value:"mi",text:"Michigan"},{value:"mn",text:"Minnesota"},{value:"mo",text:"Missouri"},{value:"ms",text:"Mississippi"},{value:"mt",text:"Montana"},{value:"nc",text:"North Carolina"},{value:"nd",text:"North Dakota"},{value:"ne",text:"Nebraska"},{value:"nh",text:"New Hampshire"},{value:"nj",text:"New Jersey"},{value:"nm",text:"New Mexico"},{value:"nv",text:"Nevada"},{value:"ny",text:"New York"},{value:"oh",text:"Ohio"},{value:"ok",text:"Oklahoma"},{value:"or",text:"Oregon"},{value:"pa",text:"Pennsylvania"},{value:"ri",text:"Rhode Island"},{value:"sc",text:"South Carolina"},{value:"sd",text:"South Dakota"},{value:"tn",text:"Tennessee"},{value:"tx",text:"Texas"},{value:"ut",text:"Utah"},{value:"va",text:"Virginia"},{value:"vt",text:"Vermont"},{value:"wa",text:"Washington"},{value:"wi",text:"Wisconsin"},{value:"wv",text:"West Virginia"},{value:"wy",text:"Wyoming"}]};var j=function(q){return !e.isBlank(q.view)&&q.view.displayFormat.heatmap&&q.view.displayFormat.heatmap.type=="custom"};var m=false;var h=function(q,t,s,r){if(m){return mapLayers}m=true;e.Tache.Get({url:"/api/layers",success:function(u){_.each(u,function(v){mapLayers.push({text:v.name,value:v.url,data:{type:"dynamic"}})});s.data("linkedFieldValues","_reset");_.each(s.data("linkedGroup"),function(v){e(v).trigger("change")});_.defer(function(){s.val(r)})}});return mapLayers};var f=function(q){return e('<span class="error">'+q+"</span>").css({marginLeft:0,paddingLeft:0})};var c=function(q){return function(){var t=this;var s=e.t("screens.ds.grid_sidebar.map.validation.location_column");var r=!e.isBlank(t._view)&&_.any(t._view.realColumns,function(u){return _.include(["location","point"],u.dataTypeName)&&u.hidden});if(q.useOtherSidebars&&r&&(e.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.showHide)){s+=" "+e.t("screens.ds.grid_sidebar.map.validation.hidden_location_html")}if(blist.mixpanelLoaded){o.trackUserError({Product:"Classic Maps","Message Shown":s,"Chart/Map Type":"Map"})}return s}};var l=function(r,t,u){var w=this;blist.common.selectedDataset=function(y){w._expectingCancel=false;e("#selectDataset").jqmHide();w._$selectedField.data("uid",y.id);var z=function(B){var A=q(B);w._$selectedField.makeStatic(B.name,!A);if(A){d.call(w,B,w._$selectedField)}e(".mapCreate .finishButtons .submit").removeClass("disabled")};var x=function(){var B=e.t("screens.ds.grid_sidebar.map.validation.location_column_invalid_dataset");var A=f(B);r.append(A);if(blist.mixpanelLoaded){o.trackUserError({Product:"Classic Maps","Message Shown":B,"Chart/Map Type":"Map"})}e(".mapCreate .finishButtons .submit").addClass("disabled")};Dataset.lookupFromViewId(y.id,z,x)};var v=function(x){if(x){x.preventDefault()}w._$selectedField=r;e("#selectDataset").jqmShow();w._expectingCancel=true};var q=function(x){return x.isArcGISDataset()||x.isGeoDataset()||_.any(x.realColumns,function(y){return _.include(["location","point"],y.renderTypeName)})};r.makeStatic=function(A,z,x){r.empty();r.data("dsName",A);r.append("<span>"+e.htmlEscape(A)+(x?"":' (<span class="edit">'+e.t("screens.ds.grid_sidebar.map.layers.edit")+"</span>)")+"</span>");r.find("span.edit").click(v).css({cursor:"pointer",color:"#0000ff"});if(z){var B=e.t("screens.ds.grid_sidebar.map.validation.location_column");var y=f(B);r.append(y);if(blist.mixpanelLoaded){o.trackUserError({Product:"Classic Maps","Message Shown":B,"Chart/Map Type":"Map"})}}};if(!e.isBlank(u)){r.data("uid",u);var s=function(y){var x=q(y);r.makeStatic(y.name,!x,w._view.id==y.id);if(x){d.call(w,y,r)}};if(u=="self"){s(w._view)}else{Dataset.lookupFromViewId(u,s)}}else{v();w._selectingEmpty=true}if(!r.data("hookedCleanupEvent")){r.parents(".line.group").find(".removeLink").click(function(){d.call(w,null,r)});r.data("hookedCleanupEvent",true);e(document).bind(blist.events.MODAL_HIDDEN,function(){if(w._expectingCancel){w._$selectedField.makeStatic(w._$selectedField.data("dsName"));w._expectingCancel=false;if(w._selectingEmpty){w._$selectedField.parents(".line.group").find(".removeLink").click();delete w._selectingEmpty}}})}return true};var d=function(v,s){var w=this;var r=s.parents(".repeater").children(".line.group").index(s.parents(".line.group"));if(!v){if(w.childPanes.length<=r){return}w.childPanes.splice(r,1)[0].$dom().remove();_.each(w.childPanes.slice(r),function(y,x){y.setIndex(r+x)});return}var u=function(y){var x=w.$dom().find(".dataLayerContainer");if(x.length==0){s.parents(".formSection").after('<div class="dataLayerContainer" />');x=w.$dom().find(".dataLayerContainer")}if(x.children().length<=r){x.append(y.$dom())}else{x.find("> div:eq("+r+")").before(y.$dom())}};var t=w.childPanes[r];if(!t){var q=e.extend(true,{},w._view.displayFormat);if(!e.subKeyDefined(q,"viewDefinitions.0.uid")){e.deepSet(q,e.extend(true,{},v.displayFormat),"viewDefinitions",r)}t=w.childPanes[r]=e("<div />").pane_mapDataLayerCreate({data:{displayFormat:q},parent:w,view:v,index:r});u(t);t.render()}else{if(w._childrenDirty&&t.$dom().parents(".controlPane").length==0){u(t)}t.setView(v);t.reset()}t.$dom().find("div.required").remove()};b.config=function(r){r=e.extend({isEdit:false,useOtherSidebars:false},r);var q=[];if(!r.canvas){q.push({title:e.t("screens.ds.grid_sidebar.map.layers.title"),fields:[{type:"repeater",name:"displayFormat.viewDefinitions",addText:e.t("screens.ds.grid_sidebar.map.layers.new_data_button"),field:{type:"group",options:[{text:e.t("screens.ds.grid_sidebar.map.layers.dataset"),type:"custom",name:"uid",required:true,defaultValue:"self",repeaterValue:"",editorCallbacks:{create:l,value:function(s){return s.data("uid")}}}]},minimum:1}]})}q.push({title:e.t("screens.ds.grid_sidebar.map.base_layers.title"),fields:[{type:"note",value:e.t("screens.ds.grid_sidebar.map.base_layers.subtitle")},{type:"repeater",name:"displayFormat.bkgdLayers",addText:e.t("screens.ds.grid_sidebar.map.base_layers.new_base_map_button"),minimum:0,field:{type:"group",options:[{text:e.t("screens.ds.grid_sidebar.map.base_layers.layer"),type:"select",name:"layerKey",required:true,prompt:e.t("screens.ds.grid_sidebar.map.base_layers.layer_prompt"),options:n,defaultValue:"World Street Map (ESRI)"},{text:e.t("screens.ds.grid_sidebar.map.base_layers.layer_url"),type:"text",name:"custom_url",onlyIf:{field:"layerKey",value:"custom"},defaultValue:"https://",required:true,data:{validlayerurl:"unverified"},change:g},{text:e.t("screens.ds.grid_sidebar.map.base_layers.alias"),type:"text",name:"alias"},{text:e.t("screens.ds.grid_sidebar.map.base_layers.opacity"),type:"slider",name:"opacity",defaultValue:1,minimum:0,maximum:1}]}}]},{title:e.t("screens.ds.grid_sidebar.map.advanced.title"),fields:[{type:"note",value:e.t("screens.ds.grid_sidebar.map.advanced.subtitle")},{text:e.t("screens.ds.grid_sidebar.map.advanced.exclusive"),name:"displayFormat.exclusiveLayers",type:"checkbox"},{text:e.t("screens.ds.grid_sidebar.map.advanced.hide_geolocator"),name:"displayFormat.disableGeolocator",type:"checkbox"}]},{title:e.t("screens.ds.grid_sidebar.map.legend.title"),type:"selectable",fields:[{text:e.t("screens.ds.grid_sidebar.map.legend.position"),type:"select",prompt:e.t("screens.ds.grid_sidebar.map.legend.position_prompt"),defaultValue:"bottom",name:"displayFormat.legendDetails.position",options:[{text:e.t("screens.ds.grid_sidebar.map.legend.positions.top_right"),value:"topRight"},{text:e.t("screens.ds.grid_sidebar.map.legend.positions.bottom_left"),value:"bottomLeft"},{text:e.t("screens.ds.grid_sidebar.map.legend.positions.none"),value:"none"}]},{text:e.t("screens.ds.grid_sidebar.map.legend.conditional_formats"),type:"checkbox",inputFirst:true,name:"displayFormat.legendDetails.showConditional",defaultValue:true,lineClass:"advLegendCheck"},{type:"repeater",minimum:0,initialRepeatCount:0,addText:e.t("screens.ds.grid_sidebar.map.legend.custom_entry"),name:"displayFormat.legendDetails.customEntries",field:{type:"group",options:[{type:"color",name:"color",defaultValue:blist.defaultColors,lineClass:"colorCollapse"},{text:e.t("screens.ds.grid_sidebar.map.legend.entry_label"),type:"text",name:"label",required:true}]}}]});return q};b.dataLayer={};b.dataLayer.socrataBase=function(q){var s=q.prefix||"displayFormat.";var r={field:s+"plotStyle",value:"heatmap"};return[{text:e.t("screens.ds.grid_sidebar.map.data_layer.alias"),type:"text",name:s+"alias",prompt:e.t("screens.ds.grid_sidebar.map.data_layer.alias_prompt")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.plot_style"),type:"select",name:s+"plotStyle",options:p,required:true,prompt:e.t("screens.ds.grid_sidebar.map.data_layer.plot_style")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.location"),name:s+"plot.locationId",type:"columnSelect",isTableColumn:true,required:true,columns:{type:["location","point"],hidden:q.isEdit}},{text:e.t("screens.ds.grid_sidebar.map.data_layer.region"),name:s+"heatmap.type",type:"select",onlyIf:r,required:!j(q),prompt:e.t("screens.ds.grid_sidebar.map.data_layer.region_level_prompt"),options:k},{text:"",name:s+"heatmap.region",type:"select",onlyIf:r,required:true,prompt:e.t("screens.ds.grid_sidebar.map.data_layer.region_prompt"),linkedField:s+"heatmap.type",options:a}]};b.dataLayer.socrata=function(r){var u=r.prefix||"displayFormat.";var t={field:u+"plotStyle",value:"point"};var v={field:u+"plotStyle",value:"point",negate:true};var q={field:u+"plotStyle",value:"rastermap",negate:true};var s={field:u+"plotStyle",value:"heatmap"};return[{text:e.t("screens.ds.grid_sidebar.map.data_layer.base_color"),name:u+"color",type:"color",onlyIf:t,defaultValue:"#0000ff"},{text:e.t("screens.ds.grid_sidebar.map.data_layer.highlight_color"),name:u+"highlightColor",type:"color",onlyIf:t,defaultValue:"#ddeaf0"},{type:"note",value:e.t("screens.ds.grid_sidebar.map.data_layer.point"),onlyIf:t},{text:e.t("screens.ds.grid_sidebar.map.data_layer.point_size"),name:u+"plot.sizeValueId",onlyIf:t,type:"columnSelect",isTableColumn:true,columns:{type:["number","money","percent"],noDefault:true,hidden:r.isEdit}},{text:e.t("screens.ds.grid_sidebar.map.data_layer.point_color"),name:u+"plot.colorValueId",onlyIf:t,type:"columnSelect",isTableColumn:true,columns:{type:["number","money","percent"],noDefault:true,hidden:r.isEdit}},{text:e.t("screens.ds.grid_sidebar.map.data_layer.icon"),name:u+"plot.iconId",onlyIf:t,type:"columnSelect",isTableColumn:true,columns:{type:["photo","photo_obsolete","url"],noDefault:true,hidden:r.isEdit}},{type:"color",text:e.t("screens.ds.grid_sidebar.map.data_layer.color_low"),defaultValue:["#c9c9c9"],onlyIf:s,name:u+"heatmap.colors.low"},{type:"color",defaultValue:["#00ff00"],text:e.t("screens.ds.grid_sidebar.map.data_layer.color_high"),onlyIf:s,name:u+"heatmap.colors.high"},{text:e.t("screens.ds.grid_sidebar.map.data_layer.quantity"),name:u+"plot.quantityId",onlyIf:v,type:"columnSelect",isTableColumn:true,columns:{type:["number","money","percent"],noDefault:true,hidden:r.isEdit}},{type:"note",value:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.title"),onlyIf:q},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.title_column"),name:u+"plot.titleId",onlyIf:q,type:"columnSelect",isTableColumn:true,columns:{type:["text","location","html","url","drop_down_list","dataset_link","email","percent","stars","flag","phone","money","data","calendar_date","number"],hidden:r.isEdit,defaultNames:["title"]}},{type:"repeater",name:u+"plot.descriptionColumns",onlyIf:q,field:{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.details"),name:"tableColumnId",type:"columnSelect",isTableColumn:true,columns:{hidden:r.isEdit}},minimum:1,addText:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.new_details_button")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.labels"),type:"checkbox",name:u+"flyoutsNoLabel",onlyIf:q},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.opacity"),type:"slider",name:u+"opacity",defaultValue:1,minimum:0,maximum:1}]};b.dataLayer.mondara=function(q){var r=q.prefix||"displayFormat.";return[{text:e.t("screens.ds.grid_sidebar.map.data_layer.alias"),type:"text",name:r+"alias",prompt:e.t("screens.ds.grid_sidebar.map.data_layer.alias_prompt")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.opacity"),type:"slider",name:r+"opacity",defaultValue:1,minimum:0,maximum:1},{type:"note",value:e.t("screens.ds.grid_sidebar.map.data_layer.mondara_note")}]};b.dataLayer.esri=function(q){var r=q.prefix;return[{text:e.t("screens.ds.grid_sidebar.map.data_layer.alias"),type:"text",name:r+"alias",prompt:e.t("screens.ds.grid_sidebar.map.data_layer.alias_prompt")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.title_column"),name:r+"plot.titleId",type:"columnSelect",isTableColumn:true,columns:{type:["text","location","html","url","drop_down_list","dataset_link","email","percent","stars","flag","phone","money","data","calendar_date","number"],hidden:q.isEdit,defaultNames:["title"]}},{type:"repeater",name:r+"plot.descriptionColumns",field:{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.details"),name:"tableColumnId",type:"columnSelect",isTableColumn:true,columns:{hidden:q.isEdit}},minimum:1,addText:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.new_details_button")},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.labels"),type:"checkbox",name:r+"flyoutsNoLabel"},{text:e.t("screens.ds.grid_sidebar.map.data_layer.flyout.opacity"),type:"slider",name:r+"opacity",defaultValue:1,minimum:0,maximum:1}]}})(jQuery);(function(b){b.Control.extend("pane_mapCreate",{_init:function(){var c=this;c._super.apply(c,arguments);if(c._view.type=="map"&&!b.subKeyDefined(c._view,"displayFormat.viewDefinitions")){Dataset.map.convertToVersion2(c._view)}if(b.subKeyDefined(c._view,"displayFormat.bkgdLayers")){c._view.displayFormat.bkgdLayers=_.map(c._view.displayFormat.bkgdLayers,function(e){if(e.layerKey){return e}else{e.layerKey=e.layerName;delete e.layerName;return e}})}var d=function(){c.childPanes=[];c.reset()};c._view.bind("clear_temporary",d,c);c._view.bind("displayformat_change",d,c);c.$dom().delegate(".showConditionalFormatting","click",function(f){f.preventDefault();if(b.subKeyDefined(blist,"datasetPage.sidebar")){blist.datasetPage.sidebar.show("visualize.conditionalFormatting")}});c.$dom().delegate(".clearConditionalFormatting","click",function(g){g.preventDefault();var f=b.extend(true,{},c._view.metadata);delete f.conditionalFormatting;c._view.update({metadata:f})});c.$dom().delegate(".sectionDisabledMessage a","click",function(h){h.preventDefault();if(!b.subKeyDefined(blist,"datasetPage.sidebar")){return}var f={dataTypeName:"location",convert:{}};var g=false;switch(b.hashHref(b(this).attr("href"))){case"convertLatLong":f.convert.latitudeColumn=true;break;case"convertLoc":f.convert.addressColumn=true;break;case"showLoc":g=true;break}c._view.once("columns_changed",function(){if(sectionOnlyIf.func.call(c)){_.defer(function(){c.show()})}});if(g){blist.datasetPage.sidebar.show("manage.showHide")}else{blist.datasetPage.sidebar.show("edit.addColumn",f)}});c.childPanes=[]},getTitle:function(){return b.t("screens.ds.grid_sidebar.map.title")},getSubtitle:function(){return b.t("screens.ds.grid_sidebar.map.subtitle")},_getCurrentData:function(){return this._super()||this._view},_dataPreProcess:function(c){var d=c.cleanCopy();if(!d.displayFormat.layers){d.displayFormat.layers=[{type:"tile",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}return d},isAvailable:function(){return(this._view.valid||a(this))&&(_.include(this._view.metadata.availableDisplayTypes,"map")||this._view.shouldShowViewCreationOptions())},getDisabledSubtitle:function(){return !this._view.valid&&!a(this)?b.t("screens.ds.grid_sidebar.base.validation.invalid_view"):b.t("screens.ds.grid_sidebar.map.validation.viz_limit")},_getSections:function(){return blist.configs.map.config({view:this._view,isEdit:a(this),useOtherSidebars:true})},render:function(){var c=this;c._super();c._childrenDirty=true},_getFinishButtons:function(){return[b.controlPane.buttons.apply,b.controlPane.buttons.cancel]},_finish:function(g,f,e){var h=this;if(!h._super.apply(h,arguments)){return}var c=b.extend(true,{metadata:{renderTypeConfig:{visible:{map:true}}}},h._getFormValues(),{metadata:h._view.metadata});_.each(h.childPanes,function(l){var k=l._index;c.displayFormat.viewDefinitions[k]=b.extend(true,{},l._finish());if(b.subKeyDefined(l,"_view.displayFormat.heatmap.type")&&l._view.displayFormat.heatmap.type=="custom"){c.displayFormat.viewDefinitions[k].heatmap.type="custom";c.displayFormat.viewDefinitions[k].heatmap.cache_url=l._view.displayFormat.heatmap.cache_url}});_.each(["viewport","compositeMembers","overrideWithLayerSet"],function(k){if(!_.isUndefined(h._view.displayFormat.viewport)){c.displayFormat[k]=h._view.displayFormat[k]}});h._view.update(c);var j=false;if(!h._view.isDefault()&&a(h)){var d=_.pluck(h._view.realColumns,"id");if(d.length>0){h._view.setVisibleColumns(d,e,true);j=true}}h._finishProcessing();h.reset();if(!j&&_.isFunction(e)){e()}}},{name:"mapCreate"},"controlPane");var a=function(c){return _.include(c._view.metadata.availableDisplayTypes,"map")};if(b.isBlank(blist.sidebarHidden.visualize)||!blist.sidebarHidden.visualize.mapCreate){b.gridSidebar.registerConfig("visualize.mapCreate","pane_mapCreate",3,"map")}b.Control.extend("pane_mapDataLayerCreate",{_init:function(){var c=this;c._super.apply(c,arguments);c._view.bind("clear_temporary",function(){c.reset()},c);c._view.bind("displayformat_change",function(){c.reset()},c);c._index=c.settings.index;c._uid=(c.settings.parent._view.id==c._view.id?"self":c._view.id);c._origDF=c._getCurrentData().displayFormat.viewDefinitions[c._index]},_getSections:function(){var c=[];var d={fields:blist.configs.map.dataLayer[this._dataType]({prefix:"displayFormat.viewDefinitions."+this._index+".",view:this._view})};var e=this._view.name+(this._uid!="self"?"<br />("+this._uid+")":"");if(this._dataType=="socrata"){c.push({title:b.t("screens.ds.grid_sidebar.map.layers.config",{name:e}),fields:blist.configs.map.dataLayer.socrataBase({prefix:"displayFormat.viewDefinitions."+this._index+".",view:this._view})});c.push({title:b.t("screens.ds.grid_sidebar.map.layers.advanced",{name:e}),name:this._view.id+"_details",type:"selectable",fields:blist.configs.map.dataLayer.socrata({prefix:"displayFormat.viewDefinitions."+this._index+".",view:this._view})})}else{c.push({title:b.t("screens.ds.grid_sidebar.map.layers.config",{name:e}),fields:blist.configs.map.dataLayer[this._dataType]({prefix:"displayFormat.viewDefinitions."+this._index+".",view:this._view})})}return c},setView:function(c){var e=this;var d=e._view;e._super(c);if(!e._getCurrentData().displayFormat.viewDefinitions){e._getCurrentData().displayFormat.viewDefinitions=[]}if(d&&d.id==c.id){e._getCurrentData().displayFormat.viewDefinitions[e._index]=e._origDF}else{e._getCurrentData().displayFormat.viewDefinitions[e._index]={}}if(b.subKeyDefined(e._view.metadata,"custom_fields.Basic.Source")){e._dataType="esri"}else{if(b.subKeyDefined(e._view.metadata,"geo")){e._dataType="mondara"}else{e._dataType="socrata"}}e._uid=(e.settings.parent._view.id==e._view.id?"self":e._view.id)},setIndex:function(c){this._index=c},_finish:function(){var d=this;var c=d._getFormValues();if(b.subKeyDefined(c,"displayFormat.viewDefinitions.0")){c=c.displayFormat.viewDefinitions[0]}else{c=null}return d.settings.data.displayFormat.viewDefinitions[d._index]=d._origDF=b.extend(true,{uid:d._uid},c)}},{name:"mapDataLayerCreate"},"controlPane")})(jQuery);(function(a){a.Control.extend("pane_odata",{getTitle:function(){return a.t("screens.ds.grid_sidebar.odata.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.odata.subtitle",{view_type:this._view.displayName})},_getSections:function(){return[{customContent:{template:"odataContentWrapper",directive:{".odataIntroWrapper@class+":"pClass"},data:{pClass:"sectionContent"}}}]}},{name:"odata"},"controlPane");if(a.isBlank(blist.sidebarHidden.exportSection)||!blist.sidebarHidden.exportSection.odata){a.gridSidebar.registerConfig("export.odata","pane_odata",9)}})(jQuery);(function(a){a.Control.extend("pane_datasetPermissions",{getTitle:function(){return a.t("screens.ds.grid_sidebar.permissions.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.permissions.subtitle",{view_type:this._view.displayName})},isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)},getDisabledSubtitle:function(){return a.t("screens.ds.grid_sidebar.permissions.validation.valid_saved")},_getSections:function(){var b=this;return[{customContent:{template:"datasetPermissions",data:{},directive:{},callback:function(e){var g=_.detect(b._view.grants||[],function(h){return _.include(h.flags||[],"public")}),f=e.find(".datasetPublicText"),d=e.find(".togglePermissionsForm"),c=d.find(".toggleDatasetPermissions");f.text(b._view.isPublic()?a.t("core.visibility.public").capitalize():a.t("core.visibility.private").capitalize());if(b._view.hasRight(blist.rights.view.UPDATE_VIEW)&&(a.isBlank(g)||(g.inherited||false)==false)){c.change(function(j){var h=a(j.target);b._view[h.val()](function(){f.text(b._view.isPublic()?a.t("core.visibility.public").capitalize():a.t("core.visibility.private").capitalize());h.socrataAlert({message:a.t("screens.ds.grid_sidebar.permissions.success"),overlay:true})},function(k,m,l){b.$dom().find(".sharingFlash").addClass("error").text(a.t("screens.ds.grid_sidebar.permissions.error"))})});_.defer(function(){c.uniform()})}else{d.hide()}e.find(".datasetTypeName").text(this._view.displayName);e.find(".datasetTypeNameUpcase").text(this._view.displayName.capitalize())}}}]},shown:function(){this._super();this.$dom().find(".flash").removeClass("error").text("")},_getFinishButtons:function(){return[a.controlPane.buttons.update,a.controlPane.buttons.cancel]},_finish:function(d,c,b){var f=this;if(!f._super.apply(this,arguments)){return}var e=f._getFormValues();f._view.disabledFeatureFlags=_.reject(_.keys(e),function(g){return e[g]});f._view.save(function(){f._finishProcessing();f._showMessage(a.t("screens.ds.grid_sidebar.permissions.success"));f._hide();if(_.isFunction(b)){b()}},function(){f.find$(".sharingFlash").addClass("error").text(a.t("screens.ds.grid_sidebar.permissions.error"))})}},{name:"datasetPermissions",noReset:true,showFinishButtons:true},"controlPane");if(blist.sidebarHidden&&(a.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.permissions)){a.gridSidebar.registerConfig("manage.datasetPermissions","pane_datasetPermissions",7)}})(jQuery);(function(a){a.Control.extend("pane_plagiarism",{_init:function(){var b=this;b._super.apply(b,arguments)},render:function(){var b=this;b._super.apply(b,arguments);if(this._pickerHooked){return}var c=b.$dom().find(".friendSelect");c.userPicker({attachTo:a("#js-appended-templates"),chooseCallback:function(d){b._thief=d},filterCallback:function(d){return d.id!==b._view.owner.id},valueFunction:function(d){return d.email},limit:25});this._pickerHooked=true},getTitle:function(){return a.t("screens.ds.grid_sidebar.ownership.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.ownership.subtitle")},isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)},getDisabledSubtitle:function(){return a.t("screens.ds.grid_sidebar.ownership.validation.valid_saved")},_getSections:function(){var c={name:"user",type:"text",extraClass:"friendSelect"};var b={};if(this._view.owner.id!=blist.currentUserId){b={type:"group",options:[{type:"radioGroup",name:"datasetThief",defaultValue:"currentUser",options:[{name:"user",value:a.t("screens.ds.grid_sidebar.ownership.me"),type:"static",isInput:true},c]}]}}else{b=c}return[{title:a.t("screens.ds.grid_sidebar.ownership.transfer_to"),fields:[b]}]},_getFinishButtons:function(){return[a.controlPane.buttons.apply,a.controlPane.buttons.cancel]},_finish:function(c,l,h){var g=this;if(!g._super.apply(g,arguments)){return}g._finishProcessing();var n=g._getFormValues();var f=n.user;var j=g.$dom().find(".mainError");j.text("");if(!f){j.text(a.t("screens.ds.grid_sidebar.ownership.validation.no_user"));return}var e,b;if(f==a.t("screens.ds.grid_sidebar.ownership.me")){b=a.t("screens.ds.grid_sidebar.ownership.success.me");e=blist.currentUserId}else{if(f!=""&&a.subKeyDefined(g,"_thief.id")){b=a.t("screens.ds.grid_sidebar.ownership.success.user",{owner:g._thief.nameAndOrEmail()});e=g._thief.id}else{var d=f.match(/(\w{4}-\w{4})$/);if(d){e=d[1];b=a.t("screens.ds.grid_sidebar.ownership.success.other")}else{j.text(a.t("screens.ds.grid_sidebar.ownership.validation.invalid_user"));return}}}g._view.changeOwner(e,function m(){blist.util.railsFlash(b);if(_.isFunction(h)){h()}g._view.redirectTo()},function k(r,q,o){var p=(r.status==404)?a.t("screens.ds.grid_sidebar.ownership.validation.invalid_user"):a.t("screens.ds.grid_sidebar.ownership.error");j.text(p)})}},{name:"plagiarism",noReset:true},"controlPane");if(blist.sidebarHidden&&(a.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.plagiarize)){a.gridSidebar.registerConfig("manage.plagiarism","pane_plagiarism",10)}})(jQuery);(function(a){a.Control.extend("pane_printDataset",{getTitle:function(){return a.t("screens.ds.grid_sidebar.print.title")},getSubtitle:function(){return a.t("screens.ds.grid_sidebar.print.subtitle")},isAvailable:function(){return this._view.isGrid()&&this._view.valid},getDisabledSubtitle:function(){return !this._view.valid?a.t("screens.ds.grid_sidebar.base.validation.invalid_view"):a.t("screens.ds.grid_sidebar.print.validation.non_tabular")},_getSections:function(){var b=this;return[{customContent:{template:"printForm",directive:{},data:{},callback:function(c){blist.namespace.fetch("blist.common");c.closest("form").data("dataset",b._view).attr("target","_blank").submit(blist.common.formInliner).attr("method","post").attr("action","/views/INLINE/rows.pdf")}}}]},_getFinishButtons:function(){return[{text:a.t("screens.ds.grid_sidebar.print.print_button"),value:"print",isDefault:true},a.controlPane.buttons.cancel]},_finish:function(d,c,b){if(c==="print"){this.$dom().find(".printForm").closest("form").submit()}this._finishProcessing();this._hide();if(_.isFunction(b)){b()}}},{name:"printDataset",noReset:true},"controlPane");if(a.isBlank(blist.sidebarHidden.exportSection)||!blist.sidebarHidden.exportSection.print){a.gridSidebar.registerConfig("export.printDataset","pane_printDataset",5)}})(jQuery);(function(c){var e=function(f){return{userId:f.attr("data-uid"),groupUid:f.attr("data-gid"),userEmail:f.attr("data-email"),type:f.find(".type").val().toLowerCase()}};var a=function(f){f.$dom().find(".sharingFlash").addClass("error").text(c.t("screens.ds.grid_sidebar.share.error"))};var d=function(j,g,f){var h=[];_.each(f,function(k){if(!c.isBlank(k.userId)){c.socrataServer.makeRequest({url:"/users/"+k.userId+".json",cache:false,type:"GET",data:{},batch:true,success:function(l){h.push(c.extend({},l,{shareType:k.type,shareInherited:k.inherited,userId:k.userId,userEmail:k.userEmail}))}})}else{if(!c.isBlank(k.userEmail)){h.push({userEmail:k.userEmail,displayName:k.userEmail,shareType:k.type,shareInherited:k.inherited})}else{if(!c.isBlank(k.groupUid)){c.socrataServer.makeRequest({url:"/api/groups/"+k.groupUid+".json",cache:false,type:"GET",data:{},batch:true,success:function(l){h.push(c.extend({},l,{shareType:k.type,shareInherited:k.inherited,displayName:l.name,groupUid:k.groupUid}))}})}}}});ServerModel.sendBatch(function(k){var l=g.find("ul.itemsList");l.empty();_.each(h,function(n){var o=c.renderTemplate("sharesList",n,{".name":"displayName!",".name@title":"displayName!","li@data-uid":"userId","li@data-gid":"groupUid","li@data-currtype":"shareType","li@data-email":"userEmail","li@class+":function(p){return(p.context.shareInherited===true?"inherited":"")}}),m=c.capitalize(n.shareType);o.find("select.type").val(m).end().find("span.type").text(m);if(!c.isBlank(n.profileImageUrlSmall)){o.find(".profileImage").css("background-image","url("+n.profileImageUrlSmall+")")}else{if(!c.isBlank(n.groupUid)){o.find(".profileImage").css({"background-image":"url(/stylesheets/images/icons/profile_icons.png)","background-position-y":"73px","background-size":"27px"})}}l.append(o)});_.defer(function(){l.find("li > select").uniform()});g.find(".type").change(function(n){var o=c(n.target).closest(".line");var m=e(o);j.settings.view.replaceGrant(c.extend({},m,{type:o.attr("data-currtype")}),m,function(){j.$dom().find(".sharingFlash").removeClass("error").addClass("notice").text(c.t("screens.ds.grid_sidebar.share.success"));o.attr("data-currtype",m.type)},function(){a(j)})});g.find(".removeShareLink").click(function(m){m.preventDefault();var n=c(m.target).closest(".line");if(n.attr("disabled")){return}n.attr("disabled",true);j._view.removeGrant(e(n),function(){n.slideToggle();b(j,n.closest("form"))},function(){n.attr("disabled",false);a(j)})})})};var b=function(j,h){var g=h.find(".andSharedHint");var f=h.find(".friendsHint");j._view.userGrants(function(k){if(k.length==0){g.addClass("hide");h.find(".noShares").show().end().find(".shareNotifyLink").hide()}else{g.removeClass("hide")}})};c.Control.extend("pane_shareDataset",{_init:function(){var f=this;f._super.apply(f,arguments);f._view.bind("permissions_changed",function(){f.reset()},f)},getTitle:function(){return c.t("screens.ds.grid_sidebar.share.title")},getSubtitle:function(){return c.t("screens.ds.grid_sidebar.share.subtitle",{view_type:this._view.displayName})},isAvailable:function(){return this._view.valid&&(!this._view.temporary||this._view.minorChange)},getDisabledSubtitle:function(){return c.t("screens.ds.grid_sidebar.share.validation.valid_saved")},_getSections:function(){return[{customContent:{template:"sharingForm",data:{},directive:{},callback:function(f){var g=this;f.find(".shareDatasetButton").click(function(h){h.preventDefault();if(c.subKeyDefined(blist,"dialog.sharing")&&_.isFunction(blist.dialog.sharing)){blist.dialog.sharing(h,g)}});f.find(".shareNotifyLink").click(function(h){h.preventDefault();g._view.notifyUsers(function(j){f.find(".shareNoticeSent").fadeIn()})});f.find(".publicOrPrivate").text(g._view.isPublic()?"Public":"Private").end().find(".datasetTypeName").text(g._view.displayName).end().find(".datasetTypeNameUpcase").text(g._view.displayName.capitalize());g._view.userGrants(function(h){b(g,f);if(c.isBlank(h)||h.length==0){_.defer(function(){f.find(".loadingShares, .itemsList").hide();f.find(".noShares").fadeIn()});return}_.defer(function(){f.find(".shareNotifyArea").fadeIn()});d(g,f,h)})}}}]},shown:function(){this._super();this.$dom().find(".flash:not(.shareNoticeSent)").removeClass("error notice").text("").end().find(".shareNoticeSent").hide()},_getFinishButtons:function(){return[c.controlPane.buttons.done]}},{name:"shareDataset",noReset:true},"controlPane");if(blist.sidebarHidden&&(c.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.sharing)){c.gridSidebar.registerConfig("manage.shareDataset","pane_shareDataset",8)}})(jQuery);(function(b){var a=false;b.Control.extend("pane_showHideColumns",{_init:function(){var c=this;c._super.apply(c,arguments);c._view.bind("columns_changed",function(){if(a){return}c.reset()},c)},getTitle:function(){return b.t("screens.ds.grid_sidebar.showhide_columns.title")},getSubtitle:function(){return b.t("screens.ds.grid_sidebar.showhide_columns.subtitle")},isAvailable:function(){return this._view.valid},getDisabledSubtitle:function(){return b.t("screens.ds.grid_sidebar.base.validation.invalid_view")},_getSections:function(){var d=this;var e=function(f){if(!f.hidden){return"a"+("000"+f.position).slice(-3)}return"z"+f.name};var c=_.chain(d._view.realColumns).sortBy(e).map(function(f){if(!b.isBlank(f.realChildColumns)){return[f].concat(_.sortBy(f.realChildColumns,e))}else{return f}}).flatten().value();if(d._view.isGrouped()){c=_.reject(c,function(f){return !_.any(d._view.metadata.jsonQuery.select,function(g){return g.columnFieldName==f.fieldName})})}return[{title:b.t("screens.ds.grid_sidebar.showhide_columns.columns.title"),customContent:{template:"showHideBlock",data:c,directive:{"li.columnItem":{"column<-":{"input@disabled":function(g){var f=g.item.view.getFilteredFieldNames();return _.includes(f,g.item.fieldName)?"disabled":undefined},"input@checked":function(f){return f.item.hidden?"":"checked"},"input@data-columnId":"column.id","input@id":"showHide_#{column.id}","label .name":"column.name!","label@for":"showHide_#{column.id}","label@class+":"column.renderTypeName","@data-parentId":function(f){return(f.item.parentColumn||{}).id||""},"@class+":function(f){return !b.isBlank(f.item.parentColumn)?"childCol":""}}}},callback:function(f){f.find('input[type="checkbox"]').each(function(){if(this.getAttribute("disabled")==="undefined"){this.removeAttribute("disabled")}else{b(this).parent("li").socrataTip({trigger:"hover",message:b.t("screens.ds.grid_sidebar.showhide_columns.warnings.active_filter"),parent:"body",isSolo:true})}});f.find("li.columnItem[data-parentId]").each(function(){var j=b(this);var h=f.find("input[data-columnId="+j.attr("data-parentId")+"]");var g=function(){_.defer(function(){j.toggle(h.is(":checked"))})};h.change(g).click(g);g()})}}}]},_getFinishButtons:function(){return[{text:b.t("core.dialogs.apply"),isDefault:true,value:true},b.controlPane.buttons.cancel]},_finish:function(g,f,e){var j=this;if(!j._super.apply(j,arguments)){return}var h=[];var c={};j.$dom().find(".columnItem :input:checked:visible").each(function(){var m=b(this);var k=m.closest("li.columnItem");var l=m.attr("data-columnId");if(k.is(".childCol")){c[k.attr("data-parentId")].push(l)}else{h.push(l);if(k.find("label").is(".nested_table")){c[l]=[]}}});h=_.sortBy(h,function(k){return j._view.columnForID(k).position});var d=_.any(_.select(j._view.realColumns,function(k){return k.hidden}),function(k){return _.include(h,k.id+"")});_.each(c,function(l,m){var k=j._view.columnForID(m);l=_.sortBy(l,function(n){return k.childColumnForID(n).position});k.setVisibleChildColumns(l)});a=true;j._view.setVisibleColumns(h,function(){j._finishProcessing();if(d){j._view.invalidateRows()}j._hide();a=false;if(_.isFunction(e)){e()}})}},{name:"showHide"},"controlPane");if(b.isBlank(blist.sidebarHidden.manage)||!blist.sidebarHidden.manage.showHide){b.gridSidebar.registerConfig("manage.showHide","pane_showHideColumns",5)}})(jQuery);(function(e){var a=_.compact(_.map(blist.datatypes,function(g,h){return g.sortable?h:null}));var f=_.compact(_.map(blist.datatypes,function(g,h){return !e.isBlank(g.rollUpAggregates)?h:null}));var c=function(g){if(e.isBlank(g)){return null}return this._view.columnForIdentifier(g).dataType.rollUpAggregates};var b=function(g){if(e.isBlank(g)){return"hidden"}return this._view.columnForIdentifier(g).dataType.groupFunctions||"hidden"};e.Control.extend("pane_sortRollUp",{getTitle:function(){return e.t("screens.ds.grid_sidebar.sort_rollup.title")},getSubtitle:function(){return e.t("screens.ds.grid_sidebar.sort_rollup.subtitle")},isAvailable:function(){return d(this)?this._view.realColumns.length>0:this._view.visibleColumns.length>0&&this._view.valid},getDisabledSubtitle:function(){return !this._view.valid&&!d(this)?e.t("screens.ds.grid_sidebar.base.validation.invalid_view"):e.t("screens.ds.grid_sidebar.sort_rollup.validation.no_eligible_columns")},_getCurrentData:function(){return this._super()||this._view.cleanCopy()},_filteredGroupableTypesForSoda2:function(g){return _.select(f,function(h){return g.newBackend?h!="date":true})},_getSections:function(){var g=[];if(!this._view.isUnpublished()){g.push({name:"filterGroup",type:"selectable",title:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.title"),fields:[{type:"repeater",name:"metadata.jsonQuery.group",minimum:0,addText:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.add_group_button"),field:{type:"group",options:[{type:"columnSelect",name:"columnFieldName",notequalto:"groupColumn",useFieldName:true,text:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.group_by"),columns:{type:this._filteredGroupableTypesForSoda2(this._view),noDefault:true,hidden:d(this)||this._view.isGrouped()}},{type:"select",name:"groupFunction",text:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.group_function_label"),prompt:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.group_function_prompt"),options:b,linkedField:"columnFieldName"}]}},{type:"repeater",minimum:0,name:"metadata.jsonQuery.select",addText:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.add_rollup_button"),field:{type:"group",options:[{type:"columnSelect",name:"columnFieldName",required:true,useFieldName:true,text:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.roll_up"),notequalto:"rollUpColumn",columns:{type:this._filteredGroupableTypesForSoda2(this._view),noDefault:true,hidden:d(this)||this._view.isGrouped()}},{type:"select",required:true,name:"aggregate",text:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.function"),prompt:e.t("screens.ds.grid_sidebar.sort_rollup.rollup.roll_up_function"),linkedField:"columnFieldName",options:c}]}}]})}g.push({name:"filterSort",type:"selectable",title:e.t("screens.ds.grid_sidebar.sort_rollup.sort.title"),fields:[{type:"repeater",name:"metadata.jsonQuery.order",minimum:0,addText:e.t("screens.ds.grid_sidebar.sort_rollup.sort.add_column_button"),field:{type:"group",options:[{type:"columnSelect",name:"columnFieldName",required:true,notequalto:"sortColumn",useFieldName:true,text:e.t("screens.ds.grid_sidebar.sort_rollup.sort.column"),columns:{type:a}},{type:"select",name:"ascending",prompt:null,text:e.t("screens.ds.grid_sidebar.sort_rollup.sort.direction"),options:[{text:e.t("screens.ds.grid_sidebar.sort_rollup.sort.directions.ascending"),value:"true"},{text:e.t("screens.ds.grid_sidebar.sort_rollup.sort.directions.descending"),value:"false"}]}]}}]});return g},shown:function(){var g=this;g._super();if(!g._registeredChange){g._view.bind("query_change",function(){g.reset()},g);g._registeredChange=true}},_getFinishButtons:function(){return[e.controlPane.buttons.apply,e.controlPane.buttons.cancel]},_finish:function(h,p,m){var l=this;if(!l._super.apply(l,arguments)){return}var g=l._getFormValues();var o=e.extend(true,{},l._view.metadata);var n=o.jsonQuery;_.each(["order","group","select"],function(r){n[r]=((g.metadata||{}).jsonQuery||{})[r]});g.metadata=o;_.each(g.metadata.jsonQuery.order||[],function(r){r.ascending=(r.ascending=="true"||r.ascending===true)});if(!_.isEmpty(g.metadata.jsonQuery.group)){g.metadata.jsonQuery.group=_.select(g.metadata.jsonQuery.group,function(r){return !e.isBlank(r.columnFieldName)})}if(_.any(g.metadata.jsonQuery.select,function(r){return !e.isBlank(r.aggregate)})&&_.isEmpty(g.metadata.jsonQuery.group)){l.$dom().find(".mainError").text(e.t("screens.ds.grid_sidebar.sort_rollup.validation.no_group_bys"));l._finishProcessing();return}if(!_.isEmpty(g.metadata.jsonQuery.group)&&_.any(g.metadata.jsonQuery.select,function(r){return e.isBlank(r.aggregate)&&!_.any(g.metadata.jsonQuery.group,function(s){return s.columnFieldName==r.columnFieldName})})){l.$dom().find(".mainError").text(e.t("screens.ds.grid_sidebar.sort_rollup.validation.no_function"));l._finishProcessing();return}var j=false;_.each(g.metadata.jsonQuery.group,function(v){var t=l._view.columnForIdentifier(v.columnFieldName);var u=Column.closestViewFormat(t,blist.datatypes.groupFunctionFromSoda2(v.groupFunction));if(!e.isBlank(u)){var s=e.extend({},t.format);s.view=u;t.update({format:s});j=true}});_.each(l._view.realColumns,function(u){if((!e.isBlank(u.format.group_function)||!e.isBlank(u.format.grouping_aggregate))&&!_.any(g.metadata.jsonQuery.select,function(r){return !e.isBlank(r.aggregate)&&r.columnFieldName==u.fieldName})&&!_.any(g.metadata.jsonQuery.group,function(r){return r.columnFieldName==u.fieldName})){var s=e.extend({},u.format);var t=Column.closestViewFormat(u,null);if(!e.isBlank(t)){s.view=t}delete s.grouping_aggregate;delete s.group_function;u.update({format:s});j=true}});var k=!l._view.valid;l._view.update(g,false,_.isEmpty(g.metadata.jsonQuery.group));if(j){l._view.trigger("columns_changed")}var q=function(){l._finishProcessing();_.defer(function(){l.reset()});if(_.isFunction(m)){m()}};if(k&&l._view.type!="blist"){if(!l._view.save(q)){q()}}else{q()}}},{name:"sortRollUp"},"controlPane");var d=function(g){return g._view.isGrouped()&&g._view.hasRight(blist.rights.view.UPDATE_VIEW)};if(e.isBlank(blist.sidebarHidden.filter)||!blist.sidebarHidden.filter.filterDataset){e.gridSidebar.registerConfig("filter.sortRollUp","pane_sortRollUp",3,"grouped")}})(jQuery);(function(h){var l={noFilter:true};h(function(){var t=h.getTemplate("filterCondition");t.find(".autogeneratedCount").append(h.tag(_.map(_.range(20),function(u){return{tagName:"option",value:u+1,contents:u+1}})));h("#js-appended-templates").append(t)});var d=function(t){if(!m(t)){return{}}else{return t}};var m=function(u){delete u.metadata;if(!_.isArray(u.children)||(u.children.length===0)){return false}if((u.type=="operator")&&_.include(["AND","OR"],u.value)){var t=[];_.each(u.children,function(v){if(!m(v)){u.children=_.without(u.children,v)}})}return u.children.length>0};var e=function(t){if(h.isBlank(t.value)){return t}if(t.value.toUpperCase()!="AND"&&t.value.toUpperCase()!="OR"){return null}t.children=_.compact(_.map(t.children,function(u){return e(u)}));return t};var g=function(t){if(_.isEmpty(t)){return null}if(t.type=="operator"&&(t.value=="OR"||t.value=="AND")){t.children=_.compact(_.map(t.children,g));if(_.isEmpty(t.children)){return null}return t}else{if(!_.any(t.children,function(u){return u.type=="column"})){return null}}return t};var c=function(z,u,x){var y=z.children[x||0];if(h.isBlank(y)){return false}var w={column:"column",subcolumn:"column",value:"literal"};var v={subcolumn:"value",value:"value"};var t=[];_.each(y.children,function(A){if(A.type==w[u]){if(u=="column"){t.push(A.columnFieldName||A.columnId)}else{t.push(A[v[u]])}}});if(t.length===1){return t[0]}else{return t}};var r=function(v){var t=v.data("unifiedFilter-editor");var u;if(h.isBlank(t)){u=v.data("unifiedFilter-editorValue")}else{if(!t.isValid()){return null}u=t.currentValue()}if(!h.isBlank(u)&&!_.isNumber(u)&&!_.isString(u)&&!_.isBoolean(u)&&_.all(_.values(u),function(w){return h.isBlank(w)})){return null}return u};var s=function(t){return h.subKeyDefined(t,"filterConditions.details.BETWEEN")?"between?":h.subKeyDefined(t,"filterConditions.details.EQUALS")?"EQUALS":"blank?"};var q=function(v,w,t){if(t=="blank?"){return"is"}var u=v.renderType;if(h.subKeyDefined(u,"subColumns."+w)){u=u.subColumns[w]}if(!h.subKeyDefined(u,"filterConditions")){return""}return(u.filterConditions.details[t]||{}).text||""};var p=function(u,t){return _.compact(_.map(u.orderedList,function(v){return(v=="IS_BLANK"||v=="IS_NOT_BLANK")||(t&&(v=="CONTAINS"||v=="NOT_CONTAINS"))?null:{value:v,text:u.details[v].text}})).concat({value:"blank?",text:h.t("core.filters.informal.is_blank")})};var o=function(t){if(t.type=="operator"&&t.value!="OR"&&t.value!="AND"){t.children=[h.extend(true,{},t)];t.value="OR"}};var a=function(w,v,t){if(!h.isBlank(t.subcolumn)&&(t.operator!="blank?")&&h.isPlainObject(w)){w=w[t.subcolumn]}var u=v.renderType;if(h.subKeyDefined(u,"subColumns."+t.subcolumn)){u=u.subColumns[t.subcolumn]}if(_.isFunction(u.filterValue)){w=u.filterValue(w)}return w};var j=function(t){return(t.metadata.operator=="blank?")||(((!_.isArray(t.children))||(t.children.length===0))&&(!_.isArray(t.metadata.customValues)||(t.metadata.customValues.length===0)))};var n=function(v,w){var u=v.renderType;if(h.subKeyDefined(u,"subColumns."+w)){u=u.subColumns[w]}var t=s(u);if(t=="between?"){if(h.subKeyDefined(v,"cachedContents.top")&&((v.cachedContents.top.length<20)||(_.select(v.cachedContents.top,function(x){return x.count>1}).length>5))){t="EQUALS"}else{t="BETWEEN"}}return t};var f=function(v){var u=0;var t=(v<0);v=Math.abs(v);if((v<1)&&(v>0)){while(v<1){v*=10;u--}}else{while(v>=10){v/=10;u++}}return{leading:Math.floor(v),exp:u,isNegative:t}};var k=function(x,w,y){var t=new Date(x.getTime());var u=(y=="down");switch(w){case"year":t.setMonth(u?0:11);case"month":if(u){t.setDate(1)}else{var v=t.getMonth();t.setDate(31);if(t.getMonth()!==v){t.setDate(31-t.getDate());t.setMonth(v)}}case"day":default:t.setHours(u?0:23);t.setMinutes(u?0:59);t.setSeconds(u?0:59);t.setMilliseconds(u?0:999)}return t};var b=function(v,t){var u=v.renderType;if(!h.isBlank(t)){if(h.subKeyDefined(v.renderType,"subColumns."+t)){u=v.renderType.subColumns[t]}else{u=null}}return u};h.fn.unifiedFilter=function(x){var S=this;var E=false;var P=false;var C=_.map(x.datasets,function(U){return{dataset:U,ufID:U.id+"_"+_.uniqueId()}});var F=C[0].dataset;var Q=x.filterableColumns;var T=h.extend(true,{},x.rootCondition);var I;var G="unifiedFilter"+_.uniqueId();var u=false;var M=function(V){var U=true;if(V.type!="operator"||!_.include(["AND","OR"],V.value)){V.children=[h.extend({},V)];V.type="operator";V.value="OR"}V.children=V.children||[];_.each(V.children,function(aa,Y){if((aa.type=="operator")&&_.include(["AND","OR"],aa.value)){if(_.any(aa.children||[],function(ab){return _.include(["AND","OR"],ab.value)})){var W=true;_.each(aa.children||[],function(ad,ab){var ac=w(ad);if(h.isPlainObject(ac)){aa.children[ab]=ac}else{return W=(W&&ac)}});return U=(U&&W)}var Z,X;_.each(aa.children||[],function(ab){if((ab.type!==(Z||ab.type))||(ab.columnFieldName!==(X||ab.columnFieldName))){return U=false}Z=ab.type;X=ab.columnFieldName})}else{V.children[Y]={type:"operator",value:"OR",children:[aa]}}});if(_.isUndefined(V.metadata)){V.metadata={advanced:true,unifiedVersion:1}}_.each(V.children,function(Z){if(_.isUndefined(Z.metadata)){var X=F.columnForIdentifier(c(Z,"column"));var W=Z.children[0].value;if(_.include(["IS_BLANK","IS_NOT_BLANK"],W)){W="blank?"}Z.metadata={tableColumnId:X.tableColumnId,operator:W};var Y=(c(Z,"subcolumn")||"").toLowerCase();if(Y&&_.include(_.keys(X.renderType.subColumns||{}),Y)){Z.metadata.subcolumn=Y}}});K(V);return U};var w=function(U){if((U.value=="AND")&&(U.children.length==2)){if(((U.children[0].value=="GREATER_THAN_OR_EQUALS")&&(U.children[1].value=="LESS_THAN_OR_EQUALS"))||((U.children[0].value=="LESS_THAN_OR_EQUALS")&&(U.children[1].value=="GREATER_THAN_OR_EQUALS"))){return{type:"operator",value:"BETWEEN",children:[{columnFieldName:c(U,"column"),type:"column"},{value:c(U,"value",0),type:"literal"},{value:c(U,"value",1),type:"literal"}]}}else{return false}}else{return false}return true};var K=function(U){_.each(U.children,function(W){var V={};V[F.publicationGroup]=W.metadata.tableColumnId;W.metadata.tableColumnId=V});U.metadata.unifiedVersion=2;return true};var v=function(U,V){if(!_.isEmpty(U)){if(_.isEmpty(U.metadata)){var W=_.detect(U.children,function(X){return _.isNumber((X.metadata||{}).unifiedVersion)});if(!h.isBlank(W)){U=W}}if(((_.isUndefined(U.metadata)||_.isNaN(U.metadata.unifiedVersion))&&!M(U))||((U.metadata.unifiedVersion<2)&&!K(U))){throw"Error: We're not currently capable of dealing with this filter."}}else{if(h.subKeyDefined(V,"metadata.filterCondition")){U=h.extend(true,{},V.metadata.filterCondition);if(U.metadata.unifiedVersion<2){K(U)}}else{U={type:"operator",value:"AND",children:[],metadata:{advanced:true,unifiedVersion:2}}}}U.children=U.children||[];if(U.children.length==0){U.metadata.advanced=true}return U};this.bind("columns_changed",function(V,U){Q=U.columns;if(h.isBlank(S)){return}S.find(".filterConditions .filterLink.columnName").each(function(){var W=h(this);if(!_.include(Q,W.popupSelect_selectedItems()[0])){A(W.closest(".filterCondition"),true)}else{W.popupSelect_update(Q)}})});this.bind("revert",function(){E=false;if(h.isBlank(S)){return}S.find(".noFilterConditionsText").show();T=h.extend(true,{},x.rootCondition);I=null;Q=x.filterableColumns;J()});this.bind("destroy",function(){_.each(C,function(V){var U=h.extend(true,{},V.dataset.query);if(u){U.filterCondition=null}else{if(!h.isBlank(U.namedFilters)){delete U.namedFilters[G]}}V.dataset.update({query:U})});T=h.extend(true,{},x.rootCondition);I=null;Q=x.filterableColumns});var J=function(){S.find(".baseFilterConditions").find(".filterCondition").remove();S.find(".filterConditions").empty();if(_.isEmpty(T)&&h.subKeyDefined(F,"query.filterCondition")){T=h.extend(true,{},F.query.filterCondition);u=true}if(h.subKeyDefined(F,"_queryBase.query.filterCondition")){I=g(h.extend(true,{},F._queryBase.query.filterCondition));I=v(I,F._queryBase);T=blist.filter.generateSODA1(blist.filter.subtractQueries(Dataset.translateFilterColumnsToBase(Dataset.translateFilterCondition(T,F,false),F).where,Dataset.translateFilterCondition(I,F._queryBase,false).where,F._queryBase)||{})}T=v(T,F);S.toggleClass("advanced",!!T.metadata.advanced);S.toggleClass("notAdvanced",!T.metadata.advanced);S.find(".advancedStateLine").removeClass("hide").filter(!!T.metadata.advanced?".editModeAdvancedOffLine":".editModeAdvancedOnLine").addClass("hide");S.find(".mainFilterOptionsMenu .matchAnyOrAll").removeClass("checked").filter(":has(>a[data-actionTarget="+T.value+"])").addClass("checked");if(T.metadata.hideBase||_.isEmpty(I)||_.isEmpty(I.children)){S.find(".baseFilterConditions").addClass("hide")}else{S.find(".baseFilterConditions").removeClass("hide");_.each(I.children,H);S.find(".baseFilterConditions .filterCondition:gt(0)").each(function(){h(this).before(h.tag2({_:"span",className:"conditionJoin",contents:h.t("core."+I.value.toLowerCase())}))})}if(T.type=="operator"&&T.value!="AND"&&T.value!="OR"){T={type:"operator",value:"AND",metadata:{advanced:T.metadata.advanced,unifiedVersion:T.metadata.unifiedVersion},children:[T]}}_.each(T.children,t);if(T.children.length==0){_.defer(function(){S.find(".initialFilterMode").show();S.find(".normalFilterMode").hide()})}else{_.defer(function(){S.find(".initialFilterMode").hide();S.find(".normalFilterMode").show()})}};var H=function(aa){var V=aa.metadata||{};if(_.isEmpty(V)){return}var W=F._queryBase.columnForTCID(V.tableColumnId[F._queryBase.publicationGroup]);if(_.isUndefined(W)){return}o(aa);var X=h.renderTemplate("filterConditionStatic",{metadata:V,column:W},{".columnName":"column.name!",".columnInfo@title":"column.description!",".subcolumnName":function(){return(((W.renderType.subColumns||{})[V.subcolumn]||{}).title||"").toLowerCase()},".subcolumnName@class+":function(){return(!h.isBlank(W.renderType.subColumns)&&_.size(W.renderType.subColumns)>0)?"":"hide"},".operator":function(){return q(W,V.subcolumn,V.operator)}});var Z="filter_"+_.uniqueId();var U=X.find(".columnInfo");U.toggleClass("hide",h.isBlank(U.attr("title"))||!V.showInfo);U.socrataTip({message:(U.attr("title")||"").clean(),killTitle:true});if(V.operator=="blank?"){if(_.any(aa.children||[],function(ab){return ab.value=="IS_BLANK"})){O({item:W.renderType.filterConditions.details.IS_BLANK.text.replace(/^is\s/,""),data:"IS_BLANK"},W,aa,X,Z,{textOnly:true,selected:true})}else{if(_.any(aa.children||[],function(ab){return ab.value=="IS_NOT_BLANK"})){O({item:W.renderType.filterConditions.details.IS_NOT_BLANK.text.replace(/^is\s/,""),data:"IS_NOT_BLANK"},W,aa,X,Z,{textOnly:true,selected:true})}}}else{_.each(aa.children||[],function(ae,ab){var ad=c(aa,"value",ab);var ac=ae.metadata||{};O({item:ad},W,aa,X,Z,{selected:true})})}var Y=X.find(".line");if(Y.length>1){if(Y.length>2){Y.slice(0,Y.length-1).find(".lineValue").append(",")}Y.eq(Y.length-2).find(".lineValue").append(" "+h.t("core."+aa.value.toLowerCase()))}X.find("input").attr("disabled",true);S.find(".baseFilterConditions").append(X);X.slideDown()};var t=function(X){var Y;var ad=X.metadata||{};if(_.isEmpty(ad)){return}if(!_.isEmpty(ad.tableColumnId)&&!_.isNull(F.publicationGroup)){Y=F.columnForTCID(ad.tableColumnId[F.publicationGroup])}if(_.isUndefined(Y)){return}o(X);if(!_.isEmpty(Y.subColumnTypes)&&h.isBlank(ad.subcolumn)){ad.subcolumn=Y.subColumnTypes[0]}var ac=h.renderTemplate("filterCondition",{metadata:ad,column:Y},{".filterCondition@class+":function(){return(ad.expanded===false)?"collapsed":"expanded"},".columnName":"column.name!",".columnInfo@title":"column.description!",".subcolumnName":function(){return(((Y.renderType.subColumns||{})[ad.subcolumn]||{}).title||"").toLowerCase()},".subcolumnName@class+":function(){return(!h.isBlank(Y.renderType.subColumns)&&_.size(Y.renderType.subColumns)>0)?"":"hide"},".operator":function(){return q(Y,ad.subcolumn,ad.operator)}});var ab="filter_"+_.uniqueId();ac.find(".autogeneratedCount").val(ad.includeAuto||5);if(_.include(["BETWEEN","GREATER_THAN","GREATER_THAN_OR_EQUALS","LESS_THAN","LESS_THAN_OR_EQUALS"],ad.operator)){ac.find(".autogeneratedProperties").html(h.tag({tagName:"p",contents:h.t("controls.filter.edit_default.auto_suggested")}))}ac.find(".filterRemoveButton").click(function(ag){ag.preventDefault();A(ac);B()});ac.find(".filterExpander").click(function(ag){ag.preventDefault();if(ac.hasClass("expanded")){ac.find(".filterValues").stop().slideUp();ac.removeClass("expanded").addClass("collapsed")}else{ac.find(".filterValues").stop().slideDown();ac.removeClass("collapsed").addClass("expanded")}});ac.find(".filterLink").click(function(ag){ag.preventDefault()});ac.find(".autogeneratedCount").change(function(ag){ad.includeAuto=parseInt(h(this).val());ac.find(".autogenerated .line").remove();D(X,Y,ac,ab,[])});var V=ac.find(".columnInfo");V.toggleClass("hide",h.isBlank(V.attr("title"))||!ad.showInfo);V.socrataTip({message:(V.attr("title")||"").clean(),killTitle:true});ac.find(".columnName").popupSelect({choices:Q,listContainerClass:"popupColumnSelect",onShowCallback:function(){return S.hasClass("advanced")},prompt:h.t("controls.filter.actions.select_column"),renderer:function(ag){return[{tagName:"span","class":["iconWrapper",ag.renderTypeName],contents:{tagName:"span","class":"blist-th-icon"}},{tagName:"span","class":"columnName",contents:h.htmlStrip(ag.name)}]},selectCallback:function(ag){if(ag==Y){return true}if(!h.isBlank(ag.renderType.subColumns)){ad.subcolumn=ag.renderType.defaultFilterSubColumn}else{delete ad.subcolumn}if(!h.subKeyDefined(b(ag,ad.subcolumn),"filterConditions.details."+ad.operator)){if(!j(X)&&!confirm(h.t("controls.filter.actions.confirm_modify"))){return false}X.children=[];ad.operator=n(ag,ad.subcolumn);ad.customValues=[]}ad.tableColumnId[F.publicationGroup]=ag.tableColumnId;y(ac,X);return true},selectedItems:Y});var W=b(Y,ad.subcolumn);var af=p(W.filterConditions||{},F.newBackend);ac.find(".operator").popupSelect({choices:af,listContainerClass:"popupOperatorSelect",onShowCallback:function(){return S.hasClass("advanced")},prompt:h.t("controls.filter.actions.select_operation"),renderer:function(ag){return ag.text},selectCallback:function(ag){if(ag==ad.operator){return true}if((ag.value=="BETWEEN")||(ag.value=="blank?")||(ad.operator=="BETWEEN")||(ad.operator=="blank?")){if(!j(X)&&!confirm(h.t("controls.filter.actions.confirm_modify"))){return false}X.children=[];ad.customValues=[];ad.operator=ag.value;y(ac,X);return true}else{ad.operator=ag.value;ac.find(".operator").text(q(Y,ad.subcolumn,ag.value));y(ac,X);return true}},selectedItems:_.detect(af,function(ag){return ag.value==ad.operator})});if(!h.isBlank(Y.renderType.subColumns)){ac.find(".subcolumnName").popupSelect({choices:_.keys(Y.renderType.subColumns),listContainerClass:"popupSubcolumnSelect",onShowCallback:function(){return S.hasClass("advanced")},prompt:h.t("controls.filter.actions.select_subcolumn",{name:Y.name}),renderer:function(ag){return((Y.renderType.subColumns[ag]||{}).title||"").toLowerCase()},selectCallback:function(ag){if(ag==ad.subcolumn){return true}if(!h.subKeyDefined(b(Y,ag),"filterConditions.details."+ad.operator)){if(!j(X)&&!confirm(h.t("controls.filter.actions.confirm_modify"))){return false}X.children=[];ad.operator=n(Y,ag);ad.customValues=[]}ad.subcolumn=ag;y(ac,X);return true},selectedItems:ad.subcolumn});ac.addClass(ad.subcolumn)}ac.find(".filterOptionsMenu").menu({additionalDataKeys:["actionTarget"],contents:[{text:h.t("controls.filter.menu.show_suggested"),href:"#toggleSuggestedValues",className:"toggleAutogenerated"+(_.isUndefined(ad.includeAuto)?"":" checked"),onlyIf:!F.newBackend},{divider:true},{text:h.t("controls.filter.menu.select_one"),href:"#selectOne",actionTarget:"one",className:"selectOneOrMany"+(ad.multiSelect===false?" checked":"")},{text:h.t("controls.filter.menu.select_many"),href:"#selectMany",actionTarget:"many",className:"selectOneOrMany"+(ad.multiSelect!==false?" checked":"")},{divider:true},{text:h.t("controls.filter.menu.match_any"),href:"#matchAny",actionTarget:"OR",className:"matchAnyOrAll"+(X.value=="OR"?" checked":"")},{text:h.t("controls.filter.menu.match_all"),href:"#matchAll",actionTarget:"AND",className:"matchAnyOrAll"+(X.value=="AND"?" checked":"")}],menuButtonClass:"filterOptionsMenuButton options",menuButtonContents:"",onOpen:function(){ac.addClass("menuOpen")},onClose:function(){ac.removeClass("menuOpen")}}).find(".menuEntry a").click(function(ah){ah.preventDefault();var ai=h(this);var ag=ai.closest(".menuEntry");if(ag.hasClass("toggleAutogenerated")){if(!_.isUndefined(ad.includeAuto)){ag.removeClass("checked");ac.find(".autogenerated .line").each(function(){var aj=h(this);if(!aj.find(".filterLineToggle").is(":checked")){aj.remove()}});delete ad.includeAuto;B()}else{ag.addClass("checked");ad.includeAuto=5;D(X,Y,ac,ab,[],function(ak){if(ak.length===0){var aj=h.tag({tagName:"div","class":"noAutoValuesMessage",contents:h.t("controls.filter.main.no_suggestions")});aj.appendTo(ac);aj.slideDown(function(){setTimeout(function(){aj.slideUp(function(){aj.remove()})},2000)})}})}}else{if(ag.hasClass("selectOneOrMany")){ad.multiSelect=(ai.attr("data-actionTarget")==="many");y(ac,X)}else{if(ag.hasClass("matchAnyOrAll")){X.value=ai.attr("data-actionTarget");ag.siblings(".matchAnyOrAll").removeClass("checked");ag.addClass("checked");B()}}}});if(ad.multiSelect===false&&!ad.forceValue){O(l,Y,X,ac,ab,{selected:!_.isArray(X.children)||(X.children.length===0)})}if(ad.operator=="blank?"){var aa=Y.cachedContents||{};O({item:W.filterConditions.details.IS_BLANK.text.replace(/^is\s/,""),data:"IS_BLANK",count:aa["null"]},Y,X,ac,ab,{textOnly:true,selected:_.any(X.children||[],function(ag){return ag.value=="IS_BLANK"})});O({item:W.filterConditions.details.IS_NOT_BLANK.text.replace(/^is\s/,""),data:"IS_NOT_BLANK",count:aa.non_null},Y,X,ac,ab,{textOnly:true,selected:_.any(X.children||[],function(ag){return ag.value=="IS_NOT_BLANK"})})}else{var ae=[];_.each(X.children||[],function(aj,ag){var ai=c(X,"value",ag);ae.push(ai);var ah=aj.metadata||{};O({item:ai},Y,X,ac,ab,{selected:((ad.multiSelect!==false)||(ag===0)),freeform:!!ah.freeform})});var U=_.after(!_.isUndefined(ad.includeAuto)?2:1,function(){if(ad.forceValue&&_.isEmpty(X.children)){_.defer(function(){h.uniform.update(ac.find(".filterLineToggle:first").value(true));B()})}if(ad.multiSelect!==false&&_.isEmpty(X.children)&&(ad.selectAll||ad.selectTop)){var ao=ac.find(".filterLineToggle");var al=ad.selectTop||ao.length;_.defer(function(){h.uniform.update(ac.find(".filterLineToggle").slice(0,al).value(true));B()})}if(_.isNumber(ad.visibleItems)){var am=ac.find(".filterValues .line");am.slice(ad.visibleItems).addClass("hide");var aj=ac.find(".showMoreLess");var ah=false;if(ac.find(".filterValues .line.hide").length>0){aj.removeClass("hide");ah=true}if(ad.usePopup){var ap=h.tag({tagName:"div","class":"filterPopupContents"});var ai;var an=[];_.each(_.sortBy(am.clone().removeClass("hide"),function(aq){return h(aq).text()}),function(at){var ar=h(at);var aq=ar.text()[0].toUpperCase();if(aq!=ai){ai=aq;an.push(ai);ap.append(h.tag({tagName:"span","class":["sectionHeader","dontend","section-"+ai,"section-All"],contents:ai}))}ar.addClass("dontsplit section-All section-"+ai);ap.append(ar)});ap.find(".filterLineToggle").quickEach(function(){var aq=h(this);aq.attr("data-relatedid",aq.attr("id"));aq.attr("id",aq.attr("id")+"_popup");aq.closest(".line").find("label").attr("for",aq.attr("id"))});var ak=function(aq){h("body").append(aq);var at=aq.children(".line").outerWidth(true);aq.width(at);var ar=Math.min(aq.height(),h(window).height()*0.6);aq.css({height:"auto","max-height":"none"});var au=Math.min(Math.ceil(aq.height()/ar),Math.floor((h(window).width()*0.6)/at));aq.width(au*at);aq.columnize({columns:au,lastNeverTallest:true});aq.height(Math.min(ar,aq.height())+10);aq.detach();return aq};var ag=h.tag({tagName:"div","class":["filterPopupBlock",ab],contents:{tagName:"div","class":"filterMenu",contents:[{tagName:"a",href:"#All","class":"active",contents:"All"}].concat(_.map(an,function(aq){return{tagName:"a",href:"#"+aq,contents:aq}}))}});ag.append(ak(ap.clone()));h(document).off(".filterPopup_"+ab);h(document).on("click.filterPopup_"+ab,".filterPopupBlock."+ab+" .filterMenu a",function(au){au.preventDefault();var aq=h(this).addClass("active");aq.siblings().removeClass("active");var at=aq.closest(".filterPopupBlock");at.find(".filterPopupContents").remove();var ar=ap.clone();ar.children().addClass("hide").filter(".section-"+h.hashHref(aq.attr("href"))).removeClass("hide");at.append(ak(ar));aj.socrataTip().refreshSize()});aj.data("popup",ag.add(ap));aj.click(function(aq){aq.preventDefault()}).socrataTip({content:ag,fill:"#444444",isSolo:true,stroke:"#444444",trigger:"click",positions:"auto",shrinkToFit:true,shownCallback:function(ar){var aq=h(ar);aj.data("popup",aq.add(ap));aq.find(".filterLineToggle").on("change click",function(at){var au=h(this);h.uniform.update(am.find("#"+au.attr("data-relatedid")).attr("checked",au.attr("checked")=="checked").trigger("change"))}).quickEach(function(){var au=h(this);var at=au.closest(".line");at.prepend(au);at.children(".uniform").remove();au.uniform()})}})}else{if(ah){aj.click(function(at){at.preventDefault();ah=!ah;aj.toggleClass("rightArrow",ah).toggleClass("upArrow",!ah).find("span.moreLess").text(ah?"More":"Less");var ar=ac.find(".autogenerated");var av=ar.height();var au=ac.find(".filterValues .line").slice(ad.visibleItems);au.toggleClass("hide",ah);var aq=ar.height();if(ah){au.removeClass("hide")}ar.height(av).animate({height:aq},function(){if(ah){au.addClass("hide")}ar.height("")})})}}}});if(!_.isUndefined(ad.includeAuto)){D(X,Y,ac,ab,ae,function(ag){ae=ae.concat(ag);U(ag)})}if(_.isArray(ad.customValues)){_.each(ad.customValues,function(ag){if(!_.contains(ae,ag)){O({item:ag},Y,X,ac,ab)}})}if(!ad.restrictedValues){O("",Y,X,ac,ab,{freeform:true})}U()}if(ad.multiSelect!==false){var Z=ac.find(".clearValues");Z.click(function(ag){ag.preventDefault();h.uniform.update(ac.find(".filterLineToggle").value(false));B()})}ac.data("unifiedFilter-condition",X);S.find(".filterConditions").children(".noFilterConditionsText").hide().end().append(ac);ac.slideDown();return ac};var A=function(V,U){L(V,function(){T.children=_.without(T.children,V.data("unifiedFilter-condition"));if(V.parent().length>0){if(V.siblings().length===1){S.find(".noFilterConditionsText").show()}V.remove()}if(U!==true){B()}})};var y=function(U,V){L(U,function(){U.replaceWith(t(V));B()})};var L=function(U,V){_.defer(function(){U.find(".filterLink").each(function(){var W=h(this).data("popupSelect-tip");if(!_.isUndefined(W)){W.destroy()}});_.defer(V)})};var O=function(aa,W,V,ab,Y,af){var ac=V.metadata||{};if(_.isUndefined(af)){af={}}var ae=h.tag({tagName:"div","class":"line clearfix"});var ad="unifiedFilterInput_"+_.uniqueId();ae.append(h.tag({tagName:"input",type:(ac.multiSelect===false)?"radio":"checkbox",id:ad,name:Y,"class":"filterLineToggle"}));if(af.selected===true){ae.find(".filterLineToggle").attr("checked",true)}ae.find(":radio, :checkbox").uniform();if(af.autogenerated!==true){ae.append(h.tag({tagName:"a","class":"removeFilterLine remove",href:"#remove",contents:{tagName:"span","class":"icon",contents:"remove"}}))}if(af.freeform){var U=W.renderType;if(h.subKeyDefined(W.renderType,"subColumns."+ac.subcolumn)){U=W.renderType.subColumns[ac.subcolumn]}if(h.isBlank(U.filterConditions)||h.isBlank(U.filterConditions.details[ac.operator])){return}var Z=U.filterConditions.details[ac.operator].interfaceType;_.times(U.filterConditions.details[ac.operator].editorCount,function(ag){if(ag>0){ae.append(h.tag({tagName:"span",contents:h.t("core.and"),"class":"conjunction"}))}ae.append(h.tag({tagName:"div","class":"filterValueEditor"}))});if(!ac.autocomplete){ae.find(".filterValueEditor").each(function(ah){var ai=h(this);var ag=a(_.isArray(aa.item)?aa.item[ah]:aa.item,W,ac);ai.data("unifiedFilter-editor",ai.blistEditor({type:U,editorInterface:Z,value:ag,row:null,format:W.format,customProperties:{dropDownList:W.dropDownList,baseUrl:W.baseUrl()}}))});ae.find(".filterValueEditor input").bind("focus",function(){if(ae.nextAll().length===0){O("",W,V,ab,Y,{freeform:true})}});var X="edit_end";if(_.include(["checkbox","stars"],W.renderTypeName)){X="editor-change"}ae.find(".filterValueEditor").bind(X,function(){var aj=h(this);var ai=ae.find(".filterLineToggle");if((X=="edit_end")&&(h(document.activeElement).parents().index(aj)<0)){return}var ah=ab.find(".filterLineToggle");if(h.isBlank(r(aj))){var ag=aj.closest(".line").next(".line");if(ag.is(":last-child")){ag.remove()}if(ai.is(":checked")){if(ac.multiSelect===false){ah.filter(":first").attr("checked",true)}ai.removeAttr("checked")}}else{if((!ai.is(":checked"))&&!P){if(ac.multiSelect===false){ah.removeAttr("checked")}ai.attr("checked",true)}}h.uniform.update(ah);B()})}else{ae.find(".filterValueEditor").each(function(ah){var ai=h(this);ai.addClass("autocompleteCombo");var ag=a(_.isArray(aa.item)?aa.item[ah]:aa.item,W,ac);ai.append(h.tag({tagName:"div","class":"wrapper",contents:[{tagName:"input",type:"text","class":"textInput",value:h.htmlEscape(ag)},{tagName:"a",href:"#choose","class":"dropdownChooser"}]}))});ae.find(".dropdownChooser").mousedown(function(ah){var ag=h(this).siblings(".textInput");if(!ag.is(":focus")){_.defer(function(){ag.focus()})}}).click(function(ag){ag.preventDefault()});_.defer(function(){ae.find(".textInput").each(function(){var ag=h(this);ag.awesomecomplete({attachTo:ae.closest(".filterCondition"),forcePosition:true,showAll:true,skipBlankValues:true,suggestionListClass:"autocompleteComboDropdown",renderFunction:function(ai,aj,ah){return h.tag({tagName:"div",contents:[{tagName:"p","class":"item",contents:ai.item},{tagName:"p","class":"count",contents:"("+ai.count+")"}]},true)},dataMethod:function(ai,ah,aj){W.getSummary(function(al){var ak=[];_.each(al,function(an,am){_.each(an.topFrequencies,function(ao){var ap=ao.value;if(!h.isBlank(W.subColumnTypes)){ap={};ap[am]=ao.value}ak.push({count:ao.count,item:ap})})});aj(ak)})},onComplete:function(ah){if(ae.nextAll().length===0){O("",W,V,ab,Y,{freeform:true})}ag.closest(".filterValueEditor").data("unifiedFilter-editorValue",ah.item);if(!P){ae.find(".filterLineToggle").attr("checked",true)}h.uniform.update(ab.find(".filterLineToggle"));B()},valueFunction:function(ah){return ah.item||null}})})})}}else{if(aa==l){ae.append(h.tag({tagName:"label","class":"lineValue noFilterValue","for":ad,contents:h.t("controls.filter.actions.disable_filter")}));ae.data("unifiedFilter-value",l)}else{ae.append(h.tag({tagName:"label","class":"lineValue","for":ad,contents:_.map(h.arrayify(aa.item),function(ah,aj){var ag=(aj>0)?" and ":"";if((af.textOnly===true)){ag+=ah.toString()}else{try{ag+=b(W,ac.subcolumn).renderer(ah,W,false,true)}catch(ai){ag+=ah.toString()}}return ag})}));if(!_.isUndefined(aa.count)&&_.isUndefined(ac.subcolumn)){ae.append(h.tag({tagName:"span","class":"lineCount",contents:["(",aa.count,")"]}))}ae.data("unifiedFilter-value",!h.isBlank(aa.data)?aa.data:aa.item)}}ae.find(".filterLineToggle").bind("change click",_.throttle(B,0));ae.find(".removeFilterLine").click(function(ag){ag.preventDefault();var ah=h(this).closest(".line");if(!ah.is(":last-child")){ah.remove();B()}});if(af.autogenerated===true){ab.find(".filterValues .autogenerated").append(ae)}else{ab.find(".filterValues").append(ae)}};var N=function(V){var U={children:[],type:"operator",value:"OR",metadata:{}};if(h.isBlank(V)){if(Q.length===0){return}V=_.detect(Q,function(W){return !_.any(T.children,function(X){if(!_.isUndefined(X.metadata.tableColumnId)){return X.metadata.tableColumnId[F.publicationGroup]==W.tableColumnId}return false})});if(h.isBlank(V)){V=Q[0]}}U.metadata.tableColumnId=U.metadata.tableColumnId||{};U.metadata.tableColumnId[F.publicationGroup]=V.tableColumnId;if(!h.isBlank(V.renderType.subColumns)){U.metadata.subcolumn=V.renderType.defaultFilterSubColumn}U.metadata.operator=n(V,U.metadata.subcolumn);T.children.push(U);t(U);return U};var z=function(V,W,Z){var U={};var Y=_.after(C.length,function(){if(h.subKeyDefined(U,"top")){if(V.sortAlphabetically&&h.subKeyDefined(W,"metadata.displayOrder")){var aa={};_.each(W.metadata.displayOrder,function(ac,ab){aa[ac.orderItem]=ab});U.top=U.top.sort(function(ac,ab){return ac.item==ab.item?0:h.isBlank(aa[ac.item])&&h.isBlank(aa[ab.item])?(ac.item>ab.item?1:-1)*(V.reverseSort?-1:1):h.isBlank(aa[ac.item])?1:h.isBlank(aa[ab.item])?-1:(aa[ac.item]>aa[ab.item]?1:-1)*(V.reverseSort?-1:1)})}else{U.top=_.sortBy(U.top,function(ab){return _.isFunction(W.renderType.matchValue)?W.renderType.matchValue(ab.item,W):ab.item});if(V.reverseSort){U.top.reverse()}}if(!V.sortAlphabetically){U.top=U.top.sort(function(ac,ab){return(ab.count-ac.count)*(V.reverseSort?-1:1)})}if(V.useBottomItems&&!h.isBlank(V.includeAuto)){U.top=U.top.slice(-V.includeAuto)}}if(_.isFunction(Z)){Z(U)}});if(C.length===0){Y()}var X=function(aa){if(h.subKeyDefined(aa,"largest")){if(!h.subKeyDefined(U,"largest")){U.largest=aa.largest}else{U.largest=Math.max(U.largest,aa.largest)}if(!h.subKeyDefined(U,"smallest")){U.smallest=aa.smallest}else{U.smallest=Math.max(U.smallest,aa.smallest)}}if(h.subKeyDefined(aa,"top")){if(!h.subKeyDefined(U,"top")){U.top=aa.top.slice()}else{_.each(aa.top,function(ac){var ab=_.detect(U.top,function(ad){return ad.item==ac.item});if(!h.isBlank(ab)){ab.count+=ac.count}else{U.top.push(ac)}})}}Y()};_.each(C,function(ab){var aa=ab.dataset;var ac=aa.columnForTCID(V.tableColumnId[aa.publicationGroup]);if(V.serverSummary||!h.subKeyDefined(ac,"cachedContents")){ac.getSummary(function(ae){var ad=[];_.each(ae,function(ag,af){_.each(ag.topFrequencies,function(ah){var ai=ah.value;if(!h.isBlank(ac.subColumnTypes)){ai={};ai[af]=ah.value}ad.push({count:ah.count,item:ai})})});X({top:ad})},V.includeAuto)}else{X(ac.cachedContents)}})};var D=function(aa,V,X,Y,W,Z){var U=aa.metadata||{};z(U,V,function(ah){var ad=[];if(_.include(["EQUALS","NOT_EQUALS"],U.operator)&&h.subKeyDefined(ah,"top")){var ab=Math.min(U.includeAuto||5,ah.top.length);_.times(ab,function(ax){var ay=a(ah.top[ax].item,V,U);if(_.isUndefined(ay)){return}if(!_.contains(W,ay)){O({item:ay},V,aa,X,Y,{autogenerated:true});ad.push(ay)}})}else{if(_.include(["BETWEEN","LESS_THAN","LESS_THAN_OR_EQUALS","GREATER_THAN","GREATER_THAN_OR_EQUALS"],U.operator)&&h.subKeyDefined(ah,"largest")){if(ah.smallest==ah.largest){return}var al=[];if(_.include(["number","money","percent"],V.renderTypeName)){var ao=ah.largest-ah.smallest;var ak=f(ah.smallest);var am=f(ah.largest);if(ao>5000){if(ak.isNegative){ak.exp++}if(!am.isNegative){am.exp++}if(ak.isNegative){for(var ar=ak.exp;ar>=(am.isNegative?am.exp:1);ar--){al.push(-Math.pow(10,ar))}}if(ak.isNegative&&!am.isNegative){al.push(0)}if(!am.isNegative){for(var ar=(ak.isNegative?1:ak.exp);ar<=am.exp;ar++){al.push(Math.pow(10,ar))}}}else{var an=(ak.isNegative?(ak.leading+1):ak.leading)*Math.pow(10,ak.exp);al.push(an);var aw=(ah.largest-an)/U.includeAuto;if(aw>20){var ae=f(aw);aw=(ae.leading+1)*Math.pow(10,ae.exp)}var ag=an;while(ag<ah.largest){ag+=aw;al.push(ag)}}}else{if(_.include(["date","calendar_date"],V.renderTypeName)){var aj=ah.smallest;var ai=ah.largest;if(_.isNumber(aj)){aj*=1000}if(_.isNumber(ai)){ai*=1000}var af=new Date(aj);var av=new Date(ai);var aq=86400000;var ao=(av.getTime()-af.getTime())/aq;var au="";var aw=0;if(ao<8){au="day";aw=1}else{if(ao<32){au="day";aw=7}else{if(ao<196){au="month";aw=1}else{if(ao<367){au="month";aw=3}else{if(ao<3670){au="year";aw=1}else{au="year";aw=10}}}}}af=k(af,au,"down");al.push(af.getTime());var ac={day:"Date",month:"Month",year:"FullYear"};var at=new Date(af.getTime());while(at<av){at["set"+ac[au]](at["get"+ac[au]]()+aw);al.push(at.getTime())}al.pop();al.push(k(av,au,"up").getTime());if(!_.isUndefined(V.renderType.stringFormat)){al=_.map(al,function(ax){return new Date(ax).toString(V.renderType.stringFormat)})}else{al=_.map(al,function(ax){return ax/1000})}}}if(_.include(["LESS_THAN","LESS_THAN_OR_EQUALS"],U.operator)){al.shift()}else{if(_.include(["GREATER_THAN","GREATER_THAN_OR_EQUALS"],U.operator)){al.pop()}}if(U.operator=="BETWEEN"){while(al.length>1){var ap=[al[0],al[1]];ad.push(ap);O({item:ap},V,aa,X,Y,{autogenerated:true});al.shift()}}else{while(al.length>0){var ap=al[0];ad.push(ap);O({item:ap},V,aa,X,Y,{autogenerated:true});al.shift()}}}}if(_.isFunction(Z)){Z(ad)}})};var R=function(){S.find(".advancedStateLink").click(function(U){U.preventDefault();var V=h(this).hasClass("advancedOnLink");S.toggleClass("advanced",V||P);S.toggleClass("notAdvanced",!V&&!P);T.metadata.advanced=V;S.find(".advancedStateLine").removeClass("hide").filter(V?".editModeAdvancedOffLine":".editModeAdvancedOnLine").addClass("hide");B()});S.find(".mainFilterOptionsMenu").menu({additionalDataKeys:["actionTarget"],contents:[{text:h.t("controls.filter.menu.match_any"),href:"#matchAny",actionTarget:"OR",className:"matchAnyOrAll"},{text:h.t("controls.filter.menu.match_all"),href:"#matchAll",actionTarget:"AND",className:"matchAnyOrAll"}],menuButtonClass:"filterOptionsMenuButton options",menuButtonContents:""}).find(".menuEntry a").click(function(V){V.preventDefault();var W=h(this);var U=W.closest(".menuEntry");T.value=W.attr("data-actionTarget");U.siblings(".matchAnyOrAll").removeClass("checked");U.addClass("checked");B()});S.find(".addFilterConditionButton").click(function(U){U.preventDefault();N();S.find(".initialFilterMode").hide();S.find(".normalFilterMode").show()});S.find(".editFilter").click(function(U){U.preventDefault();if(F.temporary&&!F.minorChange){if(confirm(h.t("controls.filter.edit_default.save_confirm"))){F.reload()}else{return}}S.find(".initialFilterMode").hide();S.find(".normalFilterMode").show();S.removeClass("notAdvanced").addClass("editMode advanced");S.find(".editModeMessage").effect("highlight",{},3000);S.find(".filterConditions input").filter(":radio, :checkbox").attr("disabled",true);P=true});S.find(".saveEditedFilter").click(function(U){U.preventDefault();var W=h(this);W.addClass("disabled");S.find(".savingEditedFilterSpinner").css("display","inline-block");B();if(F.type=="blist"){F.update({metadata:h.extend({},F.metadata,{filterCondition:e(T)})});var V=F.query;delete V.filterCondition;delete V.namedFilters;F.update({query:V})}else{F.update({query:h.extend({},F.query,{filterCondition:T})})}F.save(function(){S.removeClass("editMode");P=false;W.removeClass("disabled");S.find(".savingEditedFilterSpinner").hide()})});S.find(".discardEditedFilter").click(function(U){U.preventDefault();S.removeClass("editMode");P=false;F.update({});F.reload()})};var B=function(){if(S.parents("body").length<1){return}var V=S.find(".filterConditions .filterCondition");V.removeClass("countInvalid");var W={};var U={};_.each(C,function(Z){var Y=h.extend(true,{},Z.dataset.query);var X;var aa={type:"operator",children:[],metadata:{unifiedVersion:2}};if(u){X=Y.filterCondition=Y.filterCondition||aa}else{if(h.isBlank(Y.namedFilters)){Y.namedFilters={}}X=Y.namedFilters[G]=Y.namedFilters[G]||aa}if(!h.subKeyDefined(X,"metadata.unifiedVersion")){X.metadata={unifiedVersion:2}}X.children=[];X.value=T.value;W[Z.ufID]=X;U[Z.ufID]=Y});V.each(function(){var ac=h(this);var ae=ac.data("unifiedFilter-condition");var Z=ae.metadata||{};var Y=[];var aa=F.columnForTCID(Z.tableColumnId[F.publicationGroup]);var X={type:"column",columnFieldName:aa.fieldName};if(!_.isUndefined(Z.subcolumn)){X.value=Z.subcolumn}var ad=ac.find(".filterLineToggle");var ab=ac.find(".showMoreLess").data("popup");if(!h.isBlank(ab)){ab.find(":checkbox, :radio").attr("checked",false)}ad.filter(":checked").each(function(){var ah=h(this);if(!h.isBlank(ab)){ab.find('[id^="'+ah.attr("id")+'"]').attr("checked",true)}var ag=ah.closest(".line");var af=ag.data("unifiedFilter-value");if(af==l){return}else{if(Z.operator=="blank?"){Y.push({type:"operator",value:af,children:[X]});return}else{if(h.isBlank(af)){af=[];ag.find(".filterValueEditor").each(function(){af.push(r(h(this)))});if(_.any(af,h.isBlank)){return}}}}Y.push({type:"operator",value:Z.operator,metadata:{freeform:(ag.find(".filterValueEditor").length>0)},children:[X].concat(_.map(h.arrayify(af),function(ai){return{type:"literal",value:a(ai,aa,Z)}}))})});if(!h.isBlank(ab)){h.uniform.update(ab.find(":checkbox, :radio"))}ae.metadata.customValues=[];ad.filter(":not(:checked)").each(function(){var ag=h(this).closest(".line");if(!ag.parents().hasClass("autogenerated")){var af=ag.data("unifiedFilter-value");if(af==l){return}if(h.isBlank(af)){af=[];ag.find(".filterValueEditor").each(function(){af.push(r(h(this)))});if(_.any(af,h.isBlank)){return}}ae.metadata.customValues.push(af)}});if(_.isEmpty(ae.metadata.customValues)){delete ae.metadata.customValues}ae.children=h.extend(true,[],Y);_.each(C,function(ah){var af=ah.dataset;X.columnFieldName=af.columnForTCID(Z.tableColumnId[af.publicationGroup]).fieldName;var ag=h.extend(true,{},ae);ag.children=h.extend(true,[],Y);W[ah.ufID].children.push(ag)});if(Y.length>0){ac.siblings().addClass("countInvalid")}ac.find(".clearValues").toggleClass("hide",Y.length<1||Z.multiSelect===false||Z.clearOption!==true)});_.each(C,function(Y){var X=Y.dataset;if(E||!_.isEqual(d(h.extend(true,{},X.query.filterCondition)),d(h.extend(true,{},T)))){if(_.isArray(W[Y.ufID].children)&&I&&_.isArray(I.children)){W[Y.ufID].children=W[Y.ufID].children.concat(I.children)}X.update({query:U[Y.ufID]});E=true}})};F.getQueryBase(function(){R();J()})}})(jQuery);(function(c){var a=_.compact(_.map(blist.datatypes,function(d,e){return !c.isBlank(d.filterConditions)||_.any(d.subColumns,function(f){return !c.isBlank(f.filterConditions)})?e:null}));var b=_.compact(_.map(blist.datatypes,function(d,e){return !d.disableNBEFilter&&(!c.isBlank(d.filterConditions)||_.any(d.subColumns,function(f){return !c.isBlank(f.filterConditions)}))?e:null}));c.Control.extend("pane_unifiedFilter",{getTitle:function(){return c.t("controls.filter.main.filter")},getSubtitle:function(){return c.t("controls.filter.main.filter_based_on_contents")},isAvailable:function(){return !c.isBlank(this._view)&&this._view.visibleColumns.length>0&&this._view.valid},getDisabledSubtitle:function(){return c.isBlank(this._view)?"No dataset is defined":!this._view.valid?c.t("controls.filter.main.view_must_be_valid"):c.t("controls.filter.main.view_has_no_columns")},setView:function(g){var f=this,d=f._super;var e=function(h){d.apply(f,[h]);f.reset();if(f._pendingView){if(blist.datasetPage&&blist.datasetPage.sidebar){blist.datasetPage.sidebar.updateEnabledSubPanes()}delete f._pendingView}};if(c.subKeyDefined(g,"displayFormat.viewDefinitions")){f._pendingView=true;if(g.displayFormat.viewDefinitions[0].uid=="self"){e(g)}else{Dataset.lookupFromViewId(g.displayFormat.viewDefinitions[0].uid,e)}}else{e(g)}},_getSections:function(){return[{customContent:{template:"filterPane",directive:{},data:{},callback:function(d){var e=this;d.unifiedFilter({datasets:e.settings.datasets||[e._view],rootCondition:e.settings.rootCondition,filterableColumns:e._view.columnsForType(e._view.newBackend?b:a)});e._view.unbind(null,null,e);e._view.bind("columns_changed",function(){d.trigger("columns_changed",{columns:e._view.columnsForType(e._view.newBackend?b:a)})},e);e._view.bind("clear_temporary",function(){d.trigger("revert")},e)},cleanupCallback:function(d){d.trigger("destroy")}}}]}},{name:"unifiedFilter",noReset:true},"controlPane");if(!c.isBlank(c.gridSidebar)&&(!c.subKeyDefined(blist,"sidebarHidden.filter.filterDataset")||!blist.sidebarHidden.filter.filterDataset)){c.gridSidebar.registerConfig("filter.unifiedFilter","pane_unifiedFilter",1,"filter")}})(jQuery);(function(e){var c=20;var b=function(k,h){if(k._viewList.length<1){k._$section.addClass("noResults");return null}var f=k._viewList;if(!e.isBlank(k._currentShow)&&k._currentShow!="all"){f=_.select(f,function(m){return m.type==k._currentShow})}if(!e.isBlank(k._currentSearch)){f=_.select(f,function(m){return m.name.toLowerCase().indexOf(k._currentSearch)>=0||m.owner.displayName.toLowerCase().indexOf(k._currentSearch)>=0})}var g=k._$section.find(".itemsContent ul.itemsList");g.empty();if(f.length<1){k._$section.addClass("emptySearch");return}k._$section.removeClass("emptySearch");f=_.sortBy(f,function(n){if(k._currentSort.startsWith("date")){return Math.max(n.viewLastModified,n.createdAt)*(k._currentSort=="dateDescending"?-1:1)}else{if(k._currentSort=="alphaAscending"){return n.name.toLowerCase()}else{if(k._currentSort=="popularity"){var o=n.viewCount||0;var m=10;while(o.length<m){o="0"+o}return(n.owner.id==n.tableAuthor.id?"a":"z")+o+n.name.toLowerCase()}else{if(k._currentSort=="publicationDate"){return(n.publicationDate||0)*-1}}}}});var l=0;var j=f.length;k._renderBlock=function(m){if(j<=0){return}_.each(f.slice(l,l+c),function(p){var q=e.renderTemplate("viewItemContainer",{view:p,typeClass:k._typeClass},{".viewIcon@title":function(r){return r.context.view.displayName.capitalize()},".viewIcon@class+":function(r){return"type"+r.context.view.styleClass},".icon@class+":function(r){if(r.context.view.styleClass==="Data_lens"){return"icon-cards"}else{return""}},".nameLink@href":"view.url",".name":"view.name!",".name@title":"view.name",".pubDate":function(r){return moment((r.context.view.publicationDate||0)*1000).format("LLL")},".authorLine .date":function(r){return blist.util.humaneDate.getFromDate(Math.max(r.context.view.viewLastModified||0,r.context.view.createdAt||0)*1000,blist.util.humaneDate.DAY).capitalize()},".authorLine .author":"view.owner.displayName!",".description":function(t){if(e.isBlank(t.context.view.description)){return""}var s={ALLOWED_TAGS:["a"],ALLOWED_ATTR:["href","rel","target"]};var u=DOMPurify.sanitize(t.context.view.description,s);var v=[];var r=function(){if(this.nodeType===3){v.push(this.textContent.linkify('rel="nofollow noreferrer external"'))}else{var w=e(this);if(w.is(":not(a)")){w.contents().each(r)}else{v.push(this.outerHTML)}}};e("<p>"+u+"</p>").contents().each(r);return DOMPurify.sanitize(v.join(""),s)},".deleteViewLink@class+":function(s){var t=_.include(s.context.view.rights,blist.rights.view.DELETE_VIEW);var r=blist.feature_flags.display_catalog_lens_delete_button;return(t&&r)?"":"hide"},".viewItem@class+":"typeClass"});q.data("view",p);if(p.id==k._view.id){q.addClass("current")}if(p.owner.id==p.tableAuthor.id){q.addClass("ownerItem")}_.defer(function(){q.expander({contentSelector:".description"})});g.append(q)});var o=k._$section.find(".moreLink");l+=c;j-=c;if(j>0){o.removeClass("hide");if(j==1){o.text(e.t("screens.ds.grid_sidebar.view_list.pagination.last"))}else{o.text(e.t("screens.ds.grid_sidebar.view_list.pagination.next",{count:Math.min(j,c)}))}}else{o.addClass("hide")}if(!m){var n=k._$section.closest(".scrollContent");n.animate({scrollTop:Math.min(k._$section.outerHeight(true)-n.height(),n.scrollTop()+n.height()-o.outerHeight(true))},"slow")}};k._renderBlock(true)};var a=[{text:e.t("screens.ds.grid_sidebar.view_list.sort.popularity"),name:"popularity"},{text:e.t("screens.ds.grid_sidebar.view_list.sort.dateDescending"),name:"dateDescending"},{text:e.t("screens.ds.grid_sidebar.view_list.sort.dateAscending"),name:"dateAscending"},{text:e.t("screens.ds.grid_sidebar.view_list.sort.alphaAscending"),name:"alphaAscending"}];var d=function(m){var f=m._$section.find(".sortMenu");f.menu({menuButtonContents:e.t("screens.ds.grid_sidebar.view_list.sort_title"),menuButtonTitle:e.t("screens.ds.grid_sidebar.view_list.sort_title"),noFlip:true,contents:_.map(a,function(n){return{text:n.text,href:"#"+n.name,className:"none"+(n.name==m._currentSort?" checked":"")}})});f.find(".menuDropdown a").click(function(o){o.preventDefault();var n=e(this);if(n.closest("li").is(".checked")){return}n.closest(".menuDropdown").find(".checked").removeClass("checked");n.closest("li").addClass("checked");m._currentSort=e.hashHref(n.attr("href"));b(m)});var g=m._$section.find(".showMenu");if(!g.hasClass("hide")){var l=_.map(["chart","map","calendar","filter","data_lens","api","grouped","form"],function(n){return{text:e.t("core.view_types_plural."+n),className:n.replace(/^(.)(.+)/,function(q,p,o){return"type"+p.toUpperCase()+o}),href:"#"+n,onlyIf:_.any(m._viewList,function(o){return o.type===n})}});g.menu({menuButtonContents:e.t("screens.ds.grid_sidebar.view_list.filter_title"),menuButtonTitle:e.t("screens.ds.grid_sidebar.view_list.filter_title"),contents:[{text:e.t("screens.ds.grid_sidebar.view_list.filter.all"),className:"none checked",href:"#all"}].concat(l)});g.find(".menuDropdown .typeData_lens .icon").addClass("icon-cards");g.find(".menuDropdown a").click(function(p){p.preventDefault();var o=e(this);if(o.closest("li").is(".checked")){return}m._currentShow=e.hashHref(o.attr("href"));var n=o.closest(".menuDropdown").find(".checked");n.removeClass("checked").addClass("type"+e.hashHref(n.children("a").attr("href")).capitalize());o.closest("li").addClass("checked").removeClass("type"+m._currentShow.capitalize());b(m)})}m._$section.find(".textPrompt").example(function(){return e(this).attr("title")});var k=m._$section.find(".viewSearch");var j=m._$section.find(".clearViewSearch");var h=function(){var n=k.val().toLowerCase();if(k.is(".prompt")){n=""}j.toggle(!e.isBlank(n));m._currentSearch=n;b(m)};j.click(function(n){n.preventDefault();k.val("");k.focus().blur();h()});k.blur(function(){_.defer(h)}).closest("form").submit(function(n){n.preventDefault();_.defer(h)});m._$section.find(".moreLink").click(function(n){n.preventDefault();if(_.isFunction(m._renderBlock)){m._renderBlock()}});b(m)};e.Control.extend("pane_viewList",{_init:function(){var f=this;f._super.apply(f,arguments);f._typeClass="view";f._currentSort="popularity";f._currentShow="all";f.$dom().delegate(".deleteViewLink","click",function(k){k.preventDefault();var l=e(this).closest("li");var g=l.data("view");if(confirm(e.t("screens.ds.grid_sidebar.view_list.delete_confirm",{name:g.name}))){var j;var h=function(){l.remove();f._viewList.splice(_.indexOf(f._viewList,g),1);if(!e.isBlank(blist.datasetPage)){blist.datasetPage.$moreViewsTab.contentIndicator().setText(f._viewList.length)}if(!e.isBlank(j)){j.redirectTo()}};if(f._view.id==g.id){f._view.getParentDataset(function(m){if(!e.isBlank(m)){j=m}})}g.remove(h)}})},getTitle:function(){return e.t("screens.ds.grid_sidebar.view_list.views.title")},getSubtitle:function(){return e.t("screens.ds.grid_sidebar.view_list.views.subtitle")},_getSections:function(){return[{customContent:{template:"itemsListBlock",data:{resultType:"view"},callback:function(f){var g=this;g._startProcessing();g._$section=f;g._view.getRelatedViews(function(h){g._finishProcessing();g._viewList=h;d(g)})}}}]}},{name:"viewList"},"controlPane");if(e.isBlank(blist.sidebarHidden.moreViews)||!blist.sidebarHidden.moreViews.views){e.gridSidebar.registerConfig("moreViews.viewList","pane_viewList",1)}e.Control.extend("pane_snapshotList",{_init:function(){var f=this;f._super.apply(f,arguments);f._typeClass="snapshot";f._currentSort="publicationDate";f._currentShow="all";f.$dom().delegate(".deleteViewLink","click",function(k){k.preventDefault();var l=e(this).closest("li");var g=l.data("view");if(confirm(e.t("screens.ds.grid_sidebar.view_list.delete_snapshot_confirm",{name:g.name,date:new Date((g.publicationDate||0)*1000).format("F d, Y g:ia")}))){var j;var h=function(){l.remove();f._viewList.splice(_.indexOf(f._viewList,g),1);if(!e.isBlank(j)){j.redirectTo()}};if(f._view.id==g.id){f._view.getPublishedDataset(function(m){if(!e.isBlank(m)){j=m}})}g.remove(h)}})},getTitle:function(){return e.t("screens.ds.grid_sidebar.view_list.snapshots.title")},getSubtitle:function(){return e.t("screens.ds.grid_sidebar.view_list.snapshots.subtitle")},_getSections:function(){return[{customContent:{template:"itemsListBlock",directive:{".sortMenu@class+":"hide",".showMenu@class+":"hide"},data:{resultType:"dataset",hide:"hide"},callback:function(f){var g=this;g._startProcessing();g._$section=f;g._view.getSnapshotDatasets(function(h){g._finishProcessing();g._viewList=h;d(g)})}}}]}},{name:"snapshotList"},"controlPane");if(e.isBlank(blist.sidebarHidden.moreViews)||!blist.sidebarHidden.moreViews.snapshots){e.gridSidebar.registerConfig("moreViews.snapshotList","pane_snapshotList",2)}})(jQuery);var datasetControlsNS=blist.namespace.fetch("blist.datasetControls");blist.datasetControls.hookUpShareMenu=function(f,b,h,g){var c=f.displayType==="story"?"share_story_text":"share_text";var d=escape($.t("controls.common.share."+c,{name:f.name,site:blist.configuration.strings.company}));var j=f.fullUrl;var e=f.shortUrl;var a={menuButtonContents:$.t("controls.common.share.button_prompt"),menuButtonTitle:$.t("controls.common.share.button_tooltip"),contents:[{text:$.t("controls.common.share.networks.facebook"),className:"facebook",rel:"external",href:"http://www.facebook.com/share.php?u="+j},{text:$.t("controls.common.share.networks.twitter"),className:"twitter",rel:"external",href:"http://twitter.com/?status="+d+e},{text:$.t("controls.common.share.networks.email"),className:"email",href:"#email",onlyIf:!g}]};$.extend(a,h);b.menu(a)};blist.datasetControls.unsavedViewPrompt=function(){$("a").on("click",function(h){if(!blist.dataset.temporary||blist.dataset.minorChange){return}if(h.ctrlKey||h.metaKey){return}var b=h.currentTarget;if(b.rel.indexOf("external")>-1){return}if(b.className.indexOf("noRedirPrompt")>-1){return}var d=b.href;if($.isBlank(d)){return}var c=d;var f=window.location.href;if(f.endsWith("#")){f=f.slice(0,-1)}if(window.location.hash.length>0){f=f.slice(0,-window.location.hash.length)}if(d.startsWith(f)){c=d.slice(f.length)}if(c.charAt(0)=="#"){return}if(window.location.href==d){return}h.preventDefault();var g=function(){window.location=d;return true};datasetControlsNS.showSaveViewDialog("leavingSaveDialog",g,g)})};blist.datasetControls.showSaveViewDialog=function(h,f,e,j,c){var a=datasetControlsNS.showSaveViewDialog;var d=$(".saveViewDialog");d.find(".mainError").text("");d.jqmShow();a._customClass=h;if(!$.isBlank(a._customClass)){d.addClass(a._customClass)}var b=function(){setTimeout(function(){if(!$.isBlank(a._customClass)){d.removeClass(a._customClass)}d.find(".viewName").val("")},1000)};d.loadingSpinner({metric:"save",overlay:true});a._saveCallback=f;a._dontSaveCallback=e;a._cancelCallback=j;var g=function(k){var o=d.find(".viewName");var l=o.val();if(k&&$.isBlank(l)){d.find(".mainError").text($.t("screens.ds.save_dialog.validation.view_name_required"));return}d.find(".mainError").text("");var n=function(){d.loadingSpinner().showHide(true);var p=blist.dataset.newBackend;var r=function(t){d.loadingSpinner().showHide(false);var s=false;if(_.isFunction(a._saveCallback)){s=a._saveCallback(t)}if(!s){t.redirectTo()}else{b();d.jqmHide()}};var q=function(s){d.loadingSpinner().showHide(false);d.find(".mainError").text(JSON.parse(s.responseText).message)};if(!$.isBlank(c)){blist.dataset.update(c)}if(k){blist.dataset.name=l;blist.dataset.saveNew(p,r,q)}else{blist.dataset.save(r,q)}};if(!$.isBlank(blist.util.inlineLogin)){var m=$.t("screens.ds.save_dialog.validation.auth_required");blist.util.inlineLogin.verifyUser(function(p){if(p){n()}else{d.find(".mainError").text(m)}},m)}else{n()}};if($.isBlank(a._hookedEvents)){d.find("form").submit(function(k){k.preventDefault();g(true)});d.find("a.save").click(function(k){k.preventDefault();g(d.find(".viewName").is(":visible"))});d.find("a.update").click(function(k){k.preventDefault();g(false)});d.find(".jqmClose").click(function(){b();if(_.isFunction(a._cancelCallback)){a._cancelCallback()}});d.find(".dontSave").click(function(){if(_.isFunction(a._dontSaveCallback)){a._dontSaveCallback()}});a._hookedEvents=true}};blist.datasetControls.datasetRating=function(b,d,a){if(!a&&!$.isBlank(b.data("rating-type"))&&$.isBlank(b.data("rating"))){var c=b.closest("dd").addClass("hide");c.prev("dt").addClass("hide");return}b.stars({onChange:function(e){blist.util.doAuthedAction($.t("controls.common.rate.auth_action_phrase"),function(f){blist.dataset.updateRating({type:b.attr("data-rating-type"),rating:(e*20)},function(g){if(!_.isUndefined(g.type)){d.find(".totalTimesRated").text(parseInt($.trim(d.find(".totalTimesRated").text()))+1)}b.attr("title","");if(_.isFunction(f)){f()}})})}})};blist.datasetControls.datasetContact=function(c){var a=function(){var d=c.find("#contactPurpose");var f=d.val();var e="";if($.isBlank(f)){return}if(f=="other"){e=$.t("screens.ds.dataset_contact.other_subject",{dataset_name:blist.dataset.name,site:blist.configuration.strings.company})}else{e=$.t("screens.ds.dataset_contact.subject",{dataset_name:blist.dataset.name,reason:$.t("screens.ds.dataset_contact.reasons."+f)})}c.find("#contactSubject").val(e);c.find("#contactBody").focus()};var b=function(){c.find(".contactOwnerForm").slideToggle().find("#contactBody").focus().end().end().find(".contactOwnerLinks").slideToggle().end()};c.delegate(".contactButton","click",function(g){g.preventDefault();var h=$(this);c.find(".flash").removeClass("notice").text("").fadeOut();if($.subKeyDefined(blist,"datasetPage.sidebar")&&blist.datasetPage.sidebar.$dom().width()<350){blist.datasetPage.sidebar.$dom().width(350);$(window).resize()}if(c.find(".contactOwnerForm").length===0){h.closest(".formSection").after($.renderTemplate("aboutDataset_contact"));blist.util.loadCaptcha("contactCaptcha");var e=c.find(".contactOwnerForm").addClass("sectionContent");e.parent().addClass("formSection");e.validate({rules:{type:"required",subject:"required",message:"required",from_address:{required:true,email:true}},messages:{type:$.t("screens.ds.dataset_contact.validation.no_purpose"),subject:$.t("screens.ds.dataset_contact.validation.no_subject"),message:$.t("screens.ds.dataset_contact.validation.no_body"),from_address:{required:$.t("screens.ds.dataset_contact.validation.no_email")}},errorPlacement:function(k,l){k.appendTo(l.closest(".lined"))}});var d=c.find("#contactPurpose").change(a);if(!d.parent().hasClass("uniform")){d.uniform()}e.submit(function(k){k.preventDefault();if(e.valid()){$.ajax({url:e.attr("action"),data:e.serialize(),type:"POST",dataType:"json",error:function(){c.find(".flash:not(.recaptcha_flash)").removeClass("notice").addClass("error").text($.t("screens.ds.dataset_contact.error_message")).show()},success:function(l){if(l.success==true){_.defer(function(){c.find(".flash:not(.recaptcha_flash)").removeClass("error").addClass("notice").text($.t("screens.ds.dataset_contact.success_message")).show();b()});c.find(".recaptcha_flash").removeClass("error").fadeOut()}else{if(l.success==false){c.find(".recaptcha_flash").removeClass("notice").addClass("error").text($.t("recaptcha.errors.verification_failed")).fadeIn()}}}})}});c.find(".sendContactButton").click(function(k){k.preventDefault();e.submit()})}var f=c.find(".contactOwnerForm");f[0].reset();f.validate().resetForm();b();if(!_.isUndefined(h.attr("data-select"))){var j=c.find("#contactPurpose");j.val(h.attr("data-select"));a();$.uniform.update(j)}})};blist.datasetControls.getColumnTip=function(a){return'<div class="blist-th-tooltip '+a.renderTypeName+'"><p class="name">'+$.htmlEscape(a.name).replace(/ /,"&nbsp;")+"</p>"+(!$.isBlank(a.metadata.originalName)?'<p class="originalName"><span class="title">'+$.t("screens.ds.column_tip.original_name")+':</span> <span class="value">'+$.htmlEscape(a.metadata.originalName).replace(/ /,"&nbsp;")+"</span>":"")+(a.description!==undefined?'<p class="description">'+$.htmlEscape(a.description)+"</p>":"")+'<p class="columnType"><span class="blist-th-icon"></span>'+$.t("core.data_types."+a.dataTypeName)+(a.format.grouping_aggregate!==undefined?" "+$.t("screens.ds.column_tip.aggregate",{aggregate:$.t("core.aggregates."+a.format.grouping_aggregate),data_type:$.t("core.data_types."+a.dataTypeName)}):"")+"</p>"+(a.fieldName!==undefined?'<br/><p class="api-field">'+$.t("screens.ds.column_tip.field_name")+": "+$.htmlEscape(a.fieldName)+"</p>":"")+"</div>"};blist.datasetControls.raReasonBox=function(a){var d=a.siblings("input");var c=a.children("textarea");a.addClass("hide jsEnabled");a.append(a.siblings(".button").clone());a.append($.tag({tagName:"a",href:"#Close","class":"remove",contents:{tagName:"span","class":"icon"}}));a.closest("form").validate();var b=function(){a.addClass("hide");a.closest("form").css("z-index","");c.blur()};c.keydown(function(f){if(f.which==27){b()}});a.find(".remove").click(function(f){f.preventDefault();b()});d.click(function(f){if(a.hasClass("hide")){f.preventDefault();a.removeClass("hide");a.closest("form").css("z-index",10);c.focus()}})};blist.datasetControls.editPublishedMessage=function(){var g="editPublishedMessage"+_.uniqueId();var f=$.tag({tagName:"div","class":"editPublishedMessage",id:g,contents:{tagName:"div","class":"throbber"}});var e=true;var c=function(m,k){var o=blist.datasetControls.copyPending||k;var j=$("#"+g);if(j.length===0){j=f}if((j.length===0)||(!e&&(j.closest("body").length===0))){return}if(j.find(".doneCopyingMessage").is(":visible")){return}j.empty().append($.renderTemplate("editAlertTemplate",m,{".editPublished@class+":function(){return o?"hide":""},".editMessage":function(){return d(m)},".editMessage@class+":function(){return o?"hide":""},".copyingMessage":function(){return $.t("screens.ds.dataset_status.copy_in_progress",{additional:m.message})},".copyingMessage@class+":function(){return o?"":"hide"}}));var l=j.closest(".bt-wrapper");if(l.length>0){var h=l.data("socrataTip-$element");var n=h.data("socrataTip");n.refreshSize()}if(!blist.dataset._unpublishedView){window.setTimeout(function(){a()},30000)}e=false};var d=function(h){if(blist.dataset.isImmutable()){return $.t("screens.ds.dataset_status.immutable")}else{return $.t("screens.ds.dataset_status.needs_copy",{status:$.t("screens.ds.dataset_status.needs_copy_status."+h.status)})}};var b=false;var a=function(){blist.dataset.getOperationStatuses(function(k){var l={};var j=false;var h=function(m){return blist.util.humaneDate.getFromDate(new Date(m*1000))};switch(k.copying.copyStatus){case"finished":l.status=b?"available":"can_be_made";break;case"queued":l.message=$.t("screens.ds.dataset_status.copy_in_progress_additional.queued",{time:h(k.copying.queuedAt),totalQueued:k.copying.totalQueued});j=true;break;case"processing":l.message=$.t("screens.ds.dataset_status.copy_in_progress_additional.processing",{time:h(k.copying.startedAt)});j=true;break;case"failed":l.status="can_be_made"}b=b||j;c(l,j)})};blist.dataset.getUnpublishedDataset(function(h){if($.isBlank(h)){a()}else{c({status:"available"},false)}});return f};blist.datasetControls.hookUpPublishing=function(a){a.find(".unpublished").socrataTitleTip();a.find(".snapshotted").socrataTitleTip();a.find(".publish").click(function(b){b.preventDefault();if($(b.target).hasClass("disabled")){return}blist.dataset.publish(function(c){c.redirectTo()},function(d){var c=$.t("screens.ds.dataset_status.error_publishing_html");if((JSON.parse((d||{}).responseText)||{}).message=="Only unpublished datasets can be published."){c=$.t("screens.ds.dataset_status.error_publishing_unpublished")}a.find("#datasetName").socrataTip({content:$.tag({tagName:"p","class":"errorMessage",contents:c}),showSpike:false,trigger:"now"})})});if(a.find(".publish").exists()){blist.dataset.getPublishingAvailable(function(d,b){var c=a.find(".publish");if(!d){c.addClass("disabled").attr("title",b)}c.socrataTitleTip()})}if(!blist.dataset.isPublished()){blist.dataset.getPublishedDataset(function(b){if(!$.isBlank(b)){a.find("#publishedLink").attr("href",b.url).find(".publishedName").text(b.name)}else{a.find("#publishedLink").hide()}})}};$(function(){blist.namespace.fetch("blist.dialog");var l;var d;var j=false;var g=false;var h=function(m,n){return'<p class="title">'+m.displayName+'</p><p class="matchRow"><span class="matchedField">Email:</span> '+m.email+"</p>"};var a=function(m,n){n.closest("div").siblings(".recipientUid").val(m.id).end()};var e=function(m){m.parent().css("z-index",3001)};var k=function(m){m.parent().css("z-index","")};var c=function(m){m.awesomecomplete({blurFunction:k,dontMatch:["id"],onComplete:a,showFunction:e,staticData:j,renderFunction:h,valueFunction:function(n){return n.email}})};blist.dialog.sharing=function(r,m,q){if(!$.isBlank(r)){r.preventDefault()}if(!g){b()}var o=$(".emailDatasetDialog");q=q||blist.dataset;l.data("dataset",q);o.toggleClass("ownerDialog",q.hasRight(blist.rights.view.GRANT));l.attr("action","/api/views/"+q.id+".json?method=sendAsEmail");l.validate().resetForm();var n=q.displayName;o.find(".datasetTypeName").text(n);o.find(".datasetTypeNameUpcase").text(n.capitalize());o.find(".datasetName").text(q.name);o.find(".emailLine").slice(1).remove();o.find(".emailRecipient").val("");o.find(".recipientUid").val("");o.find("#emailMessage").val("");var p=o.find(".emailLine");p.find(".recipientRole").closest(".uniform").andSelf().remove();if(o.hasClass("ownerDialog")){p.append($.tag({tagName:"select","class":"recipientRole",name:"role",contents:_.map(q.getShareTypes(),function(s){return{tagName:"option",value:s,contents:$.t("core.share_types."+s.toLowerCase())}})}));p.find("select").uniform()}$(".emailDatasetContent").show();$(".emailSuccess").hide();o.data("owner",m);o.jqmShow();d.removeClass("notice").removeClass("error").text("");if(!q.isPublic()){d.addClass("notice").text($.t("screens.ds.email.private_notice",{displayName:n}))}if(!j&&!$.isBlank(blist.currentUserId)){$.ajax({url:"/api/users/"+blist.currentUserId+"/contacts.json",dataType:"json",success:function(s){j=_.map(_.select(s,function(t){return !$.isBlank(t.email)}),function(t){return{displayName:$.htmlEscape(t.displayName),email:t.email,id:t.id}});c($(".emailRecipient"))}})}};$.live("#shareMenu .menuEntries .email a","click",blist.dialog.sharing);$.live(".emailDatasetDialog .removeLink","click",function(m){m.preventDefault();$(this).closest(".emailLine").remove();f--;if(f<10){$(".emailDatasetDialog .addMoreRecipientsButton").removeClass("disabled")}});var f=1;var b=function(){l=$("#emailDatasetForm");d=$("#emailDatasetMessage");$(".emailDatasetDialog .addMoreRecipientsButton").click(function(o){o.preventDefault();if($(this).hasClass("disabled")){return}f++;var n=l.find(".emailLine").first().clone().find(".autocomplete").remove().end().find("label.error").remove().end().find("input").val("").end().find(".removeLink").removeClass("hiddenLink").end();var m=n.find(".recipientRole");if(m.length>0){m.get(0).selectedIndex=0;n.find(".selector.uniform").replaceWith(m);m.uniform()}n.insertAfter(l.find(".emailLine:last"));var p=n.find(".emailRecipient").attr("name","emailRecipient"+f);p.rules("add",{email:true});if(j&&j.length>0){c(p)}if(f>9){$(this).addClass("disabled")}});l.validate({rules:{emailRecipient0:{email:true,required:true}},errorPlacement:function(m,n){n.closest(".emailLine").after(m)},onkeyup:false,onfocusout:false,focusInvalid:false});l.submit(function(q){q.preventDefault();if(l.valid()){var p=l.data("dataset");var o=p.isPublic();var n=l.find("#emailMessage").val();l.find(".emailLine").each(function(){var r=$(this).find(".emailRecipient").val();var u=$(this).find(".recipientUid").val();var t=$(this).find(".recipientRole").val();if(!$.isBlank(r)){if(!o||!$.isBlank(t)){var s={userEmail:r,type:t,message:n};if(!$.isBlank(u)){s.userId=u}p.createGrant(s,null,null,true)}else{$.socrataServer.makeRequest({url:l.attr("action"),type:"POST",batch:true,data:JSON.stringify({recipient:r,message:n})})}}});var m=function(){l.closest(".emailDatasetContent").slideToggle();$(".emailSuccess").slideToggle();var r=l.closest(".emailDatasetDialog").data("owner")||{};if(_.isFunction(r.reset)){r.reset()}else{if($.subKeyDefined(blist,"datasetPage.sidebar")){blist.datasetPage.sidebar.refresh("manage.shareDataset")}}};ServerModel.sendBatch(m,function(r){var s=r||"There was an error sending your email. Please try again later.";d.addClass("error").text(s)})}});$("#emailSubmitButton").click(function(m){m.preventDefault();l.submit()});$(".emailDatasetContent .cancel").click(function(m){l.find("label.error").remove()});g=true}});(function(e){var k=blist.namespace.fetch("blist.dialog"),f=false,g=null,j="MAIL.VIEW_PUBLISHED",b,d,h,a;k.subscribe=function(n){if(!f){c()}n=n||blist.dataset;b.data("dataset",n);var m=n.displayName;d.text(m);h.text(m.capitalize());b.find(".datasetName").text(n.name);var l=n.apiUrl+"/rows.rss";b.find(".rssSection a.rss").attr("href",l);b.find(".rssSection a.greader").attr("href","http://fusion.google.com/add?feedurl="+l);b.find(".rssSection a.feed").attr("href","feed:"+l);var o=function(p){if(p){b.removeClass("unsubscribed").addClass("subscribed");e.uniform.update(a.prop("checked",true))}b.removeClass("loading")};if(blist.currentUser){g=new User(blist.currentUser);g.getEmailInterest(j,n.id,o)}else{o()}b.jqmShow()};var c=function(){b=e(".subscribeToDataset");d=b.find(".datasetTypeName");h=b.find(".datasetTypeNameUpcase");a=b.find(".subscribeCheckbox");a.uniform();a.change(function(m){var n=b.data("dataset");var l=b.hasClass("subscribed");var o=function(){b.toggleClass("loading unsubscribed subscribed")};if(l){b.addClass("loading");g.removeEmailInterest(j,n.id,o)}else{if(!g){e.uniform.update(a.prop("checked",false))}blist.util.doAuthedAction("subscribe to a dataset",function(){g=new User({id:blist.currentUserId});b.addClass("loading");g.addEmailInterest(j,n.id,o);e.uniform.update(a.prop("checked",true))})}});f=true}})(jQuery);(function(a){a.fn.embedForm=function(c){var d=a.extend({},a.fn.embedForm.defaults,c);return this.each(function(){var g=a(this);var e=a.meta?a.extend({},d,g.data()):d;var f=g.find(e.textareaSelector).text();g.find(e.widthSelector+","+e.heightSelector).keyup(function(){var h=b(g,e,f);g.find(e.sizesSelector).removeClass("selected").filter("[data-width="+h.width+"][data-height="+h.height+"]").addClass("selected")}).keypress(function(h){if((h.which<48||h.which>57)&&!(h.which==8||h.which==0)){return false}});g.find(e.codeSelector).click(function(){a(this).select()});g.find(e.sizesSelector).click(function(h){var j=a(this);j.siblings().removeClass("selected");j.addClass("selected");g.find(e.widthSelector).val(j.attr("data-width"));g.find(e.heightSelector).val(j.attr("data-height"));b(g,e,f)});g.find(e.templateSelector).change(function(h){b(g,e,f)});g.find(e.createTemplateButtonSelector).click(function(h){h.preventDefault();a(".newTemplateModal #newTemplateName").val("");a(".newTemplateModal").jqmShow()});a(".newTemplateModal .submitButton").click(function(h){h.preventDefault();a(this).closest("form").submit()});a(".newTemplateModal form").validate();a.uniform.update(g.find(e.templateSelector).val(a("#embed_default").val()));b(g,e,f)});function b(k,f,j){var h=k.find(f.widthSelector).val();var e=k.find(f.heightSelector).val();var g=k.find(f.templateSelector).val();var l=j.replace("_width_",h).replace("_height_",e).replace("_variation_",g||"");_.defer(function(){k.find(f.textareaSelector).text(l)});if(parseInt(h,10)<425||parseInt(e,10)<425||h==""||e==""){k.find(f.errorMessageSelector).addClass("errorMessage");k.find(f.textareaSelector).attr("disabled",true);f.invalidCallback()}else{k.find(f.errorMessageSelector).removeClass("errorMessage");k.find(f.textareaSelector).removeAttr("disabled");f.validCallback()}return{width:h,height:e}}};a.fn.embedForm.defaults={textareaSelector:"#embed_code",widthSelector:"#embed_width",heightSelector:"#embed_height",templateSelector:"#embed_template",errorMessageSelector:".sizeInformation",sizesSelector:".sizes li",codeSelector:".htmlCode",createTemplateButtonSelector:".createTemplateButton",invalidCallback:function(){},validCallback:function(){}}})(jQuery);(function(c){c.fn.fullScreen=function(d){var e=c(this[0]).data("fullScreen");if(!e){e=new a(d,this[0])}return e};var a=function(d,e){this.settings=c.extend({},a.defaults,d);this.currentDom=e;this.init()};c.extend(a,{defaults:{fullHeightSelector:".fullHeight"},prototype:{init:function(){var d=this;var e=d.$dom();e.data("fullScreen",d);d.adjustSize();c(window).resize(function(){d.adjustSize()})},$dom:function(){if(!this._$dom){this._$dom=c(this.currentDom)}return this._$dom},adjustSize:function(){var e=this;if(e._disabled){return}var d=c(window).height();e.$dom().parents().andSelf().each(function(){var f=c(this);d-=f.outerHeight()-f.height()});d-=b(e.$dom(),e);e.$dom().children().height(d).each(function(){var f=c(this);if(!f.is(":visible")){return}f.find(e.settings.fullHeightSelector).filter(":visible").each(function(){var h=c(this);var k=h.siblings(e.settings.fullHeightSelector).filter(":visible").add(h);var j=1;if(k.length>1){var g=1.3333;j=k.index(h)==0?g:(k.length-g)/(k.length-1)}h.height(Math.floor((h.parent().innerHeight()-b(h,e))*j/k.length))})})},enable:function(){this._disabled=false;this.adjustSize()},disable:function(){this._disabled=true;this.$dom().children().height("auto").find(this.settings.fullHeightSelector).height("auto")}}});var b=function(d,f){var e=0;d.siblings(":visible").each(function(){var g=c(this);if(g.is(f.settings.fullHeightSelector)){return}if(g.css("position")!="fixed"&&g.css("position")!="absolute"){e+=g.outerHeight(true)}});return e}})(jQuery);(function(a){a.fn.formatOptions=function(b){var c=a.extend({},a.fn.formatOptions.defaults,b);return this.each(function(){var e=a(this);var f=a.meta?a.extend({},c,e.data()):c;e.data("config-formatOptions",f);f.$grid=a(f.gridSelector);e.find("a.toggleButton").click(function(l){l.preventDefault();var k=a(this);var j=k.attr("href").split("_")[1];if(!a.isBlank(f.formatEditor)){var h=!k.is(".active");if(j=="link"){if(!h){f.formatEditor.action("unlink")}else{var g=prompt("Enter a URL:");if(g!==null){if(g.match(/^.+@.+\..+/)){g="mailto:"+g}else{if(!g.match(/^(f|ht)tps?:\/\//)){g="http://"+g}}f.formatEditor.action("link",g)}}}else{f.formatEditor.action(j,h)}}});e.find("select").change(function(j){var g=a(this);var h=g.attr("name").split("_")[1];var k=g.val();if(g.is(".fontSize")){k=(k/10)+"em"}if(!a.isBlank(f.formatEditor)){f.formatEditor.action(h,k)}});e.find(".menu.align").menu({menuButtonContents:a.tag({tagName:"span","class":"alignIcon"},true),menuButtonTitle:"Alignment",contents:[{title:"Align Left",className:"alignLeft",href:"#format_justifyLeft"},{title:"Align Center",className:"alignCenter",href:"#format_justifyCenter"},{title:"Align Right",className:"alignRight",href:"#format_justifyRight"}]}).find("a").mousedown(function(g){g.stopPropagation()}).end().find(".menuDropdown a").click(function(k){k.preventDefault();var g=a(k.currentTarget);var h=g.attr("href");var j=h.slice(h.indexOf("#")+1).split("_");var l=j[1];if(!a.isBlank(f.formatEditor)){f.formatEditor.action(l,true)}});var d=e.find("a.color");d.colorPicker().bind("color_change",function(h,g){if(!a.isBlank(f.formatEditor)){f.formatEditor.action("color",g)}d.children(".colorIndicator").css("border-bottom-color",g)}).mousedown(function(g){d.data("colorpicker-color",d.find(".colorIndicator").css("border-bottom-color"))}).click(function(g){g.preventDefault()});a("#color_selector").mousedown(function(g){g.stopPropagation()});f.$grid.bind("action-state-change",function(z){if(!a(z.target).isControlClass("blistEditor")){return}f.formatEditor=a(z.target).blistEditor();if(!f.formatEditor.supportsFormatting()){e.addClass("disabled");return}f.formatEditor.registerExternalEditor(e);e.removeClass("disabled");var n=f.formatEditor.getActionStates();var A=e.find("a.bold");n.bold.value?A.addClass("active"):A.removeClass("active");var r=e.find("a.italic");n.italic.value?r.addClass("active"):r.removeClass("active");var w=e.find("a.underline");n.underline.value?w.addClass("active"):w.removeClass("active");var m=e.find("a.strike");n.strikethrough.value?m.addClass("active"):m.removeClass("active");var B=e.find("a.bulletedList");n.unorderedList.value?B.addClass("active"):B.removeClass("active");var j=e.find("a.numberedList");n.orderedList.value?j.addClass("active"):j.removeClass("active");var t=e.find("a.link");n.unlink.enabled?t.addClass("active"):t.removeClass("active");var q=e.find(".fontFamily");var y=(n.fontFamily.value||"arial").toLowerCase();var k=q.find('[value="'+y+'"]');if(k.length<1){k=q.find('[value^="'+y+'"]')}if(k.length<1){k=q.find('[value*="'+y+'"]')}if(k.length>0){q.val(k.eq(0).val())}var D=e.find(".fontSize");var v=n.fontSize.value||"10";if(typeof v=="string"&&v.endsWith("em")){v=parseFloat(v)*10}else{v=parseFloat(v)}var g=D.find("option");var C=false;for(var x=0;x<g.length-1;x++){var s=parseFloat(g.eq(x).val());if(s>=v){D.val(s);C=true;break}var p=parseFloat(g.eq(x+1).val());if(p>v){if((p+s)/2>v){D.val(s)}else{D.val(p)}C=true;break}}if(!C){D.val(g.eq(g.length-1).val())}var o=e.find(".color .colorIndicator");var l=n.color.value+"";if(!l.startsWith("#")&&!l.startsWith("rgb(")){var l=(parseInt(n.color.value)||0).toString(16);var h=6-l.length;for(var x=0;x<h;x++){l="0"+l}l="#"+l.slice(0,6)}o.css("border-bottom-color",l);var u=e.find(".menu.align").removeClass("alignRight alignCenter");if(n.justifyRight.value){u.addClass("alignRight")}else{if(n.justifyCenter.value){u.addClass("alignCenter")}else{u.addClass("alignLeft")}}if(!a.isBlank(a.uniform)&&!a.isBlank(a.uniform.update)){_.defer(function(){a.uniform.update(e.find(".uniform :input"))})}});f.$grid.bind("edit-finished",function(g){e.addClass("disabled").find(".active").removeClass("active").end().find("select").each(function(h,j){a(j).val(a(j).find(".default").val())}).end().find(".menu.align").removeClass("alignRight alignCenter").addClass("alignLeft").end().find(".color .colorIndicator").css("border-bottom-color","#000000");delete f.formatEditor})})};a.fn.formatOptions.defaults={gridSelector:""}})(jQuery);(function(a){a.fn.pillButtons=function(b){var c=a.extend({},a.fn.pillButtons.defaults,b);this.each(function(){var d=a(this);if(a.browser.msie){d.find("li:first-child").addClass("first").end().find("li:last-child").addClass("last")}d.find("a").click(function(e){e.preventDefault();var f=a(this);if(c.hasClickHandler(f)){return}if(!c.multiState){d.find("li a."+c.activeClass).removeClass("active");f.addClass("active")}else{f.toggleClass("active")}});if(!a.isBlank(c.defaultSelector)){d.find(c.defaultSelector).addClass(c.activeClass)}})};a.fn.pillButtons.defaults={activeClass:"active",defaultSelector:"li:first-child a",hasClickHandler:function(){return false},multiState:false}})(jQuery);(function(e){var b={calendar:{name:"calendar",domId:"calendarRenderType",initFunction:"socrataCalendar",javascripts:[{assets:"shared-calendar"}],stylesheets:[{assets:"display-calendar"},"/stylesheets/fullcalendar.css",{assets:"rich-render-bundle"}],scrollsInline:false},chart:{name:"chart",domId:"chartRenderType",initFunction:"socrataChart",javascripts:[{assets:"shared-chart"}],stylesheets:["/stylesheets/chart-screen.css",{assets:"rich-render-bundle"},{assets:"display-chart"}],scrollsInline:true,translations:["controls.charts","controls.common.visualization"]},form:{name:"form",domId:"staticRenderType",initFunction:function(){},scrollsInline:false},map:{name:"map",domId:"mapRenderType",initFunction:"socrataMap",javascripts:["https://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3",false,{assets:"shared-map"}],stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"display-map"},{assets:"rich-render-bundle"}],scrollsInline:true,translations:["controls.map","controls.common.visualization"]},geoRows:{name:"geoRows",domId:"mapRenderType",initFunction:"socrataMap",javascripts:["https://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3",false,{assets:"shared-map"}],stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"display-map"},{assets:"rich-render-bundle"}],scrollsInline:true,translations:["controls.map","controls.common.visualization"]},fatrow:{name:"fatrow",domId:"fatRowRenderType",initFunction:function(g,h){g.fatrowRenderType(e.extend({view:h.view,columnDeleteEnabled:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.REMOVE_COLUMN),columnPropertiesEnabled:h.editEnabled},h.common,h.fatrow))},javascripts:[{assets:"shared-richRenderers"}],templates:["fatrow","fatrow_header"],translations:["screens.ds.column_tip","controls.grid"],reset:function(){this.$dom.children(".renderContent").removeData().children(".columnHeaders, .rowList").empty().end().children(".templateRow").removeData().empty()},stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"rich-render-bundle"}],scrollsInline:false},page:{name:"page",domId:"pageRenderType",initFunction:"pageRenderType",javascripts:[{assets:"shared-richRenderers"}],templates:["page_render_type"],reset:function(){this.$dom.children(".renderContent").removeData().children(".content").empty().removeData().end().children(".navigation").removeData()},stylesheets:[{assets:"render-images-bundle",hasImages:true},{assets:"rich-render-bundle"}],scrollsInline:false},table:{name:"table",domId:"gridRenderType",javascripts:[{assets:"shared-table-render"}],stylesheets:[{assets:"grid",hasImages:true},{assets:"render-images-bundle",hasImages:true}],initFunction:function(g,h){g.datasetGrid(e.extend({view:h.view,columnDeleteEnabled:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.REMOVE_COLUMN),columnPropertiesEnabled:h.columnEditEnabled,columnNameEdit:h.columnEditEnabled&&(h.view.isDefault()||h.view.type=="grouped")&&h.view.hasRight(blist.rights.view.UPDATE_COLUMN),showAddColumns:h.editEnabled&&h.view.type=="blist"&&h.view.hasRight(blist.rights.view.ADD_COLUMN),editEnabled:h.editEnabled},h.common,h.table))},reset:function(){this.$dom.children(".renderContent").empty().removeData().removeClass("blist-table")},scrollsInline:true,translations:["controls.grid","screens.ds"]},href:{name:"href",domId:"staticRenderType",stylesheets:[{assets:"dataset-about-minimal",hasSpecialSelectors:true},{assets:"display-blob"}],javascripts:[{assets:"shared-blob"}],scrollsInline:false,initFunction:function(g,h){g.blobDataset(e.extend({view:h.view,editEnabled:h.editEnabled},h.common,h.href))}},blob:{name:"blob",domId:"staticRenderType",stylesheets:[{assets:"dataset-about-minimal",hasSpecialSelectors:true},{assets:"display-blob"}],javascripts:[{assets:"shared-blob"}],scrollsInline:false,initFunction:function(g,h){g.blobDataset(e.extend({view:h.view,editEnabled:h.editEnabled},h.common,h.blob))}}};b.api=b.table;b.assetinventory=b.table;e.fn.renderTypeManager=function(g){var h=e(this[0]).data("renderTypeManager");if(!h){h=new d(g,this[0])}return h};var d=function(g,h){this.settings=e.extend({},d.defaults,g);this.currentDom=h;this.init()};e.extend(d,{defaults:{defaultTypes:null,handleResize:true,view:null},prototype:{init:function(){var k=this;var j=k.$dom();j.data("renderTypeManager",k);j.find(".renderTypeNode").addClass("hide");k.typeInfos={};k.visibleTypes={};k.settings.view.bind("valid",function(){if(!_.isEmpty(k.visibleTypes)){_.each(k.visibleTypes,function(l,m){if(l){k.show(m)}})}}).bind("displaytype_change",function(){var l=e.extend({},k.settings.view.metadata.renderTypeConfig.visible);_.each(_.keys(k.visibleTypes),function(m){if(!l[m]){k.hide(m)}});_.each(l,function(m,n){if(m){k.show(n)}})});j.delegate(".renderTypeNode > .divider .close","click",function(l){l.preventDefault();k.hide(e(this).closest(".renderTypeNode").data("rendertype"))});k._loadedTypes={};var g=k.settings.defaultTypes||k.settings.view.metadata.renderTypeConfig.visible;if(_.isString(g)){var h={};h[g]=true;g=h}_.each(g,function(l,m){if(l){k.show(m)}});if(k.settings.handleResize){e(window).bind("resize",function(n,m,l){if(m==this){return}_.each(k.visibleTypes,function(o,p){k.$domForType(p).trigger("resize",[this,l])})})}},$dom:function(){if(!this._$dom){this._$dom=e(this.currentDom)}return this._$dom},setTypeConfig:function(h,g){var k=this;var j=a(k,h);k.settings[j.name]=k.settings[j.name]||{};e.extend(k.settings[j.name],g)},show:function(j,h){var l=this;var k=a(l,j);l.visibleTypes[j]=true;if(!l.settings.view.valid){return}var g=e.deepGetStringField(l.settings.view,"metadata.renderTypeConfig.active."+j+".id");if(g&&k.activeView&&k.activeView.id!=g){k._assetsLoaded=true;delete k._initialized;if(_.isFunction(k.reset)){k.reset()}}f(l,j,h);if(k.$dom.is(":visible")){return}k.$dom.removeClass("hide").children(".renderContent").trigger("show");l.$dom().toggleClass("multipleRenderers",l.$dom().children(".renderTypeNode:visible").length>1);l.$dom().trigger("render_type_shown",[j]);e(window).resize()},hide:function(g){var j=this;var h=a(j,g);delete j.visibleTypes[g];if(!h.$dom.is(":visible")){return}h.$dom.addClass("hide").children(".renderContent").trigger("hide");j.$dom().toggleClass("multipleRenderers",j.$dom().children(".renderTypeNode:visible").length>1);j.$dom().trigger("render_type_hidden",[g]);e(window).resize()},toggle:function(g){var h=this;if(h.visibleTypes[g]){h.hide(g)}else{h.show(g)}},$domForType:function(g){var h=this;c(h,g);return a(h,g).$dom.children(".renderContent")}}});var a=function(j,g){if(_.isUndefined(j.typeInfos[g])){var h=e.extend(true,{},b[g]);if(e.isBlank(h)){throw"missing type info for "+g}j.typeInfos[g]=h}return j.typeInfos[g]};var c=function(q,o){var r=a(q,o);var s=r.$dom;if(e.isBlank(s)){s=q.$dom().find("."+r.domId);if(s.length<1){var k=q.settings.view.metadata.availableDisplayTypes;var g;var j=_.indexOf(k,o);var p=q.$dom().children(".renderTypeNode");if(j<0){g=p.eq(0)}for(var l=j+1;l<k.length&&e.isBlank(g);l++){var m=p.filter("[data-renderType="+k[l]+"]");if(m.length>0){g=m}}var n=e.tag2({_:"div",className:["fullHeight","renderTypeNode","hide",r.domId],"data-renderType":o});if(e.isBlank(g)||g.length<1){q.$dom().append(n)}else{g.before(n)}s=q.$dom().find("."+r.domId)}if(s.children(".renderContent").length<1){var h=e.tag({tagName:"div","class":["renderContent","fullHeight"]});h.append(s.children());s.append(h)}if(s.children(".divider").length<1){s.prepend(e.tag({tagName:"div","class":"divider",contents:{tagName:"a",href:"#Hide","class":"close",title:"Hide section",contents:{tagName:"span","class":"icon"}}}))}r.$dom=s}};var f=function(n,l,k){var m=a(n,l);if(m._initialized){return}c(n,l);var h=m.$dom;var j=h.find(".renderContent");var g=function(){n.settings.view.getViewForDisplay(l,function(o){m.activeView=o;if(_.isFunction(e.fn[m.initFunction])){j[m.initFunction](e.extend({view:o,editEnabled:n.settings.editEnabled},n.settings.common,n.settings[m.name],k))}else{if(_.isFunction(m.initFunction)){m.initFunction(j,e.extend({},n.settings,{view:o}))}}j.trigger("show")})};if(!m.scrollsInline){j.removeClass("scrollContent")}else{j.addClass("scrollContent")}if(m._assetsLoaded){g()}else{blist.util.assetLoading.loadAssets(m,g,function(){j.trigger("show");e(window).trigger("resize",[null,true])})}m._initialized=true}})(jQuery);var datasetPageNS=blist.namespace.fetch("blist.datasetPage");blist.datasetPage.adjustSize=function(){$(window).resize()};blist.datasetPage.clearTempView=function(){$("#sidebarOptions a.alert").removeClass("alert");$("body, #datasetBar").removeClass("unsavedView minorChange");datasetPageNS.sidebar.updateEnabledSubPanes();$("#renderTypeOptions li a:visible").each(function(){var b=$(this);var a=$.urlParam(b.attr("href"),"defaultRender");if(a=="richList"){a="fatrow"}if(!_.include(blist.dataset.metadata.availableDisplayTypes,a)){b.addClass("hide")}})};blist.datasetPage.setTempView=function(){if(blist.dataset.minorChange&&!blist.dataset.hasRight(blist.rights.view.UPDATE_VIEW)){return}$("body, #datasetBar").addClass("unsavedView").toggleClass("minorChange",blist.dataset.minorChange);$("#sidebarOptions .tabFilter a").addClass("alert");datasetPageNS.sidebar.updateEnabledSubPanes()};blist.datasetPage.updateValidView=function(){$(".invalidView").removeClass("invalidView");datasetPageNS.sidebar.updateEnabledSubPanes()};(function(a){if(!blist.dataset){blist.dataset={}}if(!blist.dataset.valid){a("body").addClass("invalidView")}})(jQuery);$(function(){$(".aboutLoad .aboutDataset").appendTo("#js-appended-templates");$(".aboutLoad").remove();$("#siteFooter, #site-chrome-footer").addClass("clearfix").appendTo(".siteInnerWrapper");$(".outerContainer").fullScreen();if($("#renderTypeOptions").length>0){$("#renderTypeOptions").pillButtons({multiState:true,defaultSelector:null,hasClickHandler:function(p){return p.data("popupSelect-tip")}});$.live("#renderTypeOptions a","click",function(r){r.preventDefault();var q=$(this);var p=$.urlParam(q.attr("href"),"defaultRender");if(p=="richList"){p="fatrow"}if(q.data("popupSelect-tip")){return}var s=function(u){if(blist.dataset.metadata.renderTypeConfig.visible[p]!=datasetPageNS.rtManager.visibleTypes[p]){datasetPageNS.rtManager.toggle(p)}else{if(u){if(u!=blist.dataset.id){var t=$.extend({},blist.dataset.metadata);$.deepSet(t,u,"renderTypeConfig","active",p,"id");blist.dataset.update({metadata:t})}if(datasetPageNS.rtManager.visibleTypes[p]){datasetPageNS.rtManager.hide(p)}datasetPageNS.rtManager.show(p)}else{blist.dataset.toggleRenderType(p)}}};if(q.data("noChildren")){s();return}blist.dataset.getChildOptionsForType(p,function(t){if(t.length>1){q.toggleClass("active",blist.dataset.metadata.renderTypeConfig.visible[p]).popupSelect({canDeselect:true,choices:t,isSelected:function(v){var u=$.deepGetStringField(blist.dataset.metadata,"renderTypeConfig.active."+p+".id");return $.deepGetStringField(blist.dataset.metadata,"renderTypeConfig.visible."+p)&&(v.id==u||$.isBlank(u)&&v.id==blist.dataset.id)},prompt:"Select a layer:",renderer:function(u){return u.name},selectCallback:function(u,v){if(v){s(u.id)}else{s()}return v}}).data("popupSelect-tip").show();q.data("popupSelect-width",$(window).width());$(window).resize(function(){var u=$(window).width();q.data("popupSelect-tip").adjustPosition({left:u-q.data("popupSelect-width")});q.data("popupSelect-width",u)})}else{q.data("noChildren",true);s()}})})}blist.$container.bind("render_type_shown",function(r,q){$("body").addClass(q+"-renderType");if($("#renderTypeOptions").length>0){var p=$("#renderTypeOptions li ."+q);if(p.length<1){var s=$("#renderTypeOptions li .template").parent().clone();p=s.find("a").removeClass("template hide").addClass(q);p.attr("title",p.attr("title").replace("template",q));p.attr("href",$.urlParam(p.attr("href"),"defaultRender",q));$("#renderTypeOptions").prepend(s)}p.addClass("active").removeClass("hide")}if(!blist.dataset.metadata.renderTypeConfig.visible[q]){blist.dataset.showRenderType(q)}});blist.$container.bind("render_type_hidden",function(r,q){$("body").removeClass(q+"-renderType");if($("#renderTypeOptions").length>0){var p=$("#renderTypeOptions li ."+q);if(p.length>0){p.removeClass("active")}}if(blist.dataset.metadata.renderTypeConfig.visible[q]){blist.dataset.hideRenderType(q)}});var a=$.urlParam(window.location.href,"defaultRender");if(a=="richList"){a="fatrow"}if(!$.isBlank(blist.initialRowId)){a="page"}var g=false;if(blist.dataset.displayFormat.viewDefinitions){if(!blist.dataset.childViews){blist.dataset.childViews=_.pluck(blist.dataset.displayFormat.viewDefinitions,"uid")}var n=blist.dataset.displayFormat.viewDefinitions[0].uid;if(n!="self"){_.each(blist.dataset.metadata.renderTypeConfig.visible||[],function(p,q){if(p&&_.include(["table","page","fatrow"],q)&&!$.subKeyDefined(blist.dataset.metadata,"renderTypeConfig.active."+q+".id")){$.deepSet(blist.dataset.metadata,n,"renderTypeConfig","active",q,"id")}});if($.subKeyDefined(blist.dataset,"metadata.query."+n+".filterCondition")&&(blist.dataset.metadata.query[n].filterCondition.children||[]).length>0){g=true}}}datasetPageNS.rtManager=blist.$container.renderTypeManager({view:blist.dataset,defaultTypes:a,editEnabled:!blist.dataset.isImmutable()&&(blist.dataset.isUnpublished()||blist.dataset.viewType!="tabular"),columnEditEnabled:!blist.dataset.isImmutable(),common:{editColumnCallback:function(p){datasetPageNS.sidebar.hide();datasetPageNS.sidebar.show("columnProperties",p)},showRowHandle:true,manualResize:true},table:{addColumnCallback:function(p){datasetPageNS.sidebar.show("edit.addColumn",{parentId:p})},cellCommentsCallback:blist.sidebarHidden.feed.cellFeed?null:function(q,p){datasetPageNS.sidebar.show("cellFeed",{rowId:q,tableColumnId:p},true)}},page:{defaultRowId:blist.initialRowId}});var l=datasetPageNS.rtManager.$domForType("table");$(document).bind(blist.events.DISPLAY_ROW,function(t,s,v){var p;if(typeof s=="string"&&s.indexOf("/")>-1){var r=s.split("/");p=r[0];s=r[1]}var q=$.deepGet(blist.dataset.metadata.renderTypeConfig,"active","page","id");var u=q==p||$.isBlank(q)&&p==blist.dataset.id;if(!v||(blist.dataset.metadata.renderTypeConfig.visible.page&&!u)){datasetPageNS.rtManager.setTypeConfig("page",{defaultRowId:s});blist.dataset.showRenderType("page",p,!u)}});datasetPageNS.sidebar=$("#gridSidebar").gridSidebar({position:blist.sidebarPosition||"right",waitOnDataset:blist.dataset.type!="form"&&blist.dataset.valid,onSidebarShown:function(q){var p=$("#sidebarOptions");p.find("li").removeClass("active");var r=$("#sidebarOptions").find("a[data-paneName="+q+"]");if(r.length>0){p.css("background-color",r.css("background-color"));r.closest("li").addClass("active")}else{p.css("background-color","transparent").find("li").removeClass("active")}},onSidebarClosed:function(){$("#sidebarOptions").css("background-color","transparent").find("li").removeClass("active")},columnChoosers:blist.$container.renderTypeManager().$domForType("table"),renderTypeManager:blist.$container.renderTypeManager(),resizeNeighbor:blist.$container,setSidebarTop:false,view:blist.dataset});$("#sidebarOptions").find("a[data-paneName]").each(function(){var p=$(this);var q=p.attr("data-paneName");if(datasetPageNS.sidebar.hasPane(q)){p.click(function(r){r.preventDefault();datasetPageNS.sidebar.show(q);$.analytics&&$.analytics.trackEvent("dataset page (v4-chrome)",q+" pane opened",blist.dataset.id)})}else{p.closest("li").hide()}});datasetPageNS.$feedTab=$("#sidebarOptions").find("a.feed");if(datasetPageNS.$feedTab.is(":visible")){datasetPageNS.$feedTab.contentIndicator().setText(blist.dataset.numberOfComments||"")}var c=function(p){return(p.children||[]).length>0};if(g||($.subKeyDefined(blist.dataset,"query.filterCondition")&&c(blist.dataset.query.filterCondition))||($.subKeyDefined(blist.dataset,"metadata.filterCondition")&&c(blist.dataset.metadata.filterCondition))){datasetPageNS.sidebar.setDefault("filter.unifiedFilter")}var o=$.urlParam(window.location.href,"pane")||blist.defaultPane;if(_.isString(o)&&!$.isBlank(o)){datasetPageNS.sidebar.show(o)}else{if(blist.dataset.visibleColumns&&blist.dataset.visibleColumns.length==0&&!blist.sidebarHidden.edit.addColumn){datasetPageNS.sidebar.show("edit.addColumn")}}var j=function(){datasetPageNS.sidebar.updateEnabledSubPanes()};blist.dataset.bind("columns_changed",j).bind("displaytype_change",j);var h=$("#searchForm .clearSearch");var k=$("#searchForm");k.submit(function(r){r.preventDefault();var q=$(r.currentTarget).find(":input").val();var p=$.extend(true,{},blist.dataset.metadata);p.jsonQuery.search=q;blist.dataset.update({metadata:p});if(!q||q===""){h.hide()}else{h.show()}});var f=function(){k.find(":input").focus().val(blist.dataset.metadata.jsonQuery.search).blur();h.toggle(!$.isBlank(blist.dataset.metadata.jsonQuery.search))};h.click(function(q){q.preventDefault();var p=$.extend(true,{},blist.dataset.metadata);delete p.jsonQuery.search;blist.dataset.update({metadata:p});f()}).hide();blist.dataset.bind("clear_temporary",function(){f()});if(!$.isBlank(blist.dataset.metadata.jsonQuery.search)){k.find(":input").focus().val(blist.dataset.metadata.jsonQuery.search).blur();h.show()}$("#description").expander({contentSelector:"div.descriptionContent",expanderCollapsedClass:"rightArrow",expandSelector:".descriptionExpander",moveExpandTrigger:true,resizeFinishCallback:datasetPageNS.adjustSize});var b=$("#datasetIcon");b.socrataTip(b.text());$(".fullscreenButton").click(function(p){p.preventDefault();$("#siteHeader, #site-chrome-header, #siteFooter, #site-chrome-header").animate({opacity:"toggle"},datasetPageNS.adjustSize);datasetPageNS.adjustSize();$(this).toggleClass("maximize").toggleClass("minimize")});$("#shareOptions .email").click(function(p){p.preventDefault();if(_.isFunction(blist.dialog.sharing)){blist.dialog.sharing(p)}});$("#shareOptions .subscribe").click(function(p){p.preventDefault();if(_.isFunction(blist.dialog.subscribe)){blist.dialog.subscribe()}});$("#editOptions .undo").click(function(p){p.preventDefault();if(!$(p.target).is(".disabled")){l.blistModel().undo()}});$("#editOptions .redo").click(function(p){p.preventDefault();if(!$(p.target).is(".disabled")){l.blistModel().redo()}});l.bind("undo_redo_change",function(){var p=l.blistModel();$("#editOptions .undo").toggleClass("disabled",!p.canUndo());$("#editOptions .redo").toggleClass("disabled",!p.canRedo())});if(!$.isBlank(l.blistModel)){var e=l.blistModel();$("#editOptions .undo").toggleClass("disabled",!e.canUndo());$("#editOptions .redo").toggleClass("disabled",!e.canRedo())}$("#formatOptions select").uniform();$("#formatOptions").formatOptions({gridSelector:l});blist.dataset.bind("set_temporary",datasetPageNS.setTempView);blist.dataset.bind("clear_temporary",datasetPageNS.clearTempView);blist.datasetControls.unsavedViewPrompt();$(".unsavedLine a.save").click(function(q){q.preventDefault();var p=$(this);if(p.is(".disabled")){return}p.data("saveText",p.text());p.text(p.attr("data-savingText"));p.addClass("disabled");blist.dataset.save(function(){p.text(p.data("saveText"));p.removeClass("disabled")})});$(".unsavedLine a.saveAs").click(function(p){p.preventDefault();blist.datasetControls.showSaveViewDialog()});$(".unsavedLine a.revert, .basedOnTemp .revertLink").click(function(p){p.preventDefault();blist.dataset.reload()});blist.datasetControls.hookUpPublishing($("#infoBox"));blist.$container.bind("attempted_edit",function(q){if(!blist.dataset.isPublished()||!blist.dataset.canEdit()||$.isBlank(blist.currentUserId)){return}var p=function(){$(q.target).socrataTip({content:blist.datasetControls.editPublishedMessage(),showSpike:false,trigger:"now"})};if(!blist.dataset.isDefault()){blist.dataset.getParentDataset(function(r){if(!$.isBlank(r)&&r.canEdit()){p()}})}else{p()}});$.live(".button.editPublished","click",function(p){p.preventDefault();var q=$(this);if(q.hasClass("disabled")){return}if(q.closest(".bt-wrapper").length>0){q.closest(".bt-wrapper").data("socrataTip-$element").socrataTip().hide()}blist.dataset.getUnpublishedDataset(function(r){if(!$.isBlank(r)){r.redirectTo()}else{var s=false;blist.dataset.makeUnpublishedCopy(function(t){if(s){datasetPageNS.sidebar.show("edit");$(".editAlert").find(".editPublished, .doneCopyingMessage").removeClass("hide");$(".editAlert").find(".copyingMessage").addClass("hide")}else{t.redirectTo()}},function(){$(".editAlert").find(".editPublished, .editMessage").addClass("hide");$(".editAlert").find(".copyingMessage").removeClass("hide");s=true},function(){if(s){datasetPageNS.sidebar.show("edit")}$(".editAlert").find(".errorMessage").removeClass("hide");$(".editAlert").find(".copyingMessage, .editPublished, .editMessage").addClass("hide")})}})});if(blist.dataset.isUnpublished()&&$.urlParam(window.location.href,"firstRun")=="true"){$("#infoBox #datasetName").socrataTip({trigger:"now",showSpike:false,closeOnClick:false,content:$.tag({tagName:"div","class":"unpublishedAlert",contents:[{tagName:"p",contents:$.t("screens.ds.show.unpublished_alert")},{tagName:"a","class":["button","close"],contents:"OK"}]})});$.live(".unpublishedAlert .close","click",function(p){p.preventDefault();$("#infoBox #datasetName").socrataTip().destroy()})}blist.dataset.bind("valid",function(){datasetPageNS.updateValidView()});$(".viewError").text(blist.dataset.invalidMessage());var d=$.gridSidebar.paneForDisplayType[blist.dataset.metadata.availableDisplayTypes[0]]||$.gridSidebar.paneForDisplayType[blist.dataset.type];if($.isBlank(d)||!datasetPageNS.sidebar.isPaneEnabled(d)){$(".invalidActions .editView").hide()}else{$(".invalidActions .editView").click(function(p){p.preventDefault();datasetPageNS.sidebar.show(d)})}$(".invalidActions .removeView").click(function(p){p.preventDefault();if(!confirm($.t("screens.ds.show.remove_confirm"))){return}blist.dataset.remove(function(){blist.dataset.getParentView(function(q){if(!$.isBlank(q)){q.redirectTo()}else{window.location="/datasets"}})})});$.fn.shortenActionBar=function(A){var w=$(this);var y=function(){return _.uniq(w.find("#sidebarOptions li:visible").map(function(){return $(this).position().top})).length>1};var r=w.find("a.other").parent(),v=$("#moreActionBarButtons");if(!v.exists()){v=$('<ul class="hide" id="moreActionBarButtons">');w.append(v);r.click(function(B){B.preventDefault();v.toggleClass("hide")})}var z=A.priorityForTruncate.slice(),x=[];var q=function(){r.addClass("hide");var B;if(z.length>0){B=w.find("a."+z.shift()).parent()}else{B=w.find("a:visible:last").parent()}x.push(B.index());v.append(B);r.removeClass("hide")};var t=function(){var C=x.pop(),B=v.children(":last"),D=B.find("a").attr("class");if(_.include(A.priorityForTruncate,D)){z.unshift(D)}B.insertBefore($("#sidebarOptions li:eq("+C+")"));if(!v.children().exists()){r.addClass("hide");v.addClass("hide")}};var p=Infinity,u=false,s=$("#description").position().left-$("#sidebarOptions").padding().left;$(window).resize(_.debounce(function(){if(u){return}u=true;var B=$(window).width();if(B<$(".siteOuterWrapper").width()-70){p=B;u=false;return}var C=function(){if(blist.sidebarPosition=="left"){return B*0.9}var D=$("#description, #description .collapsed").width();if(D){return B-(D+s)}else{return B*0.85}};$(".sidebarOptionsContainer").width(C());if(p<B){while(!y()&&v.children().exists()){t()}if(y()){q()}}else{if(p>B){while(y()){q()}}}p=B;u=false},500))};$("#actionBar").shortenActionBar({priorityForTruncate:["feed","embed","export"]});if($.device.ipad){$(document).bind("touchmove",function(p){p.originalEvent.preventDefault()})}blist.dataset.bind("dataset_last_modified",function(q){var r=$("#datasetName + .outOfDate");var p=$.t("screens.ds.bar.up_to_date",{current:q.lastModified});if(!r[0]){$("#datasetName").after($("<span>").addClass("outOfDate").text(p));r=$("#datasetName + .outOfDate")}if(blist.dataset._dataOutOfDate==="true"){p=$.t("screens.ds.bar.out_of_date",{age:q.age})}r.text(p)});_.defer(function(){blist.dataset.registerOpening(document.referrer);if(!_.include(["blist","blob","href","metadata_table"],blist.dataset.type)&&!blist.dataset.isGeoDataset()){blist.dataset.getParentView(function(p){if(!$.isBlank(p)){$(".basedOnParent").addClass("hasParent").find(".parentName").attr("href",p.url).text(p.name)}else{$(".basedOnParent").addClass("hasParent").find(".parentName").attr("href",null).text($.t("screens.ds.bar.based_on_private_view"))}})}$.analytics&&$.analytics.trackEvent("dataset page (v4-chrome)","page loaded",blist.dataset.id)});var m={canUpdateMetadata:function(){if(blist.feature_flags.create_v2_data_lens){return !_.isNull(blist.currentUser)&&!_.isUndefined(blist.currentUser)&&blist.currentUser.hasOwnProperty("rights")&&blist.currentUser.rights.length>0}else{return !_.isNull(blist.currentUser)&&!_.isUndefined(blist.currentUser)&&blist.currentUser.hasOwnProperty("rights")&&blist.currentUser.rights.indexOf(blist.rights.user.EDIT_OTHERS_DATASETS)>-1}},getNewUXLinkParams:function(){var p=!_.isUndefined(blist.dataset.query);var q={canUpdateMetadata:m.canUpdateMetadata(),hasGroupBys:p&&!_.isUndefined(blist.dataset.query.groupBys),dataset:blist.dataset,dataLensState:blist.feature_flags.data_lens_transition_state};if($.cookies.get("newUxCollapsed")){q.collapsed=true}return q},getNewUXLinkHref:function(r){var q=null;var p=blist.locale===blist.defaultLocale?"":"/"+blist.locale;if(r.dataset.newBackend&&r.dataset.displayType!=="map"){if(r.canUpdateMetadata&&!r.hasGroupBys){q=p+"/view/bootstrap/{0}".format(r.dataset.id);m.createNewUXLink(r,q)}}else{r.dataset.getNewBackendMetadata().done(function(t){if(!t){return}if(t.defaultPage){var s=t.defaultPage;$.get("/metadata/v1/page/{0}.json".format(s),function(u){if(r.canUpdateMetadata||(r.dataLensState==="post_beta"&&u.permissions.isPublic)){q=p+"/view/{0}".format(s);m.createNewUXLink(r,q)}}).fail(function(){if(r.canUpdateMetadata&&!r.hasGroupBys){q=p+"/view/bootstrap/{0}".format(t.id);m.createNewUXLink(r,q)}})}else{if(r.canUpdateMetadata&&!r.hasGroupBys){q=p+"/view/bootstrap/{0}".format(t.id);m.createNewUXLink(r,q)}}})}},createNewUXLink:function(r,q){if(!q||q.length<=0){return}if(typeof _gaSocrata!=="undefined"){_gaSocrata("socrata.send","event","bootstrap-link","show")}var p=$('<div class="new-ux-link icon-cards"><div class="icon-close"/><h3>'+$.t("screens.ds.new_ux_title")+"</h3><p>"+$.t("screens.ds.new_ux_text")+'</p><img class="new-ux-image" src="/images/new-ux-image.png"/><a class="explore-btn">'+$.t("screens.ds.new_ux_button")+"</a>");if(r.collapsed){p.addClass("collapsed")}p.find("a.explore-btn").attr("href",q);p.appendTo("body");p.on("click",function(){var s=$(this);if(s.hasClass("collapsed")){s.removeClass("collapsed");$.cookies.del("newUxCollapsed")}}).on("click",".icon-close",function(s){s.stopPropagation();_.defer(function(){p.addClass("collapsed");$.cookies.set("newUxCollapsed",true)})}).on("click","a",function(){if(typeof _gaSocrata!=="undefined"){_gaSocrata("socrata.send","event","bootstrap-link","click")}var s=$('<div class="overlay"/>');var t=$('<img class="spinner" '+'title="{0}" '.format($.t("screens.ds.new_ux_creating_page"))+'src="/stylesheets/images/common/BrandedSpinner.gif" />');p.addClass("loading").append(t).after(s);_.defer(function(){s.add(t).css("opacity",1)})})}};blist.configuration.onCurrentUserComplete(function(){if(blist&&blist.feature_flags&&blist.feature_flags.data_lens_transition_state!=="pre_beta"&&!blist.feature_flags.use_ephemeral_bootstrap){var p=m.getNewUXLinkParams();m.getNewUXLinkHref(p)}})});